const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/quill.Bk4jDS0q.js","../chunks/core.CG__ofcG.js"])))=>i.map(i=>d[i]);
var Pt=Object.defineProperty;var Ht=(e,t,n)=>t in e?Pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var N=(e,t,n)=>Ht(e,typeof t!="symbol"?t+"":t,n);import{s as Pe,n as ve,r as st,e as Ie,f as rt,c as se,a as he,o as lt,d as Q,z as At,A as ye,B as Rt}from"../chunks/scheduler.CNrmCPBX.js";import{S as He,i as Ae,e as A,b as qt,c as R,d as U,f as Vt,g as H,w as S,A as z,j as ne,k as I,x as ee,G as $e,l as Bt,s as W,v as ge,h as G,z as ot,a as F,o as we,t as K,n as _e,I as Se,C as ze,J as Ot,p as Ee,q as Te,r as Le,u as Ce,K as ke,m as Me}from"../chunks/index.Bx3bS2zy.js";import{e as xe,u as tt,o as nt}from"../chunks/each.BP2nLSrP.js";import{b as j}from"../chunks/paths.OVgVKbrb.js";import{m as pe,a as Tt,t as ce,f as Ut,d as ae,s as it}from"../chunks/firebaseStore.BF3F-D-v.js";import{c as be,s as Ye,S as Nt}from"../chunks/Spinner.DU_sV4I5.js";import{_ as at}from"../chunks/preload-helper.D6kgxu3v.js";import{t as Ft}from"../chunks/themes.BTx5Q4mv.js";function zt(e){let t,n,i,r,a,u;return{c(){t=A("div"),n=A("button"),i=A("span"),r=qt(e[0]),this.h()},l(l){t=R(l,"DIV",{class:!0});var s=U(t);n=R(s,"BUTTON",{class:!0,draggable:!0});var b=U(n);i=R(b,"SPAN",{class:!0});var d=U(i);r=Vt(d,e[0]),d.forEach(H),b.forEach(H),s.forEach(H),this.h()},h(){S(i,"class","title svelte-w1fi59"),S(n,"class","tab svelte-w1fi59"),S(n,"draggable","true"),z(n,"active",e[1]),S(t,"class","tab-container svelte-w1fi59"),z(t,"preventHover",e[2])},m(l,s){ne(l,t,s),I(t,n),I(n,i),I(i,r),a||(u=[ee(n,"mousedown",$e(function(){Ie(e[3])&&e[3].apply(this,arguments)})),ee(n,"touchstart",$e(function(){Ie(e[3])&&e[3].apply(this,arguments)})),ee(n,"dragstart",$e(function(){Ie(e[4])&&e[4].apply(this,arguments)}))],a=!0)},p(l,[s]){e=l,s&1&&Bt(r,e[0]),s&2&&z(n,"active",e[1]),s&4&&z(t,"preventHover",e[2])},i:ve,o:ve,d(l){l&&H(t),a=!1,st(u)}}}function Wt(e,t,n){let{title:i=""}=t,{active:r=!1}=t,{preventHover:a=!1}=t,{onPointerdown:u=s=>{}}=t,{onDragstart:l=s=>{}}=t;return e.$$set=s=>{"title"in s&&n(0,i=s.title),"active"in s&&n(1,r=s.active),"preventHover"in s&&n(2,a=s.preventHover),"onPointerdown"in s&&n(3,u=s.onPointerdown),"onDragstart"in s&&n(4,l=s.onDragstart)},[i,r,a,u,l]}class Lt extends He{constructor(t){super(),Ae(this,t,Wt,zt,Pe,{title:0,active:1,preventHover:2,onPointerdown:3,onDragstart:4})}}const ct=(e,t)=>{const{duration:n=300,easing:i=be,onEnd:r=()=>{},onStep:a=()=>{},css:u}=t;let l;function s(b){if(!e){console.warn("Cannot find element to animate");return}l===void 0&&(l=b);const d=i((b-l)/n),L=1-d;d<1?(e.style.cssText=u(d,L),a(d,L),requestAnimationFrame(s)):(e.style.cssText="",r())}requestAnimationFrame(s)},et=e=>{const{duration:t=300,easing:n=be,onEnd:i=()=>{},onStep:r=()=>{}}=e;let a;function u(l){a===void 0&&(a=l);const s=n((l-a)/t),b=1-s;s<1?(r(s,b),requestAnimationFrame(u)):i()}requestAnimationFrame(u)};function ut(e){let t,n,i=`<span class="button-icon svelte-18u4svq" style="-webkit-mask: url(${j}/images/svg/undo.svg) no-repeat center / contain; mask: url(${j}/images/svg/undo.svg) no-repeat center / contain;"></span>`,r,a,u,l,s,b,d,L;return{c(){t=A("div"),n=A("button"),n.innerHTML=i,r=W(),a=A("input"),u=W(),l=A("input"),this.h()},l(E){t=R(E,"DIV",{class:!0});var v=U(t);n=R(v,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(n)!=="svelte-1b4fip4"&&(n.innerHTML=i),r=G(v),a=R(v,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),u=G(v),l=R(v,"INPUT",{type:!0,class:!0}),v.forEach(H),this.h()},h(){S(n,"class","button svelte-18u4svq"),S(a,"type","range"),S(a,"min","2"),S(a,"max","20"),S(a,"step","2"),S(a,"class","slider svelte-18u4svq"),S(l,"type","color"),S(l,"class","color-picker svelte-18u4svq"),S(t,"class","pencil-tools svelte-18u4svq")},m(E,v){ne(E,t,v),I(t,n),I(t,r),I(t,a),ze(a,e[0]),I(t,u),I(t,l),ze(l,e[1]),b=!0,d||(L=[ee(n,"click",function(){Ie(e[4])&&e[4].apply(this,arguments)}),ee(a,"change",e[8]),ee(a,"input",e[8]),ee(l,"input",e[9])],d=!0)},p(E,v){e=E,v&1&&ze(a,e[0]),v&2&&ze(l,e[1])},i(E){b||(E&&rt(()=>{b&&(s||(s=Se(t,Ye,{duration:200,axis:"x"},!0)),s.run(1))}),b=!0)},o(E){E&&(s||(s=Se(t,Ye,{duration:200,axis:"x"},!1)),s.run(0)),b=!1},d(E){E&&H(t),E&&s&&s.end(),d=!1,st(L)}}}function Gt(e){let t,n,i=`<span class="button-icon svelte-18u4svq" style="-webkit-mask: url(${j}/images/svg/pencil.svg) no-repeat center / contain; mask: url(${j}/images/svg/pencil.svg) no-repeat center / contain;"></span>`,r,a,u,l,s,b=`<span class="button-icon svelte-18u4svq" style="-webkit-mask: url(${j}/images/svg/trash.svg) no-repeat center / contain; mask: url(${j}/images/svg/trash.svg) no-repeat center / contain;"></span>`,d,L,E,v,y,C,P=`<span class="button-icon svelte-18u4svq" style="-webkit-mask: url(${j}/images/svg/user.svg) no-repeat center / contain; mask: url(${j}/images/svg/user.svg) no-repeat center / contain;"></span>`,D,_,q=`<span class="button-icon svelte-18u4svq" style="-webkit-mask: url(${j}/images/svg/maximize.svg) no-repeat center / contain; mask: url(${j}/images/svg/maximize.svg) no-repeat center / contain;"></span>`,m,Y,p,c,h=e[5].activeTool==="pencil"&&ut(e);return{c(){t=A("div"),n=A("button"),n.innerHTML=i,r=W(),h&&h.c(),a=W(),u=A("div"),l=W(),s=A("button"),s.innerHTML=b,d=W(),L=A("button"),E=A("span"),y=W(),C=A("a"),C.innerHTML=P,D=W(),_=A("button"),_.innerHTML=q,this.h()},l(w){t=R(w,"DIV",{class:!0});var k=U(t);n=R(k,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(n)!=="svelte-t1zbc2"&&(n.innerHTML=i),r=G(k),h&&h.l(k),a=G(k),u=R(k,"DIV",{class:!0}),U(u).forEach(H),l=G(k),s=R(k,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(s)!=="svelte-cbr57k"&&(s.innerHTML=b),d=G(k),L=R(k,"BUTTON",{class:!0});var X=U(L);E=R(X,"SPAN",{class:!0,style:!0}),U(E).forEach(H),X.forEach(H),y=G(k),C=R(k,"A",{class:!0,href:!0,"data-svelte-h":!0}),ge(C)!=="svelte-1xuhzhs"&&(C.innerHTML=P),D=G(k),_=R(k,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(_)!=="svelte-siuh87"&&(_.innerHTML=q),k.forEach(H),this.h()},h(){S(n,"class","pencil button svelte-18u4svq"),z(n,"selected",e[5].activeTool==="pencil"),S(u,"class","spacer svelte-18u4svq"),S(s,"class","close button svelte-18u4svq"),S(E,"class","button-icon svelte-18u4svq"),ot(E,"-webkit-mask","url("+j+"/images/svg/refresh.svg) no-repeat center / contain"),ot(E,"mask","url("+j+"/images/svg/refresh.svg) no-repeat center / contain"),S(L,"class","refresh button svelte-18u4svq"),L.disabled=v=e[6].savingStatus==="saving",S(C,"class","button svelte-18u4svq"),S(C,"href",j+"/profile"),S(_,"class","button svelte-18u4svq"),S(t,"class","toolbar-container svelte-18u4svq")},m(w,k){ne(w,t,k),I(t,n),I(t,r),h&&h.m(t,null),I(t,a),I(t,u),I(t,l),I(t,s),I(t,d),I(t,L),I(L,E),I(t,y),I(t,C),I(t,D),I(t,_),Y=!0,p||(c=[ee(n,"click",e[7]),ee(s,"click",function(){Ie(e[3])&&e[3].apply(this,arguments)}),ee(L,"click",function(){Ie(e[2])&&e[2].apply(this,arguments)}),ee(_,"click",e[10])],p=!0)},p(w,[k]){e=w,(!Y||k&32)&&z(n,"selected",e[5].activeTool==="pencil"),e[5].activeTool==="pencil"?h?(h.p(e,k),k&32&&F(h,1)):(h=ut(e),h.c(),F(h,1),h.m(t,a)):h&&(we(),K(h,1,1,()=>{h=null}),_e()),(!Y||k&64&&v!==(v=e[6].savingStatus==="saving"))&&(L.disabled=v)},i(w){Y||(F(h),w&&rt(()=>{Y&&(m||(m=Se(t,Ye,{duration:200},!0)),m.run(1))}),Y=!0)},o(w){K(h),w&&(m||(m=Se(t,Ye,{duration:200},!1)),m.run(0)),Y=!1},d(w){w&&H(t),h&&h.d(),w&&m&&m.end(),p=!1,st(c)}}}function Kt(e,t,n){let i,r;se(e,pe,y=>n(5,i=y)),se(e,Tt,y=>n(6,r=y));let{onRefresh:a=()=>{}}=t,{onClose:u=()=>{}}=t,{drawingStroke:l}=t,{drawingColor:s}=t,{onDrawingUndo:b=()=>{}}=t;const d=()=>{he(pe,i.activeTool=i.activeTool==="pencil"?void 0:"pencil",i)};function L(){l=Ot(this.value),n(0,l)}function E(){s=this.value,n(1,s)}const v=()=>{he(pe,i.toolbarVisible=!1,i),he(pe,i.activeTool=void 0,i)};return e.$$set=y=>{"onRefresh"in y&&n(2,a=y.onRefresh),"onClose"in y&&n(3,u=y.onClose),"drawingStroke"in y&&n(0,l=y.drawingStroke),"drawingColor"in y&&n(1,s=y.drawingColor),"onDrawingUndo"in y&&n(4,b=y.onDrawingUndo)},[l,s,a,u,b,i,r,d,L,E,v]}class jt extends He{constructor(t){super(),Ae(this,t,Kt,Gt,Pe,{onRefresh:2,onClose:3,drawingStroke:0,drawingColor:1,onDrawingUndo:4})}}function dt(e,t,n){const i=e.slice();return i[47]=t[n],i[48]=t,i[49]=n,i}function ft(e,t){let n,i,r,a,u=t[49],l,s,b;function d(...C){return t[20](t[49],...C)}function L(C){t[21](C,t[47])}let E={active:t[12]==t[47],preventHover:t[11],onPointerdown:d,onDragstart:t[18]};t[14][t[47]].title!==void 0&&(E.title=t[14][t[47]].title),i=new Lt({props:E}),Q.push(()=>ke(i,"title",L));const v=()=>t[22](n,u),y=()=>t[22](null,u);return{key:e,first:null,c(){n=A("div"),Ee(i.$$.fragment),a=W(),this.h()},l(C){n=R(C,"DIV",{class:!0});var P=U(n);Te(i.$$.fragment,P),a=G(P),P.forEach(H),this.h()},h(){S(n,"class","tab-container svelte-6u8cf7"),z(n,"placeholder",t[13]==t[47]),this.first=n},m(C,P){ne(C,n,P),Le(i,n,null),I(n,a),v(),l=!0,s||(b=At(t[17].call(null,n)),s=!0)},p(C,P){t=C;const D={};P[0]&4112&&(D.active=t[12]==t[47]),P[0]&2048&&(D.preventHover=t[11]),P[0]&16&&(D.onPointerdown=d),!r&&P[0]&16400&&(r=!0,D.title=t[14][t[47]].title,ye(()=>r=!1)),i.$set(D),u!==t[49]&&(y(),u=t[49],v()),(!l||P[0]&8208)&&z(n,"placeholder",t[13]==t[47])},i(C){l||(F(i.$$.fragment,C),l=!0)},o(C){K(i.$$.fragment,C),l=!1},d(C){C&&H(n),Ce(i),y(),s=!1,b()}}}function gt(e){let t,n=`<span class="button-icon svelte-6u8cf7" style="-webkit-mask: url(${j}/images/svg/gear.svg) no-repeat center / contain; mask: url(${j}/images/svg/gear.svg) no-repeat center / contain;"></span>`,i,r,a,u;return{c(){t=A("button"),t.innerHTML=n,this.h()},l(l){t=R(l,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(t)!=="svelte-1wioe5y"&&(t.innerHTML=n),this.h()},h(){S(t,"class","button svelte-6u8cf7")},m(l,s){ne(l,t,s),r=!0,a||(u=ee(t,"click",e[24]),a=!0)},p:ve,i(l){r||(l&&rt(()=>{r&&(i||(i=Se(t,Ye,{duration:200,axis:"x"},!0)),i.run(1))}),r=!0)},o(l){l&&(i||(i=Se(t,Ye,{duration:200,axis:"x"},!1)),i.run(0)),r=!1},d(l){l&&H(t),l&&i&&i.end(),a=!1,u()}}}function ht(e){let t,n,i,r;function a(s){e[28](s)}function u(s){e[29](s)}let l={onDrawingUndo:e[26],onRefresh:Ut.loadFromFirestore,onClose:e[27]};return e[1]!==void 0&&(l.drawingColor=e[1]),e[0]!==void 0&&(l.drawingStroke=e[0]),t=new jt({props:l}),Q.push(()=>ke(t,"drawingColor",a)),Q.push(()=>ke(t,"drawingStroke",u)),{c(){Ee(t.$$.fragment)},l(s){Te(t.$$.fragment,s)},m(s,b){Le(t,s,b),r=!0},p(s,b){const d={};b[0]&4100&&(d.onDrawingUndo=s[26]),b[0]&4096&&(d.onClose=s[27]),!n&&b[0]&2&&(n=!0,d.drawingColor=s[1],ye(()=>n=!1)),!i&&b[0]&1&&(i=!0,d.drawingStroke=s[0],ye(()=>i=!1)),t.$set(d)},i(s){r||(F(t.$$.fragment,s),r=!0)},o(s){K(t.$$.fragment,s),r=!1},d(s){Ce(t,s)}}}function Qt(e){let t,n,i,r=[],a=new Map,u,l,s,b=`<span class="button-icon svelte-6u8cf7" style="-webkit-mask: url(${j}/images/svg/plus.svg) no-repeat center / contain; mask: url(${j}/images/svg/plus.svg) no-repeat center / contain;"></span>`,d,L,E,v,y,C,P,D,_,q,m,Y=xe(e[4].order);const p=w=>w[47];for(let w=0;w<Y.length;w+=1){let k=dt(e,Y,w),X=p(k);a.set(X,r[w]=ft(X,k))}let c=!e[4].toolbarVisible&&e[4].order.length>0&&gt(e);y=new Lt({props:{title:e[7],active:!e[9],preventHover:!0}});let h=e[4].toolbarVisible&&e[4].order.length>0&&ht(e);return{c(){t=A("div"),n=A("div"),i=A("div");for(let w=0;w<r.length;w+=1)r[w].c();u=W(),l=A("div"),s=A("button"),s.innerHTML=b,d=W(),L=A("div"),c&&c.c(),E=W(),v=A("div"),Ee(y.$$.fragment),C=W(),P=A("div"),D=W(),h&&h.c(),this.h()},l(w){t=R(w,"DIV",{class:!0});var k=U(t);n=R(k,"DIV",{class:!0});var X=U(n);i=R(X,"DIV",{class:!0});var te=U(i);for(let ue=0;ue<r.length;ue+=1)r[ue].l(te);te.forEach(H),u=G(X),l=R(X,"DIV",{class:!0});var Z=U(l);s=R(Z,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(s)!=="svelte-g0ls06"&&(s.innerHTML=b),Z.forEach(H),d=G(X),L=R(X,"DIV",{class:!0});var $=U(L);c&&c.l($),$.forEach(H),E=G(X),v=R(X,"DIV",{class:!0});var le=U(v);Te(y.$$.fragment,le),le.forEach(H),X.forEach(H),C=G(k),P=R(k,"DIV",{class:!0}),U(P).forEach(H),D=G(k),h&&h.l(k),k.forEach(H),this.h()},h(){S(i,"class","tabs svelte-6u8cf7"),S(s,"class","button svelte-6u8cf7"),S(l,"class","new-tab-container svelte-6u8cf7"),S(L,"class","buttons-container svelte-6u8cf7"),S(v,"class","clone svelte-6u8cf7"),z(v,"dragging",e[3]),S(n,"class","tabbar svelte-6u8cf7"),S(P,"class","divider svelte-6u8cf7"),S(t,"class","svelte-6u8cf7")},m(w,k){ne(w,t,k),I(t,n),I(n,i);for(let X=0;X<r.length;X+=1)r[X]&&r[X].m(i,null);e[23](i),I(n,u),I(n,l),I(l,s),I(n,d),I(n,L),c&&c.m(L,null),I(n,E),I(n,v),Le(y,v,null),e[25](v),I(t,C),I(t,P),I(t,D),h&&h.m(t,null),e[30](t),_=!0,q||(m=ee(s,"click",e[15]),q=!0)},p(w,k){k[0]&817232&&(Y=xe(w[4].order),we(),r=tt(r,k,p,1,w,Y,a,i,nt,ft,null,dt),_e()),!w[4].toolbarVisible&&w[4].order.length>0?c?(c.p(w,k),k[0]&16&&F(c,1)):(c=gt(w),c.c(),F(c,1),c.m(L,null)):c&&(we(),K(c,1,1,()=>{c=null}),_e());const X={};k[0]&128&&(X.title=w[7]),k[0]&512&&(X.active=!w[9]),y.$set(X),(!_||k[0]&8)&&z(v,"dragging",w[3]),w[4].toolbarVisible&&w[4].order.length>0?h?(h.p(w,k),k[0]&16&&F(h,1)):(h=ht(w),h.c(),F(h,1),h.m(t,null)):h&&(we(),K(h,1,1,()=>{h=null}),_e())},i(w){if(!_){for(let k=0;k<Y.length;k+=1)F(r[k]);F(c),F(y.$$.fragment,w),F(h),_=!0}},o(w){for(let k=0;k<r.length;k+=1)K(r[k]);K(c),K(y.$$.fragment,w),K(h),_=!1},d(w){w&&H(t);for(let k=0;k<r.length;k+=1)r[k].d();e[23](null),c&&c.d(),Ce(y),e[25](null),h&&h.d(),e[30](null),q=!1,m()}}}const Jt=12,We=200,Oe=32,Ue=200,Zt=1600,vt=.3;function $t(e,t,n){let i,r,a,u;se(e,pe,f=>n(4,a=f)),se(e,ce,f=>n(14,u=f));let{onDrawingUndo:l=f=>{}}=t,{drawingStroke:s}=t,{drawingColor:b}=t,d,L=[],E=0,v=null,y=-1,C="",P,D,_,q=!1,m=!1,Y=0,p=0,c,h=!1;const w=(f,x=300)=>{let B;return(...O)=>{clearTimeout(B),B=setTimeout(()=>{f.apply(void 0,O)},x)}};function k(){ae.newTab()}const X=f=>{const x=a.order.findIndex(B=>B===f);if(x<0||!L[x]){console.warn("Cannot close tab!");return}E=L[x].getBoundingClientRect().width,x<a.order.length-1&&(d.style.setProperty("--tab-max-width",`${E}px`),te()),x==a.activeIndex&&(x==a.order.length-1?ae.setActiveIndex(x-1):ae.setActiveIndex(x+1)),et({duration:Ue,easing:be,onStep:(B,O)=>{x==0?n(5,d.style.gridTemplateColumns=`minmax(${O*Oe}px, ${O*E}px)`,d):n(5,d.style.gridTemplateColumns=`repeat(${x}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${O*Oe}px, ${O*E}px)`,d)},onEnd:()=>{n(5,d.style.gridTemplateColumns="",d),ae.removeTab(f)}})},te=w(()=>{d&&(d.style.setProperty("--tab-max-width",`${We}px`),et({duration:Ue,easing:be,onStep:(f,x)=>{d.style.setProperty("--tab-max-width",`${E+f*(We-E)}px`)},onEnd:()=>{d.style.setProperty("--tab-max-width",`${We}px`)}}))},Zt);function Z(f){if(!d)return;const x=f.getBoundingClientRect().width;et({duration:Ue,easing:be,onStep:(B,O)=>{a.order.length==1?n(5,d.style.gridTemplateColumns=`minmax(${B*Oe}px, ${B*x}px)`,d):n(5,d.style.gridTemplateColumns=`repeat(${a.order.length-1}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${B*Oe}px, ${B*x}px)`,d),n(5,d.scrollLeft=d.scrollWidth,d)},onEnd:()=>{n(5,d.style.gridTemplateColumns="",d)}})}const $=(f,x)=>{const B=L[0].getBoundingClientRect().width;ae.moveTab(f,x,()=>{if(f>x)for(let O=x;O<f;O++)ct(L[O],{duration:Ue,easing:be,css:(Ve,oe)=>`transform: translateX(-${oe*B}px);`});if(f<x)for(let O=x;O>f;O--)ct(L[O],{duration:Ue,easing:be,css:(Ve,oe)=>`transform: translateX(${oe*B}px);`})})};function le(f){!f.target||!f.dataTransfer||(f.dataTransfer.setData("text/plain",i),f.dataTransfer.setDragImage(new Image,0,0))}function ue(f,x){if(f==0&&x==0){n(8,_.style.left="-1000px",_),n(8,_.style.top="-1000px",_);return}let B=c.getBoundingClientRect();if(f<B.left||f>B.right||x<B.top||x>B.bottom){m||(p=0),n(8,_.style.left=`${f+Y}px`,_),n(8,_.style.top=`${x-D.height/2}px`,_),n(9,m=!0);return}m&&n(9,m=!1),n(8,_.style.left=`${f+Y}px`,_),n(8,_.style.top=`${D.top}px`,_);const O=-d.scrollLeft,Ve=L[0].getBoundingClientRect().width;let oe=-1;if(f>O+a.order.length*Ve)oe=a.order.length-1;else for(let Be=0;Be<a.order.length;Be++)if(f>O+Be*Ve&&f<O+(Be+1)*Ve){oe=Be;break}f<20?(p=-vt,requestAnimationFrame(De)):f>d.clientWidth-10?(p=vt,requestAnimationFrame(De)):p=0,!(oe==-1||oe==a.placeholderIndex)&&$(a.placeholderIndex,oe)}let me=0;function De(f){if(!q||p==0){me=0;return}me==0&&(me=f);const x=f-me;me=f,d.scrollBy({left:p*x}),requestAnimationFrame(De)}function Re(f,x){if(!f.target)return;let B,O;f instanceof TouchEvent?(B=f.touches[0].clientX,O=f.touches[0].clientY):(B=f.clientX,O=f.clientY),window.addEventListener("touchmove",re,{passive:!1}),window.addEventListener("touchend",ie),window.addEventListener("mousemove",re),window.addEventListener("mouseup",ie),window.addEventListener("drag",re),window.addEventListener("dragend",ie),window.addEventListener("blur",ie),ae.setActiveIndex(x),P=f.target,D=P.getBoundingClientRect(),v=[B,O],Y=D.left-B,D.top-O,n(8,_.style.width=`${D.width}px`,_),n(8,_.style.left=`${D.left}px`,_),n(8,_.style.top=`${D.top}px`,_),y=x,n(7,C=u[a.order[x]].title)}function re(f){let x,B;if(f instanceof TouchEvent?(x=f.touches[0].clientX,B=f.touches[0].clientY,f.preventDefault()):(x=f.clientX,B=f.clientY),q){ue(x,B);return}v===null||Math.hypot(v[0]-x,v[1]-B)<Jt||(n(3,q=!0),ae.setPlaceholderIndex(y),ae.setActiveIndex(y))}function ie(){window.removeEventListener("touchmove",re),window.removeEventListener("touchend",ie),window.removeEventListener("mousemove",re),window.removeEventListener("mouseup",ie),window.removeEventListener("drag",re),window.removeEventListener("dragend",ie),window.removeEventListener("blur",ie),v=null,n(9,m=!1),y=-1,Y=0,ae.setPlaceholderIndex(),n(3,q=!1)}lt(()=>{d.style.setProperty("--tab-max-width",`${We}px`),d.style.setProperty("--tab-min-width",`${Oe}px`)});const Qe=(f,x)=>Re(x,f);function Je(f,x){e.$$.not_equal(u[x].title,f)&&(u[x].title=f,ce.set(u))}function Ze(f,x){Q[f?"unshift":"push"](()=>{L[x]=f,n(6,L)})}function T(f){Q[f?"unshift":"push"](()=>{d=f,n(5,d)})}const J=()=>{he(pe,a.toolbarVisible=!0,a)};function V(f){Q[f?"unshift":"push"](()=>{_=f,n(8,_)})}const de=()=>l(i),qe=()=>X(i);function Fe(f){b=f,n(1,b)}function Yt(f){s=f,n(0,s)}function Xt(f){Q[f?"unshift":"push"](()=>{c=f,n(10,c)})}return e.$$set=f=>{"onDrawingUndo"in f&&n(2,l=f.onDrawingUndo),"drawingStroke"in f&&n(0,s=f.drawingStroke),"drawingColor"in f&&n(1,b=f.drawingColor)},e.$$.update=()=>{e.$$.dirty[0]&16&&n(12,i=a.order[a.activeIndex]),e.$$.dirty[0]&16&&n(13,r=a.order[a.placeholderIndex]),e.$$.dirty[0]&8&&(q?n(11,h=!0):setTimeout(()=>n(11,h=!1),20))},[s,b,l,q,a,d,L,C,_,m,c,h,i,r,u,k,X,Z,le,Re,Qe,Je,Ze,T,J,V,de,qe,Fe,Yt,Xt]}class en extends He{constructor(t){super(),Ae(this,t,$t,Qt,Pe,{onDrawingUndo:2,drawingStroke:0,drawingColor:1},null,[-1,-1])}}function tn(e){let t,n;return{c(){t=A("div"),n=A("div"),this.h()},l(i){t=R(i,"DIV",{class:!0});var r=U(t);n=R(r,"DIV",{class:!0}),U(n).forEach(H),r.forEach(H),this.h()},h(){S(n,"class","quill-editor svelte-1zs6ve"),S(t,"class","quill-editor-wrapper svelte-1zs6ve"),z(t,"disabled",e[0])},m(i,r){ne(i,t,r),I(t,n),e[5](n)},p(i,[r]){r&1&&z(t,"disabled",i[0])},i:ve,o:ve,d(i){i&&H(t),e[5](null)}}}function nn(e,t,n){let i,r;se(e,ce,m=>n(6,i=m)),se(e,it,m=>n(4,r=m));let{tabID:a}=t,{disabled:u=!1}=t,l,s;const b=(m,Y=300)=>{let p;return(...c)=>{clearTimeout(p),p=setTimeout(()=>{m.apply(void 0,c)},Y)}};async function d(m){var h,w,k,X;if(!l)return;const{Delta:Y,Range:p}=await at(async()=>{const{Delta:te,Range:Z}=await import("../chunks/core.CG__ofcG.js").then($=>$.G);return{Delta:te,Range:Z}},[],import.meta.url);if(m.undo.length>0)for(var c=0;c<m.undo.length;c++){const te=(h=m.undo[c].range)==null?void 0:h.index,Z=(w=m.undo[c].range)==null?void 0:w.length,$={delta:new Y(m.undo[c].delta.ops),range:te!==void 0&&Z!==void 0?new p(te,Z):null};l.history.stack.undo.push($)}if(m.redo.length>0)for(var c=0;c<m.redo.length;c++){const Z=(k=m.redo[c].range)==null?void 0:k.index,$=(X=m.redo[c].range)==null?void 0:X.length,le={delta:new Y(m.redo[c].delta.ops),range:Z!==void 0&&$!==void 0?new p(Z,$):null};l.history.stack.redo.push(le)}}function L(m){var Y;l&&((Y=l.getSelection())==null?void 0:Y.length)===0&&window.open(m.target.href,"_blank")}function E(){if(!l||!i[a])return;const m=i[a].ops;l.setContents(m);const Y=i[a].history;d(Y)}function v(){if(!l||!i[a])return;he(ce,i[a].ops=l.getContents().ops,i);const m=structuredClone(l.history.stack);he(ce,i[a].history=m,i)}const y=b(v,500);function C(){if(!l)return;l.formatText(0,l.getLength(),"link",!1,"api");const m=l.getText(),Y=/https?:\/\/\S+/gi,p=m.matchAll(Y);for(const w of p)l.formatText(w.index,w[0].length,"link",w[0],"api");const c=/.+\@.+\..+/gi,h=m.matchAll(c);for(const w of h)l.formatText(w.index,w[0].length,"link","mailto:"+w[0],"api");document.querySelectorAll(".ql-editor a").forEach(w=>{w.addEventListener("click",L)})}const P=b(C,500);function D(m,Y,p){if(p==="user"){const c=l.getText().split(`
`)[0].trim();he(ce,i[a].title=c===""?"Untitled":c,i),P(),y()}}async function _(){const{default:m}=await at(async()=>{const{default:Y}=await import("../chunks/quill.Bk4jDS0q.js");return{default:Y}},__vite__mapDeps([0,1]),import.meta.url);n(3,l=new m(s,{formats:["bold","italic","underline","strike","code","link"],placeholder:"Enter text here"})),E(),C(),l.on("text-change",D),l.keyboard.addBinding({key:"/",altKey:!0},()=>{l.format("code",!l.getFormat().code)}),l.keyboard.addBinding({key:"-",altKey:!0},()=>{l.format("strike",!l.getFormat().strike)})}lt(()=>{_()});function q(m){Q[m?"unshift":"push"](()=>{s=m,n(1,s)})}return e.$$set=m=>{"tabID"in m&&n(2,a=m.tabID),"disabled"in m&&n(0,u=m.disabled)},e.$$.update=()=>{e.$$.dirty&9&&(u?l==null||l.disable():l==null||l.enable()),e.$$.dirty&24&&(l==null||l.root.setAttribute("spellcheck",r.spellCheck.toString()))},[u,s,a,l,r,q]}class sn extends He{constructor(t){super(),Ae(this,t,nn,tn,Pe,{tabID:2,disabled:0})}}const mt=500,rn=300,bt=500,ln=300;class on{constructor(){N(this,"isMoving",!1);N(this,"isLongclick",!1);N(this,"button",0);N(this,"lastX",0);N(this,"lastY",0);N(this,"consecutiveClicks",0);N(this,"lastMouseupTime",0);N(this,"activeElement",null);this.reset()}reset(){this.isMoving=!1,this.isLongclick=!1,this.button=0,this.lastX=0,this.lastY=0,this.consecutiveClicks=0,this.lastMouseupTime=0,this.activeElement=null}}class an{constructor(){N(this,"isDragging",!1);N(this,"isPinching",!1);N(this,"isLongpressed",!1);N(this,"consecutiveTaps",0);N(this,"lastTouchendTime",0);N(this,"lastCenterX",0);N(this,"lastCenterY",0);N(this,"identifier",0);N(this,"x",0);N(this,"y",0);N(this,"hypotenuse",0);N(this,"activeElement",null);this.reset()}reset(){this.isDragging=!1,this.isPinching=!1,this.isLongpressed=!1,this.consecutiveTaps=0,this.lastTouchendTime=0,this.lastCenterX=0,this.lastCenterY=0,this.identifier=0,this.x=0,this.y=0,this.hypotenuse=0,this.activeElement=null}}let fe=[],g=new on,o=new an;const M=(e,t)=>{e!=null&&e.dispatchEvent(new CustomEvent("gesture",{detail:t,bubbles:!1,cancelable:!1}))},Ct=e=>{g.reset(),o.reset(),g.lastMouseupTime=Date.now(),window.removeEventListener("mousemove",Ge),window.removeEventListener("mouseup",Ke),window.removeEventListener("touchmove",je),window.removeEventListener("touchend",Xe)},Dt=e=>{if(window.removeEventListener("mousemove",Ge),window.removeEventListener("mouseup",Ke),window.removeEventListener("touchmove",je),window.removeEventListener("touchend",Xe),g.isMoving)if(g.isMoving=!1,g.isLongclick)g.isLongclick=!1,M(g.activeElement,{event:e,name:"longclick-drag-end",x:g.lastX,y:g.lastY,dx:0,dy:0});else switch(g.button){case 0:M(g.activeElement,{event:e,name:"left-click-drag-end",x:g.lastX,y:g.lastY,dx:0,dy:0});break;case 1:M(g.activeElement,{event:e,name:"middle-click-drag-end",x:g.lastX,y:g.lastY,dx:0,dy:0});break;case 2:M(g.activeElement,{event:e,name:"right-click-drag-end",x:g.lastX,y:g.lastY,dx:0,dy:0});break}g.isLongclick&&M(g.activeElement,{event:e,name:"longclick-release",x:g.lastX,y:g.lastY,dx:0,dy:0}),g.reset(),o.isDragging&&(o.isDragging=!1,o.isLongpressed?(o.isLongpressed=!1,M(o.activeElement,{event:e,name:"longpress-drag-end",x:o.lastCenterX,y:o.lastCenterY,dx:0,dy:0})):M(o.activeElement,{event:e,name:"touch-drag-end",x:o.lastCenterX,y:o.lastCenterY,dx:0,dy:0})),o.isLongpressed&&M(o.activeElement,{event:e,name:"longpress-release",x:o.lastCenterX,y:o.lastCenterY,dx:0,dy:0}),o.reset()},xt=e=>{M(e.target,{event:e,name:"wheel",x:e.clientX,y:e.clientY,dx:0,dy:0})},It=e=>{},St=e=>{document.activeElement!==e.target&&(window.addEventListener("mousemove",Ge),window.addEventListener("mouseup",Ke),g.activeElement=e.target,g.lastX=e.clientX,g.lastY=e.clientY,g.isMoving||(g.button=e.button),g.button===0&&window.setTimeout(()=>{Date.now()-g.lastMouseupTime>=bt&&!g.isMoving&&(g.isLongclick=!0,M(g.activeElement,{event:e,name:"longclick",x:e.clientX,y:e.clientY,dx:0,dy:0}))},bt))},Ge=e=>{if(e.movementX===0&&e.movementY===0)return;let t=e.clientX-g.lastX,n=e.clientY-g.lastY;if(!g.isMoving)if(g.isLongclick)M(g.activeElement,{event:e,name:"longclick-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});else switch(g.button){case 0:M(g.activeElement,{event:e,name:"left-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 1:M(g.activeElement,{event:e,name:"middle-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 2:M(g.activeElement,{event:e,name:"right-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break}if(g.isMoving=!0,g.lastX=e.clientX,g.lastY=e.clientY,g.isLongclick)M(g.activeElement,{event:e,name:"longclick-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});else switch(g.button){case 0:M(g.activeElement,{event:e,name:"left-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break;case 1:M(g.activeElement,{event:e,name:"middle-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break;case 2:M(g.activeElement,{event:e,name:"right-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break}},Ke=e=>{if(window.removeEventListener("mousemove",Ge),window.removeEventListener("mouseup",Ke),g.lastMouseupTime=Date.now(),g.isMoving)if(g.isMoving=!1,g.isLongclick)g.isLongclick=!1,M(g.activeElement,{event:e,name:"longclick-drag-end",x:g.lastX,y:g.lastY,dx:0,dy:0});else switch(g.button){case 0:M(g.activeElement,{event:e,name:"left-click-drag-end",x:g.lastX,y:g.lastY,dx:0,dy:0});break;case 1:M(g.activeElement,{event:e,name:"middle-click-drag-end",x:g.lastX,y:g.lastY,dx:0,dy:0});break;case 2:M(g.activeElement,{event:e,name:"right-click-drag-end",x:g.lastX,y:g.lastY,dx:0,dy:0});break}else g.isLongclick||(e.button===2?M(g.activeElement,{event:e,name:"right-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):e.button===1?M(g.activeElement,{event:e,name:"middle-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):(g.consecutiveClicks===0&&M(g.activeElement,{event:e,name:"left-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),g.consecutiveClicks++,window.setTimeout(()=>{g.consecutiveClicks>1&&M(g.activeElement,{event:e,name:"double-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),g.consecutiveClicks=0},ln)));g.isLongclick&&M(g.activeElement,{event:e,name:"longclick-release",x:e.clientX,y:e.clientY,dx:0,dy:0}),g.isLongclick=!1},Mt=e=>{if(e.touches.length>1,document.activeElement!==e.target){if(e.touches.length>1){if(e.touches[0].identifier===o.identifier)return;o.isPinching=!0}window.addEventListener("touchmove",je,{passive:!1}),window.addEventListener("touchend",Xe),window.addEventListener("touchcancel",Xe),o.identifier=e.touches[0].identifier,o.x=e.touches[0].clientX,o.y=e.touches[0].clientY,o.activeElement=e.target,window.setTimeout(()=>{o.isPinching||o.isDragging||Date.now()-o.lastTouchendTime>=mt&&(o.isDragging=!1,o.isPinching=!1,o.hypotenuse=null,o.isLongpressed=!0,M(o.activeElement,{event:e,name:"longpress",x:o.x,y:o.y,dx:0,dy:0}))},mt)}},je=e=>{if(o.isDragging){let t=o.x,n=o.y;o.x=e.touches[0].clientX,o.y=e.touches[0].clientY;let i=o.x-t,r=o.y-n;o.isLongpressed?M(o.activeElement,{event:e,name:"longpress-dragging",x:o.x,y:o.y,dx:i,dy:r,force:e.touches[0].force}):M(o.activeElement,{event:e,name:"touch-dragging",x:o.x,y:o.y,dx:i,dy:r,force:e.touches[0].force});return}else if(!o.isLongpressed&&(o.isPinching||e.touches.length>1)){o.x=e.touches[0].clientX,o.y=e.touches[0].clientY;let t={x:e.touches[1].clientX,y:e.touches[1].clientY},n={x:(o.x+t.x)/2,y:(o.y+t.y)/2},i=Math.hypot(o.x-t.x,o.y-t.y);o.hypotenuse===null&&(o.hypotenuse=i,o.lastCenterX=n.x,o.lastCenterY=n.y,M(o.activeElement,{event:e,name:"pinch-start",x:n.x,y:n.y,dx:0,dy:0})),o.isPinching=!0;let r=i/o.hypotenuse,a=n.x-o.lastCenterX,u=n.y-o.lastCenterY;M(o.activeElement,{event:e,name:"pinching",x:n.x,y:n.y,zoom:r,dx:a,dy:u}),o.hypotenuse=i,o.lastCenterX=n.x,o.lastCenterY=n.y;return}else o.isDragging=!0,o.isLongpressed?(M(o.activeElement,{event:e,name:"longpress-drag-start",x:o.x,y:o.y,dx:0,dy:0,force:e.touches[0].force}),o.x=e.touches[0].clientX,o.y=e.touches[0].clientY,M(o.activeElement,{event:e,name:"longpress-dragging",x:o.x,y:o.y,dx:0,dy:0,force:e.touches[0].force})):(M(o.activeElement,{event:e,name:"touch-drag-start",x:o.x,y:o.y,dx:0,dy:0,force:e.touches[0].force}),o.x=e.touches[0].clientX,o.y=e.touches[0].clientY,M(o.activeElement,{event:e,name:"touch-dragging",x:o.x,y:o.y,dx:0,dy:0,force:e.touches[0].force}))},Xe=e=>{o.isDragging&&e.touches.length>0&&e.touches[0].identifier===o.identifier||(o.lastTouchendTime=Date.now(),window.removeEventListener("touchmove",je),window.removeEventListener("touchend",Xe),window.removeEventListener("touchcancel",Xe),o.isDragging?(o.isDragging=!1,o.isLongpressed?(o.isLongpressed=!1,M(o.activeElement,{event:e,name:"longpress-drag-end",x:o.x,y:o.y,dx:0,dy:0})):M(o.activeElement,{event:e,name:"touch-drag-end",x:o.x,y:o.y,dx:0,dy:0})):o.isPinching?(o.isPinching=!1,o.hypotenuse=null,M(o.activeElement,{event:e,name:"pinch-end",x:o.lastCenterX,y:o.lastCenterY,dx:0,dy:0})):o.isLongpressed||(o.consecutiveTaps===0&&M(o.activeElement,{event:e,name:"tap",x:o.x,y:o.y,dx:0,dy:0}),o.consecutiveTaps++,window.setTimeout(()=>{o.consecutiveTaps>1&&M(o.activeElement,{event:e,name:"double-tap",x:o.x,y:o.y,dx:0,dy:0}),o.consecutiveTaps=0},rn)),o.isLongpressed&&M(o.activeElement,{event:e,name:"longpress-release",x:o.x,y:o.y,dx:0,dy:0}),o.isLongpressed=!1)};function cn(...e){for(let t of e)fe.findIndex(n=>n===t)===-1&&(fe.length==0&&(window.addEventListener("blur",Dt),window.addEventListener("focus",Ct)),fe.push(t),t.addEventListener("touchstart",Mt,{passive:!1}),t.addEventListener("mousedown",St,{passive:!1}),t.addEventListener("contextmenu",It,{passive:!1}),t.addEventListener("wheel",xt,{passive:!1}))}function un(...e){const t=n=>{n.removeEventListener("touchstart",Mt),n.removeEventListener("mousedown",St),n.removeEventListener("contextmenu",It),n.removeEventListener("wheel",xt)};if(e.length==0){for(let n of fe)t(n);fe=[]}else for(let n of e){let i=fe.findIndex(r=>r===n);i!==-1&&(t(n),fe.splice(i,1))}fe.length==0&&(window.removeEventListener("blur",Dt),window.removeEventListener("focus",Ct))}function dn(e){let t,n,i,r,a,u,l="LOG";return{c(){t=A("div"),n=A("canvas"),i=W(),r=A("canvas"),a=W(),u=A("div"),u.textContent=l,this.h()},l(s){t=R(s,"DIV",{class:!0});var b=U(t);n=R(b,"CANVAS",{id:!0,class:!0}),U(n).forEach(H),i=G(b),r=R(b,"CANVAS",{id:!0,class:!0}),U(r).forEach(H),a=G(b),u=R(b,"DIV",{class:!0,"data-svelte-h":!0}),ge(u)!=="svelte-rtly9t"&&(u.textContent=l),b.forEach(H),this.h()},h(){S(n,"id","currentPath"),S(n,"class","svelte-1b93g54"),z(n,"disabled",e[0]),S(r,"id","canvas"),S(r,"class","svelte-1b93g54"),z(r,"disabled",e[0]),S(u,"class","log svelte-1b93g54"),S(t,"class","canvas-container svelte-1b93g54"),z(t,"hide",e[1])},m(s,b){ne(s,t,b),I(t,n),e[12](n),I(t,i),I(t,r),e[13](r),I(t,a),I(t,u),e[14](u)},p(s,b){b[0]&1&&z(n,"disabled",s[0]),b[0]&1&&z(r,"disabled",s[0]),b[0]&2&&z(t,"hide",s[1])},i:ve,o:ve,d(s){s&&H(t),e[12](null),e[13](null),e[14](null)}}}const fn=2,gn=178;function hn(e,t,n){var i=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),r=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),a=Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2)),u=Math.acos((r*r+i*i-a*a)/(2*r*i));return u*(180/Math.PI)}function pt(e){if(e.points.length<4)return e;for(let t=1;t<e.points.length-2;t++){const n=e.points[t-1],i=e.points[t],r=e.points[t+1];hn(n,i,r)>gn&&(e.points.splice(t,1),t--)}return e}async function Ne(e,t){if(t.lineWidth=e.lineWidth,t.lineCap="round",t.strokeStyle=e.color,e.points.length<2){t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[0].x,e.points[0].y),t.stroke();return}t.beginPath();let n=e.points[0].x,i=e.points[0].y;for(let r=0;r<e.points.length-1;r++)t.moveTo(n,i),n=(e.points[r].x+e.points[r+1].x)/2,i=(e.points[r].y+e.points[r+1].y)/2,t.quadraticCurveTo(e.points[r].x,e.points[r].y,n,i);t.stroke()}function vn(e){return{x:wt(e.x),y:wt(e.y)}}function wt(e){const t=e.toFixed(fn);return Number(t)}function mn(e,t,n){let i;se(e,ce,T=>n(25,i=T));let{radius:r=3}=t,{smoothness:a=0}=t,{stroke:u=5}=t,{color:l="#000000"}=t,{disabled:s=!1}=t,{hide:b=!1}=t,{tabID:d=""}=t;function L(){y.clearRect(0,0,q/m,_/m),w=[]}function E(){if(w.length!=0){n(4,p.innerHTML="Undo",p),w.pop(),P.clearRect(0,0,q/m,_/m);for(let T=0;T<w.length;T++)Ne(w[T],P);ue()}}let v,y,C,P,D={x:0,y:0},_=0,q=0,m,Y=!1,p,c,h,w=[];function k(){v&&(cn(v),window.addEventListener("keydown",ie))}function X(){v&&(un(v),window.removeEventListener("keydown",ie))}const te=(T,J,V,de)=>{var qe=V-T,Fe=de-J;return Math.sqrt(qe*qe+Fe*Fe)},Z=(T,J=300)=>{let V;return(...de)=>{clearTimeout(V),V=setTimeout(()=>{T.apply(void 0,de)},J)}};function $(T,J){let V=v.getBoundingClientRect();return{x:T-V.left,y:J-V.top}}function le(){if(!v||!C)return;re(),m=window.devicePixelRatio;let T=v.getBoundingClientRect();_=T.height*m,q=T.width*m,n(2,v.width=q,v),n(2,v.height=_,v),n(3,C.width=q,C),n(3,C.height=_,C),y.scale(m,m),P.scale(m,m);for(let J=0;J<w.length;J++)Ne(w[J],P)}function ue(){i[d]&&he(ce,i[d].paths=w.filter(T=>pt(T)),i)}function me(){i[d]&&(w=i[d].paths,le())}function De(T,J){Y=!0,D=$(T,J),y.lineWidth=u,y.lineCap="round",y.strokeStyle=l,y.beginPath(),y.moveTo(D.x,D.y),y.stroke(),c={points:[],lineWidth:u,color:l}}function Re(T,J){if(!Y)return;let V=$(T,J);if(r>0){if(te(V.x,V.y,D.x,D.y)<=r){c.points.length===0&&(c.points.push(V),Ne(c,y));return}let de=Math.sqrt(V.x*V.x+V.y*V.y-2*V.x*D.x+D.x*D.x-2*V.y*D.y+D.y*D.y);if(V={x:V.x+r*((D.x-V.x)/de),y:V.y+r*((D.y-V.y)/de)},te(D.x,D.y,V.x,V.y)<=a)return}c.points.push(vn(V)),y.clearRect(0,0,q/m,_/m),Ne(c,y),D=V}function re(){Y&&(w.push(pt(c)),Ne(c,P),y.clearRect(0,0,q/m,_/m),ue()),Y=!1}const ie=function(T){T.ctrlKey&&T.key=="z"&&E(),T.preventDefault()};lt(()=>{y=v.getContext("2d"),y.imageSmoothingEnabled=!1,P=C.getContext("2d"),P.imageSmoothingEnabled=!1,v.addEventListener("gesture",T=>{switch(T.detail.name){case"left-click-drag-start":case"touch-drag-start":De(T.detail.x,T.detail.y);break;case"left-click-dragging":case"touch-dragging":T.detail.force>0&&n(4,p.innerHTML=T.detail.force,p),Re(T.detail.x,T.detail.y);break;case"left-click-drag-end":case"touch-drag-end":re();break;case"left-click":case"tap":De(T.detail.x,T.detail.y),Re(T.detail.x,T.detail.y),re();break}}),h=new ResizeObserver(Z(le,0)),h.observe(v),me(),s?X():k()}),Rt(()=>{h&&h.disconnect(),X()});function Qe(T){Q[T?"unshift":"push"](()=>{C=T,n(3,C)})}function Je(T){Q[T?"unshift":"push"](()=>{v=T,n(2,v)})}function Ze(T){Q[T?"unshift":"push"](()=>{p=T,n(4,p)})}return e.$$set=T=>{"radius"in T&&n(5,r=T.radius),"smoothness"in T&&n(6,a=T.smoothness),"stroke"in T&&n(7,u=T.stroke),"color"in T&&n(8,l=T.color),"disabled"in T&&n(0,s=T.disabled),"hide"in T&&n(1,b=T.hide),"tabID"in T&&n(9,d=T.tabID)},e.$$.update=()=>{e.$$.dirty[0]&1&&(s?X():k())},[s,b,v,C,p,r,a,u,l,d,L,E,Qe,Je,Ze]}class bn extends He{constructor(t){super(),Ae(this,t,mn,dn,Pe,{radius:5,smoothness:6,stroke:7,color:8,disabled:0,hide:1,tabID:9,clear:10,undo:11},null,[-1,-1])}get clear(){return this.$$.ctx[10]}get undo(){return this.$$.ctx[11]}}function _t(e,t,n){const i=e.slice();return i[15]=t[n],i[16]=t,i[17]=n,i}function yt(e,t,n){const i=e.slice();return i[15]=t[n],i}function pn(e){let t,n;return t=new Nt({}),{c(){Ee(t.$$.fragment)},l(i){Te(t.$$.fragment,i)},m(i,r){Le(t,i,r),n=!0},p:ve,i(i){n||(F(t.$$.fragment,i),n=!0)},o(i){K(t.$$.fragment,i),n=!1},d(i){Ce(t,i)}}}function wn(e){let t,n,i,r,a,u,l,s=[],b=new Map,d,L,E=[],v=new Map,y;function C(p){e[9](p)}function P(p){e[10](p)}let D={onDrawingUndo:e[8]};e[2]!==void 0&&(D.drawingStroke=e[2]),e[0]!==void 0&&(D.drawingColor=e[0]),n=new en({props:D}),Q.push(()=>ke(n,"drawingStroke",C)),Q.push(()=>ke(n,"drawingColor",P));let _=xe(Object.keys(e[7]));const q=p=>p[15];for(let p=0;p<_.length;p+=1){let c=yt(e,_,p),h=q(c);b.set(h,s[p]=kt(h,c))}let m=xe(Object.keys(e[7]));const Y=p=>p[15];for(let p=0;p<m.length;p+=1){let c=_t(e,m,p),h=Y(c);v.set(h,E[p]=Et(h,c))}return{c(){t=A("div"),Ee(n.$$.fragment),a=W(),u=A("div"),l=A("div");for(let p=0;p<s.length;p+=1)s[p].c();d=W(),L=A("div");for(let p=0;p<E.length;p+=1)E[p].c();this.h()},l(p){t=R(p,"DIV",{class:!0});var c=U(t);Te(n.$$.fragment,c),a=G(c),u=R(c,"DIV",{class:!0});var h=U(u);l=R(h,"DIV",{class:!0});var w=U(l);for(let X=0;X<s.length;X+=1)s[X].l(w);w.forEach(H),d=G(h),L=R(h,"DIV",{class:!0});var k=U(L);for(let X=0;X<E.length;X+=1)E[X].l(k);k.forEach(H),h.forEach(H),c.forEach(H),this.h()},h(){S(l,"class","editor-container svelte-gwyvkn"),S(L,"class","drawing-container svelte-gwyvkn"),z(L,"disabled",e[1].activeTool!=="pencil"),S(u,"class","canvas-container svelte-gwyvkn"),S(t,"class","page-container svelte-gwyvkn")},m(p,c){ne(p,t,c),Le(n,t,null),I(t,a),I(t,u),I(u,l);for(let h=0;h<s.length;h+=1)s[h]&&s[h].m(l,null);I(u,d),I(u,L);for(let h=0;h<E.length;h+=1)E[h]&&E[h].m(L,null);y=!0},p(p,c){const h={};c&40&&(h.onDrawingUndo=p[8]),!i&&c&4&&(i=!0,h.drawingStroke=p[2],ye(()=>i=!1)),!r&&c&1&&(r=!0,h.drawingColor=p[0],ye(()=>r=!1)),n.$set(h),c&160&&(_=xe(Object.keys(p[7])),we(),s=tt(s,c,q,1,p,_,b,l,nt,kt,null,yt),_e()),c&190&&(m=xe(Object.keys(p[7])),we(),E=tt(E,c,Y,1,p,m,v,L,nt,Et,null,_t),_e()),(!y||c&2)&&z(L,"disabled",p[1].activeTool!=="pencil")},i(p){if(!y){F(n.$$.fragment,p);for(let c=0;c<_.length;c+=1)F(s[c]);for(let c=0;c<m.length;c+=1)F(E[c]);y=!0}},o(p){K(n.$$.fragment,p);for(let c=0;c<s.length;c+=1)K(s[c]);for(let c=0;c<E.length;c+=1)K(E[c]);y=!1},d(p){p&&H(t),Ce(n);for(let c=0;c<s.length;c+=1)s[c].d();for(let c=0;c<E.length;c+=1)E[c].d()}}}function kt(e,t){let n,i,r;return i=new sn({props:{disabled:t[15]!==t[5],tabID:t[15]}}),{key:e,first:null,c(){n=Me(),Ee(i.$$.fragment),this.h()},l(a){n=Me(),Te(i.$$.fragment,a),this.h()},h(){this.first=n},m(a,u){ne(a,n,u),Le(i,a,u),r=!0},p(a,u){t=a;const l={};u&160&&(l.disabled=t[15]!==t[5]),u&128&&(l.tabID=t[15]),i.$set(l)},i(a){r||(F(i.$$.fragment,a),r=!0)},o(a){K(i.$$.fragment,a),r=!1},d(a){a&&H(n),Ce(i,a)}}}function Et(e,t){let n,i,r=t[15],a,u,l;const s=()=>t[11](i,r),b=()=>t[11](null,r);function d(v){t[12](v)}function L(v){t[13](v)}let E={tabID:t[15],hide:t[15]!==t[5],disabled:t[15]!==t[5]||t[1].activeTool!=="pencil"};return t[4]!==void 0&&(E.color=t[4]),t[2]!==void 0&&(E.stroke=t[2]),i=new bn({props:E}),s(),Q.push(()=>ke(i,"color",d)),Q.push(()=>ke(i,"stroke",L)),{key:e,first:null,c(){n=Me(),Ee(i.$$.fragment),this.h()},l(v){n=Me(),Te(i.$$.fragment,v),this.h()},h(){this.first=n},m(v,y){ne(v,n,y),Le(i,v,y),l=!0},p(v,y){t=v,r!==t[15]&&(b(),r=t[15],s());const C={};y&128&&(C.tabID=t[15]),y&160&&(C.hide=t[15]!==t[5]),y&162&&(C.disabled=t[15]!==t[5]||t[1].activeTool!=="pencil"),!a&&y&16&&(a=!0,C.color=t[4],ye(()=>a=!1)),!u&&y&4&&(u=!0,C.stroke=t[2],ye(()=>u=!1)),i.$set(C)},i(v){l||(F(i.$$.fragment,v),l=!0)},o(v){K(i.$$.fragment,v),l=!1},d(v){v&&H(n),b(),Ce(i,v)}}}function _n(e){let t,n,i,r;const a=[wn,pn],u=[];function l(s,b){return s[6].currentUser&&!s[6].isLoading?0:1}return t=l(e),n=u[t]=a[t](e),{c(){n.c(),i=Me()},l(s){n.l(s),i=Me()},m(s,b){u[t].m(s,b),ne(s,i,b),r=!0},p(s,[b]){let d=t;t=l(s),t===d?u[t].p(s,b):(we(),K(u[d],1,1,()=>{u[d]=null}),_e(),n=u[t],n?n.p(s,b):(n=u[t]=a[t](s),n.c()),F(n,1),n.m(i.parentNode,i))},i(s){r||(F(n),r=!0)},o(s){K(n),r=!1},d(s){s&&H(i),u[t].d(s)}}}function yn(e,t){var n=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16);return"rgba("+n+", "+i+", "+r+", "+t+")"}function kn(e,t,n){let i,r,a,u,l,s;se(e,it,_=>n(14,a=_)),se(e,pe,_=>n(1,u=_)),se(e,Tt,_=>n(6,l=_)),se(e,ce,_=>n(7,s=_));let b="#000000";it.subscribe(()=>{var _;n(0,b=((_=Ft.find(q=>q.name===a.theme))==null?void 0:_.caret)||"#000000")});let d=10,L={};const E=()=>L[i].undo();function v(_){d=_,n(2,d)}function y(_){b=_,n(0,b)}function C(_,q){Q[_?"unshift":"push"](()=>{L[q]=_,n(3,L)})}function P(_){r=_,n(4,r),n(0,b)}function D(_){d=_,n(2,d)}return e.$$.update=()=>{e.$$.dirty&2&&n(5,i=u.order[u.activeIndex]),e.$$.dirty&1&&n(4,r=yn(b,.3))},[b,u,d,L,r,i,l,s,E,v,y,C,P,D]}class Yn extends He{constructor(t){super(),Ae(this,t,kn,_n,Pe,{})}}export{Yn as component};
