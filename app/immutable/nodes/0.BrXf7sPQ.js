import{s as j,v as Q,w as X,x as Y,y as Z,c as v,o as ee,n as U,a as A}from"../chunks/scheduler.CgGcoA3v.js";import{S as L,i as M,H as re,s as F,E as oe,h as R,j as D,a as k,t as E,g as f,e as w,c as T,v as ie,w as h,A as b,p as te,F as le,q as se,k as P,r as ae,u as ne,d as V}from"../chunks/index.BSd0CfbD.js";import{s as S,a as _,t as ce,c as ue,b as W,m as B,d as H,e as G,g as J,h as me,i as K,f as de}from"../chunks/firebaseStore.Dz1ivsi6.js";import{b as C,g as fe}from"../chunks/entry.C8Z30L8i.js";import{t as N}from"../chunks/themes.BTx5Q4mv.js";const pe=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,he=!0,ge="always",He=Object.freeze(Object.defineProperty({__proto__:null,prerender:he,trailingSlash:ge},Symbol.toStringTag,{value:"Module"}));function be(i){let e,r,s;const a=i[3].default,o=Q(a,i,i[2],null);return{c(){e=new re(!1),r=F(),o&&o.c(),this.h()},l(t){e=oe(t,!1),r=R(t),o&&o.l(t),this.h()},h(){e.a=r},m(t,n){e.m(i[0],t,n),D(t,r,n),o&&o.m(t,n),s=!0},p(t,[n]){(!s||n&1)&&e.p(t[0]),o&&o.p&&(!s||n&4)&&X(o,a,t,t[2],s?Z(a,t[2],n,null):Y(t[2]),null)},i(t){s||(k(o,t),s=!0)},o(t){E(o,t),s=!1},d(t){t&&(e.d(),f(r)),o&&o.d(t)}}}function _e(i,e,r){let s,a;v(i,S,c=>r(1,a=c));let{$$slots:o={},$$scope:t}=e;function n(c){const m=N.find(g=>g.name===c);return m?`<style>
    :root {
    --bg: ${m.bg};
    --bg-alt: ${m.bgAlt};
    --main: ${m.main};
    --caret: ${m.caret};
    --error: ${m.error};
    --sub: ${m.sub};
    --text: ${m.text};
    }
    </style>`:""}function l(){var m;const c=N.find(g=>g.name===a.theme);c&&((m=document.querySelector('meta[name="theme-color"]'))==null||m.setAttribute("content",c.bg))}return ee(()=>{n(a.theme),S.subscribe(l)}),i.$$set=c=>{"$$scope"in c&&r(2,t=c.$$scope)},i.$$.update=()=>{i.$$.dirty&2&&r(0,s=n(a.theme))},[s,a,t,o]}class ve extends L{constructor(e){super(),M(this,e,_e,be,j,{})}}function ye(i){let e,r=`<span class="status-icon svelte-1mx6eh7" style="-webkit-mask: url(${C}/images/svg/double-checkmark.svg) no-repeat center / contain; mask: url(${C}/images/svg/double-checkmark.svg) no-repeat center / contain;"></span>`;return{c(){e=w("div"),e.innerHTML=r,this.h()},l(s){e=T(s,"DIV",{class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-jbp3id"&&(e.innerHTML=r),this.h()},h(){h(e,"class","status svelte-1mx6eh7"),b(e,"saving",i[0].savingStatus==="saving"),b(e,"saved",i[0].savingStatus==="saved"),b(e,"error",i[0].savingStatus==="error")},m(s,a){D(s,e,a)},p(s,[a]){a&1&&b(e,"saving",s[0].savingStatus==="saving"),a&1&&b(e,"saved",s[0].savingStatus==="saved"),a&1&&b(e,"error",s[0].savingStatus==="error")},i:U,o:U,d(s){s&&f(e)}}}function $e(i,e,r){let s;return v(i,_,a=>r(0,s=a)),[s]}class Se extends L{constructor(e){super(),M(this,e,$e,ye,j,{})}}const{document:I}=pe;function we(i){let e,r,s,a,o;const t=i[0].default,n=Q(t,i,i[1],null);return a=new Se({}),{c(){e=w("div"),n&&n.c(),r=F(),s=w("div"),te(a.$$.fragment),this.h()},l(l){e=T(l,"DIV",{class:!0});var c=V(e);n&&n.l(c),r=R(c),s=T(c,"DIV",{class:!0});var m=V(s);se(a.$$.fragment,m),m.forEach(f),c.forEach(f),this.h()},h(){h(s,"class","sync-status svelte-j4k8tx"),h(e,"class","layout-container svelte-j4k8tx")},m(l,c){D(l,e,c),n&&n.m(e,null),P(e,r),P(e,s),ae(a,s,null),o=!0},p(l,c){n&&n.p&&(!o||c&2)&&X(n,t,l,l[1],o?Z(t,l[1],c,null):Y(l[1]),null)},i(l){o||(k(n,l),k(a.$$.fragment,l),o=!0)},o(l){E(n,l),E(a.$$.fragment,l),o=!1},d(l){l&&f(e),n&&n.d(l),ne(a)}}}function Te(i){let e,r,s,a,o;return a=new ve({props:{$$slots:{default:[we]},$$scope:{ctx:i}}}),{c(){e=w("meta"),r=w("meta"),s=F(),te(a.$$.fragment),this.h()},l(t){const n=le("svelte-17tnzz8",I.head);e=T(n,"META",{name:!0,content:!0}),r=T(n,"META",{name:!0,content:!0}),n.forEach(f),s=R(t),se(a.$$.fragment,t),this.h()},h(){h(e,"name","viewport"),h(e,"content","width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover"),h(r,"name","theme-color"),h(r,"content","var(--bg)")},m(t,n){P(I.head,e),P(I.head,r),D(t,s,n),ae(a,t,n),o=!0},p(t,[n]){const l={};n&2&&(l.$$scope={dirty:n,ctx:t}),a.$set(l)},i(t){o||(k(a.$$.fragment,t),o=!0)},o(t){E(a.$$.fragment,t),o=!1},d(t){t&&f(s),f(e),f(r),ne(a,t)}}}function ke(){switch(screen.orientation.type){case"portrait-primary":document.documentElement.style.setProperty("--safe-area-top","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-primary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-secondary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","env(safe-area-inset-right)");break}}function Ee(i,e,r){let s,a,o,t;v(i,W,u=>r(3,s=u)),v(i,S,u=>r(4,a=u)),v(i,B,u=>r(5,o=u)),v(i,_,u=>r(6,t=u));let{$$slots:n={},$$scope:l}=e,c=!0;async function m(){const u=t.currentUser;if(!u)return;c=!0;const p=H(G,"users",u.uid),q=await J(p);let d={activeIndex:0,order:[],settings:{theme:"Canvas",spellCheck:!0}},x={};if(q.exists()){console.log("Fetching firestore user doc...");const y=q.data();d={...d,...y};for(let $=0;$<d.order.length;$++){const z=d.order[$],O=await J(H(p,"tabs",z));if(!O.exists()){d.order.splice($,1),$--;continue}x[z]=O.data()}}else{console.log("Creating firestore user doc...");const y=H(G,"users",u.uid);await me(y,d,{merge:!0})}K.loadPackedTabs(x),A(B,o.order=d.order,o),K.setActiveIndex(d.activeIndex),A(S,a=d.settings,a),_.update(y=>({...y,isAuthenticating:!1,userData:d,packedTabs:x})),c=!1}function g(){c||de.publish()}return ce.subscribe(g),S.subscribe(g),ee(()=>{screen.orientation.addEventListener("change",ke),ue.onAuthStateChanged(async u=>{if(!u){_.update(p=>({...p,currentUser:u})),A(W,s=window.location.pathname.slice(C.length),s),fe(C+"/login");return}_.update(p=>({...p,isLoading:!0,currentUser:u})),await m(),_.update(p=>({...p,isLoading:!1}))})}),i.$$set=u=>{"$$scope"in u&&r(1,l=u.$$scope)},[n,l]}class Ie extends L{constructor(e){super(),M(this,e,Ee,Te,j,{})}}export{Ie as component,He as universal};
