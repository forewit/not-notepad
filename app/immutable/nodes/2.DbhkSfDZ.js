const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/quill.Bk4jDS0q.js","../chunks/core.CG__ofcG.js"])))=>i.map(i=>d[i]);
var pt=Object.defineProperty;var wt=(e,n,t)=>n in e?pt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var W=(e,n,t)=>wt(e,typeof n!="symbol"?n+"":n,t);import{s as Ae,n as be,r as dt,e as Se,c as fe,o as Qe,d as he,z as kt,A as _t,a as Me}from"../chunks/scheduler.BOxWOvYx.js";import{S as He,i as Re,e as O,b as xt,c as B,d as q,f as Et,g as Y,w as H,A as U,j as se,k as S,x as ye,G as qe,l as Tt,s as ne,p as Te,h as ie,v as Pe,q as Le,z as Ze,r as Ce,o as Be,n as Ne,a as le,t as re,u as De,I as Lt,m as xe}from"../chunks/index.BFcqwp_n.js";import{e as _e,u as ze,o as Ge}from"../chunks/each.DD9ZPifO.js";import{b as te}from"../chunks/paths.BCiFuG65.js";import{m as je,t as ue,a as ut,d as de,s as Ct,f as Dt}from"../chunks/firebaseStore.CNrJAtum.js";import{_ as Je}from"../chunks/preload-helper.D6kgxu3v.js";import{S as It}from"../chunks/Spinner.DVSMDdgP.js";function Yt(e){let n,t,i,a,l,c;return{c(){n=O("div"),t=O("button"),i=O("span"),a=xt(e[0]),this.h()},l(o){n=B(o,"DIV",{class:!0});var g=q(n);t=B(g,"BUTTON",{class:!0,draggable:!0});var _=q(t);i=B(_,"SPAN",{class:!0});var m=q(i);a=Et(m,e[0]),m.forEach(Y),_.forEach(Y),g.forEach(Y),this.h()},h(){H(i,"class","title svelte-1aycx2r"),H(t,"class","tab svelte-1aycx2r"),H(t,"draggable","true"),U(t,"active",e[1]),H(n,"class","tab-container svelte-1aycx2r"),U(n,"preventHover",e[2])},m(o,g){se(o,n,g),S(n,t),S(t,i),S(i,a),l||(c=[ye(t,"mousedown",qe(function(){Se(e[3])&&e[3].apply(this,arguments)})),ye(t,"touchstart",qe(function(){Se(e[3])&&e[3].apply(this,arguments)})),ye(t,"dragstart",qe(function(){Se(e[4])&&e[4].apply(this,arguments)}))],l=!0)},p(o,[g]){e=o,g&1&&Tt(a,e[0]),g&2&&U(t,"active",e[1]),g&4&&U(n,"preventHover",e[2])},i:be,o:be,d(o){o&&Y(n),l=!1,dt(c)}}}function Xt(e,n,t){let{title:i=""}=n,{active:a=!1}=n,{preventHover:l=!1}=n,{onPointerdown:c=g=>{}}=n,{onDragstart:o=g=>{}}=n;return e.$$set=g=>{"title"in g&&t(0,i=g.title),"active"in g&&t(1,a=g.active),"preventHover"in g&&t(2,l=g.preventHover),"onPointerdown"in g&&t(3,c=g.onPointerdown),"onDragstart"in g&&t(4,o=g.onDragstart)},[i,a,l,c,o]}class ft extends He{constructor(n){super(),Re(this,n,Xt,Yt,Ae,{title:0,active:1,preventHover:2,onPointerdown:3,onDragstart:4})}}function ve(e){return e<.5?4*e*e*e:.5*Math.pow(2*e-2,3)+1}const $e=(e,n)=>{const{duration:t=300,easing:i=ve,onEnd:a=()=>{},onStep:l=()=>{},css:c}=n;let o;function g(_){if(!e){console.warn("Cannot find element to animate");return}o===void 0&&(o=_);const m=i((_-o)/t),E=1-m;m<1?(e.style.cssText=c(m,E),l(m,E),requestAnimationFrame(g)):(e.style.cssText="",a())}requestAnimationFrame(g)},Ue=e=>{const{duration:n=300,easing:t=ve,onEnd:i=()=>{},onStep:a=()=>{}}=e;let l;function c(o){l===void 0&&(l=o);const g=t((o-l)/n),_=1-g;g<1?(a(g,_),requestAnimationFrame(c)):i()}requestAnimationFrame(c)};function et(e,n,t){const i=e.slice();return i[43]=n[t],i[44]=n,i[45]=t,i}function tt(e,n){let t,i,a,l,c=n[45],o,g,_;function m(...v){return n[20](n[45],...v)}function E(v){n[21](v,n[43])}let D={active:n[11]==n[43],preventHover:n[10],onPointerdown:m,onDragstart:n[18]};n[13][n[43]].title!==void 0&&(D.title=n[13][n[43]].title),i=new ft({props:D}),he.push(()=>Lt(i,"title",E));const V=()=>n[22](t,c),z=()=>n[22](null,c);return{key:e,first:null,c(){t=O("div"),Te(i.$$.fragment),l=ne(),this.h()},l(v){t=B(v,"DIV",{class:!0});var y=q(t);Le(i.$$.fragment,y),l=ie(y),y.forEach(Y),this.h()},h(){H(t,"class","tab-container svelte-11x45ky"),U(t,"placeholder",n[12]==n[43]),this.first=t},m(v,y){se(v,t,y),Ce(i,t,null),S(t,l),V(),o=!0,g||(_=kt(n[17].call(null,t)),g=!0)},p(v,y){n=v;const u={};y[0]&2056&&(u.active=n[11]==n[43]),y[0]&1024&&(u.preventHover=n[10]),y[0]&8&&(u.onPointerdown=m),!a&&y[0]&8200&&(a=!0,u.title=n[13][n[43]].title,_t(()=>a=!1)),i.$set(u),c!==n[45]&&(z(),c=n[45],V()),(!o||y[0]&4104)&&U(t,"placeholder",n[12]==n[43])},i(v){o||(le(i.$$.fragment,v),o=!0)},o(v){re(i.$$.fragment,v),o=!1},d(v){v&&Y(t),De(i),z(),g=!1,_()}}}function Pt(e){let n,t,i,a=[],l=new Map,c,o,g,_=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/plus.svg) no-repeat center / contain; mask: url(${te}/images/svg/plus.svg) no-repeat center / contain;"></span>`,m,E,D,V=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/trash.svg) no-repeat center / contain; mask: url(${te}/images/svg/trash.svg) no-repeat center / contain;"></span>`,z,v,y,u,f,w,b=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/pencil.svg) no-repeat center / contain; mask: url(${te}/images/svg/pencil.svg) no-repeat center / contain;"></span>`,I,x,L=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/gear.svg) no-repeat center / contain; mask: url(${te}/images/svg/gear.svg) no-repeat center / contain;"></span>`,G,M,N,$,K,F,Q,ae,oe=_e(e[3].order);const ee=X=>X[43];for(let X=0;X<oe.length;X+=1){let C=et(e,oe,X),P=ee(C);l.set(P,a[X]=tt(P,C))}return N=new ft({props:{title:e[6],active:!e[8],preventHover:!0}}),{c(){n=O("div"),t=O("div"),i=O("div");for(let X=0;X<a.length;X+=1)a[X].c();c=ne(),o=O("div"),g=O("button"),g.innerHTML=_,m=ne(),E=O("div"),D=O("button"),D.innerHTML=V,z=ne(),v=O("button"),y=O("span"),f=ne(),w=O("button"),w.innerHTML=b,I=ne(),x=O("a"),x.innerHTML=L,G=ne(),M=O("div"),Te(N.$$.fragment),$=ne(),K=O("div"),this.h()},l(X){n=B(X,"DIV",{class:!0});var C=q(n);t=B(C,"DIV",{class:!0});var P=q(t);i=B(P,"DIV",{class:!0});var Z=q(i);for(let h=0;h<a.length;h+=1)a[h].l(Z);Z.forEach(Y),c=ie(P),o=B(P,"DIV",{class:!0});var me=q(o);g=B(me,"BUTTON",{class:!0,"data-svelte-h":!0}),Pe(g)!=="svelte-g0ls06"&&(g.innerHTML=_),me.forEach(Y),m=ie(P),E=B(P,"DIV",{class:!0});var J=q(E);D=B(J,"BUTTON",{class:!0,"data-svelte-h":!0}),Pe(D)!=="svelte-hhcvrt"&&(D.innerHTML=V),z=ie(J),v=B(J,"BUTTON",{class:!0});var pe=q(v);y=B(pe,"SPAN",{class:!0,style:!0}),q(y).forEach(Y),pe.forEach(Y),f=ie(J),w=B(J,"BUTTON",{class:!0,"data-svelte-h":!0}),Pe(w)!=="svelte-4n2i7g"&&(w.innerHTML=b),I=ie(J),x=B(J,"A",{class:!0,href:!0,"data-svelte-h":!0}),Pe(x)!=="svelte-8w27ao"&&(x.innerHTML=L),J.forEach(Y),G=ie(P),M=B(P,"DIV",{class:!0});var we=q(M);Le(N.$$.fragment,we),we.forEach(Y),P.forEach(Y),$=ie(C),K=B(C,"DIV",{class:!0}),q(K).forEach(Y),C.forEach(Y),this.h()},h(){H(i,"class","tabs svelte-11x45ky"),H(g,"class","button svelte-11x45ky"),H(o,"class","new-tab-container svelte-11x45ky"),H(D,"class","close button svelte-11x45ky"),H(y,"class","button-icon svelte-11x45ky"),Ze(y,"-webkit-mask","url("+te+"/images/svg/refresh.svg) no-repeat center / contain"),Ze(y,"mask","url("+te+"/images/svg/refresh.svg) no-repeat center / contain"),H(v,"class","refresh button svelte-11x45ky"),v.disabled=u=e[14].savingStatus==="saving",H(w,"class","pencil button svelte-11x45ky"),U(w,"selected",e[3].activeTool==="pencil"),H(x,"class","button svelte-11x45ky"),H(x,"href",te+"/settings"),H(E,"class","settings-container svelte-11x45ky"),H(M,"class","clone svelte-11x45ky"),U(M,"dragging",e[2]),H(t,"class","tabbar svelte-11x45ky"),H(K,"class","divider svelte-11x45ky"),H(n,"class","svelte-11x45ky")},m(X,C){se(X,n,C),S(n,t),S(t,i);for(let P=0;P<a.length;P+=1)a[P]&&a[P].m(i,null);e[23](i),S(t,c),S(t,o),S(o,g),S(t,m),S(t,E),S(E,D),S(E,z),S(E,v),S(v,y),S(E,f),S(E,w),S(E,I),S(E,x),S(t,G),S(t,M),Ce(N,M,null),e[25](M),S(n,$),S(n,K),e[26](n),F=!0,Q||(ae=[ye(g,"click",e[15]),ye(D,"click",e[24]),ye(v,"click",function(){Se(e[0])&&e[0].apply(this,arguments)}),ye(w,"click",function(){Se(e[1])&&e[1].apply(this,arguments)})],Q=!0)},p(X,C){e=X,C[0]&801832&&(oe=_e(e[3].order),Be(),a=ze(a,C,ee,1,e,oe,l,i,Ge,tt,null,et),Ne()),(!F||C[0]&16384&&u!==(u=e[14].savingStatus==="saving"))&&(v.disabled=u),(!F||C[0]&8)&&U(w,"selected",e[3].activeTool==="pencil");const P={};C[0]&64&&(P.title=e[6]),C[0]&256&&(P.active=!e[8]),N.$set(P),(!F||C[0]&4)&&U(M,"dragging",e[2])},i(X){if(!F){for(let C=0;C<oe.length;C+=1)le(a[C]);le(N.$$.fragment,X),F=!0}},o(X){for(let C=0;C<a.length;C+=1)re(a[C]);re(N.$$.fragment,X),F=!1},d(X){X&&Y(n);for(let C=0;C<a.length;C+=1)a[C].d();e[23](null),De(N),e[25](null),e[26](null),Q=!1,dt(ae)}}}const St=12,Oe=200,Ye=32,Xe=200,Mt=1600,nt=.3;function At(e,n,t){let i,a,l,c,o;fe(e,je,r=>t(3,l=r)),fe(e,ue,r=>t(13,c=r)),fe(e,ut,r=>t(14,o=r));let{refreshClicked:g=()=>{}}=n,{pencilClicked:_=()=>{Me(je,l.activeTool=l.activeTool==="pencil"?void 0:"pencil",l)}}=n,m,E=[],D=0,V=null,z=-1,v="",y,u,f,w=!1,b=!1,I=0,x=0,L,G=!1;const M=(r,p=300)=>{let T;return(...A)=>{clearTimeout(T),T=setTimeout(()=>{r.apply(void 0,A)},p)}};function N(){de.newTab()}const $=r=>{const p=l.order.findIndex(T=>T===r);if(p<0||!E[p]){console.warn("Cannot close tab!");return}D=E[p].getBoundingClientRect().width,p<l.order.length-1&&(m.style.setProperty("--tab-max-width",`${D}px`),K()),p==l.activeIndex&&(p==l.order.length-1?de.setActiveIndex(p-1):de.setActiveIndex(p+1)),Ue({duration:Xe,easing:ve,onStep:(T,A)=>{p==0?t(4,m.style.gridTemplateColumns=`minmax(${A*Ye}px, ${A*D}px)`,m):t(4,m.style.gridTemplateColumns=`repeat(${p}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${A*Ye}px, ${A*D}px)`,m)},onEnd:()=>{t(4,m.style.gridTemplateColumns="",m),de.removeTab(r)}})},K=M(()=>{m&&(m.style.setProperty("--tab-max-width",`${Oe}px`),Ue({duration:Xe,easing:ve,onStep:(r,p)=>{m.style.setProperty("--tab-max-width",`${D+r*(Oe-D)}px`)},onEnd:()=>{m.style.setProperty("--tab-max-width",`${Oe}px`)}}))},Mt);function F(r){if(!m)return;const p=r.getBoundingClientRect().width;Ue({duration:Xe,easing:ve,onStep:(T,A)=>{l.order.length==1?t(4,m.style.gridTemplateColumns=`minmax(${T*Ye}px, ${T*p}px)`,m):t(4,m.style.gridTemplateColumns=`repeat(${l.order.length-1}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${T*Ye}px, ${T*p}px)`,m),t(4,m.scrollLeft=m.scrollWidth,m)},onEnd:()=>{t(4,m.style.gridTemplateColumns="",m)}})}const Q=(r,p)=>{const T=E[0].getBoundingClientRect().width;de.moveTab(r,p,()=>{if(r>p)for(let A=p;A<r;A++)$e(E[A],{duration:Xe,easing:ve,css:(ke,ce)=>`transform: translateX(-${ce*T}px);`});if(r<p)for(let A=p;A>r;A--)$e(E[A],{duration:Xe,easing:ve,css:(ke,ce)=>`transform: translateX(${ce*T}px);`})})};function ae(r){!r.target||!r.dataTransfer||(r.dataTransfer.setData("text/plain",i),r.dataTransfer.setDragImage(new Image,0,0))}function oe(r,p){if(r==0&&p==0){t(7,f.style.left="-1000px",f),t(7,f.style.top="-1000px",f);return}let T=L.getBoundingClientRect();if(r<T.left||r>T.right||p<T.top||p>T.bottom){b||(x=0),t(7,f.style.left=`${r+I}px`,f),t(7,f.style.top=`${p-u.height/2}px`,f),t(8,b=!0);return}b&&t(8,b=!1),t(7,f.style.left=`${r+I}px`,f),t(7,f.style.top=`${u.top}px`,f);const A=-m.scrollLeft,ke=E[0].getBoundingClientRect().width;let ce=-1;if(r>A+l.order.length*ke)ce=l.order.length-1;else for(let Ie=0;Ie<l.order.length;Ie++)if(r>A+Ie*ke&&r<A+(Ie+1)*ke){ce=Ie;break}r<20?(x=-nt,requestAnimationFrame(X)):r>m.clientWidth-10?(x=nt,requestAnimationFrame(X)):x=0,!(ce==-1||ce==l.placeholderIndex)&&Q(l.placeholderIndex,ce)}let ee=0;function X(r){if(!w||x==0){ee=0;return}ee==0&&(ee=r);const p=r-ee;ee=r,m.scrollBy({left:x*p}),requestAnimationFrame(X)}function C(r,p){if(!r.target)return;let T,A;r instanceof TouchEvent?(T=r.touches[0].clientX,A=r.touches[0].clientY):(T=r.clientX,A=r.clientY),window.addEventListener("touchmove",P,{passive:!1}),window.addEventListener("touchend",Z),window.addEventListener("mousemove",P),window.addEventListener("mouseup",Z),window.addEventListener("drag",P),window.addEventListener("dragend",Z),window.addEventListener("blur",Z),de.setActiveIndex(p),y=r.target,u=y.getBoundingClientRect(),V=[T,A],I=u.left-T,u.top-A,t(7,f.style.width=`${u.width}px`,f),t(7,f.style.left=`${u.left}px`,f),t(7,f.style.top=`${u.top}px`,f),z=p,t(6,v=c[l.order[p]].title)}function P(r){let p,T;if(r instanceof TouchEvent?(p=r.touches[0].clientX,T=r.touches[0].clientY,r.preventDefault()):(p=r.clientX,T=r.clientY),w){oe(p,T);return}V===null||Math.hypot(V[0]-p,V[1]-T)<St||(t(2,w=!0),de.setPlaceholderIndex(z),de.setActiveIndex(z))}function Z(){window.removeEventListener("touchmove",P),window.removeEventListener("touchend",Z),window.removeEventListener("mousemove",P),window.removeEventListener("mouseup",Z),window.removeEventListener("drag",P),window.removeEventListener("dragend",Z),window.removeEventListener("blur",Z),V=null,t(8,b=!1),z=-1,I=0,de.setPlaceholderIndex(),t(2,w=!1)}Qe(()=>{m.style.setProperty("--tab-max-width",`${Oe}px`),m.style.setProperty("--tab-min-width",`${Ye}px`)});const me=(r,p)=>C(p,r);function J(r,p){e.$$.not_equal(c[p].title,r)&&(c[p].title=r,ue.set(c))}function pe(r,p){he[r?"unshift":"push"](()=>{E[p]=r,t(5,E)})}function we(r){he[r?"unshift":"push"](()=>{m=r,t(4,m)})}const h=()=>$(i);function R(r){he[r?"unshift":"push"](()=>{f=r,t(7,f)})}function j(r){he[r?"unshift":"push"](()=>{L=r,t(9,L)})}return e.$$set=r=>{"refreshClicked"in r&&t(0,g=r.refreshClicked),"pencilClicked"in r&&t(1,_=r.pencilClicked)},e.$$.update=()=>{e.$$.dirty[0]&8&&t(11,i=l.order[l.activeIndex]),e.$$.dirty[0]&8&&t(12,a=l.order[l.placeholderIndex]),e.$$.dirty[0]&4&&(w?t(10,G=!0):setTimeout(()=>t(10,G=!1),20))},[g,_,w,l,m,E,v,f,b,L,G,i,a,c,o,N,$,F,ae,C,me,J,pe,we,h,R,j]}class Ht extends He{constructor(n){super(),Re(this,n,At,Pt,Ae,{refreshClicked:0,pencilClicked:1},null,[-1,-1])}}function Rt(e){let n,t;return{c(){n=O("div"),t=O("div"),this.h()},l(i){n=B(i,"DIV",{class:!0});var a=q(n);t=B(a,"DIV",{class:!0}),q(t).forEach(Y),a.forEach(Y),this.h()},h(){H(t,"class","quill-editor svelte-1zs6ve"),H(n,"class","quill-editor-wrapper svelte-1zs6ve"),U(n,"disabled",e[0])},m(i,a){se(i,n,a),S(n,t),e[5](t)},p(i,[a]){a&1&&U(n,"disabled",i[0])},i:be,o:be,d(i){i&&Y(n),e[5](null)}}}function Ot(e,n,t){let i,a;fe(e,ue,b=>t(6,i=b)),fe(e,Ct,b=>t(4,a=b));let{tabID:l}=n,{disabled:c=!1}=n,o,g;const _=(b,I=300)=>{let x;return(...L)=>{clearTimeout(x),x=setTimeout(()=>{b.apply(void 0,L)},I)}};async function m(b){var G,M,N,$;if(!o)return;const{Delta:I,Range:x}=await Je(async()=>{const{Delta:K,Range:F}=await import("../chunks/core.CG__ofcG.js").then(Q=>Q.G);return{Delta:K,Range:F}},[],import.meta.url);if(b.undo.length>0)for(var L=0;L<b.undo.length;L++){const K=(G=b.undo[L].range)==null?void 0:G.index,F=(M=b.undo[L].range)==null?void 0:M.length,Q={delta:new I(b.undo[L].delta.ops),range:K!==void 0&&F!==void 0?new x(K,F):null};o.history.stack.undo.push(Q)}if(b.redo.length>0)for(var L=0;L<b.redo.length;L++){const F=(N=b.redo[L].range)==null?void 0:N.index,Q=($=b.redo[L].range)==null?void 0:$.length,ae={delta:new I(b.redo[L].delta.ops),range:F!==void 0&&Q!==void 0?new x(F,Q):null};o.history.stack.redo.push(ae)}}function E(b){var I;o&&((I=o.getSelection())==null?void 0:I.length)===0&&window.open(b.target.href,"_blank")}function D(){if(!o||!i[l])return;const b=i[l].ops;o.setContents(b);const I=i[l].history;m(I)}function V(){if(!o||!i[l])return;Me(ue,i[l].ops=o.getContents().ops,i);const b=structuredClone(o.history.stack);Me(ue,i[l].history=b,i)}const z=_(V,500);function v(){if(!o)return;o.formatText(0,o.getLength(),"link",!1,"api");const b=o.getText(),I=/https?:\/\/\S+/gi,x=b.matchAll(I);for(const M of x)o.formatText(M.index,M[0].length,"link",M[0],"api");const L=/.+\@.+\..+/gi,G=b.matchAll(L);for(const M of G)o.formatText(M.index,M[0].length,"link","mailto:"+M[0],"api");document.querySelectorAll(".ql-editor a").forEach(M=>{M.addEventListener("click",E)})}const y=_(v,500);function u(b,I,x){if(x==="user"){const L=o.getText().split(`
`)[0].trim();Me(ue,i[l].title=L===""?"Untitled":L,i),y(),z()}}async function f(){const{default:b}=await Je(async()=>{const{default:I}=await import("../chunks/quill.Bk4jDS0q.js");return{default:I}},__vite__mapDeps([0,1]),import.meta.url);t(3,o=new b(g,{formats:["bold","italic","underline","strike","code","link"],placeholder:"Enter text here"})),D(),v(),o.on("text-change",u),o.keyboard.addBinding({key:"/",altKey:!0},()=>{o.format("code",!o.getFormat().code)}),o.keyboard.addBinding({key:"-",altKey:!0},()=>{o.format("strike",!o.getFormat().strike)})}Qe(()=>{f()});function w(b){he[b?"unshift":"push"](()=>{g=b,t(1,g)})}return e.$$set=b=>{"tabID"in b&&t(2,l=b.tabID),"disabled"in b&&t(0,c=b.disabled)},e.$$.update=()=>{e.$$.dirty&9&&(c?o==null||o.disable():o==null||o.enable()),e.$$.dirty&24&&(o==null||o.root.setAttribute("spellcheck",a.spellCheck.toString()))},[c,g,l,o,a,w]}class Bt extends He{constructor(n){super(),Re(this,n,Ot,Rt,Ae,{tabID:2,disabled:0})}}const it=500,Nt=300,st=500,Vt=300;class Wt{constructor(){W(this,"isMoving",!1);W(this,"isLongclick",!1);W(this,"button",0);W(this,"lastX",0);W(this,"lastY",0);W(this,"consecutiveClicks",0);W(this,"lastMouseupTime",0);W(this,"activeElement",null);this.reset()}reset(){this.isMoving=!1,this.isLongclick=!1,this.button=0,this.lastX=0,this.lastY=0,this.consecutiveClicks=0,this.lastMouseupTime=0,this.activeElement=null}}class Ft{constructor(){W(this,"isDragging",!1);W(this,"isPinching",!1);W(this,"isLongpressed",!1);W(this,"consecutiveTaps",0);W(this,"lastTouchendTime",0);W(this,"lastCenterX",0);W(this,"lastCenterY",0);W(this,"identifier",0);W(this,"x",0);W(this,"y",0);W(this,"hypotenuse",0);W(this,"activeElement",null);this.reset()}reset(){this.isDragging=!1,this.isPinching=!1,this.isLongpressed=!1,this.consecutiveTaps=0,this.lastTouchendTime=0,this.lastCenterX=0,this.lastCenterY=0,this.identifier=0,this.x=0,this.y=0,this.hypotenuse=0,this.activeElement=null}}let ge=[],d=new Wt,s=new Ft;const k=(e,n)=>{e!=null&&e.dispatchEvent(new CustomEvent("gesture",{detail:n,bubbles:!1,cancelable:!1}))},gt=e=>{d.reset(),s.reset(),d.lastMouseupTime=Date.now(),window.removeEventListener("mousemove",Ve),window.removeEventListener("mouseup",We),window.removeEventListener("touchmove",Fe),window.removeEventListener("touchend",Ee)},ht=e=>{if(window.removeEventListener("mousemove",Ve),window.removeEventListener("mouseup",We),window.removeEventListener("touchmove",Fe),window.removeEventListener("touchend",Ee),d.isMoving)if(d.isMoving=!1,d.isLongclick)d.isLongclick=!1,k(d.activeElement,{event:e,name:"longclick-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});else switch(d.button){case 0:k(d.activeElement,{event:e,name:"left-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break;case 1:k(d.activeElement,{event:e,name:"middle-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break;case 2:k(d.activeElement,{event:e,name:"right-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break}d.isLongclick&&k(d.activeElement,{event:e,name:"longclick-release",x:d.lastX,y:d.lastY,dx:0,dy:0}),d.reset(),s.isDragging&&(s.isDragging=!1,s.isLongpressed?(s.isLongpressed=!1,k(s.activeElement,{event:e,name:"longpress-drag-end",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0})):k(s.activeElement,{event:e,name:"touch-drag-end",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0})),s.isLongpressed&&k(s.activeElement,{event:e,name:"longpress-release",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0}),s.reset()},mt=e=>{k(e.target,{event:e,name:"wheel",x:e.clientX,y:e.clientY,dx:0,dy:0})},vt=e=>{},yt=e=>{document.activeElement!==e.target&&(window.addEventListener("mousemove",Ve),window.addEventListener("mouseup",We),d.activeElement=e.target,d.lastX=e.clientX,d.lastY=e.clientY,d.isMoving||(d.button=e.button),d.button===0&&window.setTimeout(()=>{Date.now()-d.lastMouseupTime>=st&&!d.isMoving&&(d.isLongclick=!0,k(d.activeElement,{event:e,name:"longclick",x:e.clientX,y:e.clientY,dx:0,dy:0}))},st))},Ve=e=>{if(e.movementX===0&&e.movementY===0)return;let n=e.clientX-d.lastX,t=e.clientY-d.lastY;if(!d.isMoving)if(d.isLongclick)k(d.activeElement,{event:e,name:"longclick-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});else switch(d.button){case 0:k(d.activeElement,{event:e,name:"left-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 1:k(d.activeElement,{event:e,name:"middle-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 2:k(d.activeElement,{event:e,name:"right-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break}if(d.isMoving=!0,d.lastX=e.clientX,d.lastY=e.clientY,d.isLongclick)k(d.activeElement,{event:e,name:"longclick-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});else switch(d.button){case 0:k(d.activeElement,{event:e,name:"left-click-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});break;case 1:k(d.activeElement,{event:e,name:"middle-click-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});break;case 2:k(d.activeElement,{event:e,name:"right-click-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});break}},We=e=>{if(window.removeEventListener("mousemove",Ve),window.removeEventListener("mouseup",We),d.lastMouseupTime=Date.now(),d.isMoving)if(d.isMoving=!1,d.isLongclick)d.isLongclick=!1,k(d.activeElement,{event:e,name:"longclick-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});else switch(d.button){case 0:k(d.activeElement,{event:e,name:"left-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break;case 1:k(d.activeElement,{event:e,name:"middle-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break;case 2:k(d.activeElement,{event:e,name:"right-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break}else d.isLongclick||(e.button===2?k(d.activeElement,{event:e,name:"right-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):e.button===1?k(d.activeElement,{event:e,name:"middle-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):(d.consecutiveClicks===0&&k(d.activeElement,{event:e,name:"left-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),d.consecutiveClicks++,window.setTimeout(()=>{d.consecutiveClicks>1&&k(d.activeElement,{event:e,name:"double-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),d.consecutiveClicks=0},Vt)));d.isLongclick&&k(d.activeElement,{event:e,name:"longclick-release",x:e.clientX,y:e.clientY,dx:0,dy:0}),d.isLongclick=!1},bt=e=>{if(e.touches.length>1,document.activeElement!==e.target){if(e.touches.length>1){if(e.touches[0].identifier===s.identifier)return;s.isPinching=!0}window.addEventListener("touchmove",Fe,{passive:!1}),window.addEventListener("touchend",Ee),window.addEventListener("touchcancel",Ee),s.identifier=e.touches[0].identifier,s.x=e.touches[0].clientX,s.y=e.touches[0].clientY,s.activeElement=e.target,window.setTimeout(()=>{s.isPinching||s.isDragging||Date.now()-s.lastTouchendTime>=it&&(s.isDragging=!1,s.isPinching=!1,s.hypotenuse=null,s.isLongpressed=!0,k(s.activeElement,{event:e,name:"longpress",x:s.x,y:s.y,dx:0,dy:0}))},it)}},Fe=e=>{if(s.isDragging){let n=s.x,t=s.y;s.x=e.touches[0].clientX,s.y=e.touches[0].clientY;let i=s.x-n,a=s.y-t;s.isLongpressed?k(s.activeElement,{event:e,name:"longpress-dragging",x:s.x,y:s.y,dx:i,dy:a,force:e.touches[0].force}):k(s.activeElement,{event:e,name:"touch-dragging",x:s.x,y:s.y,dx:i,dy:a,force:e.touches[0].force});return}else if(!s.isLongpressed&&(s.isPinching||e.touches.length>1)){s.x=e.touches[0].clientX,s.y=e.touches[0].clientY;let n={x:e.touches[1].clientX,y:e.touches[1].clientY},t={x:(s.x+n.x)/2,y:(s.y+n.y)/2},i=Math.hypot(s.x-n.x,s.y-n.y);s.hypotenuse===null&&(s.hypotenuse=i,s.lastCenterX=t.x,s.lastCenterY=t.y,k(s.activeElement,{event:e,name:"pinch-start",x:t.x,y:t.y,dx:0,dy:0})),s.isPinching=!0;let a=i/s.hypotenuse,l=t.x-s.lastCenterX,c=t.y-s.lastCenterY;k(s.activeElement,{event:e,name:"pinching",x:t.x,y:t.y,zoom:a,dx:l,dy:c}),s.hypotenuse=i,s.lastCenterX=t.x,s.lastCenterY=t.y;return}else s.isDragging=!0,s.isLongpressed?(k(s.activeElement,{event:e,name:"longpress-drag-start",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force}),s.x=e.touches[0].clientX,s.y=e.touches[0].clientY,k(s.activeElement,{event:e,name:"longpress-dragging",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force})):(k(s.activeElement,{event:e,name:"touch-drag-start",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force}),s.x=e.touches[0].clientX,s.y=e.touches[0].clientY,k(s.activeElement,{event:e,name:"touch-dragging",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force}))},Ee=e=>{s.isDragging&&e.touches.length>0&&e.touches[0].identifier===s.identifier||(s.lastTouchendTime=Date.now(),window.removeEventListener("touchmove",Fe),window.removeEventListener("touchend",Ee),window.removeEventListener("touchcancel",Ee),s.isDragging?(s.isDragging=!1,s.isLongpressed?(s.isLongpressed=!1,k(s.activeElement,{event:e,name:"longpress-drag-end",x:s.x,y:s.y,dx:0,dy:0})):k(s.activeElement,{event:e,name:"touch-drag-end",x:s.x,y:s.y,dx:0,dy:0})):s.isPinching?(s.isPinching=!1,s.hypotenuse=null,k(s.activeElement,{event:e,name:"pinch-end",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0})):s.isLongpressed||(s.consecutiveTaps===0&&k(s.activeElement,{event:e,name:"tap",x:s.x,y:s.y,dx:0,dy:0}),s.consecutiveTaps++,window.setTimeout(()=>{s.consecutiveTaps>1&&k(s.activeElement,{event:e,name:"double-tap",x:s.x,y:s.y,dx:0,dy:0}),s.consecutiveTaps=0},Nt)),s.isLongpressed&&k(s.activeElement,{event:e,name:"longpress-release",x:s.x,y:s.y,dx:0,dy:0}),s.isLongpressed=!1)};function qt(...e){for(let n of e)ge.findIndex(t=>t===n)===-1&&(ge.length==0&&(window.addEventListener("blur",ht),window.addEventListener("focus",gt)),ge.push(n),n.addEventListener("touchstart",bt,{passive:!1}),n.addEventListener("mousedown",yt,{passive:!1}),n.addEventListener("contextmenu",vt,{passive:!1}),n.addEventListener("wheel",mt,{passive:!1}))}function Ut(...e){const n=t=>{t.removeEventListener("touchstart",bt),t.removeEventListener("mousedown",yt),t.removeEventListener("contextmenu",vt),t.removeEventListener("wheel",mt)};if(e.length==0){for(let t of ge)n(t);ge=[]}else for(let t of e){let i=ge.findIndex(a=>a===t);i!==-1&&(n(t),ge.splice(i,1))}ge.length==0&&(window.removeEventListener("blur",ht),window.removeEventListener("focus",gt))}function zt(e){let n,t,i,a="LOG";return{c(){n=O("canvas"),t=ne(),i=O("div"),i.textContent=a,this.h()},l(l){n=B(l,"CANVAS",{id:!0,class:!0}),q(n).forEach(Y),t=ie(l),i=B(l,"DIV",{class:!0,"data-svelte-h":!0}),Pe(i)!=="svelte-1d0fb2l"&&(i.textContent=a),this.h()},h(){H(n,"id","canvas"),H(n,"class","svelte-1g16fxp"),U(n,"disabled",e[0]),U(n,"hide",e[1]),H(i,"class","log svelte-1g16fxp"),U(i,"hide",e[1])},m(l,c){se(l,n,c),e[12](n),se(l,t,c),se(l,i,c),e[13](i)},p(l,c){c[0]&1&&U(n,"disabled",l[0]),c[0]&2&&U(n,"hide",l[1]),c[0]&2&&U(i,"hide",l[1])},i:be,o:be,d(l){l&&(Y(n),Y(t),Y(i)),e[12](null),e[13](null)}}}const Gt=2;function lt(e){return{x:Ke(e.x),y:Ke(e.y)}}function Ke(e){return Number(e.toFixed(Gt))}function jt(e,n,t){let i,a;fe(e,ue,h=>t(25,a=h));let{radius:l=3}=n,{smoothness:c=2}=n,{stroke:o=5}=n,{pressureScaler:g=5}=n,{color:_="#000000"}=n,{disabled:m=!1}=n,{hide:E=!1}=n,{tabID:D=""}=n;function V(){y.clearRect(0,0,b,w),N=[]}function z(){if(N.length!=0){t(3,L.innerHTML="Undo",L),N.pop(),y.clearRect(0,0,b,w);for(let h=0;h<N.length;h++)ee(N[h])}}let v,y,u={x:0,y:0},f=0,w=0,b=0,I,x=!1,L,G,M,N=[];function $(){v&&(qt(v),window.addEventListener("keydown",J),M.observe(v),console.log("drawing enabled"))}function K(){v&&(Ut(v),window.removeEventListener("keydown",J),M.disconnect(),console.log("drawing disabled"))}const F=(h,R,j,r)=>{var p=j-h,T=r-R;return Math.sqrt(p*p+T*T)},Q=(h,R=300)=>{let j;return(...r)=>{clearTimeout(j),j=setTimeout(()=>{h.apply(void 0,r)},R)}};function ae(h,R){let j=v.getBoundingClientRect();return{x:(h-j.left)*I,y:(R-j.top)*I}}function oe(){console.log("resizing"),me(),I=window.devicePixelRatio;let h=v.getBoundingClientRect();w=h.height*I,b=h.width*I,t(2,v.width=b,v),t(2,v.height=w,v);for(let R=0;R<N.length;R++)ee(N[R])}function ee(h){y.lineWidth=h.lineWidths[0],y.lineCap="round",y.strokeStyle=h.color,y.beginPath(),y.moveTo(h.points[0].x,h.points[0].y),y.stroke();for(let R=0;R<h.points.length;R++)y.lineWidth=h.lineWidths[R],y.quadraticCurveTo(h.points[R].x,h.points[R].y,h.ctrlPoints[R].x,h.ctrlPoints[R].y),y.stroke(),y.beginPath(),y.moveTo(h.ctrlPoints[R].x,h.ctrlPoints[R].y)}function X(){a[D]&&Me(ue,a[D].paths=N,a)}function C(){a[D]&&(N=a[D].paths,oe())}function P(h,R,j){x=!0,u=ae(h,R),j!==void 0&&j>0?f=Math.log(j+1)*g*i:f=i,y.lineWidth=f,y.lineCap="round",y.strokeStyle=_,y.beginPath(),y.moveTo(u.x,u.y),y.stroke(),G={points:[],ctrlPoints:[],lineWidths:[],color:_}}function Z(h,R,j){if(!x)return;let r=ae(h,R);if(l>0){if(F(r.x,r.y,u.x,u.y)<=l)return;let A=Math.sqrt(r.x*r.x+r.y*r.y-2*r.x*u.x+u.x*u.x-2*r.y*u.y+u.y*u.y);if(r={x:r.x+l*((u.x-r.x)/A),y:r.y+l*((u.y-r.y)/A)},F(u.x,u.y,r.x,r.y)<=c)return}let p=(u.x+r.x)/2,T=(u.y+r.y)/2;j!==void 0&&j>0&&(f=Math.log(j+1)*g*i*.2+f*.8),y.lineWidth=f,y.quadraticCurveTo(u.x,u.y,p,T),y.stroke(),y.beginPath(),y.moveTo(p,T),G.points.push(lt(u)),G.ctrlPoints.push(lt({x:p,y:T})),G.lineWidths.push(Ke(f)),u=r}function me(){x&&(N.push(G),X()),x=!1}function J(h){h.ctrlKey&&h.key=="z"&&(z(),X()),h.preventDefault()}Qe(()=>{y=v.getContext("2d"),y.imageSmoothingEnabled=!1,v.addEventListener("gesture",h=>{switch(h.detail.name){case"left-click-drag-start":case"touch-drag-start":P(h.detail.x,h.detail.y,h.detail.force);break;case"left-click-dragging":case"touch-dragging":h.detail.force>0&&t(3,L.innerHTML=h.detail.force,L),Z(h.detail.x,h.detail.y,h.detail.force);break;case"left-click-drag-end":case"touch-drag-end":me();break}}),M=new ResizeObserver(Q(oe,0)),C(),t(0,m)});function pe(h){he[h?"unshift":"push"](()=>{v=h,t(2,v)})}function we(h){he[h?"unshift":"push"](()=>{L=h,t(3,L)})}return e.$$set=h=>{"radius"in h&&t(4,l=h.radius),"smoothness"in h&&t(5,c=h.smoothness),"stroke"in h&&t(6,o=h.stroke),"pressureScaler"in h&&t(7,g=h.pressureScaler),"color"in h&&t(8,_=h.color),"disabled"in h&&t(0,m=h.disabled),"hide"in h&&t(1,E=h.hide),"tabID"in h&&t(9,D=h.tabID)},e.$$.update=()=>{e.$$.dirty[0]&64&&(i=Math.max(o,1)),e.$$.dirty[0]&1&&(m?K():$())},[m,E,v,L,l,c,o,g,_,D,V,z,pe,we]}class Kt extends He{constructor(n){super(),Re(this,n,jt,zt,Ae,{radius:4,smoothness:5,stroke:6,pressureScaler:7,color:8,disabled:0,hide:1,tabID:9,clear:10,undo:11},null,[-1,-1])}get clear(){return this.$$.ctx[10]}get undo(){return this.$$.ctx[11]}}function rt(e,n,t){const i=e.slice();return i[4]=n[t],i}function ot(e,n,t){const i=e.slice();return i[4]=n[t],i}function Qt(e){let n,t;return n=new It({}),{c(){Te(n.$$.fragment)},l(i){Le(n.$$.fragment,i)},m(i,a){Ce(n,i,a),t=!0},p:be,i(i){t||(le(n.$$.fragment,i),t=!0)},o(i){re(n.$$.fragment,i),t=!1},d(i){De(n,i)}}}function Zt(e){let n,t,i,a,l,c=[],o=new Map,g,_,m=[],E=new Map,D;t=new Ht({props:{refreshClicked:Dt.loadFromFirestore}});let V=_e(Object.keys(e[3]));const z=u=>u[4];for(let u=0;u<V.length;u+=1){let f=ot(e,V,u),w=z(f);o.set(w,c[u]=at(w,f))}let v=_e(Object.keys(e[3]));const y=u=>u[4];for(let u=0;u<v.length;u+=1){let f=rt(e,v,u),w=y(f);E.set(w,m[u]=ct(w,f))}return{c(){n=O("div"),Te(t.$$.fragment),i=ne(),a=O("div"),l=O("div");for(let u=0;u<c.length;u+=1)c[u].c();g=ne(),_=O("div");for(let u=0;u<m.length;u+=1)m[u].c();this.h()},l(u){n=B(u,"DIV",{class:!0});var f=q(n);Le(t.$$.fragment,f),i=ie(f),a=B(f,"DIV",{class:!0});var w=q(a);l=B(w,"DIV",{class:!0});var b=q(l);for(let x=0;x<c.length;x+=1)c[x].l(b);b.forEach(Y),g=ie(w),_=B(w,"DIV",{class:!0});var I=q(_);for(let x=0;x<m.length;x+=1)m[x].l(I);I.forEach(Y),w.forEach(Y),f.forEach(Y),this.h()},h(){H(l,"class","editor-container svelte-1w5t1su"),H(_,"class","drawing-container svelte-1w5t1su"),U(_,"disabled",e[0].activeTool!=="pencil"),H(a,"class","canvas-container svelte-1w5t1su"),H(n,"class","page-container svelte-1w5t1su")},m(u,f){se(u,n,f),Ce(t,n,null),S(n,i),S(n,a),S(a,l);for(let w=0;w<c.length;w+=1)c[w]&&c[w].m(l,null);S(a,g),S(a,_);for(let w=0;w<m.length;w+=1)m[w]&&m[w].m(_,null);D=!0},p(u,f){f&10&&(V=_e(Object.keys(u[3])),Be(),c=ze(c,f,z,1,u,V,o,l,Ge,at,null,ot),Ne()),f&11&&(v=_e(Object.keys(u[3])),Be(),m=ze(m,f,y,1,u,v,E,_,Ge,ct,null,rt),Ne()),(!D||f&1)&&U(_,"disabled",u[0].activeTool!=="pencil")},i(u){if(!D){le(t.$$.fragment,u);for(let f=0;f<V.length;f+=1)le(c[f]);for(let f=0;f<v.length;f+=1)le(m[f]);D=!0}},o(u){re(t.$$.fragment,u);for(let f=0;f<c.length;f+=1)re(c[f]);for(let f=0;f<m.length;f+=1)re(m[f]);D=!1},d(u){u&&Y(n),De(t);for(let f=0;f<c.length;f+=1)c[f].d();for(let f=0;f<m.length;f+=1)m[f].d()}}}function at(e,n){let t,i,a;return i=new Bt({props:{disabled:n[4]!==n[1],tabID:n[4]}}),{key:e,first:null,c(){t=xe(),Te(i.$$.fragment),this.h()},l(l){t=xe(),Le(i.$$.fragment,l),this.h()},h(){this.first=t},m(l,c){se(l,t,c),Ce(i,l,c),a=!0},p(l,c){n=l;const o={};c&10&&(o.disabled=n[4]!==n[1]),c&8&&(o.tabID=n[4]),i.$set(o)},i(l){a||(le(i.$$.fragment,l),a=!0)},o(l){re(i.$$.fragment,l),a=!1},d(l){l&&Y(t),De(i,l)}}}function ct(e,n){let t,i,a;return i=new Kt({props:{color:nn,stroke:$t,radius:en,smoothness:tn,tabID:n[4],hide:n[4]!==n[1],disabled:n[4]!==n[1]||n[0].activeTool!=="pencil"}}),{key:e,first:null,c(){t=xe(),Te(i.$$.fragment),this.h()},l(l){t=xe(),Le(i.$$.fragment,l),this.h()},h(){this.first=t},m(l,c){se(l,t,c),Ce(i,l,c),a=!0},p(l,c){n=l;const o={};c&8&&(o.tabID=n[4]),c&10&&(o.hide=n[4]!==n[1]),c&11&&(o.disabled=n[4]!==n[1]||n[0].activeTool!=="pencil"),i.$set(o)},i(l){a||(le(i.$$.fragment,l),a=!0)},o(l){re(i.$$.fragment,l),a=!1},d(l){l&&Y(t),De(i,l)}}}function Jt(e){let n,t,i,a;const l=[Zt,Qt],c=[];function o(g,_){return g[2].currentUser&&!g[2].isLoading?0:1}return n=o(e),t=c[n]=l[n](e),{c(){t.c(),i=xe()},l(g){t.l(g),i=xe()},m(g,_){c[n].m(g,_),se(g,i,_),a=!0},p(g,[_]){let m=n;n=o(g),n===m?c[n].p(g,_):(Be(),re(c[m],1,1,()=>{c[m]=null}),Ne(),t=c[n],t?t.p(g,_):(t=c[n]=l[n](g),t.c()),le(t,1),t.m(i.parentNode,i))},i(g){a||(le(t),a=!0)},o(g){re(t),a=!1},d(g){g&&Y(i),c[n].d(g)}}}let $t=10,en=3,tn=2,nn="#429A53";function sn(e,n,t){let i,a,l,c;return fe(e,je,o=>t(0,a=o)),fe(e,ut,o=>t(2,l=o)),fe(e,ue,o=>t(3,c=o)),e.$$.update=()=>{e.$$.dirty&1&&t(1,i=a.order[a.activeIndex])},[a,i,l,c]}class gn extends He{constructor(n){super(),Re(this,n,sn,Jt,Ae,{})}}export{gn as component};
