import{s as H,v as J,w as N,x as W,y as B,c as h,n as F,o as Z,a as R}from"../chunks/scheduler.CIGC0wka.js";import{S as j,i as A,H as ee,s as L,D as te,h as M,j as C,a as y,t as T,g as d,e as k,c as D,v as se,w as S,A as _,p as G,E as ae,q as K,k as E,r as Q,u as X,d as U}from"../chunks/index.Dl2TOe6M.js";import{s as w,a as b,c as re,d as V,e as q,g as ne,h as oe,b as x,f as ie}from"../chunks/firebaseStore.lYoxvhN0.js";import{t as P,a as z,m as le}from"../chunks/tabsStore.CErso9RI.js";import{g as ue}from"../chunks/entry.BL1RM7wU.js";import{b as I}from"../chunks/paths.Xmj4vszd.js";import{t as ce}from"../chunks/themes.BTx5Q4mv.js";const fe=!0,me="always",Ee=Object.freeze(Object.defineProperty({__proto__:null,prerender:fe,trailingSlash:me},Symbol.toStringTag,{value:"Module"}));function de(r){let e,n,t;const o=r[3].default,s=J(o,r,r[2],null);return{c(){e=new ee(!1),n=L(),s&&s.c(),this.h()},l(a){e=te(a,!1),n=M(a),s&&s.l(a),this.h()},h(){e.a=n},m(a,i){e.m(r[0],a,i),C(a,n,i),s&&s.m(a,i),t=!0},p(a,[i]){(!t||i&1)&&e.p(a[0]),s&&s.p&&(!t||i&4)&&N(s,o,a,a[2],t?B(o,a[2],i,null):W(a[2]),null)},i(a){t||(y(s,a),t=!0)},o(a){T(s,a),t=!1},d(a){a&&(e.d(),d(n)),s&&s.d(a)}}}function pe(r,e,n){let t,o;h(r,w,l=>n(1,o=l));let{$$slots:s={},$$scope:a}=e;function i(l){const c=ce.find(p=>p.name===l);return c?`<style>
    :root {
    --bg: ${c.bg};
    --bg-alt: ${c.bgAlt};
    --main: ${c.main};
    --caret: ${c.caret};
    --error: ${c.error};
    --sub: ${c.sub};
    --text: ${c.text};
    }
    </style>`:""}return r.$$set=l=>{"$$scope"in l&&n(2,a=l.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&n(0,t=i(o.theme))},[t,o,a,s]}class he extends j{constructor(e){super(),A(this,e,pe,de,H,{})}}function ge(r){let e,n=`<span class="status-icon svelte-1mx6eh7" style="-webkit-mask: url(${I}/images/svg/double-checkmark.svg) no-repeat center / contain; mask: url(${I}/images/svg/double-checkmark.svg) no-repeat center / contain;"></span>`;return{c(){e=k("div"),e.innerHTML=n,this.h()},l(t){e=D(t,"DIV",{class:!0,"data-svelte-h":!0}),se(e)!=="svelte-jbp3id"&&(e.innerHTML=n),this.h()},h(){S(e,"class","status svelte-1mx6eh7"),_(e,"saving",r[0].savingStatus==="saving"),_(e,"saved",r[0].savingStatus==="saved"),_(e,"error",r[0].savingStatus==="error")},m(t,o){C(t,e,o)},p(t,[o]){o&1&&_(e,"saving",t[0].savingStatus==="saving"),o&1&&_(e,"saved",t[0].savingStatus==="saved"),o&1&&_(e,"error",t[0].savingStatus==="error")},i:F,o:F,d(t){t&&d(e)}}}function _e(r,e,n){let t;return h(r,b,o=>n(0,t=o)),[t]}class ve extends j{constructor(e){super(),A(this,e,_e,ge,H,{})}}function be(r){let e,n,t,o,s;const a=r[2].default,i=J(a,r,r[3],null);return o=new ve({}),{c(){e=k("div"),i&&i.c(),n=L(),t=k("div"),G(o.$$.fragment),this.h()},l(l){e=D(l,"DIV",{class:!0});var c=U(e);i&&i.l(c),n=M(c),t=D(c,"DIV",{class:!0});var p=U(t);K(o.$$.fragment,p),p.forEach(d),c.forEach(d),this.h()},h(){S(t,"class","sync-status svelte-10ut5p6"),S(e,"class","container svelte-10ut5p6")},m(l,c){C(l,e,c),i&&i.m(e,null),E(e,n),E(e,t),Q(o,t,null),s=!0},p(l,c){i&&i.p&&(!s||c&8)&&N(i,a,l,l[3],s?B(a,l[3],c,null):W(l[3]),null)},i(l){s||(y(i,l),y(o.$$.fragment,l),s=!0)},o(l){T(i,l),T(o.$$.fragment,l),s=!1},d(l){l&&d(e),i&&i.d(l),X(o)}}}function Se(r){let e,n,t,o;return t=new he({props:{$$slots:{default:[be]},$$scope:{ctx:r}}}),{c(){e=k("meta"),n=L(),G(t.$$.fragment),this.h()},l(s){const a=ae("svelte-1xk05yi",document.head);e=D(a,"META",{name:!0,content:!0}),a.forEach(d),n=M(s),K(t.$$.fragment,s),this.h()},h(){S(e,"name","viewport"),S(e,"content","width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover")},m(s,a){E(document.head,e),C(s,n,a),Q(t,s,a),o=!0},p(s,[a]){const i={};a&8&&(i.$$scope={dirty:a,ctx:s}),t.$set(i)},i(s){o||(y(t.$$.fragment,s),o=!0)},o(s){T(t.$$.fragment,s),o=!1},d(s){s&&d(n),d(e),X(t,s)}}}function $e(r,e,n){let t,o,s,a,i;h(r,w,u=>n(5,t=u)),h(r,x,u=>n(6,o=u)),h(r,b,u=>n(1,s=u)),h(r,le,u=>n(7,a=u)),h(r,P,u=>n(8,i=u));let{$$slots:l={},$$scope:c}=e,p=!0;function O(){if(p)return;let u={};Object.entries(i).forEach(([m,f])=>{u[m]=JSON.stringify(f)});const v={activeIndex:a.activeIndex,settings:t,tabs:u};b.update(m=>({...m,data:v})),ie.publish()}P.subscribe(O),w.subscribe(O);function Y(u){u&&Object.entries(u).forEach(([v,m])=>{try{z.newTabFromString(v,m)}catch(f){console.warn("Failed to parse tab!",m,f);return}})}let $=!1;return Z(()=>{re.onAuthStateChanged(async u=>{if(!u){b.update(g=>({...g,isLoading:!1,currentUser:u})),n(0,$=!0);return}const v=V(q,"users",u.uid),m=await ne(v);let f={tabs:{},activeIndex:0,settings:{theme:"Canvas",spellCheck:!0}};if(m.exists())console.log("Fetching firestore user doc..."),f=m.data();else{console.log("Creating firestore user doc...");const g=V(q,"users",u.uid);await oe(g,f,{merge:!0})}Y(f.tabs),z.setActiveIndex(f.activeIndex),R(w,t=f.settings,t),b.update(g=>({...g,isLoading:!1,currentUser:u,data:f})),n(0,$=!0),p=!1})}),r.$$set=u=>{"$$scope"in u&&n(3,c=u.$$scope)},r.$$.update=()=>{r.$$.dirty&3&&!s.currentUser&&$&&(R(x,o=window.location.pathname.slice(I.length),o),ue(I+"/login"))},[$,s,l,c]}class He extends j{constructor(e){super(),A(this,e,$e,Se,H,{})}}export{He as component,Ee as universal};
