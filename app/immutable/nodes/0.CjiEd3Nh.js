import{s as x,u as J,v as N,w as P,x as W,c as v,n as F,o as X,a as R}from"../chunks/scheduler.uUNFeN3d.js";import{S as A,i as L,H as Y,s as M,D as Z,h as j,j as C,a as D,t as I,g as d,e as S,c as w,v as ee,w as b,A as _,p as B,E as te,q as G,k,r as K,u as Q,d as E}from"../chunks/index.Bn23-NmW.js";import{a as $,f as se,b as ae,d as V,c as O,g as re,s as ne}from"../chunks/firebaseStore.Bgw6Lohe.js";import{t as U,a as q}from"../chunks/tabsStore.C9BKqCl3.js";import{s as T,a as z}from"../chunks/settingsStore.BdwUC0KU.js";import{g as oe}from"../chunks/entry.C2kWb6hP.js";import{b as H}from"../chunks/paths.9c8GCMBI.js";import{t as ie}from"../chunks/themes.BTx5Q4mv.js";const le=!0,ue="always",Ie=Object.freeze(Object.defineProperty({__proto__:null,prerender:le,trailingSlash:ue},Symbol.toStringTag,{value:"Module"}));function ce(n){let e,r,a;const o=n[3].default,s=J(o,n,n[2],null);return{c(){e=new Y(!1),r=M(),s&&s.c(),this.h()},l(t){e=Z(t,!1),r=j(t),s&&s.l(t),this.h()},h(){e.a=r},m(t,c){e.m(n[0],t,c),C(t,r,c),s&&s.m(t,c),a=!0},p(t,[c]){(!a||c&1)&&e.p(t[0]),s&&s.p&&(!a||c&4)&&N(s,o,t,t[2],a?W(o,t[2],c,null):P(t[2]),null)},i(t){a||(D(s,t),a=!0)},o(t){I(s,t),a=!1},d(t){t&&(e.d(),d(r)),s&&s.d(t)}}}function fe(n,e,r){let a,o;v(n,T,u=>r(1,o=u));let{$$slots:s={},$$scope:t}=e;function c(u){const i=ie.find(f=>f.name===u);return i?`<style>
    :root {
    --bg: ${i.bg};
    --bg-alt: ${i.bgAlt};
    --main: ${i.main};
    --caret: ${i.caret};
    --error: ${i.error};
    --sub: ${i.sub};
    --text: ${i.text};
    }
    </style>`:""}return n.$$set=u=>{"$$scope"in u&&r(2,t=u.$$scope)},n.$$.update=()=>{n.$$.dirty&2&&r(0,a=c(o.theme))},[a,o,t,s]}class me extends A{constructor(e){super(),L(this,e,fe,ce,x,{})}}function de(n){let e,r=`<span class="status-icon svelte-1mx6eh7" style="-webkit-mask: url(${H}/images/svg/double-checkmark.svg) no-repeat center / contain; mask: url(${H}/images/svg/double-checkmark.svg) no-repeat center / contain;"></span>`;return{c(){e=S("div"),e.innerHTML=r,this.h()},l(a){e=w(a,"DIV",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-jbp3id"&&(e.innerHTML=r),this.h()},h(){b(e,"class","status svelte-1mx6eh7"),_(e,"saving",n[0].savingStatus==="saving"),_(e,"saved",n[0].savingStatus==="saved"),_(e,"error",n[0].savingStatus==="error")},m(a,o){C(a,e,o)},p(a,[o]){o&1&&_(e,"saving",a[0].savingStatus==="saving"),o&1&&_(e,"saved",a[0].savingStatus==="saved"),o&1&&_(e,"error",a[0].savingStatus==="error")},i:F,o:F,d(a){a&&d(e)}}}function pe(n,e,r){let a;return v(n,$,o=>r(0,a=o)),[a]}class he extends A{constructor(e){super(),L(this,e,pe,de,x,{})}}function ge(n){let e,r,a,o,s,t;const c=n[2].default,u=J(c,n,n[3],null);return s=new he({}),{c(){e=S("div"),r=S("div"),u&&u.c(),a=M(),o=S("div"),B(s.$$.fragment),this.h()},l(i){e=w(i,"DIV",{class:!0});var f=E(e);r=w(f,"DIV",{class:!0});var m=E(r);u&&u.l(m),a=j(m),o=w(m,"DIV",{class:!0});var l=E(o);G(s.$$.fragment,l),l.forEach(d),m.forEach(d),f.forEach(d),this.h()},h(){b(o,"class","sync-status svelte-14x3dky"),b(r,"class","content svelte-14x3dky"),b(e,"class","container svelte-14x3dky")},m(i,f){C(i,e,f),k(e,r),u&&u.m(r,null),k(r,a),k(r,o),K(s,o,null),t=!0},p(i,f){u&&u.p&&(!t||f&8)&&N(u,c,i,i[3],t?W(c,i[3],f,null):P(i[3]),null)},i(i){t||(D(u,i),D(s.$$.fragment,i),t=!0)},o(i){I(u,i),I(s.$$.fragment,i),t=!1},d(i){i&&d(e),u&&u.d(i),Q(s)}}}function _e(n){let e,r,a,o;return a=new me({props:{$$slots:{default:[ge]},$$scope:{ctx:n}}}),{c(){e=S("meta"),r=M(),B(a.$$.fragment),this.h()},l(s){const t=te("svelte-1xk05yi",document.head);e=w(t,"META",{name:!0,content:!0}),t.forEach(d),r=j(s),G(a.$$.fragment,s),this.h()},h(){b(e,"name","viewport"),b(e,"content","width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover")},m(s,t){k(document.head,e),C(s,r,t),K(a,s,t),o=!0},p(s,[t]){const c={};t&8&&(c.$$scope={dirty:t,ctx:s}),a.$set(c)},i(s){o||(D(a.$$.fragment,s),o=!0)},o(s){I(a.$$.fragment,s),o=!1},d(s){s&&d(r),d(e),Q(a,s)}}}function ve(n,e,r){let a,o,s,t;v(n,T,l=>r(4,a=l)),v(n,z,l=>r(5,o=l)),v(n,$,l=>r(1,s=l)),v(n,U,l=>r(6,t=l));let{$$slots:c={},$$scope:u}=e;function i(){const l=t.tabs.map(p=>JSON.stringify(p));$.update(p=>({...p,data:{activeIndex:t.activeIndex,tabs:l,settings:a}})),se.publish()}U.subscribe(i),T.subscribe(i);function f(l){l.length!==0&&l.forEach(p=>{try{q.newTabFromString(p)}catch(y){console.warn("Failed to parse tab!",p,y);return}})}let m=!1;return X(()=>{ae.onAuthStateChanged(async l=>{if(!l){$.update(g=>({...g,isLoading:!1,currentUser:l})),r(0,m=!0);return}const p=V(O,"users",l.uid),y=await re(p);let h={tabs:[],activeIndex:0,settings:{theme:"Canvas",spellCheck:!0}};if(y.exists())console.log("Fetching firestore user doc..."),h=y.data();else{console.log("Creating firestore user doc...");const g=V(O,"users",l.uid);await ne(g,h,{merge:!0})}f(h.tabs),q.setActiveIndex(h.activeIndex),R(T,a=h.settings,a),$.update(g=>({...g,isLoading:!1,currentUser:l,data:h})),r(0,m=!0)})}),n.$$set=l=>{"$$scope"in l&&r(3,u=l.$$scope)},n.$$.update=()=>{n.$$.dirty&3&&!s.currentUser&&m&&(R(z,o=window.location.pathname,o),oe(H+"/login"))},[m,s,c,u]}class Ce extends A{constructor(e){super(),L(this,e,ve,_e,x,{})}}export{Ce as component,Ie as universal};
