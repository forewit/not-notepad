import{s as H,u as J,v as K,w as N,x as X,c as y,o as Y,n as O,a as I}from"../chunks/scheduler.uUNFeN3d.js";import{S as M,i as F,H as ae,s as L,D as re,h as R,j as C,a as E,t as D,g as p,e as w,c as k,v as ne,w as g,A as v,p as Z,E as oe,q as ee,k as P,r as te,u as se,d as U}from"../chunks/index.Bn23-NmW.js";import{s as S,a as _,t as ie,c as le,b as V,m as Q,d as W,e as B,g as ce,h as ue,i as me,j as de,k as A,f as fe}from"../chunks/firebaseStore.B22G3dWM.js";import{b as x,g as pe}from"../chunks/entry.xp586oID.js";import{t as G}from"../chunks/themes.BTx5Q4mv.js";const he=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,ge=!0,be="always",je=Object.freeze(Object.defineProperty({__proto__:null,prerender:ge,trailingSlash:be},Symbol.toStringTag,{value:"Module"}));function ve(i){let e,o,s;const a=i[3].default,n=J(a,i,i[2],null);return{c(){e=new ae(!1),o=L(),n&&n.c(),this.h()},l(t){e=re(t,!1),o=R(t),n&&n.l(t),this.h()},h(){e.a=o},m(t,r){e.m(i[0],t,r),C(t,o,r),n&&n.m(t,r),s=!0},p(t,[r]){(!s||r&1)&&e.p(t[0]),n&&n.p&&(!s||r&4)&&K(n,a,t,t[2],s?X(a,t[2],r,null):N(t[2]),null)},i(t){s||(E(n,t),s=!0)},o(t){D(n,t),s=!1},d(t){t&&(e.d(),p(o)),n&&n.d(t)}}}function _e(i,e,o){let s,a;y(i,S,c=>o(1,a=c));let{$$slots:n={},$$scope:t}=e;function r(c){const m=G.find($=>$.name===c);return m?`<style>
    :root {
    --bg: ${m.bg};
    --bg-alt: ${m.bgAlt};
    --main: ${m.main};
    --caret: ${m.caret};
    --error: ${m.error};
    --sub: ${m.sub};
    --text: ${m.text};
    }
    </style>`:""}function l(){var m;const c=G.find($=>$.name===a.theme);c&&((m=document.querySelector('meta[name="theme-color"]'))==null||m.setAttribute("content",c.bg))}return Y(()=>{r(a.theme),S.subscribe(l)}),i.$$set=c=>{"$$scope"in c&&o(2,t=c.$$scope)},i.$$.update=()=>{i.$$.dirty&2&&o(0,s=r(a.theme))},[s,a,t,n]}class ye extends M{constructor(e){super(),F(this,e,_e,ve,H,{})}}function $e(i){let e,o=`<span class="status-icon svelte-1mx6eh7" style="-webkit-mask: url(${x}/images/svg/double-checkmark.svg) no-repeat center / contain; mask: url(${x}/images/svg/double-checkmark.svg) no-repeat center / contain;"></span>`;return{c(){e=w("div"),e.innerHTML=o,this.h()},l(s){e=k(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-jbp3id"&&(e.innerHTML=o),this.h()},h(){g(e,"class","status svelte-1mx6eh7"),v(e,"saving",i[0].savingStatus==="saving"),v(e,"saved",i[0].savingStatus==="saved"),v(e,"error",i[0].savingStatus==="error")},m(s,a){C(s,e,a)},p(s,[a]){a&1&&v(e,"saving",s[0].savingStatus==="saving"),a&1&&v(e,"saved",s[0].savingStatus==="saved"),a&1&&v(e,"error",s[0].savingStatus==="error")},i:O,o:O,d(s){s&&p(e)}}}function Se(i,e,o){let s;return y(i,_,a=>o(0,s=a)),[s]}class we extends M{constructor(e){super(),F(this,e,Se,$e,H,{})}}const{document:j}=he;function ke(i){let e,o,s,a,n;const t=i[0].default,r=J(t,i,i[1],null);return a=new we({}),{c(){e=w("div"),r&&r.c(),o=L(),s=w("div"),Z(a.$$.fragment),this.h()},l(l){e=k(l,"DIV",{class:!0});var c=U(e);r&&r.l(c),o=R(c),s=k(c,"DIV",{class:!0});var m=U(s);ee(a.$$.fragment,m),m.forEach(p),c.forEach(p),this.h()},h(){g(s,"class","sync-status svelte-j4k8tx"),g(e,"class","layout-container svelte-j4k8tx")},m(l,c){C(l,e,c),r&&r.m(e,null),P(e,o),P(e,s),te(a,s,null),n=!0},p(l,c){r&&r.p&&(!n||c&2)&&K(r,t,l,l[1],n?X(t,l[1],c,null):N(l[1]),null)},i(l){n||(E(r,l),E(a.$$.fragment,l),n=!0)},o(l){D(r,l),D(a.$$.fragment,l),n=!1},d(l){l&&p(e),r&&r.d(l),se(a)}}}function Te(i){let e,o,s,a,n;return a=new ye({props:{$$slots:{default:[ke]},$$scope:{ctx:i}}}),{c(){e=w("meta"),o=w("meta"),s=L(),Z(a.$$.fragment),this.h()},l(t){const r=oe("svelte-17tnzz8",j.head);e=k(r,"META",{name:!0,content:!0}),o=k(r,"META",{name:!0,content:!0}),r.forEach(p),s=R(t),ee(a.$$.fragment,t),this.h()},h(){g(e,"name","viewport"),g(e,"content","width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover"),g(o,"name","theme-color"),g(o,"content","var(--bg)")},m(t,r){P(j.head,e),P(j.head,o),C(t,s,r),te(a,t,r),n=!0},p(t,[r]){const l={};r&2&&(l.$$scope={dirty:r,ctx:t}),a.$set(l)},i(t){n||(E(a.$$.fragment,t),n=!0)},o(t){D(a.$$.fragment,t),n=!1},d(t){t&&p(s),p(e),p(o),se(a,t)}}}function Ee(){switch(screen.orientation.type){case"portrait-primary":document.documentElement.style.setProperty("--safe-area-top","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-primary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-secondary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","env(safe-area-inset-right)");break}}function De(i,e,o){let s,a,n,t;y(i,V,u=>o(3,s=u)),y(i,S,u=>o(4,a=u)),y(i,Q,u=>o(5,n=u)),y(i,_,u=>o(6,t=u));let{$$slots:r={},$$scope:l}=e,c=!0;function m(){if(c)return;const u=A.packTabs(),h={activeIndex:n.activeIndex,order:n.order,settings:a};_.update(b=>({...b,userData:h,packedTabs:u}));try{fe.publish()}catch(b){console.warn("Failed to publish to firestore",b)}}async function $(){const u=t.currentUser;if(!u)return;c=!0;const h=W(B,"users",u.uid),b=await ce(h);let f={activeIndex:0,order:[],settings:{theme:"Canvas",spellCheck:!0}},T={};if(b.exists()){console.log("Fetching firestore user doc...");const d=b.data();f={...f,...d},(await me(de(h,"tabs"))).forEach(z=>{T[z.id]=z.data()})}else{console.log("Creating firestore user doc...");const d=W(B,"users",u.uid);await ue(d,f,{merge:!0})}for(let d=0;d<f.order.length;d++){const q=f.order[d];T[q]||(f.order.splice(d,1),d--)}A.loadPackedTabs(T),I(Q,n.order=f.order,n),A.setActiveIndex(f.activeIndex),I(S,a=f.settings,a),_.update(d=>({...d,isAuthenticating:!1,userData:f,tabsData:T})),c=!1}return ie.subscribe(m),S.subscribe(m),Y(()=>{screen.orientation.addEventListener("change",Ee),le.onAuthStateChanged(async u=>{if(!u){_.update(h=>({...h,currentUser:u})),I(V,s=window.location.pathname.slice(x.length),s),pe(x+"/login");return}_.update(h=>({...h,currentUser:u})),await $()})}),i.$$set=u=>{"$$scope"in u&&o(1,l=u.$$scope)},[r,l]}class He extends M{constructor(e){super(),F(this,e,De,Te,H,{})}}export{He as component,je as universal};
