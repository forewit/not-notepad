const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/quill.Bk4jDS0q.js","../chunks/core.CG__ofcG.js"])))=>i.map(i=>d[i]);
var xt=Object.defineProperty;var Dt=(e,t,n)=>t in e?xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var W=(e,t,n)=>Dt(e,typeof t!="symbol"?t+"":t,n);import{s as _e,n as me,r as Ne,i as Se,c as ae,o as je,a as G,d as ee,A as Ct,B as ze,C as mt,e as Ue}from"../chunks/scheduler.CE28Mlnp.js";import{S as Ee,i as Te,e as z,t as It,c as R,a as O,b as Mt,d as H,w as C,A as U,g as ie,h as P,x as ne,F as Qe,j as Pt,s as Z,p as ve,f as J,v as ge,q as pe,r as be,o as xe,m as De,n as F,l as Q,u as ye,G as Re,z as Je,I as Ce,C as Ve,J as Yt,K as Xt}from"../chunks/index.CblOyuwr.js";import{e as $e,u as Ht,o as At,t as St}from"../chunks/themes.CBFgFqeR.js";import{m as q,t as he,d as ue,s as vt,a as pt,f as zt}from"../chunks/firebaseStore.BLf--Ilt.js";import{b as N}from"../chunks/paths.DkoStSqI.js";import{_ as et}from"../chunks/preload-helper.D6kgxu3v.js";import{P as Rt}from"../chunks/ProgressBar.Cdh5Uk4U.js";function jt(e){let t,n,s,o,r,c;return{c(){t=z("div"),n=z("button"),s=z("span"),o=It(e[0]),this.h()},l(d){t=R(d,"DIV",{class:!0});var i=O(t);n=R(i,"BUTTON",{class:!0,draggable:!0});var l=O(n);s=R(l,"SPAN",{class:!0});var g=O(s);o=Mt(g,e[0]),g.forEach(H),l.forEach(H),i.forEach(H),this.h()},h(){C(s,"class","title svelte-1jmw20r"),C(n,"class","tab svelte-1jmw20r"),C(n,"draggable","true"),U(n,"active",e[1]),C(t,"class","tab-container svelte-1jmw20r"),U(t,"preventHover",e[2])},m(d,i){ie(d,t,i),P(t,n),P(n,s),P(s,o),r||(c=[ne(n,"mousedown",Qe(function(){Se(e[3])&&e[3].apply(this,arguments)})),ne(n,"touchstart",Qe(function(){Se(e[3])&&e[3].apply(this,arguments)})),ne(n,"dragstart",Qe(function(){Se(e[4])&&e[4].apply(this,arguments)}))],r=!0)},p(d,[i]){e=d,i&1&&Pt(o,e[0]),i&2&&U(n,"active",e[1]),i&4&&U(t,"preventHover",e[2])},i:me,o:me,d(d){d&&H(t),r=!1,Ne(c)}}}function Vt(e,t,n){let{title:s=""}=t,{active:o=!1}=t,{preventHover:r=!1}=t,{onPointerdown:c=i=>{}}=t,{onDragstart:d=i=>{}}=t;return e.$$set=i=>{"title"in i&&n(0,s=i.title),"active"in i&&n(1,o=i.active),"preventHover"in i&&n(2,r=i.preventHover),"onPointerdown"in i&&n(3,c=i.onPointerdown),"onDragstart"in i&&n(4,d=i.onDragstart)},[s,o,r,c,d]}class bt extends Ee{constructor(t){super(),Te(this,t,Vt,jt,_e,{title:0,active:1,preventHover:2,onPointerdown:3,onDragstart:4})}}function ke(e){return e<.5?4*e*e*e:.5*Math.pow(2*e-2,3)+1}function yt(e){const t=e-1;return t*t*t+1}const tt=(e,t)=>{const{duration:n=300,easing:s=ke,onEnd:o=()=>{},onStep:r=()=>{},css:c}=t;let d;function i(l){if(!e){console.warn("Cannot find element to animate");return}d===void 0&&(d=l);const g=s((l-d)/n),m=1-g;g<1?(e.style.cssText=c(g,m),r(g,m),requestAnimationFrame(i)):(e.style.cssText="",o())}requestAnimationFrame(i)},Ze=e=>{const{duration:t=300,easing:n=ke,onEnd:s=()=>{},onStep:o=()=>{}}=e;let r;function c(d){r===void 0&&(r=d);const i=n((d-r)/t),l=1-i;i<1?(o(i,l),requestAnimationFrame(c)):s()}requestAnimationFrame(c)};function nt(e,t,n){const s=e.slice();return s[41]=t[n],s[42]=t,s[43]=n,s}function st(e,t){let n,s,o,r,c=t[43],d,i,l;function g(...w){return t[17](t[43],...w)}function m(w){t[18](w,t[41])}let u={active:t[9]==t[41],preventHover:t[8],onPointerdown:g,onDragstart:t[14]};t[11][t[41]].title!==void 0&&(u.title=t[11][t[41]].title),s=new bt({props:u}),ee.push(()=>Re(s,"title",m));const L=()=>t[19](n,c),y=()=>t[19](null,c);return{key:e,first:null,c(){n=z("div"),ve(s.$$.fragment),r=Z(),this.h()},l(w){n=R(w,"DIV",{class:!0});var f=O(n);pe(s.$$.fragment,f),r=J(f),f.forEach(H),this.h()},h(){C(n,"class","tab-container svelte-1udz9mj"),U(n,"placeholder",t[10]==t[41]),this.first=n},m(w,f){ie(w,n,f),be(s,n,null),P(n,r),L(),d=!0,i||(l=Ct(t[13].call(null,n)),i=!0)},p(w,f){t=w;const k={};f[0]&516&&(k.active=t[9]==t[41]),f[0]&256&&(k.preventHover=t[8]),f[0]&4&&(k.onPointerdown=g),!o&&f[0]&2052&&(o=!0,k.title=t[11][t[41]].title,ze(()=>o=!1)),s.$set(k),c!==t[43]&&(y(),c=t[43],L()),(!d||f[0]&1028)&&U(n,"placeholder",t[10]==t[41])},i(w){d||(F(s.$$.fragment,w),d=!0)},o(w){Q(s.$$.fragment,w),d=!1},d(w){w&&H(n),ye(s),y(),i=!1,l()}}}function Bt(e){let t,n,s,o=[],r=new Map,c,d,i,l=`<span class="button-icon svelte-1udz9mj" style="-webkit-mask: url(${N}/images/svg/plus.svg) no-repeat center / contain; mask: url(${N}/images/svg/plus.svg) no-repeat center / contain;"></span>`,g,m,u,L=`<span class="button-icon svelte-1udz9mj" style="-webkit-mask: url(${N}/images/svg/gear.svg) no-repeat center / contain; mask: url(${N}/images/svg/gear.svg) no-repeat center / contain;"></span>`,y,w,f,k,M,I,j,A,E=$e(e[2].order);const X=_=>_[41];for(let _=0;_<E.length;_+=1){let b=nt(e,E,_),T=X(b);r.set(T,o[_]=st(T,b))}return f=new bt({props:{title:e[5],active:!e[1],preventHover:!0}}),{c(){t=z("div"),n=z("div"),s=z("div");for(let _=0;_<o.length;_+=1)o[_].c();c=Z(),d=z("div"),i=z("button"),i.innerHTML=l,g=Z(),m=z("div"),u=z("button"),u.innerHTML=L,y=Z(),w=z("div"),ve(f.$$.fragment),k=Z(),M=z("div"),this.h()},l(_){t=R(_,"DIV",{class:!0});var b=O(t);n=R(b,"DIV",{class:!0});var T=O(n);s=R(T,"DIV",{class:!0});var p=O(s);for(let K=0;K<o.length;K+=1)o[K].l(p);p.forEach(H),c=J(T),d=R(T,"DIV",{class:!0});var te=O(d);i=R(te,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(i)!=="svelte-g0ls06"&&(i.innerHTML=l),te.forEach(H),g=J(T),m=R(T,"DIV",{class:!0});var re=O(m);u=R(re,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(u)!=="svelte-v7vri0"&&(u.innerHTML=L),re.forEach(H),y=J(T),w=R(T,"DIV",{class:!0});var oe=O(w);pe(f.$$.fragment,oe),oe.forEach(H),T.forEach(H),k=J(b),M=R(b,"DIV",{class:!0}),O(M).forEach(H),b.forEach(H),this.h()},h(){C(s,"class","tabs svelte-1udz9mj"),C(i,"class","button svelte-1udz9mj"),C(d,"class","new-tab-container svelte-1udz9mj"),C(u,"class","button svelte-1udz9mj"),C(m,"class","buttons-container svelte-1udz9mj"),C(w,"class","clone svelte-1udz9mj"),U(w,"draggingOutside",e[1]),U(w,"dragging",e[0]),C(n,"class","tabbar svelte-1udz9mj"),C(M,"class","divider svelte-1udz9mj"),C(t,"class","svelte-1udz9mj")},m(_,b){ie(_,t,b),P(t,n),P(n,s);for(let T=0;T<o.length;T+=1)o[T]&&o[T].m(s,null);e[20](s),P(n,c),P(n,d),P(d,i),P(n,g),P(n,m),P(m,u),P(n,y),P(n,w),be(f,w,null),e[22](w),P(t,k),P(t,M),e[23](t),I=!0,j||(A=[ne(i,"click",e[12]),ne(u,"click",e[21])],j=!0)},p(_,b){b[0]&53012&&(E=$e(_[2].order),xe(),o=Ht(o,b,X,1,_,E,r,s,At,st,null,nt),De());const T={};b[0]&32&&(T.title=_[5]),b[0]&2&&(T.active=!_[1]),f.$set(T),(!I||b[0]&2)&&U(w,"draggingOutside",_[1]),(!I||b[0]&1)&&U(w,"dragging",_[0])},i(_){if(!I){for(let b=0;b<E.length;b+=1)F(o[b]);F(f.$$.fragment,_),I=!0}},o(_){for(let b=0;b<o.length;b+=1)Q(o[b]);Q(f.$$.fragment,_),I=!1},d(_){_&&H(t);for(let b=0;b<o.length;b+=1)o[b].d();e[20](null),ye(f),e[22](null),e[23](null),j=!1,Ne(A)}}}const Ot=12,Be=200,He=32,Ae=200,Nt=1600,it=.3;function Ut(e,t,n){let s,o,r,c;ae(e,q,v=>n(2,r=v)),ae(e,he,v=>n(11,c=v));const d=()=>{b(r.order[r.activeIndex])};let i,l=[],g=0,m=null,u=-1,L="",y,w,f,k=!1,M=!1,I=0,j=0,A,E=!1;const X=(v,D=300)=>{let S;return(...B)=>{clearTimeout(S),S=setTimeout(()=>{v.apply(void 0,B)},D)}};function _(){ue.newTab()}const b=v=>{const D=r.order.findIndex(S=>S===v);if(D<0||!l[D]){console.warn("Cannot close tab!");return}g=l[D].getBoundingClientRect().width,D<r.order.length-1&&(i.style.setProperty("--tab-max-width",`${g}px`),T()),D==r.activeIndex&&(D==r.order.length-1?ue.setActiveIndex(D-1):ue.setActiveIndex(D+1)),Ze({duration:Ae,easing:ke,onStep:(S,B)=>{D==0?n(3,i.style.gridTemplateColumns=`minmax(${B*He}px, ${B*g}px)`,i):n(3,i.style.gridTemplateColumns=`repeat(${D}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${B*He}px, ${B*g}px)`,i)},onEnd:()=>{n(3,i.style.gridTemplateColumns="",i),ue.removeTab(v)}})},T=X(()=>{i&&(i.style.setProperty("--tab-max-width",`${Be}px`),Ze({duration:Ae,easing:ke,onStep:(v,D)=>{i.style.setProperty("--tab-max-width",`${g+v*(Be-g)}px`)},onEnd:()=>{i.style.setProperty("--tab-max-width",`${Be}px`)}}))},Nt);function p(v){if(!i)return;const D=v.getBoundingClientRect().width;Ze({duration:Ae,easing:ke,onStep:(S,B)=>{r.order.length==1?n(3,i.style.gridTemplateColumns=`minmax(${S*He}px, ${S*D}px)`,i):n(3,i.style.gridTemplateColumns=`repeat(${r.order.length-1}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${S*He}px, ${S*D}px)`,i),n(3,i.scrollLeft=i.scrollWidth,i)},onEnd:()=>{n(3,i.style.gridTemplateColumns="",i)}})}const te=(v,D)=>{const S=l[0].getBoundingClientRect().width;ue.moveTab(v,D,()=>{if(v>D)for(let B=D;B<v;B++)tt(l[B],{duration:Ae,easing:ke,css:(Ye,ce)=>`transform: translateX(-${ce*S}px);`});if(v<D)for(let B=D;B>v;B--)tt(l[B],{duration:Ae,easing:ke,css:(Ye,ce)=>`transform: translateX(${ce*S}px);`})})};function re(v){!v.target||!v.dataTransfer||(v.dataTransfer.setData("text/plain",s),v.dataTransfer.setDragImage(new Image,0,0))}function oe(v,D){if(v==0&&D==0){n(6,f.style.left="-1000px",f),n(6,f.style.top="-1000px",f);return}let S=A.getBoundingClientRect();if(v<S.left||v>S.right||D<S.top||D>S.bottom){M||(j=0),n(6,f.style.left=`${v+I}px`,f),n(6,f.style.top=`${D-w.height/2}px`,f),n(1,M=!0);return}M&&n(1,M=!1),n(6,f.style.left=`${v+I}px`,f),n(6,f.style.top=`${w.top}px`,f);const B=-i.scrollLeft,Ye=l[0].getBoundingClientRect().width;let ce=-1;if(v>B+r.order.length*Ye)ce=r.order.length-1;else for(let Xe=0;Xe<r.order.length;Xe++)if(v>B+Xe*Ye&&v<B+(Xe+1)*Ye){ce=Xe;break}v<20?(j=-it,requestAnimationFrame(se)):v>i.clientWidth-10?(j=it,requestAnimationFrame(se)):j=0,!(ce==-1||ce==r.placeholderIndex)&&te(r.placeholderIndex,ce)}let K=0;function se(v){if(!k||j==0){K=0;return}K==0&&(K=v);const D=v-K;K=v,i.scrollBy({left:j*D}),requestAnimationFrame(se)}function Le(v,D){if(!v.target)return;let S,B;v instanceof TouchEvent?(S=v.touches[0].clientX,B=v.touches[0].clientY,v.preventDefault()):(S=v.clientX,B=v.clientY),window.addEventListener("touchmove",de,{passive:!1}),window.addEventListener("touchend",le),window.addEventListener("mousemove",de),window.addEventListener("mouseup",le),window.addEventListener("drag",de),window.addEventListener("dragend",le),window.addEventListener("blur",le),ue.setActiveIndex(D),y=v.target,w=y.getBoundingClientRect(),m=[S,B],I=w.left-S,w.top-B,n(6,f.style.width=`${w.width}px`,f),n(6,f.style.left=`${w.left}px`,f),n(6,f.style.top=`${w.top}px`,f),u=D,n(5,L=c[r.order[D]].title)}function de(v){let D,S;if(v instanceof TouchEvent?(D=v.touches[0].clientX,S=v.touches[0].clientY):(D=v.clientX,S=v.clientY),k){oe(D,S);return}m===null||Math.hypot(m[0]-D,m[1]-S)<Ot||(n(0,k=!0),ue.setPlaceholderIndex(u),ue.setActiveIndex(u))}function le(){window.removeEventListener("touchmove",de),window.removeEventListener("touchend",le),window.removeEventListener("mousemove",de),window.removeEventListener("mouseup",le),window.removeEventListener("drag",de),window.removeEventListener("dragend",le),window.removeEventListener("blur",le),m=null,n(1,M=!1),u=-1,I=0,ue.setPlaceholderIndex(),n(0,k=!1)}je(()=>{i.style.setProperty("--tab-max-width",`${Be}px`),i.style.setProperty("--tab-min-width",`${He}px`)});const Me=(v,D)=>Le(D,v);function Pe(v,D){e.$$.not_equal(c[D].title,v)&&(c[D].title=v,he.set(c))}function Ge(v,D){ee[v?"unshift":"push"](()=>{l[D]=v,n(4,l)})}function Ke(v){ee[v?"unshift":"push"](()=>{i=v,n(3,i)})}const x=()=>{G(q,r.toolbarVisible=!r.toolbarVisible,r),r.toolbarVisible||G(q,r.tool=void 0,r)};function $(v){ee[v?"unshift":"push"](()=>{f=v,n(6,f)})}function V(v){ee[v?"unshift":"push"](()=>{A=v,n(7,A)})}return e.$$.update=()=>{e.$$.dirty[0]&2&&(M?G(q,r.trashcanVisible=!0,r):G(q,r.trashcanVisible=!1,r)),e.$$.dirty[0]&4&&n(9,s=r.order[r.activeIndex]),e.$$.dirty[0]&4&&n(10,o=r.order[r.placeholderIndex]),e.$$.dirty[0]&1&&(k?n(8,E=!0):setTimeout(()=>{n(8,E=!1)},20))},[k,M,r,i,l,L,f,A,E,s,o,c,_,p,re,Le,d,Me,Pe,Ge,Ke,x,$,V]}class Ft extends Ee{constructor(t){super(),Te(this,t,Ut,Bt,_e,{closeActiveTab:16},null,[-1,-1])}get closeActiveTab(){return this.$$.ctx[16]}}function Wt(e){let t,n;return{c(){t=z("div"),n=z("div"),this.h()},l(s){t=R(s,"DIV",{class:!0});var o=O(t);n=R(o,"DIV",{class:!0}),O(n).forEach(H),o.forEach(H),this.h()},h(){C(n,"class","quill-editor"),C(t,"class","quill-editor-container svelte-16m16ue"),U(t,"disabled",e[0])},m(s,o){ie(s,t,o),P(t,n),e[7](n)},p(s,[o]){o&1&&U(t,"disabled",s[0])},i:me,o:me,d(s){s&&H(t),e[7](null)}}}function qt(e,t,n){let s,o;ae(e,he,E=>n(8,s=E)),ae(e,vt,E=>n(6,o=E));let{tabID:r}=t,{disabled:c=!1}=t;const d=()=>{l&&l.setSelection(l.getLength(),0)},i=()=>{l&&l.blur()};let l,g;const m=(E,X=300)=>{let _;return(...b)=>{clearTimeout(_),_=setTimeout(()=>{E.apply(void 0,b)},X)}};async function u(E){var T,p,te,re;if(!l)return;const{Delta:X,Range:_}=await et(async()=>{const{Delta:oe,Range:K}=await import("../chunks/core.CG__ofcG.js").then(se=>se.G);return{Delta:oe,Range:K}},[],import.meta.url);if(E.undo.length>0)for(var b=0;b<E.undo.length;b++){const oe=(T=E.undo[b].range)==null?void 0:T.index,K=(p=E.undo[b].range)==null?void 0:p.length,se={delta:new X(E.undo[b].delta.ops),range:oe!==void 0&&K!==void 0?new _(oe,K):null};l.history.stack.undo.push(se)}if(E.redo.length>0)for(var b=0;b<E.redo.length;b++){const K=(te=E.redo[b].range)==null?void 0:te.index,se=(re=E.redo[b].range)==null?void 0:re.length,Le={delta:new X(E.redo[b].delta.ops),range:K!==void 0&&se!==void 0?new _(K,se):null};l.history.stack.redo.push(Le)}}function L(E){var X;l&&((X=l.getSelection())==null?void 0:X.length)===0&&window.open(E.target.href,"_blank")}function y(){if(!l||!s[r])return;const E=s[r].ops;l.setContents(E);const X=s[r].history;u(X)}function w(){if(!l||!s[r])return;G(he,s[r].ops=l.getContents().ops,s);const E=structuredClone(l.history.stack);G(he,s[r].history=E,s)}const f=m(w,500);function k(){if(!l)return;l.formatText(0,l.getLength(),"link",!1,"api");const E=l.getText(),X=/https?:\/\/\S+/gi,_=E.matchAll(X);for(const p of _)l.formatText(p.index,p[0].length,"link",p[0],"api");const b=/.+\@.+\..+/gi,T=E.matchAll(b);for(const p of T)l.formatText(p.index,p[0].length,"link","mailto:"+p[0],"api");document.querySelectorAll(".ql-editor a").forEach(p=>{p.addEventListener("click",L)})}const M=m(k,500);function I(E,X,_){if(_==="user"){const b=l.getText().split(`
`)[0].trim();G(he,s[r].title=b===""?"Untitled":b,s),M(),f()}}async function j(){const{default:E}=await et(async()=>{const{default:X}=await import("../chunks/quill.Bk4jDS0q.js");return{default:X}},__vite__mapDeps([0,1]),import.meta.url);n(5,l=new E(g,{formats:["bold","italic","underline","strike","code","link"],placeholder:"Enter text here"})),y(),k(),l.on("text-change",I),l.keyboard.addBinding({key:"/",altKey:!0},()=>{l.format("code",!l.getFormat().code)}),l.keyboard.addBinding({key:"-",altKey:!0},()=>{l.format("strike",!l.getFormat().strike)})}je(()=>{j()});function A(E){ee[E?"unshift":"push"](()=>{g=E,n(1,g)})}return e.$$set=E=>{"tabID"in E&&n(2,r=E.tabID),"disabled"in E&&n(0,c=E.disabled)},e.$$.update=()=>{e.$$.dirty&33&&(c?l==null||l.disable():l==null||l.enable()),e.$$.dirty&96&&(l==null||l.root.setAttribute("spellcheck",o.spellCheck.toString()))},[c,g,r,d,i,l,o,A]}class Gt extends Ee{constructor(t){super(),Te(this,t,qt,Wt,_e,{tabID:2,disabled:0,focus:3,blur:4})}get focus(){return this.$$.ctx[3]}get blur(){return this.$$.ctx[4]}}const rt=500,Kt=300,ot=500,Qt=300;class Zt{constructor(){W(this,"isMoving",!1);W(this,"isLongclick",!1);W(this,"button",0);W(this,"lastX",0);W(this,"lastY",0);W(this,"consecutiveClicks",0);W(this,"lastMouseupTime",0);W(this,"activeElement",null);this.reset()}reset(){this.isMoving=!1,this.isLongclick=!1,this.button=0,this.lastX=0,this.lastY=0,this.consecutiveClicks=0,this.lastMouseupTime=0,this.activeElement=null}}class Jt{constructor(){W(this,"isDragging",!1);W(this,"isPinching",!1);W(this,"isLongpressed",!1);W(this,"consecutiveTaps",0);W(this,"lastTouchendTime",0);W(this,"lastCenterX",0);W(this,"lastCenterY",0);W(this,"identifier",0);W(this,"x",0);W(this,"y",0);W(this,"hypotenuse",0);W(this,"activeElement",null);this.reset()}reset(){this.isDragging=!1,this.isPinching=!1,this.isLongpressed=!1,this.consecutiveTaps=0,this.lastTouchendTime=0,this.lastCenterX=0,this.lastCenterY=0,this.identifier=0,this.x=0,this.y=0,this.hypotenuse=0,this.activeElement=null}}let fe=[],h=new Zt,a=new Jt;const Y=(e,t)=>{e!=null&&e.dispatchEvent(new CustomEvent("gesture",{detail:t,bubbles:!1,cancelable:!1}))},_t=e=>{h.reset(),a.reset(),h.lastMouseupTime=Date.now(),window.removeEventListener("mousemove",Fe),window.removeEventListener("mouseup",We),window.removeEventListener("touchmove",qe),window.removeEventListener("touchend",Ie)},wt=e=>{if(window.removeEventListener("mousemove",Fe),window.removeEventListener("mouseup",We),window.removeEventListener("touchmove",qe),window.removeEventListener("touchend",Ie),h.isMoving)if(h.isMoving=!1,h.isLongclick)h.isLongclick=!1,Y(h.activeElement,{event:e,name:"longclick-drag-end",x:h.lastX,y:h.lastY,dx:0,dy:0});else switch(h.button){case 0:Y(h.activeElement,{event:e,name:"left-click-drag-end",x:h.lastX,y:h.lastY,dx:0,dy:0});break;case 1:Y(h.activeElement,{event:e,name:"middle-click-drag-end",x:h.lastX,y:h.lastY,dx:0,dy:0});break;case 2:Y(h.activeElement,{event:e,name:"right-click-drag-end",x:h.lastX,y:h.lastY,dx:0,dy:0});break}h.isLongclick&&Y(h.activeElement,{event:e,name:"longclick-release",x:h.lastX,y:h.lastY,dx:0,dy:0}),h.reset(),a.isDragging&&(a.isDragging=!1,a.isLongpressed?(a.isLongpressed=!1,Y(a.activeElement,{event:e,name:"longpress-drag-end",x:a.lastCenterX,y:a.lastCenterY,dx:0,dy:0})):Y(a.activeElement,{event:e,name:"touch-drag-end",x:a.lastCenterX,y:a.lastCenterY,dx:0,dy:0})),a.isLongpressed&&Y(a.activeElement,{event:e,name:"longpress-release",x:a.lastCenterX,y:a.lastCenterY,dx:0,dy:0}),a.reset()},kt=e=>{Y(e.target,{event:e,name:"wheel",x:e.clientX,y:e.clientY,dx:0,dy:0})},Et=e=>{},Tt=e=>{document.activeElement!==e.target&&(window.addEventListener("mousemove",Fe),window.addEventListener("mouseup",We),h.activeElement=e.target,h.lastX=e.clientX,h.lastY=e.clientY,h.isMoving||(h.button=e.button),h.button===0&&window.setTimeout(()=>{Date.now()-h.lastMouseupTime>=ot&&!h.isMoving&&(h.isLongclick=!0,Y(h.activeElement,{event:e,name:"longclick",x:e.clientX,y:e.clientY,dx:0,dy:0}))},ot))},Fe=e=>{if(e.movementX===0&&e.movementY===0)return;let t=e.clientX-h.lastX,n=e.clientY-h.lastY;if(!h.isMoving)if(h.isLongclick)Y(h.activeElement,{event:e,name:"longclick-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});else switch(h.button){case 0:Y(h.activeElement,{event:e,name:"left-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 1:Y(h.activeElement,{event:e,name:"middle-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 2:Y(h.activeElement,{event:e,name:"right-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break}if(h.isMoving=!0,h.lastX=e.clientX,h.lastY=e.clientY,h.isLongclick)Y(h.activeElement,{event:e,name:"longclick-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});else switch(h.button){case 0:Y(h.activeElement,{event:e,name:"left-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break;case 1:Y(h.activeElement,{event:e,name:"middle-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break;case 2:Y(h.activeElement,{event:e,name:"right-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break}},We=e=>{if(window.removeEventListener("mousemove",Fe),window.removeEventListener("mouseup",We),h.lastMouseupTime=Date.now(),h.isMoving)if(h.isMoving=!1,h.isLongclick)h.isLongclick=!1,Y(h.activeElement,{event:e,name:"longclick-drag-end",x:h.lastX,y:h.lastY,dx:0,dy:0});else switch(h.button){case 0:Y(h.activeElement,{event:e,name:"left-click-drag-end",x:h.lastX,y:h.lastY,dx:0,dy:0});break;case 1:Y(h.activeElement,{event:e,name:"middle-click-drag-end",x:h.lastX,y:h.lastY,dx:0,dy:0});break;case 2:Y(h.activeElement,{event:e,name:"right-click-drag-end",x:h.lastX,y:h.lastY,dx:0,dy:0});break}else h.isLongclick||(e.button===2?Y(h.activeElement,{event:e,name:"right-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):e.button===1?Y(h.activeElement,{event:e,name:"middle-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):(h.consecutiveClicks===0&&Y(h.activeElement,{event:e,name:"left-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),h.consecutiveClicks++,window.setTimeout(()=>{h.consecutiveClicks>1&&Y(h.activeElement,{event:e,name:"double-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),h.consecutiveClicks=0},Qt)));h.isLongclick&&Y(h.activeElement,{event:e,name:"longclick-release",x:e.clientX,y:e.clientY,dx:0,dy:0}),h.isLongclick=!1},Lt=e=>{if(document.activeElement!==e.target){if(e.preventDefault(),e.stopPropagation(),e.touches.length>1){if(e.touches[0].identifier===a.identifier)return;a.isPinching=!0}window.addEventListener("touchmove",qe,{passive:!1}),window.addEventListener("touchend",Ie),window.addEventListener("touchcancel",Ie),a.identifier=e.touches[0].identifier,a.x=e.touches[0].clientX,a.y=e.touches[0].clientY,a.activeElement=e.target,window.setTimeout(()=>{a.isPinching||a.isDragging||Date.now()-a.lastTouchendTime>=rt&&(a.isDragging=!1,a.isPinching=!1,a.hypotenuse=null,a.isLongpressed=!0,Y(a.activeElement,{event:e,name:"longpress",x:a.x,y:a.y,dx:0,dy:0}))},rt)}},qe=e=>{if(a.isDragging){let t=a.x,n=a.y;a.x=e.touches[0].clientX,a.y=e.touches[0].clientY;let s=a.x-t,o=a.y-n;a.isLongpressed?Y(a.activeElement,{event:e,name:"longpress-dragging",x:a.x,y:a.y,dx:s,dy:o,force:e.touches[0].force}):Y(a.activeElement,{event:e,name:"touch-dragging",x:a.x,y:a.y,dx:s,dy:o,force:e.touches[0].force});return}else if(!a.isLongpressed&&(a.isPinching||e.touches.length>1)){a.x=e.touches[0].clientX,a.y=e.touches[0].clientY;let t={x:e.touches[1].clientX,y:e.touches[1].clientY},n={x:(a.x+t.x)/2,y:(a.y+t.y)/2},s=Math.hypot(a.x-t.x,a.y-t.y);a.hypotenuse===null&&(a.hypotenuse=s,a.lastCenterX=n.x,a.lastCenterY=n.y,Y(a.activeElement,{event:e,name:"pinch-start",x:n.x,y:n.y,dx:0,dy:0})),a.isPinching=!0;let o=s/a.hypotenuse,r=n.x-a.lastCenterX,c=n.y-a.lastCenterY;Y(a.activeElement,{event:e,name:"pinching",x:n.x,y:n.y,zoom:o,dx:r,dy:c}),a.hypotenuse=s,a.lastCenterX=n.x,a.lastCenterY=n.y;return}else a.isDragging=!0,a.isLongpressed?(Y(a.activeElement,{event:e,name:"longpress-drag-start",x:a.x,y:a.y,dx:0,dy:0,force:e.touches[0].force}),a.x=e.touches[0].clientX,a.y=e.touches[0].clientY,Y(a.activeElement,{event:e,name:"longpress-dragging",x:a.x,y:a.y,dx:0,dy:0,force:e.touches[0].force})):(Y(a.activeElement,{event:e,name:"touch-drag-start",x:a.x,y:a.y,dx:0,dy:0,force:e.touches[0].force}),a.x=e.touches[0].clientX,a.y=e.touches[0].clientY,Y(a.activeElement,{event:e,name:"touch-dragging",x:a.x,y:a.y,dx:0,dy:0,force:e.touches[0].force}))},Ie=e=>{a.isDragging&&e.touches.length>0&&e.touches[0].identifier===a.identifier||(a.lastTouchendTime=Date.now(),window.removeEventListener("touchmove",qe),window.removeEventListener("touchend",Ie),window.removeEventListener("touchcancel",Ie),a.isDragging?(a.isDragging=!1,a.isLongpressed?(a.isLongpressed=!1,Y(a.activeElement,{event:e,name:"longpress-drag-end",x:a.x,y:a.y,dx:0,dy:0})):Y(a.activeElement,{event:e,name:"touch-drag-end",x:a.x,y:a.y,dx:0,dy:0})):a.isPinching?(a.isPinching=!1,a.hypotenuse=null,Y(a.activeElement,{event:e,name:"pinch-end",x:a.lastCenterX,y:a.lastCenterY,dx:0,dy:0})):a.isLongpressed||(a.consecutiveTaps===0&&Y(a.activeElement,{event:e,name:"tap",x:a.x,y:a.y,dx:0,dy:0}),a.consecutiveTaps++,window.setTimeout(()=>{a.consecutiveTaps>1&&Y(a.activeElement,{event:e,name:"double-tap",x:a.x,y:a.y,dx:0,dy:0}),a.consecutiveTaps=0},Kt)),a.isLongpressed&&Y(a.activeElement,{event:e,name:"longpress-release",x:a.x,y:a.y,dx:0,dy:0}),a.isLongpressed=!1)};function $t(...e){for(let t of e)fe.findIndex(n=>n===t)===-1&&(fe.length==0&&(window.addEventListener("blur",wt),window.addEventListener("focus",_t)),fe.push(t),t.addEventListener("touchstart",Lt,{passive:!1}),t.addEventListener("mousedown",Tt,{passive:!1}),t.addEventListener("contextmenu",Et,{passive:!1}),t.addEventListener("wheel",kt,{passive:!1}))}function en(...e){const t=n=>{n.removeEventListener("touchstart",Lt),n.removeEventListener("mousedown",Tt),n.removeEventListener("contextmenu",Et),n.removeEventListener("wheel",kt)};if(e.length==0){for(let n of fe)t(n);fe=[]}else for(let n of e){let s=fe.findIndex(o=>o===n);s!==-1&&(t(n),fe.splice(s,1))}fe.length==0&&(window.removeEventListener("blur",wt),window.removeEventListener("focus",_t))}function tn(e){let t,n,s,o;return{c(){t=z("div"),n=z("canvas"),s=Z(),o=z("canvas"),this.h()},l(r){t=R(r,"DIV",{class:!0});var c=O(t);n=R(c,"CANVAS",{id:!0,class:!0}),O(n).forEach(H),s=J(c),o=R(c,"CANVAS",{id:!0,class:!0}),O(o).forEach(H),c.forEach(H),this.h()},h(){C(n,"id","currentPath"),C(n,"class","svelte-1rt306j"),C(o,"id","canvas"),C(o,"class","svelte-1rt306j"),C(t,"class","drawing-container svelte-1rt306j"),U(t,"disabled",e[0]===void 0)},m(r,c){ie(r,t,c),P(t,n),e[10](n),P(t,s),P(t,o),e[11](o)},p(r,c){c[0]&1&&U(t,"disabled",r[0]===void 0)},i:me,o:me,d(r){r&&H(t),e[10](null),e[11](null)}}}const nn=2,sn=178;function rn(e,t,n){var s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),o=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),r=Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2)),c=Math.acos((o*o+s*s-r*r)/(2*o*s));return c*(180/Math.PI)}function lt(e){if(e.points.length<4)return e;for(let t=1;t<e.points.length-2;t++){const n=e.points[t-1],s=e.points[t],o=e.points[t+1];rn(n,s,o)>sn&&(e.points.splice(t,1),t--)}return e}async function we(e,t){if(t.lineWidth=e.lineWidth,t.lineCap="round",t.strokeStyle=e.color,e.points.length<2){t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[0].x,e.points[0].y),t.stroke();return}t.beginPath();let n=e.points[0].x,s=e.points[0].y;for(let o=0;o<e.points.length-1;o++)t.moveTo(n,s),n=(e.points[o].x+e.points[o+1].x)/2,s=(e.points[o].y+e.points[o+1].y)/2,t.quadraticCurveTo(e.points[o].x,e.points[o].y,n,s);t.stroke()}function at(e){return{x:ct(e.x),y:ct(e.y)}}function ct(e){const t=e.toFixed(nn);return Number(t)}function on(e,t,n){let s;ae(e,he,x=>n(23,s=x));let{radius:o=4}=t,{smoothness:r=0}=t,{stroke:c=5}=t,{color:d="#000000"}=t,{tool:i=void 0}=t,{tabID:l=""}=t;const g=()=>{L.clearRect(0,0,M/I,k/I),X=[]},m=()=>{if(X.length!=0){X.pop(),w.clearRect(0,0,M/I,k/I);for(let x=0;x<X.length;x++)we(X[x],w);te()}};let u,L,y,w,f={x:0,y:0},k=0,M=0,I,j=!1,A,E,X=[];function _(){if(u){if(!i){u.removeEventListener("gesture",Me),u.removeEventListener("gesture",Pe),en(u);return}i==="pen"?(u.removeEventListener("gesture",Me),u.addEventListener("gesture",Pe)):i==="eraser"&&(u.removeEventListener("gesture",Pe),u.addEventListener("gesture",Me)),$t(u)}}const b=(x,$,V,v)=>{var D=V-x,S=v-$;return Math.sqrt(D*D+S*S)};function T(x,$){let V=u.getBoundingClientRect();return{x:x-V.left,y:$-V.top}}function p(){if(!u||!y)return;se(),I=window.devicePixelRatio;let x=u.getBoundingClientRect();k=x.height*I,M=x.width*I,n(1,u.width=M,u),n(1,u.height=k,u),n(2,y.width=M,y),n(2,y.height=k,y),L.scale(I,I),w.scale(I,I);for(let $=0;$<X.length;$++)we(X[$],w)}function te(){s[l]&&G(he,s[l].paths=X.filter(x=>lt(x)),s)}function re(){s[l]&&(X=s[l].paths,p())}function oe(x,$){j=!0,f=T(x,$),A={points:[],lineWidth:c,color:d}}function K(x,$){if(!j)return;let V=T(x,$);if(o>0){if(b(V.x,V.y,f.x,f.y)<=o){A.points.length===0&&(A.points.push(V),we(A,L));return}let v=Math.sqrt(V.x*V.x+V.y*V.y-2*V.x*f.x+f.x*f.x-2*V.y*f.y+f.y*f.y);if(V={x:V.x+o*((f.x-V.x)/v),y:V.y+o*((f.y-V.y)/v)},b(f.x,f.y,V.x,V.y)<=r)return}A.points.push(at(V)),L.clearRect(0,0,M/I,k/I),we(A,L),f=V}function se(){j&&(X.push(lt(A)),we(A,w),L.clearRect(0,0,M/I,k/I),te()),j=!1}function Le(x,$){j=!0,A={points:[],lineWidth:10,color:"rgba(0,0,0,0.2)"}}function de(x,$){if(!j)return;const V=T(x,$);A.points.push(at(V)),setTimeout(()=>{L.clearRect(0,0,M/I,k/I),we(A,L),A.points.shift(),A.points.length<=1&&!j&&L.clearRect(0,0,M/I,k/I)},100),X.forEach((v,D)=>{for(let S=0;S<v.points.length-1;S++)if(b(v.points[S].x,v.points[S].y,V.x,V.y)<=v.lineWidth){X.splice(D,1),w.clearRect(0,0,M/I,k/I);for(let B=0;B<X.length;B++)we(X[B],w);te();break}})}function le(){A.points.length<=1&&L.clearRect(0,0,M/I,k/I),j=!1}const Me=function(x){switch(x.detail.name){case"left-click-drag-start":case"touch-drag-start":Le(x.detail.x,x.detail.y);break;case"left-click-dragging":case"touch-dragging":de(x.detail.x,x.detail.y);break;case"left-click-drag-end":case"touch-drag-end":le();break}},Pe=function(x){switch(x.detail.name){case"left-click-drag-start":case"touch-drag-start":oe(x.detail.x,x.detail.y);break;case"left-click-dragging":case"touch-dragging":K(x.detail.x,x.detail.y);break;case"left-click-drag-end":case"touch-drag-end":se();break}};je(()=>{L=u.getContext("2d"),L.imageSmoothingEnabled=!1,w=y.getContext("2d"),w.imageSmoothingEnabled=!1,E=new ResizeObserver(p),E.observe(u),re(),_()}),mt(()=>{E&&E.disconnect(),n(0,i=void 0),_()});function Ge(x){ee[x?"unshift":"push"](()=>{y=x,n(2,y)})}function Ke(x){ee[x?"unshift":"push"](()=>{u=x,n(1,u)})}return e.$$set=x=>{"radius"in x&&n(3,o=x.radius),"smoothness"in x&&n(4,r=x.smoothness),"stroke"in x&&n(5,c=x.stroke),"color"in x&&n(6,d=x.color),"tool"in x&&n(0,i=x.tool),"tabID"in x&&n(7,l=x.tabID)},e.$$.update=()=>{e.$$.dirty[0]&1&&_()},[i,u,y,o,r,c,d,l,g,m,Ge,Ke]}class ln extends Ee{constructor(t){super(),Te(this,t,on,tn,_e,{radius:3,smoothness:4,stroke:5,color:6,tool:0,tabID:7,clear:8,undo:9},null,[-1,-1])}get clear(){return this.$$.ctx[8]}get undo(){return this.$$.ctx[9]}}function Oe(e,{delay:t=0,duration:n=400,easing:s=yt,axis:o="y"}={}){const r=getComputedStyle(e),c=+r.opacity,d=o==="y"?"height":"width",i=parseFloat(r[d]),l=o==="y"?["top","bottom"]:["left","right"],g=l.map(k=>`${k[0].toUpperCase()}${k.slice(1)}`),m=parseFloat(r[`padding${g[0]}`]),u=parseFloat(r[`padding${g[1]}`]),L=parseFloat(r[`margin${g[0]}`]),y=parseFloat(r[`margin${g[1]}`]),w=parseFloat(r[`border${g[0]}Width`]),f=parseFloat(r[`border${g[1]}Width`]);return{delay:t,duration:n,easing:s,css:k=>`overflow: hidden;opacity: ${Math.min(k*20,1)*c};${d}: ${k*i}px;padding-${l[0]}: ${k*m}px;padding-${l[1]}: ${k*u}px;margin-${l[0]}: ${k*L}px;margin-${l[1]}: ${k*y}px;border-${l[0]}-width: ${k*w}px;border-${l[1]}-width: ${k*f}px;`}}function ut(e,{delay:t=0,duration:n=400,easing:s=yt,start:o=0,opacity:r=0}={}){const c=getComputedStyle(e),d=+c.opacity,i=c.transform==="none"?"":c.transform,l=1-o,g=d*(1-r);return{delay:t,duration:n,easing:s,css:(m,u)=>`
			transform: ${i} scale(${1-l*u});
			opacity: ${d-g*u}
		`}}function dt(e){let t,n,s=`<span class="button-icon svelte-gz2jxk" style="-webkit-mask: url(${N}/images/svg/undo.svg) no-repeat center / contain; mask: url(${N}/images/svg/undo.svg) no-repeat center / contain;"></span>`,o,r,c,d,i,l,g,m;return{c(){t=z("div"),n=z("button"),n.innerHTML=s,o=Z(),r=z("input"),c=Z(),d=z("input"),this.h()},l(u){t=R(u,"DIV",{class:!0});var L=O(t);n=R(L,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(n)!=="svelte-1b4fip4"&&(n.innerHTML=s),o=J(L),r=R(L,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),c=J(L),d=R(L,"INPUT",{type:!0,class:!0}),L.forEach(H),this.h()},h(){C(n,"class","button svelte-gz2jxk"),C(r,"type","range"),C(r,"min","2"),C(r,"max","20"),C(r,"step","2"),C(r,"class","slider svelte-gz2jxk"),C(d,"type","color"),C(d,"class","color-picker svelte-gz2jxk"),C(t,"class","pencil-tools svelte-gz2jxk")},m(u,L){ie(u,t,L),P(t,n),P(t,o),P(t,r),Ve(r,e[0]),P(t,c),P(t,d),Ve(d,e[1]),l=!0,g||(m=[ne(n,"click",function(){Se(e[3])&&e[3].apply(this,arguments)}),ne(r,"change",e[9]),ne(r,"input",e[9]),ne(d,"input",e[10])],g=!0)},p(u,L){e=u,L&1&&Ve(r,e[0]),L&2&&Ve(d,e[1])},i(u){l||(u&&Ue(()=>{l&&(i||(i=Ce(t,Oe,{duration:200,axis:"x"},!0)),i.run(1))}),l=!0)},o(u){u&&(i||(i=Ce(t,Oe,{duration:200,axis:"x"},!1)),i.run(0)),l=!1},d(u){u&&H(t),u&&i&&i.end(),g=!1,Ne(m)}}}function an(e){let t,n,s=`<span class="button-icon svelte-gz2jxk" style="-webkit-mask: url(${N}/images/svg/pen.svg) no-repeat center / contain; mask: url(${N}/images/svg/pen.svg) no-repeat center / contain;"></span>`,o,r,c=`<span class="button-icon svelte-gz2jxk" style="-webkit-mask: url(${N}/images/svg/highlighter.svg) no-repeat center / contain; mask: url(${N}/images/svg/highlighter.svg) no-repeat center / contain;"></span>`,d,i,l=`<span class="button-icon svelte-gz2jxk" style="-webkit-mask: url(${N}/images/svg/eraser.svg) no-repeat center / contain; mask: url(${N}/images/svg/eraser.svg) no-repeat center / contain;"></span>`,g,m,u,L,y,w,f,k,M,I=`<span class="button-icon svelte-gz2jxk" style="-webkit-mask: url(${N}/images/svg/user.svg) no-repeat center / contain; mask: url(${N}/images/svg/user.svg) no-repeat center / contain;"></span>`,j,A,E,X,_=(e[4].tool==="pen"||e[4].tool==="highlighter")&&dt(e);return{c(){t=z("div"),n=z("button"),n.innerHTML=s,o=Z(),r=z("button"),r.innerHTML=c,d=Z(),i=z("button"),i.innerHTML=l,g=Z(),_&&_.c(),m=Z(),u=z("div"),L=Z(),y=z("button"),w=z("span"),k=Z(),M=z("a"),M.innerHTML=I,this.h()},l(b){t=R(b,"DIV",{class:!0});var T=O(t);n=R(T,"BUTTON",{tabindex:!0,class:!0,"data-svelte-h":!0}),ge(n)!=="svelte-zvfyy8"&&(n.innerHTML=s),o=J(T),r=R(T,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(r)!=="svelte-1evhkjr"&&(r.innerHTML=c),d=J(T),i=R(T,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(i)!=="svelte-1aagamc"&&(i.innerHTML=l),g=J(T),_&&_.l(T),m=J(T),u=R(T,"DIV",{class:!0}),O(u).forEach(H),L=J(T),y=R(T,"BUTTON",{class:!0});var p=O(y);w=R(p,"SPAN",{class:!0,style:!0}),O(w).forEach(H),p.forEach(H),k=J(T),M=R(T,"A",{class:!0,href:!0,"data-svelte-h":!0}),ge(M)!=="svelte-1xuhzhs"&&(M.innerHTML=I),T.forEach(H),this.h()},h(){C(n,"tabindex","0"),C(n,"class","pencil button svelte-gz2jxk"),U(n,"selected",e[4].tool==="pen"),C(r,"class","button svelte-gz2jxk"),U(r,"selected",e[4].tool==="highlighter"),C(i,"class","button svelte-gz2jxk"),U(i,"selected",e[4].tool==="eraser"),C(u,"class","spacer svelte-gz2jxk"),C(w,"class","button-icon svelte-gz2jxk"),Je(w,"-webkit-mask","url("+N+"/images/svg/refresh.svg) no-repeat center / contain"),Je(w,"mask","url("+N+"/images/svg/refresh.svg) no-repeat center / contain"),C(y,"class","refresh button svelte-gz2jxk"),y.disabled=f=e[5].savingStatus==="saving",C(M,"class","button svelte-gz2jxk"),C(M,"href",N+"/profile"),C(t,"class","toolbar-container svelte-gz2jxk")},m(b,T){ie(b,t,T),P(t,n),P(t,o),P(t,r),P(t,d),P(t,i),P(t,g),_&&_.m(t,null),P(t,m),P(t,u),P(t,L),P(t,y),P(y,w),P(t,k),P(t,M),A=!0,E||(X=[ne(n,"click",e[6]),ne(r,"click",e[7]),ne(i,"click",e[8]),ne(y,"click",function(){Se(e[2])&&e[2].apply(this,arguments)})],E=!0)},p(b,[T]){e=b,(!A||T&16)&&U(n,"selected",e[4].tool==="pen"),(!A||T&16)&&U(r,"selected",e[4].tool==="highlighter"),(!A||T&16)&&U(i,"selected",e[4].tool==="eraser"),e[4].tool==="pen"||e[4].tool==="highlighter"?_?(_.p(e,T),T&16&&F(_,1)):(_=dt(e),_.c(),F(_,1),_.m(t,m)):_&&(xe(),Q(_,1,1,()=>{_=null}),De()),(!A||T&32&&f!==(f=e[5].savingStatus==="saving"))&&(y.disabled=f)},i(b){A||(F(_),b&&Ue(()=>{A&&(j||(j=Ce(t,Oe,{duration:200},!0)),j.run(1))}),A=!0)},o(b){Q(_),b&&(j||(j=Ce(t,Oe,{duration:200},!1)),j.run(0)),A=!1},d(b){b&&H(t),_&&_.d(),b&&j&&j.end(),E=!1,Ne(X)}}}function cn(e,t,n){let s,o;ae(e,q,y=>n(4,s=y)),ae(e,pt,y=>n(5,o=y));let{onRefresh:r=()=>{}}=t,{onDrawingUndo:c=()=>{}}=t,{stroke:d}=t,{color:i}=t;const l=()=>{G(q,s.tool=s.tool==="pen"?void 0:"pen",s)},g=()=>{G(q,s.tool=s.tool==="highlighter"?void 0:"highlighter",s)},m=()=>{G(q,s.tool=s.tool==="eraser"?void 0:"eraser",s)};function u(){d=Yt(this.value),n(0,d)}function L(){i=this.value,n(1,i)}return e.$$set=y=>{"onRefresh"in y&&n(2,r=y.onRefresh),"onDrawingUndo"in y&&n(3,c=y.onDrawingUndo),"stroke"in y&&n(0,d=y.stroke),"color"in y&&n(1,i=y.color)},[d,i,r,c,s,o,l,g,m,u,L]}class un extends Ee{constructor(t){super(),Te(this,t,cn,an,_e,{onRefresh:2,onDrawingUndo:3,stroke:0,color:1})}}function dn(e){let t,n=`<div class="trashcan-icon svelte-15jm748" style="-webkit-mask: url(${N}/images/svg/trash.svg) no-repeat center / contain; mask: url(${N}/images/svg/trash.svg) no-repeat center / contain;"></div>`,s,o;return{c(){t=z("div"),t.innerHTML=n,this.h()},l(r){t=R(r,"DIV",{class:!0,"data-svelte-h":!0}),ge(t)!=="svelte-1bi7fon"&&(t.innerHTML=n),this.h()},h(){C(t,"class","trashcan svelte-15jm748"),U(t,"overTrashcan",e[1])},m(r,c){ie(r,t,c),e[3](t),o=!0},p(r,[c]){(!o||c&2)&&U(t,"overTrashcan",r[1])},i(r){o||(r&&Ue(()=>{o&&(s||(s=Ce(t,ut,{duration:200},!0)),s.run(1))}),o=!0)},o(r){r&&(s||(s=Ce(t,ut,{duration:200},!1)),s.run(0)),o=!1},d(r){r&&H(t),e[3](null),r&&s&&s.end()}}}function fn(e,t,n){let{throwAway:s=()=>{}}=t,o,r=!1;const c=l=>{const g=o.getBoundingClientRect(),m=l instanceof MouseEvent?l.clientX:l.touches[0].clientX,u=l instanceof MouseEvent?l.clientY:l.touches[0].clientY;if(m<g.left||m>g.right||u<g.top||u>g.bottom){n(1,r=!1);return}n(1,r=!0)},d=l=>{const g=o.getBoundingClientRect(),m=l instanceof MouseEvent?l.clientX:l.touches[0].clientX,u=l instanceof MouseEvent?l.clientY:l.touches[0].clientY;if(m<g.left||m>g.right||u<g.top||u>g.bottom){n(1,r=!1);return}s()};je(()=>{window.addEventListener("mousemove",c),window.addEventListener("touchmove",c),window.addEventListener("drag",c),window.addEventListener("dragend",d),window.addEventListener("mouseup",d),window.addEventListener("touchend",d)}),mt(()=>{window.removeEventListener("mousemove",c),window.removeEventListener("touchmove",c),window.removeEventListener("drag",c),window.removeEventListener("dragend",d),window.removeEventListener("mouseup",d),window.removeEventListener("touchend",d)});function i(l){ee[l?"unshift":"push"](()=>{o=l,n(0,o)})}return e.$$set=l=>{"throwAway"in l&&n(2,s=l.throwAway)},[o,r,s,i]}class gn extends Ee{constructor(t){super(),Te(this,t,fn,dn,_e,{throwAway:2})}}function ft(e){let t,n,s,o;function r(i){e[16](i)}function c(i){e[17](i)}let d={onDrawingUndo:e[14],onRefresh:e[15]};return e[4]!==void 0&&(d.stroke=e[4]),e[0]!==void 0&&(d.color=e[0]),t=new un({props:d}),ee.push(()=>Re(t,"stroke",r)),ee.push(()=>Re(t,"color",c)),{c(){ve(t.$$.fragment)},l(i){pe(t.$$.fragment,i)},m(i,l){be(t,i,l),o=!0},p(i,l){const g={};l&128&&(g.onDrawingUndo=i[14]),!n&&l&16&&(n=!0,g.stroke=i[4],ze(()=>n=!1)),!s&&l&1&&(s=!0,g.color=i[0],ze(()=>s=!1)),t.$set(g)},i(i){o||(F(t.$$.fragment,i),o=!0)},o(i){Q(t.$$.fragment,i),o=!1},d(i){ye(t,i)}}}function hn(e){let t,n;return t=new Rt({}),{c(){ve(t.$$.fragment)},l(s){pe(t.$$.fragment,s)},m(s,o){be(t,s,o),n=!0},p:me,i(s){n||(F(t.$$.fragment,s),n=!0)},o(s){Q(t.$$.fragment,s),n=!1},d(s){ye(t,s)}}}function mn(e){let t,n,s=e[10],o,r,c,d=gt(e),i=e[2].trashcanVisible&&ht(e);return{c(){t=z("div"),n=z("div"),d.c(),o=Z(),i&&i.c(),this.h()},l(l){t=R(l,"DIV",{class:!0,style:!0});var g=O(t);n=R(g,"DIV",{class:!0});var m=O(n);d.l(m),m.forEach(H),o=J(g),i&&i.l(g),g.forEach(H),this.h()},h(){C(n,"class","editor-container svelte-17mx60y"),C(t,"class","scrollable-canvas svelte-17mx60y"),C(t,"style",e[8]),Ue(()=>e[22].call(t))},m(l,g){ie(l,t,g),P(t,n),d.m(n,null),P(t,o),i&&i.m(t,null),r=Xt(t,e[22].bind(t)),c=!0},p(l,g){g&1024&&_e(s,s=l[10])?(xe(),Q(d,1,1,me),De(),d=gt(l),d.c(),F(d,1),d.m(n,null)):d.p(l,g),l[2].trashcanVisible?i?(i.p(l,g),g&4&&F(i,1)):(i=ht(l),i.c(),F(i,1),i.m(t,null)):i&&(xe(),Q(i,1,1,()=>{i=null}),De()),(!c||g&256)&&C(t,"style",l[8])},i(l){c||(F(d),F(i),c=!0)},o(l){Q(d),Q(i),c=!1},d(l){l&&H(t),d.d(l),i&&i.d(),r()}}}function gt(e){let t,n,s,o,r,c,d={tabID:e[10]};t=new Gt({props:d}),e[18](t);function i(m){e[20](m)}function l(m){e[21](m)}let g={tabID:e[10],tool:e[9]};return e[3]!==void 0&&(g.color=e[3]),e[4]!==void 0&&(g.stroke=e[4]),s=new ln({props:g}),e[19](s),ee.push(()=>Re(s,"color",i)),ee.push(()=>Re(s,"stroke",l)),{c(){ve(t.$$.fragment),n=Z(),ve(s.$$.fragment)},l(m){pe(t.$$.fragment,m),n=J(m),pe(s.$$.fragment,m)},m(m,u){be(t,m,u),ie(m,n,u),be(s,m,u),c=!0},p(m,u){const L={};u&1024&&(L.tabID=m[10]),t.$set(L);const y={};u&1024&&(y.tabID=m[10]),u&512&&(y.tool=m[9]),!o&&u&8&&(o=!0,y.color=m[3],ze(()=>o=!1)),!r&&u&16&&(r=!0,y.stroke=m[4],ze(()=>r=!1)),s.$set(y)},i(m){c||(F(t.$$.fragment,m),F(s.$$.fragment,m),c=!0)},o(m){Q(t.$$.fragment,m),Q(s.$$.fragment,m),c=!1},d(m){m&&H(n),e[18](null),ye(t,m),e[19](null),ye(s,m)}}}function ht(e){let t,n,s;return n=new gn({props:{throwAway:e[5].closeActiveTab}}),{c(){t=z("div"),ve(n.$$.fragment),this.h()},l(o){t=R(o,"DIV",{class:!0});var r=O(t);pe(n.$$.fragment,r),r.forEach(H),this.h()},h(){C(t,"class","trashcan-container svelte-17mx60y")},m(o,r){ie(o,t,r),be(n,t,null),s=!0},p(o,r){const c={};r&32&&(c.throwAway=o[5].closeActiveTab),n.$set(c)},i(o){s||(F(n.$$.fragment,o),s=!0)},o(o){Q(n.$$.fragment,o),s=!1},d(o){o&&H(t),ye(n)}}}function vn(e){let t,n,s,o,r,c,d,i,l,g,m={};n=new Ft({props:m}),e[13](n);let u=e[2].toolbarVisible&&e[2].order.length>0&&ft(e);const L=[mn,hn],y=[];function w(f,k){return f[11].currentUser&&!f[11].isLoading?0:1}return c=w(e),d=y[c]=L[c](e),{c(){t=z("div"),ve(n.$$.fragment),s=Z(),o=z("div"),u&&u.c(),r=Z(),d.c(),this.h()},l(f){t=R(f,"DIV",{class:!0});var k=O(t);pe(n.$$.fragment,k),s=J(k),o=R(k,"DIV",{class:!0});var M=O(o);u&&u.l(M),M.forEach(H),r=J(k),d.l(k),k.forEach(H),this.h()},h(){C(o,"class","toolbar"),C(t,"class","page-container svelte-17mx60y")},m(f,k){ie(f,t,k),be(n,t,null),P(t,s),P(t,o),u&&u.m(o,null),P(t,r),y[c].m(t,null),i=!0,l||(g=ne(window,"keydown",e[12],{passive:!1}),l=!0)},p(f,[k]){const M={};n.$set(M),f[2].toolbarVisible&&f[2].order.length>0?u?(u.p(f,k),k&4&&F(u,1)):(u=ft(f),u.c(),F(u,1),u.m(o,null)):u&&(xe(),Q(u,1,1,()=>{u=null}),De());let I=c;c=w(f),c===I?y[c].p(f,k):(xe(),Q(y[I],1,1,()=>{y[I]=null}),De(),d=y[c],d?d.p(f,k):(d=y[c]=L[c](f),d.c()),F(d,1),d.m(t,null))},i(f){i||(F(n.$$.fragment,f),F(u),F(d),i=!0)},o(f){Q(n.$$.fragment,f),Q(u),Q(d),i=!1},d(f){f&&H(t),e[13](null),ye(n),u&&u.d(),y[c].d(),l=!1,g()}}}function pn(e,t){var n=parseInt(e.slice(1,3),16),s=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16);return"rgba("+n+", "+s+", "+o+", "+t+")"}function bn(e,t,n){let s,o,r;ae(e,q,p=>n(2,s=p)),ae(e,vt,p=>n(23,o=p)),ae(e,pt,p=>n(11,r=p));let c="#000000",d="rgba(0, 0, 0, 1)",i=10,l,g,m,u=0,L="",y,w="";function f(p){p.key==="Escape"?(p.preventDefault(),p.stopPropagation(),s.tool!==void 0&&G(q,s.tool=void 0,s)):p.altKey&&p.key==="1"?(p.preventDefault(),p.stopPropagation(),s.tool==="pen"?G(q,s.tool=void 0,s):(G(q,s.tool="pen",s),G(q,s.toolbarVisible=!0,s))):p.altKey&&p.key==="2"?(p.preventDefault(),p.stopPropagation(),s.tool==="highlighter"?G(q,s.tool=void 0,s):(G(q,s.tool="highlighter",s),G(q,s.toolbarVisible=!0,s))):p.altKey&&p.key==="3"?(p.preventDefault(),p.stopPropagation(),s.tool==="eraser"?G(q,s.tool=void 0,s):(G(q,s.tool="eraser",s),G(q,s.toolbarVisible=!0,s))):p.ctrlKey&&p.key==="z"?(p.preventDefault(),p.stopPropagation(),console.log("undo"),(s.tool==="pen"||s.tool==="highlighter"||s.tool==="eraser")&&m.undo()):p.ctrlKey&&p.key==="Z"&&(p.preventDefault(),p.stopPropagation(),console.log("redo"))}q.subscribe(p=>{switch(n(10,w=p.order[p.activeIndex]),p.tool){case"pen":n(8,L=`cursor: url(${N}/images/svg/pen.svg) 1 20, auto;`),n(9,y="pen");const te=St.find(re=>re.name===o.theme);te&&n(0,c=te.caret);break;case"highlighter":n(0,c="#ffdd33"),n(8,L=`cursor: url(${N}/images/svg/highlighter.svg) 1 18, auto;`),n(9,y="pen");break;case"eraser":n(9,y="eraser"),n(8,L=`cursor: url(${N}/images/svg/eraser.svg) 5 18, auto;`);break;default:n(8,L=""),n(9,y=void 0);break}}),je(()=>{});function k(p){ee[p?"unshift":"push"](()=>{l=p,n(5,l)})}const M=()=>m.undo(),I=()=>zt.loadFromFirestore();function j(p){i=p,n(4,i)}function A(p){c=p,n(0,c)}function E(p){ee[p?"unshift":"push"](()=>{g=p,n(6,g)})}function X(p){ee[p?"unshift":"push"](()=>{m=p,n(7,m)})}function _(p){d=p,n(3,d),n(2,s),n(0,c)}function b(p){i=p,n(4,i)}function T(){u=this.clientHeight,n(1,u)}return e.$$.update=()=>{e.$$.dirty&5&&n(3,d=s.tool==="highlighter"?pn(c,.3):c),e.$$.dirty&2&&u>0&&document.documentElement.style.setProperty("--canvas-height",u+"px")},[c,u,s,d,i,l,g,m,L,y,w,r,f,k,M,I,j,A,E,X,_,b,T]}class Dn extends Ee{constructor(t){super(),Te(this,t,bn,vn,_e,{})}}export{Dn as component};
