const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/quill.Bk4jDS0q.js","../chunks/core.CG__ofcG.js"])))=>i.map(i=>d[i]);
var Xt=Object.defineProperty;var Pt=(e,t,n)=>t in e?Xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var j=(e,t,n)=>Pt(e,typeof t!="symbol"?t+"":t,n);import{s as Pe,n as me,r as it,e as Ie,f as st,c as se,a as he,o as rt,d as Q,z as Ht,A as ye,B as At}from"../chunks/scheduler.CNrmCPBX.js";import{S as He,i as Ae,e as R,b as Rt,c as V,d as N,f as Vt,g as A,w as M,A as F,j as ne,k as S,x as ee,G as $e,l as Bt,s as z,v as ge,h as W,z as lt,a as q,o as we,t as G,n as _e,I as Se,C as Fe,J as Ot,p as Ee,q as Te,r as Le,u as Ce,K as ke,m as Me}from"../chunks/index.Bx3bS2zy.js";import{e as De,u as tt,o as nt}from"../chunks/each.BP2nLSrP.js";import{b as K}from"../chunks/paths.B0Z5yc1J.js";import{m as pe,a as Et,t as ce,f as Ut,d as ae,s as Tt}from"../chunks/firebaseStore.ClxdZPDh.js";import{c as be,s as Ye,S as Nt}from"../chunks/Spinner.DU_sV4I5.js";import{_ as ot}from"../chunks/preload-helper.D6kgxu3v.js";import{t as jt}from"../chunks/themes.BTx5Q4mv.js";function qt(e){let t,n,i,r,a,d;return{c(){t=R("div"),n=R("button"),i=R("span"),r=Rt(e[0]),this.h()},l(l){t=V(l,"DIV",{class:!0});var s=N(t);n=V(s,"BUTTON",{class:!0,draggable:!0});var v=N(n);i=V(v,"SPAN",{class:!0});var u=N(i);r=Vt(u,e[0]),u.forEach(A),v.forEach(A),s.forEach(A),this.h()},h(){M(i,"class","title svelte-w1fi59"),M(n,"class","tab svelte-w1fi59"),M(n,"draggable","true"),F(n,"active",e[1]),M(t,"class","tab-container svelte-w1fi59"),F(t,"preventHover",e[2])},m(l,s){ne(l,t,s),S(t,n),S(n,i),S(i,r),a||(d=[ee(n,"mousedown",$e(function(){Ie(e[3])&&e[3].apply(this,arguments)})),ee(n,"touchstart",$e(function(){Ie(e[3])&&e[3].apply(this,arguments)})),ee(n,"dragstart",$e(function(){Ie(e[4])&&e[4].apply(this,arguments)}))],a=!0)},p(l,[s]){e=l,s&1&&Bt(r,e[0]),s&2&&F(n,"active",e[1]),s&4&&F(t,"preventHover",e[2])},i:me,o:me,d(l){l&&A(t),a=!1,it(d)}}}function Ft(e,t,n){let{title:i=""}=t,{active:r=!1}=t,{preventHover:a=!1}=t,{onPointerdown:d=s=>{}}=t,{onDragstart:l=s=>{}}=t;return e.$$set=s=>{"title"in s&&n(0,i=s.title),"active"in s&&n(1,r=s.active),"preventHover"in s&&n(2,a=s.preventHover),"onPointerdown"in s&&n(3,d=s.onPointerdown),"onDragstart"in s&&n(4,l=s.onDragstart)},[i,r,a,d,l]}class Lt extends He{constructor(t){super(),Ae(this,t,Ft,qt,Pe,{title:0,active:1,preventHover:2,onPointerdown:3,onDragstart:4})}}const at=(e,t)=>{const{duration:n=300,easing:i=be,onEnd:r=()=>{},onStep:a=()=>{},css:d}=t;let l;function s(v){if(!e){console.warn("Cannot find element to animate");return}l===void 0&&(l=v);const u=i((v-l)/n),y=1-u;u<1?(e.style.cssText=d(u,y),a(u,y),requestAnimationFrame(s)):(e.style.cssText="",r())}requestAnimationFrame(s)},et=e=>{const{duration:t=300,easing:n=be,onEnd:i=()=>{},onStep:r=()=>{}}=e;let a;function d(l){a===void 0&&(a=l);const s=n((l-a)/t),v=1-s;s<1?(r(s,v),requestAnimationFrame(d)):i()}requestAnimationFrame(d)};function ct(e){let t,n,i=`<span class="button-icon svelte-5bs9xj" style="-webkit-mask: url(${K}/images/svg/undo.svg) no-repeat center / contain; mask: url(${K}/images/svg/undo.svg) no-repeat center / contain;"></span>`,r,a,d,l,s,v,u,y;return{c(){t=R("div"),n=R("button"),n.innerHTML=i,r=z(),a=R("input"),d=z(),l=R("input"),this.h()},l(w){t=V(w,"DIV",{class:!0});var k=N(t);n=V(k,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(n)!=="svelte-1b4fip4"&&(n.innerHTML=i),r=W(k),a=V(k,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),d=W(k),l=V(k,"INPUT",{type:!0,class:!0}),k.forEach(A),this.h()},h(){M(n,"class","button svelte-5bs9xj"),M(a,"type","range"),M(a,"min","2"),M(a,"max","20"),M(a,"step","2"),M(a,"class","slider svelte-5bs9xj"),M(l,"type","color"),M(l,"class","color-picker svelte-5bs9xj"),M(t,"class","pencil-tools svelte-5bs9xj")},m(w,k){ne(w,t,k),S(t,n),S(t,r),S(t,a),Fe(a,e[0]),S(t,d),S(t,l),Fe(l,e[1]),v=!0,u||(y=[ee(n,"click",function(){Ie(e[4])&&e[4].apply(this,arguments)}),ee(a,"change",e[8]),ee(a,"input",e[8]),ee(l,"input",e[9])],u=!0)},p(w,k){e=w,k&1&&Fe(a,e[0]),k&2&&Fe(l,e[1])},i(w){v||(w&&st(()=>{v&&(s||(s=Se(t,Ye,{duration:200,axis:"x"},!0)),s.run(1))}),v=!0)},o(w){w&&(s||(s=Se(t,Ye,{duration:200,axis:"x"},!1)),s.run(0)),v=!1},d(w){w&&A(t),w&&s&&s.end(),u=!1,it(y)}}}function zt(e){let t,n,i=`<span class="button-icon svelte-5bs9xj" style="-webkit-mask: url(${K}/images/svg/pencil.svg) no-repeat center / contain; mask: url(${K}/images/svg/pencil.svg) no-repeat center / contain;"></span>`,r,a,d,l,s,v=`<span class="button-icon svelte-5bs9xj" style="-webkit-mask: url(${K}/images/svg/trash.svg) no-repeat center / contain; mask: url(${K}/images/svg/trash.svg) no-repeat center / contain;"></span>`,u,y,w,k,T,C,H=`<span class="button-icon svelte-5bs9xj" style="-webkit-mask: url(${K}/images/svg/user.svg) no-repeat center / contain; mask: url(${K}/images/svg/user.svg) no-repeat center / contain;"></span>`,x,L,D=`<span class="button-icon svelte-5bs9xj" style="-webkit-mask: url(${K}/images/svg/maximize.svg) no-repeat center / contain; mask: url(${K}/images/svg/maximize.svg) no-repeat center / contain;"></span>`,m,X,b,c,g=e[5].activeTool==="pencil"&&ct(e);return{c(){t=R("div"),n=R("button"),n.innerHTML=i,r=z(),g&&g.c(),a=z(),d=R("div"),l=z(),s=R("button"),s.innerHTML=v,u=z(),y=R("button"),w=R("span"),T=z(),C=R("a"),C.innerHTML=H,x=z(),L=R("button"),L.innerHTML=D,this.h()},l(p){t=V(p,"DIV",{class:!0});var _=N(t);n=V(_,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(n)!=="svelte-t1zbc2"&&(n.innerHTML=i),r=W(_),g&&g.l(_),a=W(_),d=V(_,"DIV",{class:!0}),N(d).forEach(A),l=W(_),s=V(_,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(s)!=="svelte-cbr57k"&&(s.innerHTML=v),u=W(_),y=V(_,"BUTTON",{class:!0});var P=N(y);w=V(P,"SPAN",{class:!0,style:!0}),N(w).forEach(A),P.forEach(A),T=W(_),C=V(_,"A",{class:!0,href:!0,"data-svelte-h":!0}),ge(C)!=="svelte-1xuhzhs"&&(C.innerHTML=H),x=W(_),L=V(_,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(L)!=="svelte-siuh87"&&(L.innerHTML=D),_.forEach(A),this.h()},h(){M(n,"class","pencil button svelte-5bs9xj"),F(n,"selected",e[5].activeTool==="pencil"),M(d,"class","spacer svelte-5bs9xj"),M(s,"class","close button svelte-5bs9xj"),M(w,"class","button-icon svelte-5bs9xj"),lt(w,"-webkit-mask","url("+K+"/images/svg/refresh.svg) no-repeat center / contain"),lt(w,"mask","url("+K+"/images/svg/refresh.svg) no-repeat center / contain"),M(y,"class","refresh button svelte-5bs9xj"),y.disabled=k=e[6].savingStatus==="saving",M(C,"class","button svelte-5bs9xj"),M(C,"href",K+"/profile"),M(L,"class","button svelte-5bs9xj"),M(t,"class","toolbar-container svelte-5bs9xj")},m(p,_){ne(p,t,_),S(t,n),S(t,r),g&&g.m(t,null),S(t,a),S(t,d),S(t,l),S(t,s),S(t,u),S(t,y),S(y,w),S(t,T),S(t,C),S(t,x),S(t,L),X=!0,b||(c=[ee(n,"click",e[7]),ee(s,"click",function(){Ie(e[3])&&e[3].apply(this,arguments)}),ee(y,"click",function(){Ie(e[2])&&e[2].apply(this,arguments)}),ee(L,"click",e[10])],b=!0)},p(p,[_]){e=p,(!X||_&32)&&F(n,"selected",e[5].activeTool==="pencil"),e[5].activeTool==="pencil"?g?(g.p(e,_),_&32&&q(g,1)):(g=ct(e),g.c(),q(g,1),g.m(t,a)):g&&(we(),G(g,1,1,()=>{g=null}),_e()),(!X||_&64&&k!==(k=e[6].savingStatus==="saving"))&&(y.disabled=k)},i(p){X||(q(g),p&&st(()=>{X&&(m||(m=Se(t,Ye,{duration:200},!0)),m.run(1))}),X=!0)},o(p){G(g),p&&(m||(m=Se(t,Ye,{duration:200},!1)),m.run(0)),X=!1},d(p){p&&A(t),g&&g.d(),p&&m&&m.end(),b=!1,it(c)}}}function Wt(e,t,n){let i,r;se(e,pe,T=>n(5,i=T)),se(e,Et,T=>n(6,r=T));let{onRefresh:a=()=>{}}=t,{onClose:d=()=>{}}=t,{drawingStroke:l}=t,{drawingColor:s}=t,{onDrawingUndo:v=()=>{}}=t;const u=()=>{he(pe,i.activeTool=i.activeTool==="pencil"?void 0:"pencil",i)};function y(){l=Ot(this.value),n(0,l)}function w(){s=this.value,n(1,s)}const k=()=>{he(pe,i.toolbarVisible=!1,i),he(pe,i.activeTool=void 0,i)};return e.$$set=T=>{"onRefresh"in T&&n(2,a=T.onRefresh),"onClose"in T&&n(3,d=T.onClose),"drawingStroke"in T&&n(0,l=T.drawingStroke),"drawingColor"in T&&n(1,s=T.drawingColor),"onDrawingUndo"in T&&n(4,v=T.onDrawingUndo)},[l,s,a,d,v,i,r,u,y,w,k]}class Gt extends He{constructor(t){super(),Ae(this,t,Wt,zt,Pe,{onRefresh:2,onClose:3,drawingStroke:0,drawingColor:1,onDrawingUndo:4})}}function ut(e,t,n){const i=e.slice();return i[46]=t[n],i[47]=t,i[48]=n,i}function dt(e,t){let n,i,r,a,d=t[48],l,s,v;function u(...C){return t[20](t[48],...C)}function y(C){t[21](C,t[46])}let w={active:t[12]==t[46],preventHover:t[11],onPointerdown:u,onDragstart:t[18]};t[14][t[46]].title!==void 0&&(w.title=t[14][t[46]].title),i=new Lt({props:w}),Q.push(()=>ke(i,"title",y));const k=()=>t[22](n,d),T=()=>t[22](null,d);return{key:e,first:null,c(){n=R("div"),Ee(i.$$.fragment),a=z(),this.h()},l(C){n=V(C,"DIV",{class:!0});var H=N(n);Te(i.$$.fragment,H),a=W(H),H.forEach(A),this.h()},h(){M(n,"class","tab-container svelte-6u8cf7"),F(n,"placeholder",t[13]==t[46]),this.first=n},m(C,H){ne(C,n,H),Le(i,n,null),S(n,a),k(),l=!0,s||(v=Ht(t[17].call(null,n)),s=!0)},p(C,H){t=C;const x={};H[0]&4112&&(x.active=t[12]==t[46]),H[0]&2048&&(x.preventHover=t[11]),H[0]&16&&(x.onPointerdown=u),!r&&H[0]&16400&&(r=!0,x.title=t[14][t[46]].title,ye(()=>r=!1)),i.$set(x),d!==t[48]&&(T(),d=t[48],k()),(!l||H[0]&8208)&&F(n,"placeholder",t[13]==t[46])},i(C){l||(q(i.$$.fragment,C),l=!0)},o(C){G(i.$$.fragment,C),l=!1},d(C){C&&A(n),Ce(i),T(),s=!1,v()}}}function ft(e){let t,n=`<span class="button-icon svelte-6u8cf7" style="-webkit-mask: url(${K}/images/svg/gear.svg) no-repeat center / contain; mask: url(${K}/images/svg/gear.svg) no-repeat center / contain;"></span>`,i,r,a,d;return{c(){t=R("button"),t.innerHTML=n,this.h()},l(l){t=V(l,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(t)!=="svelte-1wioe5y"&&(t.innerHTML=n),this.h()},h(){M(t,"class","button svelte-6u8cf7")},m(l,s){ne(l,t,s),r=!0,a||(d=ee(t,"click",e[24]),a=!0)},p:me,i(l){r||(l&&st(()=>{r&&(i||(i=Se(t,Ye,{duration:200,axis:"x"},!0)),i.run(1))}),r=!0)},o(l){l&&(i||(i=Se(t,Ye,{duration:200,axis:"x"},!1)),i.run(0)),r=!1},d(l){l&&A(t),l&&i&&i.end(),a=!1,d()}}}function gt(e){let t,n,i,r;function a(s){e[27](s)}function d(s){e[28](s)}let l={onDrawingUndo:e[2],onRefresh:Ut.loadFromFirestore,onClose:e[26]};return e[1]!==void 0&&(l.drawingColor=e[1]),e[0]!==void 0&&(l.drawingStroke=e[0]),t=new Gt({props:l}),Q.push(()=>ke(t,"drawingColor",a)),Q.push(()=>ke(t,"drawingStroke",d)),{c(){Ee(t.$$.fragment)},l(s){Te(t.$$.fragment,s)},m(s,v){Le(t,s,v),r=!0},p(s,v){const u={};v[0]&4&&(u.onDrawingUndo=s[2]),v[0]&4096&&(u.onClose=s[26]),!n&&v[0]&2&&(n=!0,u.drawingColor=s[1],ye(()=>n=!1)),!i&&v[0]&1&&(i=!0,u.drawingStroke=s[0],ye(()=>i=!1)),t.$set(u)},i(s){r||(q(t.$$.fragment,s),r=!0)},o(s){G(t.$$.fragment,s),r=!1},d(s){Ce(t,s)}}}function Kt(e){let t,n,i,r=[],a=new Map,d,l,s,v=`<span class="button-icon svelte-6u8cf7" style="-webkit-mask: url(${K}/images/svg/plus.svg) no-repeat center / contain; mask: url(${K}/images/svg/plus.svg) no-repeat center / contain;"></span>`,u,y,w,k,T,C,H,x,L,D,m,X=De(e[4].order);const b=p=>p[46];for(let p=0;p<X.length;p+=1){let _=ut(e,X,p),P=b(_);a.set(P,r[p]=dt(P,_))}let c=!e[4].toolbarVisible&&ft(e);T=new Lt({props:{title:e[7],active:!e[9],preventHover:!0}});let g=e[4].toolbarVisible&&gt(e);return{c(){t=R("div"),n=R("div"),i=R("div");for(let p=0;p<r.length;p+=1)r[p].c();d=z(),l=R("div"),s=R("button"),s.innerHTML=v,u=z(),y=R("div"),c&&c.c(),w=z(),k=R("div"),Ee(T.$$.fragment),C=z(),H=R("div"),x=z(),g&&g.c(),this.h()},l(p){t=V(p,"DIV",{class:!0});var _=N(t);n=V(_,"DIV",{class:!0});var P=N(n);i=V(P,"DIV",{class:!0});var te=N(i);for(let ue=0;ue<r.length;ue+=1)r[ue].l(te);te.forEach(A),d=W(P),l=V(P,"DIV",{class:!0});var Z=N(l);s=V(Z,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(s)!=="svelte-g0ls06"&&(s.innerHTML=v),Z.forEach(A),u=W(P),y=V(P,"DIV",{class:!0});var $=N(y);c&&c.l($),$.forEach(A),w=W(P),k=V(P,"DIV",{class:!0});var le=N(k);Te(T.$$.fragment,le),le.forEach(A),P.forEach(A),C=W(_),H=V(_,"DIV",{class:!0}),N(H).forEach(A),x=W(_),g&&g.l(_),_.forEach(A),this.h()},h(){M(i,"class","tabs svelte-6u8cf7"),M(s,"class","button svelte-6u8cf7"),M(l,"class","new-tab-container svelte-6u8cf7"),M(y,"class","buttons-container svelte-6u8cf7"),M(k,"class","clone svelte-6u8cf7"),F(k,"dragging",e[3]),M(n,"class","tabbar svelte-6u8cf7"),M(H,"class","divider svelte-6u8cf7"),M(t,"class","svelte-6u8cf7")},m(p,_){ne(p,t,_),S(t,n),S(n,i);for(let P=0;P<r.length;P+=1)r[P]&&r[P].m(i,null);e[23](i),S(n,d),S(n,l),S(l,s),S(n,u),S(n,y),c&&c.m(y,null),S(n,w),S(n,k),Le(T,k,null),e[25](k),S(t,C),S(t,H),S(t,x),g&&g.m(t,null),e[29](t),L=!0,D||(m=ee(s,"click",e[15]),D=!0)},p(p,_){_[0]&817232&&(X=De(p[4].order),we(),r=tt(r,_,b,1,p,X,a,i,nt,dt,null,ut),_e()),p[4].toolbarVisible?c&&(we(),G(c,1,1,()=>{c=null}),_e()):c?(c.p(p,_),_[0]&16&&q(c,1)):(c=ft(p),c.c(),q(c,1),c.m(y,null));const P={};_[0]&128&&(P.title=p[7]),_[0]&512&&(P.active=!p[9]),T.$set(P),(!L||_[0]&8)&&F(k,"dragging",p[3]),p[4].toolbarVisible?g?(g.p(p,_),_[0]&16&&q(g,1)):(g=gt(p),g.c(),q(g,1),g.m(t,null)):g&&(we(),G(g,1,1,()=>{g=null}),_e())},i(p){if(!L){for(let _=0;_<X.length;_+=1)q(r[_]);q(c),q(T.$$.fragment,p),q(g),L=!0}},o(p){for(let _=0;_<r.length;_+=1)G(r[_]);G(c),G(T.$$.fragment,p),G(g),L=!1},d(p){p&&A(t);for(let _=0;_<r.length;_+=1)r[_].d();e[23](null),c&&c.d(),Ce(T),e[25](null),g&&g.d(),e[29](null),D=!1,m()}}}const Qt=12,ze=200,Ue=32,Ne=200,Jt=1600,ht=.3;function Zt(e,t,n){let i,r,a,d;se(e,pe,h=>n(4,a=h)),se(e,ce,h=>n(14,d=h));let{onDrawingUndo:l=()=>{}}=t,{drawingStroke:s}=t,{drawingColor:v}=t,u,y=[],w=0,k=null,T=-1,C="",H,x,L,D=!1,m=!1,X=0,b=0,c,g=!1;const p=(h,I=300)=>{let O;return(...U)=>{clearTimeout(O),O=setTimeout(()=>{h.apply(void 0,U)},I)}};function _(){ae.newTab()}const P=h=>{const I=a.order.findIndex(O=>O===h);if(I<0||!y[I]){console.warn("Cannot close tab!");return}w=y[I].getBoundingClientRect().width,I<a.order.length-1&&(u.style.setProperty("--tab-max-width",`${w}px`),te()),I==a.activeIndex&&(I==a.order.length-1?ae.setActiveIndex(I-1):ae.setActiveIndex(I+1)),et({duration:Ne,easing:be,onStep:(O,U)=>{I==0?n(5,u.style.gridTemplateColumns=`minmax(${U*Ue}px, ${U*w}px)`,u):n(5,u.style.gridTemplateColumns=`repeat(${I}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${U*Ue}px, ${U*w}px)`,u)},onEnd:()=>{n(5,u.style.gridTemplateColumns="",u),ae.removeTab(h)}})},te=p(()=>{u&&(u.style.setProperty("--tab-max-width",`${ze}px`),et({duration:Ne,easing:be,onStep:(h,I)=>{u.style.setProperty("--tab-max-width",`${w+h*(ze-w)}px`)},onEnd:()=>{u.style.setProperty("--tab-max-width",`${ze}px`)}}))},Jt);function Z(h){if(!u)return;const I=h.getBoundingClientRect().width;et({duration:Ne,easing:be,onStep:(O,U)=>{a.order.length==1?n(5,u.style.gridTemplateColumns=`minmax(${O*Ue}px, ${O*I}px)`,u):n(5,u.style.gridTemplateColumns=`repeat(${a.order.length-1}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${O*Ue}px, ${O*I}px)`,u),n(5,u.scrollLeft=u.scrollWidth,u)},onEnd:()=>{n(5,u.style.gridTemplateColumns="",u)}})}const $=(h,I)=>{const O=y[0].getBoundingClientRect().width;ae.moveTab(h,I,()=>{if(h>I)for(let U=I;U<h;U++)at(y[U],{duration:Ne,easing:be,css:(Be,oe)=>`transform: translateX(-${oe*O}px);`});if(h<I)for(let U=I;U>h;U--)at(y[U],{duration:Ne,easing:be,css:(Be,oe)=>`transform: translateX(${oe*O}px);`})})};function le(h){!h.target||!h.dataTransfer||(h.dataTransfer.setData("text/plain",i),h.dataTransfer.setDragImage(new Image,0,0))}function ue(h,I){if(h==0&&I==0){n(8,L.style.left="-1000px",L),n(8,L.style.top="-1000px",L);return}let O=c.getBoundingClientRect();if(h<O.left||h>O.right||I<O.top||I>O.bottom){m||(b=0),n(8,L.style.left=`${h+X}px`,L),n(8,L.style.top=`${I-x.height/2}px`,L),n(9,m=!0);return}m&&n(9,m=!1),n(8,L.style.left=`${h+X}px`,L),n(8,L.style.top=`${x.top}px`,L);const U=-u.scrollLeft,Be=y[0].getBoundingClientRect().width;let oe=-1;if(h>U+a.order.length*Be)oe=a.order.length-1;else for(let Oe=0;Oe<a.order.length;Oe++)if(h>U+Oe*Be&&h<U+(Oe+1)*Be){oe=Oe;break}h<20?(b=-ht,requestAnimationFrame(xe)):h>u.clientWidth-10?(b=ht,requestAnimationFrame(xe)):b=0,!(oe==-1||oe==a.placeholderIndex)&&$(a.placeholderIndex,oe)}let ve=0;function xe(h){if(!D||b==0){ve=0;return}ve==0&&(ve=h);const I=h-ve;ve=h,u.scrollBy({left:b*I}),requestAnimationFrame(xe)}function Re(h,I){if(!h.target)return;let O,U;h instanceof TouchEvent?(O=h.touches[0].clientX,U=h.touches[0].clientY):(O=h.clientX,U=h.clientY),window.addEventListener("touchmove",re,{passive:!1}),window.addEventListener("touchend",ie),window.addEventListener("mousemove",re),window.addEventListener("mouseup",ie),window.addEventListener("drag",re),window.addEventListener("dragend",ie),window.addEventListener("blur",ie),ae.setActiveIndex(I),H=h.target,x=H.getBoundingClientRect(),k=[O,U],X=x.left-O,x.top-U,n(8,L.style.width=`${x.width}px`,L),n(8,L.style.left=`${x.left}px`,L),n(8,L.style.top=`${x.top}px`,L),T=I,n(7,C=d[a.order[I]].title)}function re(h){let I,O;if(h instanceof TouchEvent?(I=h.touches[0].clientX,O=h.touches[0].clientY,h.preventDefault()):(I=h.clientX,O=h.clientY),D){ue(I,O);return}k===null||Math.hypot(k[0]-I,k[1]-O)<Qt||(n(3,D=!0),ae.setPlaceholderIndex(T),ae.setActiveIndex(T))}function ie(){window.removeEventListener("touchmove",re),window.removeEventListener("touchend",ie),window.removeEventListener("mousemove",re),window.removeEventListener("mouseup",ie),window.removeEventListener("drag",re),window.removeEventListener("dragend",ie),window.removeEventListener("blur",ie),k=null,n(9,m=!1),T=-1,X=0,ae.setPlaceholderIndex(),n(3,D=!1)}rt(()=>{u.style.setProperty("--tab-max-width",`${ze}px`),u.style.setProperty("--tab-min-width",`${Ue}px`)});const Qe=(h,I)=>Re(I,h);function Je(h,I){e.$$.not_equal(d[I].title,h)&&(d[I].title=h,ce.set(d))}function Ze(h,I){Q[h?"unshift":"push"](()=>{y[I]=h,n(6,y)})}function E(h){Q[h?"unshift":"push"](()=>{u=h,n(5,u)})}const J=()=>{he(pe,a.toolbarVisible=!0,a)};function B(h){Q[h?"unshift":"push"](()=>{L=h,n(8,L)})}const de=()=>P(i);function Ve(h){v=h,n(1,v)}function qe(h){s=h,n(0,s)}function Yt(h){Q[h?"unshift":"push"](()=>{c=h,n(10,c)})}return e.$$set=h=>{"onDrawingUndo"in h&&n(2,l=h.onDrawingUndo),"drawingStroke"in h&&n(0,s=h.drawingStroke),"drawingColor"in h&&n(1,v=h.drawingColor)},e.$$.update=()=>{e.$$.dirty[0]&16&&n(12,i=a.order[a.activeIndex]),e.$$.dirty[0]&16&&n(13,r=a.order[a.placeholderIndex]),e.$$.dirty[0]&8&&(D?n(11,g=!0):setTimeout(()=>n(11,g=!1),20))},[s,v,l,D,a,u,y,C,L,m,c,g,i,r,d,_,P,Z,le,Re,Qe,Je,Ze,E,J,B,de,Ve,qe,Yt]}class $t extends He{constructor(t){super(),Ae(this,t,Zt,Kt,Pe,{onDrawingUndo:2,drawingStroke:0,drawingColor:1},null,[-1,-1])}}function en(e){let t,n;return{c(){t=R("div"),n=R("div"),this.h()},l(i){t=V(i,"DIV",{class:!0});var r=N(t);n=V(r,"DIV",{class:!0}),N(n).forEach(A),r.forEach(A),this.h()},h(){M(n,"class","quill-editor svelte-1zs6ve"),M(t,"class","quill-editor-wrapper svelte-1zs6ve"),F(t,"disabled",e[0])},m(i,r){ne(i,t,r),S(t,n),e[5](n)},p(i,[r]){r&1&&F(t,"disabled",i[0])},i:me,o:me,d(i){i&&A(t),e[5](null)}}}function tn(e,t,n){let i,r;se(e,ce,m=>n(6,i=m)),se(e,Tt,m=>n(4,r=m));let{tabID:a}=t,{disabled:d=!1}=t,l,s;const v=(m,X=300)=>{let b;return(...c)=>{clearTimeout(b),b=setTimeout(()=>{m.apply(void 0,c)},X)}};async function u(m){var g,p,_,P;if(!l)return;const{Delta:X,Range:b}=await ot(async()=>{const{Delta:te,Range:Z}=await import("../chunks/core.CG__ofcG.js").then($=>$.G);return{Delta:te,Range:Z}},[],import.meta.url);if(m.undo.length>0)for(var c=0;c<m.undo.length;c++){const te=(g=m.undo[c].range)==null?void 0:g.index,Z=(p=m.undo[c].range)==null?void 0:p.length,$={delta:new X(m.undo[c].delta.ops),range:te!==void 0&&Z!==void 0?new b(te,Z):null};l.history.stack.undo.push($)}if(m.redo.length>0)for(var c=0;c<m.redo.length;c++){const Z=(_=m.redo[c].range)==null?void 0:_.index,$=(P=m.redo[c].range)==null?void 0:P.length,le={delta:new X(m.redo[c].delta.ops),range:Z!==void 0&&$!==void 0?new b(Z,$):null};l.history.stack.redo.push(le)}}function y(m){var X;l&&((X=l.getSelection())==null?void 0:X.length)===0&&window.open(m.target.href,"_blank")}function w(){if(!l||!i[a])return;const m=i[a].ops;l.setContents(m);const X=i[a].history;u(X)}function k(){if(!l||!i[a])return;he(ce,i[a].ops=l.getContents().ops,i);const m=structuredClone(l.history.stack);he(ce,i[a].history=m,i)}const T=v(k,500);function C(){if(!l)return;l.formatText(0,l.getLength(),"link",!1,"api");const m=l.getText(),X=/https?:\/\/\S+/gi,b=m.matchAll(X);for(const p of b)l.formatText(p.index,p[0].length,"link",p[0],"api");const c=/.+\@.+\..+/gi,g=m.matchAll(c);for(const p of g)l.formatText(p.index,p[0].length,"link","mailto:"+p[0],"api");document.querySelectorAll(".ql-editor a").forEach(p=>{p.addEventListener("click",y)})}const H=v(C,500);function x(m,X,b){if(b==="user"){const c=l.getText().split(`
`)[0].trim();he(ce,i[a].title=c===""?"Untitled":c,i),H(),T()}}async function L(){const{default:m}=await ot(async()=>{const{default:X}=await import("../chunks/quill.Bk4jDS0q.js");return{default:X}},__vite__mapDeps([0,1]),import.meta.url);n(3,l=new m(s,{formats:["bold","italic","underline","strike","code","link"],placeholder:"Enter text here"})),w(),C(),l.on("text-change",x),l.keyboard.addBinding({key:"/",altKey:!0},()=>{l.format("code",!l.getFormat().code)}),l.keyboard.addBinding({key:"-",altKey:!0},()=>{l.format("strike",!l.getFormat().strike)})}rt(()=>{L()});function D(m){Q[m?"unshift":"push"](()=>{s=m,n(1,s)})}return e.$$set=m=>{"tabID"in m&&n(2,a=m.tabID),"disabled"in m&&n(0,d=m.disabled)},e.$$.update=()=>{e.$$.dirty&9&&(d?l==null||l.disable():l==null||l.enable()),e.$$.dirty&24&&(l==null||l.root.setAttribute("spellcheck",r.spellCheck.toString()))},[d,s,a,l,r,D]}class nn extends He{constructor(t){super(),Ae(this,t,tn,en,Pe,{tabID:2,disabled:0})}}const mt=500,sn=300,vt=500,rn=300;class ln{constructor(){j(this,"isMoving",!1);j(this,"isLongclick",!1);j(this,"button",0);j(this,"lastX",0);j(this,"lastY",0);j(this,"consecutiveClicks",0);j(this,"lastMouseupTime",0);j(this,"activeElement",null);this.reset()}reset(){this.isMoving=!1,this.isLongclick=!1,this.button=0,this.lastX=0,this.lastY=0,this.consecutiveClicks=0,this.lastMouseupTime=0,this.activeElement=null}}class on{constructor(){j(this,"isDragging",!1);j(this,"isPinching",!1);j(this,"isLongpressed",!1);j(this,"consecutiveTaps",0);j(this,"lastTouchendTime",0);j(this,"lastCenterX",0);j(this,"lastCenterY",0);j(this,"identifier",0);j(this,"x",0);j(this,"y",0);j(this,"hypotenuse",0);j(this,"activeElement",null);this.reset()}reset(){this.isDragging=!1,this.isPinching=!1,this.isLongpressed=!1,this.consecutiveTaps=0,this.lastTouchendTime=0,this.lastCenterX=0,this.lastCenterY=0,this.identifier=0,this.x=0,this.y=0,this.hypotenuse=0,this.activeElement=null}}let fe=[],f=new ln,o=new on;const Y=(e,t)=>{e!=null&&e.dispatchEvent(new CustomEvent("gesture",{detail:t,bubbles:!1,cancelable:!1}))},Ct=e=>{f.reset(),o.reset(),f.lastMouseupTime=Date.now(),window.removeEventListener("mousemove",We),window.removeEventListener("mouseup",Ge),window.removeEventListener("touchmove",Ke),window.removeEventListener("touchend",Xe)},xt=e=>{if(window.removeEventListener("mousemove",We),window.removeEventListener("mouseup",Ge),window.removeEventListener("touchmove",Ke),window.removeEventListener("touchend",Xe),f.isMoving)if(f.isMoving=!1,f.isLongclick)f.isLongclick=!1,Y(f.activeElement,{event:e,name:"longclick-drag-end",x:f.lastX,y:f.lastY,dx:0,dy:0});else switch(f.button){case 0:Y(f.activeElement,{event:e,name:"left-click-drag-end",x:f.lastX,y:f.lastY,dx:0,dy:0});break;case 1:Y(f.activeElement,{event:e,name:"middle-click-drag-end",x:f.lastX,y:f.lastY,dx:0,dy:0});break;case 2:Y(f.activeElement,{event:e,name:"right-click-drag-end",x:f.lastX,y:f.lastY,dx:0,dy:0});break}f.isLongclick&&Y(f.activeElement,{event:e,name:"longclick-release",x:f.lastX,y:f.lastY,dx:0,dy:0}),f.reset(),o.isDragging&&(o.isDragging=!1,o.isLongpressed?(o.isLongpressed=!1,Y(o.activeElement,{event:e,name:"longpress-drag-end",x:o.lastCenterX,y:o.lastCenterY,dx:0,dy:0})):Y(o.activeElement,{event:e,name:"touch-drag-end",x:o.lastCenterX,y:o.lastCenterY,dx:0,dy:0})),o.isLongpressed&&Y(o.activeElement,{event:e,name:"longpress-release",x:o.lastCenterX,y:o.lastCenterY,dx:0,dy:0}),o.reset()},Dt=e=>{Y(e.target,{event:e,name:"wheel",x:e.clientX,y:e.clientY,dx:0,dy:0})},It=e=>{},St=e=>{document.activeElement!==e.target&&(window.addEventListener("mousemove",We),window.addEventListener("mouseup",Ge),f.activeElement=e.target,f.lastX=e.clientX,f.lastY=e.clientY,f.isMoving||(f.button=e.button),f.button===0&&window.setTimeout(()=>{Date.now()-f.lastMouseupTime>=vt&&!f.isMoving&&(f.isLongclick=!0,Y(f.activeElement,{event:e,name:"longclick",x:e.clientX,y:e.clientY,dx:0,dy:0}))},vt))},We=e=>{if(e.movementX===0&&e.movementY===0)return;let t=e.clientX-f.lastX,n=e.clientY-f.lastY;if(!f.isMoving)if(f.isLongclick)Y(f.activeElement,{event:e,name:"longclick-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});else switch(f.button){case 0:Y(f.activeElement,{event:e,name:"left-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 1:Y(f.activeElement,{event:e,name:"middle-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 2:Y(f.activeElement,{event:e,name:"right-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break}if(f.isMoving=!0,f.lastX=e.clientX,f.lastY=e.clientY,f.isLongclick)Y(f.activeElement,{event:e,name:"longclick-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});else switch(f.button){case 0:Y(f.activeElement,{event:e,name:"left-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break;case 1:Y(f.activeElement,{event:e,name:"middle-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break;case 2:Y(f.activeElement,{event:e,name:"right-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break}},Ge=e=>{if(window.removeEventListener("mousemove",We),window.removeEventListener("mouseup",Ge),f.lastMouseupTime=Date.now(),f.isMoving)if(f.isMoving=!1,f.isLongclick)f.isLongclick=!1,Y(f.activeElement,{event:e,name:"longclick-drag-end",x:f.lastX,y:f.lastY,dx:0,dy:0});else switch(f.button){case 0:Y(f.activeElement,{event:e,name:"left-click-drag-end",x:f.lastX,y:f.lastY,dx:0,dy:0});break;case 1:Y(f.activeElement,{event:e,name:"middle-click-drag-end",x:f.lastX,y:f.lastY,dx:0,dy:0});break;case 2:Y(f.activeElement,{event:e,name:"right-click-drag-end",x:f.lastX,y:f.lastY,dx:0,dy:0});break}else f.isLongclick||(e.button===2?Y(f.activeElement,{event:e,name:"right-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):e.button===1?Y(f.activeElement,{event:e,name:"middle-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):(f.consecutiveClicks===0&&Y(f.activeElement,{event:e,name:"left-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),f.consecutiveClicks++,window.setTimeout(()=>{f.consecutiveClicks>1&&Y(f.activeElement,{event:e,name:"double-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),f.consecutiveClicks=0},rn)));f.isLongclick&&Y(f.activeElement,{event:e,name:"longclick-release",x:e.clientX,y:e.clientY,dx:0,dy:0}),f.isLongclick=!1},Mt=e=>{if(e.touches.length>1,document.activeElement!==e.target){if(e.touches.length>1){if(e.touches[0].identifier===o.identifier)return;o.isPinching=!0}window.addEventListener("touchmove",Ke,{passive:!1}),window.addEventListener("touchend",Xe),window.addEventListener("touchcancel",Xe),o.identifier=e.touches[0].identifier,o.x=e.touches[0].clientX,o.y=e.touches[0].clientY,o.activeElement=e.target,window.setTimeout(()=>{o.isPinching||o.isDragging||Date.now()-o.lastTouchendTime>=mt&&(o.isDragging=!1,o.isPinching=!1,o.hypotenuse=null,o.isLongpressed=!0,Y(o.activeElement,{event:e,name:"longpress",x:o.x,y:o.y,dx:0,dy:0}))},mt)}},Ke=e=>{if(o.isDragging){let t=o.x,n=o.y;o.x=e.touches[0].clientX,o.y=e.touches[0].clientY;let i=o.x-t,r=o.y-n;o.isLongpressed?Y(o.activeElement,{event:e,name:"longpress-dragging",x:o.x,y:o.y,dx:i,dy:r,force:e.touches[0].force}):Y(o.activeElement,{event:e,name:"touch-dragging",x:o.x,y:o.y,dx:i,dy:r,force:e.touches[0].force});return}else if(!o.isLongpressed&&(o.isPinching||e.touches.length>1)){o.x=e.touches[0].clientX,o.y=e.touches[0].clientY;let t={x:e.touches[1].clientX,y:e.touches[1].clientY},n={x:(o.x+t.x)/2,y:(o.y+t.y)/2},i=Math.hypot(o.x-t.x,o.y-t.y);o.hypotenuse===null&&(o.hypotenuse=i,o.lastCenterX=n.x,o.lastCenterY=n.y,Y(o.activeElement,{event:e,name:"pinch-start",x:n.x,y:n.y,dx:0,dy:0})),o.isPinching=!0;let r=i/o.hypotenuse,a=n.x-o.lastCenterX,d=n.y-o.lastCenterY;Y(o.activeElement,{event:e,name:"pinching",x:n.x,y:n.y,zoom:r,dx:a,dy:d}),o.hypotenuse=i,o.lastCenterX=n.x,o.lastCenterY=n.y;return}else o.isDragging=!0,o.isLongpressed?(Y(o.activeElement,{event:e,name:"longpress-drag-start",x:o.x,y:o.y,dx:0,dy:0,force:e.touches[0].force}),o.x=e.touches[0].clientX,o.y=e.touches[0].clientY,Y(o.activeElement,{event:e,name:"longpress-dragging",x:o.x,y:o.y,dx:0,dy:0,force:e.touches[0].force})):(Y(o.activeElement,{event:e,name:"touch-drag-start",x:o.x,y:o.y,dx:0,dy:0,force:e.touches[0].force}),o.x=e.touches[0].clientX,o.y=e.touches[0].clientY,Y(o.activeElement,{event:e,name:"touch-dragging",x:o.x,y:o.y,dx:0,dy:0,force:e.touches[0].force}))},Xe=e=>{o.isDragging&&e.touches.length>0&&e.touches[0].identifier===o.identifier||(o.lastTouchendTime=Date.now(),window.removeEventListener("touchmove",Ke),window.removeEventListener("touchend",Xe),window.removeEventListener("touchcancel",Xe),o.isDragging?(o.isDragging=!1,o.isLongpressed?(o.isLongpressed=!1,Y(o.activeElement,{event:e,name:"longpress-drag-end",x:o.x,y:o.y,dx:0,dy:0})):Y(o.activeElement,{event:e,name:"touch-drag-end",x:o.x,y:o.y,dx:0,dy:0})):o.isPinching?(o.isPinching=!1,o.hypotenuse=null,Y(o.activeElement,{event:e,name:"pinch-end",x:o.lastCenterX,y:o.lastCenterY,dx:0,dy:0})):o.isLongpressed||(o.consecutiveTaps===0&&Y(o.activeElement,{event:e,name:"tap",x:o.x,y:o.y,dx:0,dy:0}),o.consecutiveTaps++,window.setTimeout(()=>{o.consecutiveTaps>1&&Y(o.activeElement,{event:e,name:"double-tap",x:o.x,y:o.y,dx:0,dy:0}),o.consecutiveTaps=0},sn)),o.isLongpressed&&Y(o.activeElement,{event:e,name:"longpress-release",x:o.x,y:o.y,dx:0,dy:0}),o.isLongpressed=!1)};function an(...e){for(let t of e)fe.findIndex(n=>n===t)===-1&&(fe.length==0&&(window.addEventListener("blur",xt),window.addEventListener("focus",Ct)),fe.push(t),t.addEventListener("touchstart",Mt,{passive:!1}),t.addEventListener("mousedown",St,{passive:!1}),t.addEventListener("contextmenu",It,{passive:!1}),t.addEventListener("wheel",Dt,{passive:!1}))}function cn(...e){const t=n=>{n.removeEventListener("touchstart",Mt),n.removeEventListener("mousedown",St),n.removeEventListener("contextmenu",It),n.removeEventListener("wheel",Dt)};if(e.length==0){for(let n of fe)t(n);fe=[]}else for(let n of e){let i=fe.findIndex(r=>r===n);i!==-1&&(t(n),fe.splice(i,1))}fe.length==0&&(window.removeEventListener("blur",xt),window.removeEventListener("focus",Ct))}function un(e){let t,n,i,r,a,d,l="LOG";return{c(){t=R("div"),n=R("canvas"),i=z(),r=R("canvas"),a=z(),d=R("div"),d.textContent=l,this.h()},l(s){t=V(s,"DIV",{class:!0});var v=N(t);n=V(v,"CANVAS",{id:!0,class:!0}),N(n).forEach(A),i=W(v),r=V(v,"CANVAS",{id:!0,class:!0}),N(r).forEach(A),a=W(v),d=V(v,"DIV",{class:!0,"data-svelte-h":!0}),ge(d)!=="svelte-rtly9t"&&(d.textContent=l),v.forEach(A),this.h()},h(){M(n,"id","currentPath"),M(n,"class","svelte-mgp9tj"),F(n,"disabled",e[0]),M(r,"id","canvas"),M(r,"class","svelte-mgp9tj"),F(r,"disabled",e[0]),M(d,"class","log svelte-mgp9tj"),M(t,"class","canvas-container svelte-mgp9tj"),F(t,"hide",e[1])},m(s,v){ne(s,t,v),S(t,n),e[12](n),S(t,i),S(t,r),e[13](r),S(t,a),S(t,d),e[14](d)},p(s,v){v[0]&1&&F(n,"disabled",s[0]),v[0]&1&&F(r,"disabled",s[0]),v[0]&2&&F(t,"hide",s[1])},i:me,o:me,d(s){s&&A(t),e[12](null),e[13](null),e[14](null)}}}const dn=2,fn=178;function gn(e,t,n){var i=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),r=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),a=Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2)),d=Math.acos((r*r+i*i-a*a)/(2*r*i));return d*(180/Math.PI)}function bt(e){if(e.points.length<4)return e;for(let t=1;t<e.points.length-2;t++){const n=e.points[t-1],i=e.points[t],r=e.points[t+1];gn(n,i,r)>fn&&(e.points.splice(t,1),t--)}return e}async function je(e,t){if(t.lineWidth=e.lineWidth,t.lineCap="round",t.strokeStyle=e.color,e.points.length<2){t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[0].x,e.points[0].y),t.stroke();return}t.beginPath();let n=e.points[0].x,i=e.points[0].y;for(let r=0;r<e.points.length-1;r++)t.moveTo(n,i),n=(e.points[r].x+e.points[r+1].x)/2,i=(e.points[r].y+e.points[r+1].y)/2,t.quadraticCurveTo(e.points[r].x,e.points[r].y,n,i);t.stroke()}function hn(e){return{x:pt(e.x),y:pt(e.y)}}function pt(e){const t=e.toFixed(dn);return Number(t)}function mn(e,t,n){let i;se(e,ce,E=>n(25,i=E));let{radius:r=3}=t,{smoothness:a=0}=t,{stroke:d=5}=t,{color:l="#000000"}=t,{disabled:s=!1}=t,{hide:v=!1}=t,{tabID:u=""}=t;function y(){T.clearRect(0,0,D/m,L/m),p=[]}function w(){if(p.length!=0){n(4,b.innerHTML="Undo",b),p.pop(),H.clearRect(0,0,D/m,L/m);for(let E=0;E<p.length;E++)je(p[E],H);ue()}}let k,T,C,H,x={x:0,y:0},L=0,D=0,m,X=!1,b,c,g,p=[];function _(){k&&(an(k),window.addEventListener("keydown",ie))}function P(){k&&(cn(k),window.removeEventListener("keydown",ie))}const te=(E,J,B,de)=>{var Ve=B-E,qe=de-J;return Math.sqrt(Ve*Ve+qe*qe)},Z=(E,J=300)=>{let B;return(...de)=>{clearTimeout(B),B=setTimeout(()=>{E.apply(void 0,de)},J)}};function $(E,J){let B=k.getBoundingClientRect();return{x:E-B.left,y:J-B.top}}function le(){if(!k||!C)return;re(),m=window.devicePixelRatio;let E=k.getBoundingClientRect();L=E.height*m,D=E.width*m,n(2,k.width=D,k),n(2,k.height=L,k),n(3,C.width=D,C),n(3,C.height=L,C),T.scale(m,m),H.scale(m,m);for(let J=0;J<p.length;J++)je(p[J],H)}function ue(){i[u]&&he(ce,i[u].paths=p.filter(E=>bt(E)),i)}function ve(){i[u]&&(p=i[u].paths,le())}function xe(E,J){X=!0,x=$(E,J),T.lineWidth=d,T.lineCap="round",T.strokeStyle=l,T.beginPath(),T.moveTo(x.x,x.y),T.stroke(),c={points:[],lineWidth:d,color:l}}function Re(E,J){if(!X)return;let B=$(E,J);if(r>0){if(te(B.x,B.y,x.x,x.y)<=r){c.points.length===0&&(c.points.push(B),je(c,T));return}let de=Math.sqrt(B.x*B.x+B.y*B.y-2*B.x*x.x+x.x*x.x-2*B.y*x.y+x.y*x.y);if(B={x:B.x+r*((x.x-B.x)/de),y:B.y+r*((x.y-B.y)/de)},te(x.x,x.y,B.x,B.y)<=a)return}c.points.push(hn(B)),T.clearRect(0,0,D/m,L/m),je(c,T),x=B}function re(){X&&(p.push(bt(c)),je(c,H),T.clearRect(0,0,D/m,L/m),ue()),X=!1}const ie=function(E){E.ctrlKey&&E.key=="z"&&w(),E.preventDefault()};rt(()=>{T=k.getContext("2d"),T.imageSmoothingEnabled=!1,H=C.getContext("2d"),H.imageSmoothingEnabled=!1,k.addEventListener("gesture",E=>{switch(E.detail.name){case"left-click-drag-start":case"touch-drag-start":xe(E.detail.x,E.detail.y);break;case"left-click-dragging":case"touch-dragging":E.detail.force>0&&n(4,b.innerHTML=E.detail.force,b),Re(E.detail.x,E.detail.y);break;case"left-click-drag-end":case"touch-drag-end":re();break;case"left-click":case"tap":xe(E.detail.x,E.detail.y),Re(E.detail.x,E.detail.y),re();break}}),g=new ResizeObserver(Z(le,0)),g.observe(k),ve(),s?P():_()}),At(()=>{g&&g.disconnect(),P()});function Qe(E){Q[E?"unshift":"push"](()=>{C=E,n(3,C)})}function Je(E){Q[E?"unshift":"push"](()=>{k=E,n(2,k)})}function Ze(E){Q[E?"unshift":"push"](()=>{b=E,n(4,b)})}return e.$$set=E=>{"radius"in E&&n(5,r=E.radius),"smoothness"in E&&n(6,a=E.smoothness),"stroke"in E&&n(7,d=E.stroke),"color"in E&&n(8,l=E.color),"disabled"in E&&n(0,s=E.disabled),"hide"in E&&n(1,v=E.hide),"tabID"in E&&n(9,u=E.tabID)},e.$$.update=()=>{e.$$.dirty[0]&1&&(s?P():_())},[s,v,k,C,b,r,a,d,l,u,y,w,Qe,Je,Ze]}class vn extends He{constructor(t){super(),Ae(this,t,mn,un,Pe,{radius:5,smoothness:6,stroke:7,color:8,disabled:0,hide:1,tabID:9,clear:10,undo:11},null,[-1,-1])}get clear(){return this.$$.ctx[10]}get undo(){return this.$$.ctx[11]}}function wt(e,t,n){const i=e.slice();return i[15]=t[n],i}function _t(e,t,n){const i=e.slice();return i[15]=t[n],i}function bn(e){let t,n;return t=new Nt({}),{c(){Ee(t.$$.fragment)},l(i){Te(t.$$.fragment,i)},m(i,r){Le(t,i,r),n=!0},p:me,i(i){n||(q(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){Ce(t,i)}}}function pn(e){let t,n,i,r,a,d,l,s=[],v=new Map,u,y,w=[],k=new Map,T;function C(b){e[9](b)}function H(b){e[10](b)}let x={onDrawingUndo:e[8]};e[2]!==void 0&&(x.drawingStroke=e[2]),e[0]!==void 0&&(x.drawingColor=e[0]),n=new $t({props:x}),Q.push(()=>ke(n,"drawingStroke",C)),Q.push(()=>ke(n,"drawingColor",H));let L=De(Object.keys(e[7]));const D=b=>b[15];for(let b=0;b<L.length;b+=1){let c=_t(e,L,b),g=D(c);v.set(g,s[b]=yt(g,c))}let m=De(Object.keys(e[7]));const X=b=>b[15];for(let b=0;b<m.length;b+=1){let c=wt(e,m,b),g=X(c);k.set(g,w[b]=kt(g,c))}return{c(){t=R("div"),Ee(n.$$.fragment),a=z(),d=R("div"),l=R("div");for(let b=0;b<s.length;b+=1)s[b].c();u=z(),y=R("div");for(let b=0;b<w.length;b+=1)w[b].c();this.h()},l(b){t=V(b,"DIV",{class:!0});var c=N(t);Te(n.$$.fragment,c),a=W(c),d=V(c,"DIV",{class:!0});var g=N(d);l=V(g,"DIV",{class:!0});var p=N(l);for(let P=0;P<s.length;P+=1)s[P].l(p);p.forEach(A),u=W(g),y=V(g,"DIV",{class:!0});var _=N(y);for(let P=0;P<w.length;P+=1)w[P].l(_);_.forEach(A),g.forEach(A),c.forEach(A),this.h()},h(){M(l,"class","editor-container svelte-gwyvkn"),M(y,"class","drawing-container svelte-gwyvkn"),F(y,"disabled",e[1].activeTool!=="pencil"),M(d,"class","canvas-container svelte-gwyvkn"),M(t,"class","page-container svelte-gwyvkn")},m(b,c){ne(b,t,c),Le(n,t,null),S(t,a),S(t,d),S(d,l);for(let g=0;g<s.length;g+=1)s[g]&&s[g].m(l,null);S(d,u),S(d,y);for(let g=0;g<w.length;g+=1)w[g]&&w[g].m(y,null);T=!0},p(b,c){const g={};c&8&&(g.onDrawingUndo=b[8]),!i&&c&4&&(i=!0,g.drawingStroke=b[2],ye(()=>i=!1)),!r&&c&1&&(r=!0,g.drawingColor=b[0],ye(()=>r=!1)),n.$set(g),c&160&&(L=De(Object.keys(b[7])),we(),s=tt(s,c,D,1,b,L,v,l,nt,yt,null,_t),_e()),c&190&&(m=De(Object.keys(b[7])),we(),w=tt(w,c,X,1,b,m,k,y,nt,kt,null,wt),_e()),(!T||c&2)&&F(y,"disabled",b[1].activeTool!=="pencil")},i(b){if(!T){q(n.$$.fragment,b);for(let c=0;c<L.length;c+=1)q(s[c]);for(let c=0;c<m.length;c+=1)q(w[c]);T=!0}},o(b){G(n.$$.fragment,b);for(let c=0;c<s.length;c+=1)G(s[c]);for(let c=0;c<w.length;c+=1)G(w[c]);T=!1},d(b){b&&A(t),Ce(n);for(let c=0;c<s.length;c+=1)s[c].d();for(let c=0;c<w.length;c+=1)w[c].d()}}}function yt(e,t){let n,i,r;return i=new nn({props:{disabled:t[15]!==t[5],tabID:t[15]}}),{key:e,first:null,c(){n=Me(),Ee(i.$$.fragment),this.h()},l(a){n=Me(),Te(i.$$.fragment,a),this.h()},h(){this.first=n},m(a,d){ne(a,n,d),Le(i,a,d),r=!0},p(a,d){t=a;const l={};d&160&&(l.disabled=t[15]!==t[5]),d&128&&(l.tabID=t[15]),i.$set(l)},i(a){r||(q(i.$$.fragment,a),r=!0)},o(a){G(i.$$.fragment,a),r=!1},d(a){a&&A(n),Ce(i,a)}}}function kt(e,t){let n,i,r,a,d;function l(u){t[12](u)}function s(u){t[13](u)}let v={tabID:t[15],hide:t[15]!==t[5],disabled:t[15]!==t[5]||t[1].activeTool!=="pencil"};return t[4]!==void 0&&(v.color=t[4]),t[2]!==void 0&&(v.stroke=t[2]),i=new vn({props:v}),t[11](i),Q.push(()=>ke(i,"color",l)),Q.push(()=>ke(i,"stroke",s)),{key:e,first:null,c(){n=Me(),Ee(i.$$.fragment),this.h()},l(u){n=Me(),Te(i.$$.fragment,u),this.h()},h(){this.first=n},m(u,y){ne(u,n,y),Le(i,u,y),d=!0},p(u,y){t=u;const w={};y&128&&(w.tabID=t[15]),y&160&&(w.hide=t[15]!==t[5]),y&162&&(w.disabled=t[15]!==t[5]||t[1].activeTool!=="pencil"),!r&&y&16&&(r=!0,w.color=t[4],ye(()=>r=!1)),!a&&y&4&&(a=!0,w.stroke=t[2],ye(()=>a=!1)),i.$set(w)},i(u){d||(q(i.$$.fragment,u),d=!0)},o(u){G(i.$$.fragment,u),d=!1},d(u){u&&A(n),t[11](null),Ce(i,u)}}}function wn(e){let t,n,i,r;const a=[pn,bn],d=[];function l(s,v){return s[6].currentUser&&!s[6].isLoading?0:1}return t=l(e),n=d[t]=a[t](e),{c(){n.c(),i=Me()},l(s){n.l(s),i=Me()},m(s,v){d[t].m(s,v),ne(s,i,v),r=!0},p(s,[v]){let u=t;t=l(s),t===u?d[t].p(s,v):(we(),G(d[u],1,1,()=>{d[u]=null}),_e(),n=d[t],n?n.p(s,v):(n=d[t]=a[t](s),n.c()),q(n,1),n.m(i.parentNode,i))},i(s){r||(q(n),r=!0)},o(s){G(n),r=!1},d(s){s&&A(i),d[t].d(s)}}}function _n(e,t){var n=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16);return"rgba("+n+", "+i+", "+r+", "+t+")"}function yn(e,t,n){var L;let i,r,a,d,l,s;se(e,Tt,D=>n(14,a=D)),se(e,pe,D=>n(1,d=D)),se(e,Et,D=>n(6,l=D)),se(e,ce,D=>n(7,s=D));let v=((L=jt.find(D=>D.name===a.theme))==null?void 0:L.caret)||"#000000",u=10,y;const w=()=>y.undo();function k(D){u=D,n(2,u)}function T(D){v=D,n(0,v)}function C(D){Q[D?"unshift":"push"](()=>{y=D,n(3,y)})}function H(D){r=D,n(4,r),n(0,v)}function x(D){u=D,n(2,u)}return e.$$.update=()=>{e.$$.dirty&2&&n(5,i=d.order[d.activeIndex]),e.$$.dirty&1&&n(4,r=_n(v,.3))},[v,d,u,y,r,i,l,s,w,k,T,C,H,x]}class Mn extends He{constructor(t){super(),Ae(this,t,yn,wn,Pe,{})}}export{Mn as component};
