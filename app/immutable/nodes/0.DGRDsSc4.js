import{s as L,v as Q,w as X,x as Y,y as Z,c as _,o as ee,n as U,a as A}from"../chunks/scheduler.CgGcoA3v.js";import{S as j,i as M,H as oe,s as F,E as ie,h as R,j as D,a as k,t as E,g as f,e as w,c as T,v as le,w as h,A as v,p as te,F as ue,q as se,k as P,r as ae,u as ne,d as V}from"../chunks/index.BSd0CfbD.js";import{s as S,a as b,t as ce,c as me,b as W,m as B,d as I,e as G,g as J,h as de,i as K,f as fe}from"../chunks/firebaseStore.3gJMdFGm.js";import{b as C,g as pe}from"../chunks/entry.oeuzvreM.js";import{t as N}from"../chunks/themes.BTx5Q4mv.js";const he=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,ge=!0,ve="always",He=Object.freeze(Object.defineProperty({__proto__:null,prerender:ge,trailingSlash:ve},Symbol.toStringTag,{value:"Module"}));function be(i){let e,r,s;const a=i[3].default,o=Q(a,i,i[2],null);return{c(){e=new oe(!1),r=F(),o&&o.c(),this.h()},l(t){e=ie(t,!1),r=R(t),o&&o.l(t),this.h()},h(){e.a=r},m(t,n){e.m(i[0],t,n),D(t,r,n),o&&o.m(t,n),s=!0},p(t,[n]){(!s||n&1)&&e.p(t[0]),o&&o.p&&(!s||n&4)&&X(o,a,t,t[2],s?Z(a,t[2],n,null):Y(t[2]),null)},i(t){s||(k(o,t),s=!0)},o(t){E(o,t),s=!1},d(t){t&&(e.d(),f(r)),o&&o.d(t)}}}function _e(i,e,r){let s,a;_(i,S,u=>r(1,a=u));let{$$slots:o={},$$scope:t}=e;function n(u){const m=N.find(g=>g.name===u);return m?`<style>
    :root {
    --bg: ${m.bg};
    --bg-alt: ${m.bgAlt};
    --main: ${m.main};
    --caret: ${m.caret};
    --error: ${m.error};
    --sub: ${m.sub};
    --text: ${m.text};
    }
    </style>`:""}function l(){var m;const u=N.find(g=>g.name===a.theme);u&&((m=document.querySelector('meta[name="theme-color"]'))==null||m.setAttribute("content",u.bg))}return ee(()=>{n(a.theme),S.subscribe(l)}),i.$$set=u=>{"$$scope"in u&&r(2,t=u.$$scope)},i.$$.update=()=>{i.$$.dirty&2&&r(0,s=n(a.theme))},[s,a,t,o]}class ye extends j{constructor(e){super(),M(this,e,_e,be,L,{})}}function $e(i){let e,r=`<span class="status-icon svelte-1mx6eh7" style="-webkit-mask: url(${C}/images/svg/double-checkmark.svg) no-repeat center / contain; mask: url(${C}/images/svg/double-checkmark.svg) no-repeat center / contain;"></span>`;return{c(){e=w("div"),e.innerHTML=r,this.h()},l(s){e=T(s,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-jbp3id"&&(e.innerHTML=r),this.h()},h(){h(e,"class","status svelte-1mx6eh7"),v(e,"saving",i[0].savingStatus==="saving"),v(e,"saved",i[0].savingStatus==="saved"),v(e,"error",i[0].savingStatus==="error")},m(s,a){D(s,e,a)},p(s,[a]){a&1&&v(e,"saving",s[0].savingStatus==="saving"),a&1&&v(e,"saved",s[0].savingStatus==="saved"),a&1&&v(e,"error",s[0].savingStatus==="error")},i:U,o:U,d(s){s&&f(e)}}}function Se(i,e,r){let s;return _(i,b,a=>r(0,s=a)),[s]}class we extends j{constructor(e){super(),M(this,e,Se,$e,L,{})}}const{document:H}=he;function Te(i){let e,r,s,a,o;const t=i[0].default,n=Q(t,i,i[1],null);return a=new we({}),{c(){e=w("div"),n&&n.c(),r=F(),s=w("div"),te(a.$$.fragment),this.h()},l(l){e=T(l,"DIV",{class:!0});var u=V(e);n&&n.l(u),r=R(u),s=T(u,"DIV",{class:!0});var m=V(s);se(a.$$.fragment,m),m.forEach(f),u.forEach(f),this.h()},h(){h(s,"class","sync-status svelte-j4k8tx"),h(e,"class","layout-container svelte-j4k8tx")},m(l,u){D(l,e,u),n&&n.m(e,null),P(e,r),P(e,s),ae(a,s,null),o=!0},p(l,u){n&&n.p&&(!o||u&2)&&X(n,t,l,l[1],o?Z(t,l[1],u,null):Y(l[1]),null)},i(l){o||(k(n,l),k(a.$$.fragment,l),o=!0)},o(l){E(n,l),E(a.$$.fragment,l),o=!1},d(l){l&&f(e),n&&n.d(l),ne(a)}}}function ke(i){let e,r,s,a,o;return a=new ye({props:{$$slots:{default:[Te]},$$scope:{ctx:i}}}),{c(){e=w("meta"),r=w("meta"),s=F(),te(a.$$.fragment),this.h()},l(t){const n=ue("svelte-17tnzz8",H.head);e=T(n,"META",{name:!0,content:!0}),r=T(n,"META",{name:!0,content:!0}),n.forEach(f),s=R(t),se(a.$$.fragment,t),this.h()},h(){h(e,"name","viewport"),h(e,"content","width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover"),h(r,"name","theme-color"),h(r,"content","var(--bg)")},m(t,n){P(H.head,e),P(H.head,r),D(t,s,n),ae(a,t,n),o=!0},p(t,[n]){const l={};n&2&&(l.$$scope={dirty:n,ctx:t}),a.$set(l)},i(t){o||(k(a.$$.fragment,t),o=!0)},o(t){E(a.$$.fragment,t),o=!1},d(t){t&&f(s),f(e),f(r),ne(a,t)}}}function Ee(){switch(screen.orientation.type){case"portrait-primary":document.documentElement.style.setProperty("--safe-area-top","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-primary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-secondary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","env(safe-area-inset-right)");break}}function Pe(i,e,r){let s,a,o,t;_(i,W,c=>r(3,s=c)),_(i,b,c=>r(4,a=c)),_(i,S,c=>r(5,o=c)),_(i,B,c=>r(6,t=c));let{$$slots:n={},$$scope:l}=e,u=!0;async function m(){const c=a.currentUser;if(!c)return;u=!0;const p=I(G,"users",c.uid),q=await J(p);let d={activeIndex:0,order:[],settings:{theme:"Canvas",spellCheck:!0}},x={};if(q.exists()){console.log("Fetching firestore user doc...");const y=q.data();d={...d,...y};for(let $=0;$<d.order.length;$++){const z=d.order[$],O=await J(I(p,"tabs",z));if(!O.exists()){d.order.splice($,1),$--;continue}x[z]=O.data()}}else{console.log("Creating firestore user doc...");const y=I(G,"users",c.uid);await de(y,d,{merge:!0})}K.loadPackedTabs(x),A(B,t.order=d.order,t),K.setActiveIndex(d.activeIndex),A(S,o=d.settings,o),b.update(y=>({...y,isAuthenticating:!1,userData:d,packedTabs:x})),u=!1}function g(){u||fe.publish()}ce.subscribe(g),S.subscribe(g);function re(c){a.savingStatus==="saving"&&c.preventDefault()}return ee(()=>{window.addEventListener("beforeunload",re),screen.orientation.addEventListener("change",Ee),me.onAuthStateChanged(async c=>{if(!c){b.update(p=>({...p,currentUser:c})),A(W,s=window.location.pathname.slice(C.length),s),pe(C+"/login");return}b.update(p=>({...p,isLoading:!0,currentUser:c})),await m(),b.update(p=>({...p,isLoading:!1}))})}),i.$$set=c=>{"$$scope"in c&&r(1,l=c.$$scope)},[n,l]}class Le extends j{constructor(e){super(),M(this,e,Pe,ke,L,{})}}export{Le as component,He as universal};
