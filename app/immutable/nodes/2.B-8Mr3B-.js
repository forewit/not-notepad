const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/quill.Bk4jDS0q.js","../chunks/core.CG__ofcG.js"])))=>i.map(i=>d[i]);
var Lt=Object.defineProperty;var Dt=(e,t,n)=>t in e?Lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var F=(e,t,n)=>Dt(e,typeof t!="symbol"?t+"":t,n);import{s as we,n as ve,r as Ue,i as Se,c as ue,o as Re,a as G,d as $,A as Ct,B as je,C as ht,e as Ne}from"../chunks/scheduler.CE28Mlnp.js";import{S as Ee,i as xe,e as z,t as It,c as R,a as B,b as Mt,d as S,w as I,A as U,g as re,h as P,x as te,F as Ze,j as Pt,s as Q,p as pe,f as Z,v as he,q as be,r as ye,o as Le,m as De,n as N,l as q,u as _e,G as ze,z as et,I as Ce,C as Ve,J as Yt,K as Xt}from"../chunks/index.CblOyuwr.js";import{e as tt,u as Ht,o as At,t as St}from"../chunks/themes.CBFgFqeR.js";import{m as W,t as me,d as de,s as mt,a as vt,f as jt}from"../chunks/firebaseStore.BficT-lK.js";import{b as O}from"../chunks/paths.BtEH3qtv.js";import{_ as nt}from"../chunks/preload-helper.D6kgxu3v.js";import{P as zt}from"../chunks/ProgressBar.Cdh5Uk4U.js";function Rt(e){let t,n,s,o,r,a;return{c(){t=z("div"),n=z("button"),s=z("span"),o=It(e[0]),this.h()},l(u){t=R(u,"DIV",{class:!0});var i=B(t);n=R(i,"BUTTON",{class:!0,draggable:!0});var l=B(n);s=R(l,"SPAN",{class:!0});var h=B(s);o=Mt(h,e[0]),h.forEach(S),l.forEach(S),i.forEach(S),this.h()},h(){I(s,"class","title svelte-1jmw20r"),I(n,"class","tab svelte-1jmw20r"),I(n,"draggable","true"),U(n,"active",e[1]),I(t,"class","tab-container svelte-1jmw20r"),U(t,"preventHover",e[2])},m(u,i){re(u,t,i),P(t,n),P(n,s),P(s,o),r||(a=[te(n,"mousedown",Ze(function(){Se(e[3])&&e[3].apply(this,arguments)})),te(n,"touchstart",Ze(function(){Se(e[3])&&e[3].apply(this,arguments)})),te(n,"dragstart",Ze(function(){Se(e[4])&&e[4].apply(this,arguments)}))],r=!0)},p(u,[i]){e=u,i&1&&Pt(o,e[0]),i&2&&U(n,"active",e[1]),i&4&&U(t,"preventHover",e[2])},i:ve,o:ve,d(u){u&&S(t),r=!1,Ue(a)}}}function Vt(e,t,n){let{title:s=""}=t,{active:o=!1}=t,{preventHover:r=!1}=t,{onPointerdown:a=i=>{}}=t,{onDragstart:u=i=>{}}=t;return e.$$set=i=>{"title"in i&&n(0,s=i.title),"active"in i&&n(1,o=i.active),"preventHover"in i&&n(2,r=i.preventHover),"onPointerdown"in i&&n(3,a=i.onPointerdown),"onDragstart"in i&&n(4,u=i.onDragstart)},[s,o,r,a,u]}class pt extends Ee{constructor(t){super(),xe(this,t,Vt,Rt,we,{title:0,active:1,preventHover:2,onPointerdown:3,onDragstart:4})}}function ke(e){return e<.5?4*e*e*e:.5*Math.pow(2*e-2,3)+1}function bt(e){const t=e-1;return t*t*t+1}const st=(e,t)=>{const{duration:n=300,easing:s=ke,onEnd:o=()=>{},onStep:r=()=>{},css:a}=t;let u;function i(l){if(!e){console.warn("Cannot find element to animate");return}u===void 0&&(u=l);const h=s((l-u)/n),m=1-h;h<1?(e.style.cssText=a(h,m),r(h,m),requestAnimationFrame(i)):(e.style.cssText="",o())}requestAnimationFrame(i)},Je=e=>{const{duration:t=300,easing:n=ke,onEnd:s=()=>{},onStep:o=()=>{}}=e;let r;function a(u){r===void 0&&(r=u);const i=n((u-r)/t),l=1-i;i<1?(o(i,l),requestAnimationFrame(a)):s()}requestAnimationFrame(a)};function it(e,t,n){const s=e.slice();return s[41]=t[n],s[42]=t,s[43]=n,s}function rt(e,t){let n,s,o,r,a=t[43],u,i,l;function h(..._){return t[17](t[43],..._)}function m(_){t[18](_,t[41])}let d={active:t[9]==t[41],preventHover:t[8],onPointerdown:h,onDragstart:t[14]};t[11][t[41]].title!==void 0&&(d.title=t[11][t[41]].title),s=new pt({props:d}),$.push(()=>ze(s,"title",m));const x=()=>t[19](n,a),b=()=>t[19](null,a);return{key:e,first:null,c(){n=z("div"),pe(s.$$.fragment),r=Q(),this.h()},l(_){n=R(_,"DIV",{class:!0});var f=B(n);be(s.$$.fragment,f),r=Z(f),f.forEach(S),this.h()},h(){I(n,"class","tab-container svelte-1udz9mj"),U(n,"placeholder",t[10]==t[41]),this.first=n},m(_,f){re(_,n,f),ye(s,n,null),P(n,r),x(),u=!0,i||(l=Ct(t[13].call(null,n)),i=!0)},p(_,f){t=_;const w={};f[0]&516&&(w.active=t[9]==t[41]),f[0]&256&&(w.preventHover=t[8]),f[0]&4&&(w.onPointerdown=h),!o&&f[0]&2052&&(o=!0,w.title=t[11][t[41]].title,je(()=>o=!1)),s.$set(w),a!==t[43]&&(b(),a=t[43],x()),(!u||f[0]&1028)&&U(n,"placeholder",t[10]==t[41])},i(_){u||(N(s.$$.fragment,_),u=!0)},o(_){q(s.$$.fragment,_),u=!1},d(_){_&&S(n),_e(s),b(),i=!1,l()}}}function Bt(e){let t,n,s,o=[],r=new Map,a,u,i,l=`<span class="button-icon svelte-1udz9mj" style="-webkit-mask: url(${O}/images/svg/plus.svg) no-repeat center / contain; mask: url(${O}/images/svg/plus.svg) no-repeat center / contain;"></span>`,h,m,d,x=`<span class="button-icon svelte-1udz9mj" style="-webkit-mask: url(${O}/images/svg/gear.svg) no-repeat center / contain; mask: url(${O}/images/svg/gear.svg) no-repeat center / contain;"></span>`,b,_,f,w,M,C,H,j,L=tt(e[2].order);const A=k=>k[41];for(let k=0;k<L.length;k+=1){let y=it(e,L,k),T=A(y);r.set(T,o[k]=rt(T,y))}return f=new pt({props:{title:e[5],active:!e[1],preventHover:!0}}),{c(){t=z("div"),n=z("div"),s=z("div");for(let k=0;k<o.length;k+=1)o[k].c();a=Q(),u=z("div"),i=z("button"),i.innerHTML=l,h=Q(),m=z("div"),d=z("button"),d.innerHTML=x,b=Q(),_=z("div"),pe(f.$$.fragment),w=Q(),M=z("div"),this.h()},l(k){t=R(k,"DIV",{class:!0});var y=B(t);n=R(y,"DIV",{class:!0});var T=B(n);s=R(T,"DIV",{class:!0});var p=B(s);for(let K=0;K<o.length;K+=1)o[K].l(p);p.forEach(S),a=Z(T),u=R(T,"DIV",{class:!0});var ee=B(u);i=R(ee,"BUTTON",{class:!0,"data-svelte-h":!0}),he(i)!=="svelte-g0ls06"&&(i.innerHTML=l),ee.forEach(S),h=Z(T),m=R(T,"DIV",{class:!0});var ne=B(m);d=R(ne,"BUTTON",{class:!0,"data-svelte-h":!0}),he(d)!=="svelte-v7vri0"&&(d.innerHTML=x),ne.forEach(S),b=Z(T),_=R(T,"DIV",{class:!0});var oe=B(_);be(f.$$.fragment,oe),oe.forEach(S),T.forEach(S),w=Z(y),M=R(y,"DIV",{class:!0}),B(M).forEach(S),y.forEach(S),this.h()},h(){I(s,"class","tabs svelte-1udz9mj"),I(i,"class","button svelte-1udz9mj"),I(u,"class","new-tab-container svelte-1udz9mj"),I(d,"class","button svelte-1udz9mj"),I(m,"class","buttons-container svelte-1udz9mj"),I(_,"class","clone svelte-1udz9mj"),U(_,"draggingOutside",e[1]),U(_,"dragging",e[0]),I(n,"class","tabbar svelte-1udz9mj"),I(M,"class","divider svelte-1udz9mj"),I(t,"class","svelte-1udz9mj")},m(k,y){re(k,t,y),P(t,n),P(n,s);for(let T=0;T<o.length;T+=1)o[T]&&o[T].m(s,null);e[20](s),P(n,a),P(n,u),P(u,i),P(n,h),P(n,m),P(m,d),P(n,b),P(n,_),ye(f,_,null),e[22](_),P(t,w),P(t,M),e[23](t),C=!0,H||(j=[te(i,"click",e[12]),te(d,"click",e[21])],H=!0)},p(k,y){y[0]&53012&&(L=tt(k[2].order),Le(),o=Ht(o,y,A,1,k,L,r,s,At,rt,null,it),De());const T={};y[0]&32&&(T.title=k[5]),y[0]&2&&(T.active=!k[1]),f.$set(T),(!C||y[0]&2)&&U(_,"draggingOutside",k[1]),(!C||y[0]&1)&&U(_,"dragging",k[0])},i(k){if(!C){for(let y=0;y<L.length;y+=1)N(o[y]);N(f.$$.fragment,k),C=!0}},o(k){for(let y=0;y<o.length;y+=1)q(o[y]);q(f.$$.fragment,k),C=!1},d(k){k&&S(t);for(let y=0;y<o.length;y+=1)o[y].d();e[20](null),_e(f),e[22](null),e[23](null),H=!1,Ue(j)}}}const Ot=12,Be=200,Xe=32,He=200,Ut=1600,ot=.3;function Nt(e,t,n){let s,o,r,a;ue(e,W,g=>n(2,r=g)),ue(e,me,g=>n(11,a=g));const u=()=>{y(r.order[r.activeIndex])};let i,l=[],h=0,m=null,d=-1,x="",b,_,f,w=!1,M=!1,C=0,H=0,j,L=!1;const A=(g,D=300)=>{let X;return(...V)=>{clearTimeout(X),X=setTimeout(()=>{g.apply(void 0,V)},D)}};function k(){de.newTab()}const y=g=>{const D=r.order.findIndex(X=>X===g);if(D<0||!l[D]){console.warn("Cannot close tab!");return}h=l[D].getBoundingClientRect().width,D<r.order.length-1&&(i.style.setProperty("--tab-max-width",`${h}px`),T()),D==r.activeIndex&&(D==r.order.length-1?de.setActiveIndex(D-1):de.setActiveIndex(D+1)),Je({duration:He,easing:ke,onStep:(X,V)=>{D==0?n(3,i.style.gridTemplateColumns=`minmax(${V*Xe}px, ${V*h}px)`,i):n(3,i.style.gridTemplateColumns=`repeat(${D}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${V*Xe}px, ${V*h}px)`,i)},onEnd:()=>{n(3,i.style.gridTemplateColumns="",i),de.removeTab(g)}})},T=A(()=>{i&&(i.style.setProperty("--tab-max-width",`${Be}px`),Je({duration:He,easing:ke,onStep:(g,D)=>{i.style.setProperty("--tab-max-width",`${h+g*(Be-h)}px`)},onEnd:()=>{i.style.setProperty("--tab-max-width",`${Be}px`)}}))},Ut);function p(g){if(!i)return;const D=g.getBoundingClientRect().width;Je({duration:He,easing:ke,onStep:(X,V)=>{r.order.length==1?n(3,i.style.gridTemplateColumns=`minmax(${X*Xe}px, ${X*D}px)`,i):n(3,i.style.gridTemplateColumns=`repeat(${r.order.length-1}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${X*Xe}px, ${X*D}px)`,i),n(3,i.scrollLeft=i.scrollWidth,i)},onEnd:()=>{n(3,i.style.gridTemplateColumns="",i)}})}const ee=(g,D)=>{const X=l[0].getBoundingClientRect().width;de.moveTab(g,D,()=>{if(g>D)for(let V=D;V<g;V++)st(l[V],{duration:He,easing:ke,css:(le,ie)=>`transform: translateX(-${ie*X}px);`});if(g<D)for(let V=D;V>g;V--)st(l[V],{duration:He,easing:ke,css:(le,ie)=>`transform: translateX(${ie*X}px);`})})};function ne(g){!g.target||!g.dataTransfer||(g.dataTransfer.setData("text/plain",s),g.dataTransfer.setDragImage(new Image,0,0))}function oe(g,D){if(g==0&&D==0){n(6,f.style.left="-1000px",f),n(6,f.style.top="-1000px",f);return}let X=j.getBoundingClientRect();if(g<X.left||g>X.right||D<X.top||D>X.bottom){M||(H=0),n(6,f.style.left=`${g+C}px`,f),n(6,f.style.top=`${D-_.height/2}px`,f),n(1,M=!0);return}M&&n(1,M=!1),n(6,f.style.left=`${g+C}px`,f),n(6,f.style.top=`${_.top}px`,f);const V=-i.scrollLeft,le=l[0].getBoundingClientRect().width;let ie=-1;if(g>V+r.order.length*le)ie=r.order.length-1;else for(let ae=0;ae<r.order.length;ae++)if(g>V+ae*le&&g<V+(ae+1)*le){ie=ae;break}g<20?(H=-ot,requestAnimationFrame(se)):g>i.clientWidth-10?(H=ot,requestAnimationFrame(se)):H=0,!(ie==-1||ie==r.placeholderIndex)&&ee(r.placeholderIndex,ie)}let K=0;function se(g){if(!w||H==0){K=0;return}K==0&&(K=g);const D=g-K;K=g,i.scrollBy({left:H*D}),requestAnimationFrame(se)}function Te(g,D){if(!g.target)return;let X,V;g instanceof TouchEvent?(X=g.touches[0].clientX,V=g.touches[0].clientY,g.preventDefault()):(X=g.clientX,V=g.clientY),window.addEventListener("touchmove",fe,{passive:!1}),window.addEventListener("touchend",ce),window.addEventListener("mousemove",fe),window.addEventListener("mouseup",ce),window.addEventListener("drag",fe),window.addEventListener("dragend",ce),window.addEventListener("blur",ce),de.setActiveIndex(D),b=g.target,_=b.getBoundingClientRect(),m=[X,V],C=_.left-X,_.top-V,n(6,f.style.width=`${_.width}px`,f),n(6,f.style.left=`${_.left}px`,f),n(6,f.style.top=`${_.top}px`,f),d=D,n(5,x=a[r.order[D]].title)}function fe(g){let D,X;if(g instanceof TouchEvent?(D=g.touches[0].clientX,X=g.touches[0].clientY):(D=g.clientX,X=g.clientY),w){oe(D,X);return}m===null||Math.hypot(m[0]-D,m[1]-X)<Ot||(n(0,w=!0),de.setPlaceholderIndex(d),de.setActiveIndex(d))}function ce(){window.removeEventListener("touchmove",fe),window.removeEventListener("touchend",ce),window.removeEventListener("mousemove",fe),window.removeEventListener("mouseup",ce),window.removeEventListener("drag",fe),window.removeEventListener("dragend",ce),window.removeEventListener("blur",ce),m=null,n(1,M=!1),d=-1,C=0,de.setPlaceholderIndex(),n(0,w=!1)}Re(()=>{i.style.setProperty("--tab-max-width",`${Be}px`),i.style.setProperty("--tab-min-width",`${Xe}px`)});const Ke=(g,D)=>Te(D,g);function Pe(g,D){e.$$.not_equal(a[D].title,g)&&(a[D].title=g,me.set(a))}function Ye(g,D){$[g?"unshift":"push"](()=>{l[D]=g,n(4,l)})}function qe(g){$[g?"unshift":"push"](()=>{i=g,n(3,i)})}const Qe=()=>{G(W,r.toolbarVisible=!r.toolbarVisible,r),r.toolbarVisible||G(W,r.tool=void 0,r)};function E(g){$[g?"unshift":"push"](()=>{f=g,n(6,f)})}function J(g){$[g?"unshift":"push"](()=>{j=g,n(7,j)})}return e.$$.update=()=>{e.$$.dirty[0]&2&&(M?G(W,r.trashcanVisible=!0,r):G(W,r.trashcanVisible=!1,r)),e.$$.dirty[0]&4&&n(9,s=r.order[r.activeIndex]),e.$$.dirty[0]&4&&n(10,o=r.order[r.placeholderIndex]),e.$$.dirty[0]&1&&(w?n(8,L=!0):setTimeout(()=>{n(8,L=!1)},20))},[w,M,r,i,l,x,f,j,L,s,o,a,k,p,ne,Te,u,Ke,Pe,Ye,qe,Qe,E,J]}class Ft extends Ee{constructor(t){super(),xe(this,t,Nt,Bt,we,{closeActiveTab:16},null,[-1,-1])}get closeActiveTab(){return this.$$.ctx[16]}}function Wt(e){let t,n;return{c(){t=z("div"),n=z("div"),this.h()},l(s){t=R(s,"DIV",{class:!0});var o=B(t);n=R(o,"DIV",{class:!0}),B(n).forEach(S),o.forEach(S),this.h()},h(){I(n,"class","quill-editor"),I(t,"class","quill-editor-container svelte-16m16ue"),U(t,"disabled",e[0])},m(s,o){re(s,t,o),P(t,n),e[7](n)},p(s,[o]){o&1&&U(t,"disabled",s[0])},i:ve,o:ve,d(s){s&&S(t),e[7](null)}}}function Gt(e,t,n){let s,o;ue(e,me,L=>n(8,s=L)),ue(e,mt,L=>n(6,o=L));let{tabID:r}=t,{disabled:a=!1}=t;const u=()=>{l&&l.setSelection(l.getLength(),0)},i=()=>{l&&l.blur()};let l,h;const m=(L,A=300)=>{let k;return(...y)=>{clearTimeout(k),k=setTimeout(()=>{L.apply(void 0,y)},A)}};async function d(L){var T,p,ee,ne;if(!l)return;const{Delta:A,Range:k}=await nt(async()=>{const{Delta:oe,Range:K}=await import("../chunks/core.CG__ofcG.js").then(se=>se.G);return{Delta:oe,Range:K}},[],import.meta.url);if(L.undo.length>0)for(var y=0;y<L.undo.length;y++){const oe=(T=L.undo[y].range)==null?void 0:T.index,K=(p=L.undo[y].range)==null?void 0:p.length,se={delta:new A(L.undo[y].delta.ops),range:oe!==void 0&&K!==void 0?new k(oe,K):null};l.history.stack.undo.push(se)}if(L.redo.length>0)for(var y=0;y<L.redo.length;y++){const K=(ee=L.redo[y].range)==null?void 0:ee.index,se=(ne=L.redo[y].range)==null?void 0:ne.length,Te={delta:new A(L.redo[y].delta.ops),range:K!==void 0&&se!==void 0?new k(K,se):null};l.history.stack.redo.push(Te)}}function x(L){var A;l&&((A=l.getSelection())==null?void 0:A.length)===0&&window.open(L.target.href,"_blank")}function b(){if(!l||!s[r])return;const L=s[r].ops;l.setContents(L);const A=s[r].history;d(A)}function _(){if(!l||!s[r])return;G(me,s[r].ops=l.getContents().ops,s);const L=structuredClone(l.history.stack);G(me,s[r].history=L,s)}const f=m(_,500);function w(){if(!l)return;l.formatText(0,l.getLength(),"link",!1,"api");const L=l.getText(),A=/https?:\/\/\S+/gi,k=L.matchAll(A);for(const p of k)l.formatText(p.index,p[0].length,"link",p[0],"api");const y=/.+\@.+\..+/gi,T=L.matchAll(y);for(const p of T)l.formatText(p.index,p[0].length,"link","mailto:"+p[0],"api");document.querySelectorAll(".ql-editor a").forEach(p=>{p.addEventListener("click",x)})}const M=m(w,500);function C(L,A,k){if(k==="user"){const y=l.getText().split(`
`)[0].trim();G(me,s[r].title=y===""?"Untitled":y,s),M(),f()}}async function H(){const{default:L}=await nt(async()=>{const{default:A}=await import("../chunks/quill.Bk4jDS0q.js");return{default:A}},__vite__mapDeps([0,1]),import.meta.url);n(5,l=new L(h,{formats:["bold","italic","underline","strike","code","link"],placeholder:"Enter text here"})),b(),w(),l.on("text-change",C),l.keyboard.addBinding({key:"/",altKey:!0},()=>{l.format("code",!l.getFormat().code)}),l.keyboard.addBinding({key:"-",altKey:!0},()=>{l.format("strike",!l.getFormat().strike)})}Re(()=>{H()});function j(L){$[L?"unshift":"push"](()=>{h=L,n(1,h)})}return e.$$set=L=>{"tabID"in L&&n(2,r=L.tabID),"disabled"in L&&n(0,a=L.disabled)},e.$$.update=()=>{e.$$.dirty&33&&(a?l==null||l.disable():l==null||l.enable()),e.$$.dirty&96&&(l==null||l.root.setAttribute("spellcheck",o.spellCheck.toString()))},[a,h,r,u,i,l,o,j]}class Kt extends Ee{constructor(t){super(),xe(this,t,Gt,Wt,we,{tabID:2,disabled:0,focus:3,blur:4})}get focus(){return this.$$.ctx[3]}get blur(){return this.$$.ctx[4]}}const lt=500,qt=300,at=500,Qt=300;class Zt{constructor(){F(this,"isMoving",!1);F(this,"isLongclick",!1);F(this,"button",0);F(this,"lastX",0);F(this,"lastY",0);F(this,"consecutiveClicks",0);F(this,"lastMouseupTime",0);F(this,"activeElement",null);this.reset()}reset(){this.isMoving=!1,this.isLongclick=!1,this.button=0,this.lastX=0,this.lastY=0,this.consecutiveClicks=0,this.lastMouseupTime=0,this.activeElement=null}}class Jt{constructor(){F(this,"isDragging",!1);F(this,"isPinching",!1);F(this,"isLongpressed",!1);F(this,"consecutiveTaps",0);F(this,"lastTouchendTime",0);F(this,"lastCenterX",0);F(this,"lastCenterY",0);F(this,"identifier",0);F(this,"x",0);F(this,"y",0);F(this,"hypotenuse",0);F(this,"activeElement",null);this.reset()}reset(){this.isDragging=!1,this.isPinching=!1,this.isLongpressed=!1,this.consecutiveTaps=0,this.lastTouchendTime=0,this.lastCenterX=0,this.lastCenterY=0,this.identifier=0,this.x=0,this.y=0,this.hypotenuse=0,this.activeElement=null}}let ge=[],v=new Zt,c=new Jt;const Y=(e,t)=>{e!=null&&e.dispatchEvent(new CustomEvent("gesture",{detail:t,bubbles:!1,cancelable:!1}))},yt=e=>{v.reset(),c.reset(),v.lastMouseupTime=Date.now(),window.removeEventListener("mousemove",Fe),window.removeEventListener("mouseup",We),window.removeEventListener("touchmove",Ge),window.removeEventListener("touchend",Ie)},_t=e=>{if(window.removeEventListener("mousemove",Fe),window.removeEventListener("mouseup",We),window.removeEventListener("touchmove",Ge),window.removeEventListener("touchend",Ie),v.isMoving)if(v.isMoving=!1,v.isLongclick)v.isLongclick=!1,Y(v.activeElement,{event:e,name:"longclick-drag-end",x:v.lastX,y:v.lastY,dx:0,dy:0});else switch(v.button){case 0:Y(v.activeElement,{event:e,name:"left-click-drag-end",x:v.lastX,y:v.lastY,dx:0,dy:0});break;case 1:Y(v.activeElement,{event:e,name:"middle-click-drag-end",x:v.lastX,y:v.lastY,dx:0,dy:0});break;case 2:Y(v.activeElement,{event:e,name:"right-click-drag-end",x:v.lastX,y:v.lastY,dx:0,dy:0});break}v.isLongclick&&Y(v.activeElement,{event:e,name:"longclick-release",x:v.lastX,y:v.lastY,dx:0,dy:0}),v.reset(),c.isDragging&&(c.isDragging=!1,c.isLongpressed?(c.isLongpressed=!1,Y(c.activeElement,{event:e,name:"longpress-drag-end",x:c.lastCenterX,y:c.lastCenterY,dx:0,dy:0})):Y(c.activeElement,{event:e,name:"touch-drag-end",x:c.lastCenterX,y:c.lastCenterY,dx:0,dy:0})),c.isLongpressed&&Y(c.activeElement,{event:e,name:"longpress-release",x:c.lastCenterX,y:c.lastCenterY,dx:0,dy:0}),c.reset()},wt=e=>{Y(e.target,{event:e,name:"wheel",x:e.clientX,y:e.clientY,dx:0,dy:0})},kt=e=>{},Et=e=>{document.activeElement!==e.target&&(window.addEventListener("mousemove",Fe),window.addEventListener("mouseup",We),v.activeElement=e.target,v.lastX=e.clientX,v.lastY=e.clientY,v.isMoving||(v.button=e.button),v.button===0&&window.setTimeout(()=>{Date.now()-v.lastMouseupTime>=at&&!v.isMoving&&(v.isLongclick=!0,Y(v.activeElement,{event:e,name:"longclick",x:e.clientX,y:e.clientY,dx:0,dy:0}))},at))},Fe=e=>{if(e.movementX===0&&e.movementY===0)return;let t=e.clientX-v.lastX,n=e.clientY-v.lastY;if(!v.isMoving)if(v.isLongclick)Y(v.activeElement,{event:e,name:"longclick-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});else switch(v.button){case 0:Y(v.activeElement,{event:e,name:"left-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 1:Y(v.activeElement,{event:e,name:"middle-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 2:Y(v.activeElement,{event:e,name:"right-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break}if(v.isMoving=!0,v.lastX=e.clientX,v.lastY=e.clientY,v.isLongclick)Y(v.activeElement,{event:e,name:"longclick-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});else switch(v.button){case 0:Y(v.activeElement,{event:e,name:"left-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break;case 1:Y(v.activeElement,{event:e,name:"middle-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break;case 2:Y(v.activeElement,{event:e,name:"right-click-dragging",x:e.clientX,y:e.clientY,dx:t,dy:n});break}},We=e=>{if(window.removeEventListener("mousemove",Fe),window.removeEventListener("mouseup",We),v.lastMouseupTime=Date.now(),v.isMoving)if(v.isMoving=!1,v.isLongclick)v.isLongclick=!1,Y(v.activeElement,{event:e,name:"longclick-drag-end",x:v.lastX,y:v.lastY,dx:0,dy:0});else switch(v.button){case 0:Y(v.activeElement,{event:e,name:"left-click-drag-end",x:v.lastX,y:v.lastY,dx:0,dy:0});break;case 1:Y(v.activeElement,{event:e,name:"middle-click-drag-end",x:v.lastX,y:v.lastY,dx:0,dy:0});break;case 2:Y(v.activeElement,{event:e,name:"right-click-drag-end",x:v.lastX,y:v.lastY,dx:0,dy:0});break}else v.isLongclick||(e.button===2?Y(v.activeElement,{event:e,name:"right-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):e.button===1?Y(v.activeElement,{event:e,name:"middle-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):(v.consecutiveClicks===0&&Y(v.activeElement,{event:e,name:"left-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),v.consecutiveClicks++,window.setTimeout(()=>{v.consecutiveClicks>1&&Y(v.activeElement,{event:e,name:"double-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),v.consecutiveClicks=0},Qt)));v.isLongclick&&Y(v.activeElement,{event:e,name:"longclick-release",x:e.clientX,y:e.clientY,dx:0,dy:0}),v.isLongclick=!1},xt=e=>{if(document.activeElement!==e.target){if(e.preventDefault(),e.stopPropagation(),e.touches.length>1){if(e.touches[0].identifier===c.identifier)return;c.isPinching=!0}window.addEventListener("touchmove",Ge,{passive:!1}),window.addEventListener("touchend",Ie),window.addEventListener("touchcancel",Ie),c.identifier=e.touches[0].identifier,c.x=e.touches[0].clientX,c.y=e.touches[0].clientY,c.activeElement=e.target,window.setTimeout(()=>{c.isPinching||c.isDragging||Date.now()-c.lastTouchendTime>=lt&&(c.isDragging=!1,c.isPinching=!1,c.hypotenuse=null,c.isLongpressed=!0,Y(c.activeElement,{event:e,name:"longpress",x:c.x,y:c.y,dx:0,dy:0}))},lt)}},Ge=e=>{if(c.isDragging){let t=c.x,n=c.y;c.x=e.touches[0].clientX,c.y=e.touches[0].clientY;let s=c.x-t,o=c.y-n;c.isLongpressed?Y(c.activeElement,{event:e,name:"longpress-dragging",x:c.x,y:c.y,dx:s,dy:o,force:e.touches[0].force}):Y(c.activeElement,{event:e,name:"touch-dragging",x:c.x,y:c.y,dx:s,dy:o,force:e.touches[0].force});return}else if(!c.isLongpressed&&(c.isPinching||e.touches.length>1)){c.x=e.touches[0].clientX,c.y=e.touches[0].clientY;let t={x:e.touches[1].clientX,y:e.touches[1].clientY},n={x:(c.x+t.x)/2,y:(c.y+t.y)/2},s=Math.hypot(c.x-t.x,c.y-t.y);c.hypotenuse===null&&(c.hypotenuse=s,c.lastCenterX=n.x,c.lastCenterY=n.y,Y(c.activeElement,{event:e,name:"pinch-start",x:n.x,y:n.y,dx:0,dy:0})),c.isPinching=!0;let o=s/c.hypotenuse,r=n.x-c.lastCenterX,a=n.y-c.lastCenterY;Y(c.activeElement,{event:e,name:"pinching",x:n.x,y:n.y,zoom:o,dx:r,dy:a}),c.hypotenuse=s,c.lastCenterX=n.x,c.lastCenterY=n.y;return}else c.isDragging=!0,c.isLongpressed?(Y(c.activeElement,{event:e,name:"longpress-drag-start",x:c.x,y:c.y,dx:0,dy:0,force:e.touches[0].force}),c.x=e.touches[0].clientX,c.y=e.touches[0].clientY,Y(c.activeElement,{event:e,name:"longpress-dragging",x:c.x,y:c.y,dx:0,dy:0,force:e.touches[0].force})):(Y(c.activeElement,{event:e,name:"touch-drag-start",x:c.x,y:c.y,dx:0,dy:0,force:e.touches[0].force}),c.x=e.touches[0].clientX,c.y=e.touches[0].clientY,Y(c.activeElement,{event:e,name:"touch-dragging",x:c.x,y:c.y,dx:0,dy:0,force:e.touches[0].force}))},Ie=e=>{c.isDragging&&e.touches.length>0&&e.touches[0].identifier===c.identifier||(c.lastTouchendTime=Date.now(),window.removeEventListener("touchmove",Ge),window.removeEventListener("touchend",Ie),window.removeEventListener("touchcancel",Ie),c.isDragging?(c.isDragging=!1,c.isLongpressed?(c.isLongpressed=!1,Y(c.activeElement,{event:e,name:"longpress-drag-end",x:c.x,y:c.y,dx:0,dy:0})):Y(c.activeElement,{event:e,name:"touch-drag-end",x:c.x,y:c.y,dx:0,dy:0})):c.isPinching?(c.isPinching=!1,c.hypotenuse=null,Y(c.activeElement,{event:e,name:"pinch-end",x:c.lastCenterX,y:c.lastCenterY,dx:0,dy:0})):c.isLongpressed||(c.consecutiveTaps===0&&Y(c.activeElement,{event:e,name:"tap",x:c.x,y:c.y,dx:0,dy:0}),c.consecutiveTaps++,window.setTimeout(()=>{c.consecutiveTaps>1&&Y(c.activeElement,{event:e,name:"double-tap",x:c.x,y:c.y,dx:0,dy:0}),c.consecutiveTaps=0},qt)),c.isLongpressed&&Y(c.activeElement,{event:e,name:"longpress-release",x:c.x,y:c.y,dx:0,dy:0}),c.isLongpressed=!1)};function $t(...e){for(let t of e)ge.findIndex(n=>n===t)===-1&&(ge.length==0&&(window.addEventListener("blur",_t),window.addEventListener("focus",yt)),ge.push(t),t.addEventListener("touchstart",xt,{passive:!1}),t.addEventListener("mousedown",Et,{passive:!1}),t.addEventListener("contextmenu",kt,{passive:!1}),t.addEventListener("wheel",wt,{passive:!1}))}function en(...e){const t=n=>{n.removeEventListener("touchstart",xt),n.removeEventListener("mousedown",Et),n.removeEventListener("contextmenu",kt),n.removeEventListener("wheel",wt)};if(e.length==0){for(let n of ge)t(n);ge=[]}else for(let n of e){let s=ge.findIndex(o=>o===n);s!==-1&&(t(n),ge.splice(s,1))}ge.length==0&&(window.removeEventListener("blur",_t),window.removeEventListener("focus",yt))}function tn(e,t,n,s){var o,r,a;return o=(t.x-e.x)*(s.y-n.y)-(s.x-n.x)*(t.y-e.y),o===0?!1:(a=((s.y-n.y)*(s.x-e.x)+(n.x-s.x)*(s.y-e.y))/o,r=((e.y-t.y)*(s.x-e.x)+(t.x-e.x)*(s.y-e.y))/o,0<a&&a<1&&0<r&&r<1)}function nn(e,t,n,s,o){if(s.x===o.x&&s.y===o.y)return!1;const r={x:e.x-2*t.x+n.x,y:e.y-2*t.y+n.y},a={x:2*(t.x-e.x),y:2*(t.y-e.y)},u={x:e.x,y:e.y},i={x:o.x-s.x,y:o.y-s.y},l={x:s.x,y:s.y},h=i.y*r.x-i.x*r.y,m=i.y*a.x-i.x*a.y,d=i.y*(u.x-l.x)-i.x*(u.y-l.y),x=m*m-4*h*d;if(x<0)return!1;const b=Math.sqrt(x),_=(-m+b)/(2*h),f=(-m-b)/(2*h);if(_>=0&&_<=1||f>=0&&f<=1){const w=H=>i.x!==0?(r.x*H*H+a.x*H+u.x-l.x)/i.x:(r.y*H*H+a.y*H+u.y-l.y)/i.y,M=w(_),C=w(f);if(M>=0&&M<=1||C>=0&&C<=1)return!0}return!1}function sn(e){let t,n,s,o;return{c(){t=z("div"),n=z("canvas"),s=Q(),o=z("canvas"),this.h()},l(r){t=R(r,"DIV",{class:!0});var a=B(t);n=R(a,"CANVAS",{id:!0,class:!0}),B(n).forEach(S),s=Z(a),o=R(a,"CANVAS",{id:!0,class:!0}),B(o).forEach(S),a.forEach(S),this.h()},h(){I(n,"id","currentPath"),I(n,"class","svelte-1rt306j"),I(o,"id","canvas"),I(o,"class","svelte-1rt306j"),I(t,"class","drawing-container svelte-1rt306j"),U(t,"disabled",e[0]===void 0)},m(r,a){re(r,t,a),P(t,n),e[10](n),P(t,s),P(t,o),e[11](o)},p(r,a){a[0]&1&&U(t,"disabled",r[0]===void 0)},i:ve,o:ve,d(r){r&&S(t),e[10](null),e[11](null)}}}const rn=178;function on(e,t,n){var s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),o=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),r=Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2)),a=Math.acos((o*o+s*s-r*r)/(2*o*s));return a*(180/Math.PI)}function Me(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}}function ln(e){if(e.points.length<5)return e;let t=Me(e.points[1],e.points[2]);for(let n=2;n<e.points.length-3;n++){let s=e.points[n],o=Me(e.points[n],e.points[n+1]);on(t,s,o)>rn&&(e.points.splice(n,1),n--),t=o}return e}function Ae(e,t){const n=e.points.length;if(n<1)return;if(t.lineWidth=e.lineWidth,t.lineCap="round",t.strokeStyle=e.color,t.fillStyle=e.color,n===1){t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[0].x,e.points[0].y),t.stroke();return}if(n===2){t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.stroke();return}t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y);let s=Me(e.points[0],e.points[1]);t.lineTo(s.x,s.y);for(let o=1;o<n-2;o++)s=Me(e.points[o],e.points[o+1]),t.quadraticCurveTo(e.points[o].x,e.points[o].y,s.x,s.y);t.stroke()}function an(e,t,n){let s;ue(e,me,E=>n(22,s=E));let{radius:o=4}=t,{smoothness:r=0}=t,{stroke:a=5}=t,{color:u="#000000"}=t,{tool:i=void 0}=t,{tabID:l=""}=t;const h=()=>{x.clearRect(0,0,M/C,w/C),A=[]},m=()=>{if(A.length!=0){A.pop(),_.clearRect(0,0,M/C,w/C);for(let E=0;E<A.length;E++)Ae(A[E],_);ne()}};let d,x,b,_,f={x:0,y:0},w=0,M=0,C,H=!1,j,L,A=[];function k(){if(d){if(!i){d.removeEventListener("gesture",Pe),d.removeEventListener("gesture",Ye),en(d);return}i==="pen"?(d.removeEventListener("gesture",Pe),d.addEventListener("gesture",Ye)):i==="eraser"&&(d.removeEventListener("gesture",Ye),d.addEventListener("gesture",Pe)),$t(d)}}const y=(E,J)=>{var g=J.x-E.x,D=J.y-E.y;return Math.sqrt(g*g+D*D)};function T(E){let J=d.getBoundingClientRect();return{x:Math.round(E.x-J.left),y:Math.round(E.y-J.top)}}function p(){if(!d||!b)return;x.resetTransform(),_.resetTransform(),C=window.devicePixelRatio;let E=d.getBoundingClientRect();w=E.height*C,M=E.width*C,n(1,d.width=M,d),n(1,d.height=w,d),n(2,b.width=M,b),n(2,b.height=w,b),x.scale(C,C),_.scale(C,C),ee()}function ee(){_.clearRect(0,0,M/C,w/C);for(let E=0;E<A.length;E++)Ae(A[E],_)}function ne(){s[l]&&me.update(E=>(E[l].paths=[],A.forEach(J=>{E[l].paths.push(ln(J))}),E))}function oe(){s[l]&&(A=s[l].paths,ee())}function K(E,J){H=!0,f=T({x:E,y:J}),j={points:[],lineWidth:a,color:u}}function se(E,J){if(!H)return;let g=T({x:E,y:J});if(o>0){if(y(g,f)<=o){j.points.length===0&&(j.points.push(g),Ae(j,x));return}let D=Math.sqrt(g.x*g.x+g.y*g.y-2*g.x*f.x+f.x*f.x-2*g.y*f.y+f.y*f.y);if(g={x:g.x+o*((f.x-g.x)/D),y:g.y+o*((f.y-g.y)/D)},y(f,g)<=r)return}j.points.push(g),x.clearRect(0,0,M/C,w/C),Ae(j,x),f=g}function Te(){H&&(A.push(j),x.clearRect(0,0,M/C,w/C),ne(),ee()),H=!1}function fe(E,J){H=!0,f=T({x:E,y:J}),j={points:[],lineWidth:10,color:"rgba(0,0,0,0.2)"}}function ce(E,J){if(!H)return;const g=T({x:E,y:J});j.points.push(g),setTimeout(()=>{x.clearRect(0,0,M/C,w/C),Ae(j,x),j.points.shift(),j.points.length<=1&&!H&&x.clearRect(0,0,M/C,w/C)},100);for(let D=0;D<A.length;D++){const X=A[D],V=X.points.length;if(V<1)return;let le=!1;if(V===1)le=y(X.points[0],g)<(X.lineWidth+j.lineWidth)/2;else{if(le=tn(f,g,X.points[0],X.points[1]),le)break;let ie=Me(X.points[0],X.points[1]);for(let ae=1;ae<V-2;ae++){let Tt=X.points[ae],$e=Me(X.points[ae],X.points[ae+1]);if(nn(ie,Tt,$e,f,g)){le=!0;break}ie=$e}}le&&(A.splice(D,1),ne(),ee())}f=g}function Ke(){j.points.length<=1&&x.clearRect(0,0,M/C,w/C),H=!1}const Pe=function(E){switch(E.detail.name){case"left-click-drag-start":case"touch-drag-start":fe(E.detail.x,E.detail.y);break;case"left-click-dragging":case"touch-dragging":ce(E.detail.x,E.detail.y);break;case"left-click-drag-end":case"touch-drag-end":Ke();break}},Ye=function(E){switch(E.detail.name){case"left-click-drag-start":case"touch-drag-start":K(E.detail.x,E.detail.y);break;case"left-click-dragging":case"touch-dragging":se(E.detail.x,E.detail.y);break;case"left-click-drag-end":case"touch-drag-end":Te();break}};Re(()=>{x=d.getContext("2d"),x.imageSmoothingEnabled=!1,_=b.getContext("2d"),_.imageSmoothingEnabled=!1,L=new ResizeObserver(p),L.observe(d),oe(),k()}),ht(()=>{L&&L.disconnect(),n(0,i=void 0),k()});function qe(E){$[E?"unshift":"push"](()=>{b=E,n(2,b)})}function Qe(E){$[E?"unshift":"push"](()=>{d=E,n(1,d)})}return e.$$set=E=>{"radius"in E&&n(3,o=E.radius),"smoothness"in E&&n(4,r=E.smoothness),"stroke"in E&&n(5,a=E.stroke),"color"in E&&n(6,u=E.color),"tool"in E&&n(0,i=E.tool),"tabID"in E&&n(7,l=E.tabID)},e.$$.update=()=>{e.$$.dirty[0]&1&&k()},[i,d,b,o,r,a,u,l,h,m,qe,Qe]}class cn extends Ee{constructor(t){super(),xe(this,t,an,sn,we,{radius:3,smoothness:4,stroke:5,color:6,tool:0,tabID:7,clear:8,undo:9},null,[-1,-1])}get clear(){return this.$$.ctx[8]}get undo(){return this.$$.ctx[9]}}function Oe(e,{delay:t=0,duration:n=400,easing:s=bt,axis:o="y"}={}){const r=getComputedStyle(e),a=+r.opacity,u=o==="y"?"height":"width",i=parseFloat(r[u]),l=o==="y"?["top","bottom"]:["left","right"],h=l.map(w=>`${w[0].toUpperCase()}${w.slice(1)}`),m=parseFloat(r[`padding${h[0]}`]),d=parseFloat(r[`padding${h[1]}`]),x=parseFloat(r[`margin${h[0]}`]),b=parseFloat(r[`margin${h[1]}`]),_=parseFloat(r[`border${h[0]}Width`]),f=parseFloat(r[`border${h[1]}Width`]);return{delay:t,duration:n,easing:s,css:w=>`overflow: hidden;opacity: ${Math.min(w*20,1)*a};${u}: ${w*i}px;padding-${l[0]}: ${w*m}px;padding-${l[1]}: ${w*d}px;margin-${l[0]}: ${w*x}px;margin-${l[1]}: ${w*b}px;border-${l[0]}-width: ${w*_}px;border-${l[1]}-width: ${w*f}px;`}}function ct(e,{delay:t=0,duration:n=400,easing:s=bt,start:o=0,opacity:r=0}={}){const a=getComputedStyle(e),u=+a.opacity,i=a.transform==="none"?"":a.transform,l=1-o,h=u*(1-r);return{delay:t,duration:n,easing:s,css:(m,d)=>`
			transform: ${i} scale(${1-l*d});
			opacity: ${u-h*d}
		`}}function ut(e){let t,n,s=`<span class="button-icon svelte-gz2jxk" style="-webkit-mask: url(${O}/images/svg/undo.svg) no-repeat center / contain; mask: url(${O}/images/svg/undo.svg) no-repeat center / contain;"></span>`,o,r,a,u,i,l,h,m;return{c(){t=z("div"),n=z("button"),n.innerHTML=s,o=Q(),r=z("input"),a=Q(),u=z("input"),this.h()},l(d){t=R(d,"DIV",{class:!0});var x=B(t);n=R(x,"BUTTON",{class:!0,"data-svelte-h":!0}),he(n)!=="svelte-1b4fip4"&&(n.innerHTML=s),o=Z(x),r=R(x,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),a=Z(x),u=R(x,"INPUT",{type:!0,class:!0}),x.forEach(S),this.h()},h(){I(n,"class","button svelte-gz2jxk"),I(r,"type","range"),I(r,"min","2"),I(r,"max","20"),I(r,"step","2"),I(r,"class","slider svelte-gz2jxk"),I(u,"type","color"),I(u,"class","color-picker svelte-gz2jxk"),I(t,"class","pencil-tools svelte-gz2jxk")},m(d,x){re(d,t,x),P(t,n),P(t,o),P(t,r),Ve(r,e[0]),P(t,a),P(t,u),Ve(u,e[1]),l=!0,h||(m=[te(n,"click",function(){Se(e[3])&&e[3].apply(this,arguments)}),te(r,"change",e[9]),te(r,"input",e[9]),te(u,"input",e[10])],h=!0)},p(d,x){e=d,x&1&&Ve(r,e[0]),x&2&&Ve(u,e[1])},i(d){l||(d&&Ne(()=>{l&&(i||(i=Ce(t,Oe,{duration:200,axis:"x"},!0)),i.run(1))}),l=!0)},o(d){d&&(i||(i=Ce(t,Oe,{duration:200,axis:"x"},!1)),i.run(0)),l=!1},d(d){d&&S(t),d&&i&&i.end(),h=!1,Ue(m)}}}function un(e){let t,n,s=`<span class="button-icon svelte-gz2jxk" style="-webkit-mask: url(${O}/images/svg/pen.svg) no-repeat center / contain; mask: url(${O}/images/svg/pen.svg) no-repeat center / contain;"></span>`,o,r,a=`<span class="button-icon svelte-gz2jxk" style="-webkit-mask: url(${O}/images/svg/highlighter.svg) no-repeat center / contain; mask: url(${O}/images/svg/highlighter.svg) no-repeat center / contain;"></span>`,u,i,l=`<span class="button-icon svelte-gz2jxk" style="-webkit-mask: url(${O}/images/svg/eraser.svg) no-repeat center / contain; mask: url(${O}/images/svg/eraser.svg) no-repeat center / contain;"></span>`,h,m,d,x,b,_,f,w,M,C=`<span class="button-icon svelte-gz2jxk" style="-webkit-mask: url(${O}/images/svg/user.svg) no-repeat center / contain; mask: url(${O}/images/svg/user.svg) no-repeat center / contain;"></span>`,H,j,L,A,k=(e[4].tool==="pen"||e[4].tool==="highlighter")&&ut(e);return{c(){t=z("div"),n=z("button"),n.innerHTML=s,o=Q(),r=z("button"),r.innerHTML=a,u=Q(),i=z("button"),i.innerHTML=l,h=Q(),k&&k.c(),m=Q(),d=z("div"),x=Q(),b=z("button"),_=z("span"),w=Q(),M=z("a"),M.innerHTML=C,this.h()},l(y){t=R(y,"DIV",{class:!0});var T=B(t);n=R(T,"BUTTON",{tabindex:!0,class:!0,"data-svelte-h":!0}),he(n)!=="svelte-zvfyy8"&&(n.innerHTML=s),o=Z(T),r=R(T,"BUTTON",{class:!0,"data-svelte-h":!0}),he(r)!=="svelte-1evhkjr"&&(r.innerHTML=a),u=Z(T),i=R(T,"BUTTON",{class:!0,"data-svelte-h":!0}),he(i)!=="svelte-1aagamc"&&(i.innerHTML=l),h=Z(T),k&&k.l(T),m=Z(T),d=R(T,"DIV",{class:!0}),B(d).forEach(S),x=Z(T),b=R(T,"BUTTON",{class:!0});var p=B(b);_=R(p,"SPAN",{class:!0,style:!0}),B(_).forEach(S),p.forEach(S),w=Z(T),M=R(T,"A",{class:!0,href:!0,"data-svelte-h":!0}),he(M)!=="svelte-1xuhzhs"&&(M.innerHTML=C),T.forEach(S),this.h()},h(){I(n,"tabindex","0"),I(n,"class","pencil button svelte-gz2jxk"),U(n,"selected",e[4].tool==="pen"),I(r,"class","button svelte-gz2jxk"),U(r,"selected",e[4].tool==="highlighter"),I(i,"class","button svelte-gz2jxk"),U(i,"selected",e[4].tool==="eraser"),I(d,"class","spacer svelte-gz2jxk"),I(_,"class","button-icon svelte-gz2jxk"),et(_,"-webkit-mask","url("+O+"/images/svg/refresh.svg) no-repeat center / contain"),et(_,"mask","url("+O+"/images/svg/refresh.svg) no-repeat center / contain"),I(b,"class","refresh button svelte-gz2jxk"),b.disabled=f=e[5].savingStatus==="saving",I(M,"class","button svelte-gz2jxk"),I(M,"href",O+"/profile"),I(t,"class","toolbar-container svelte-gz2jxk")},m(y,T){re(y,t,T),P(t,n),P(t,o),P(t,r),P(t,u),P(t,i),P(t,h),k&&k.m(t,null),P(t,m),P(t,d),P(t,x),P(t,b),P(b,_),P(t,w),P(t,M),j=!0,L||(A=[te(n,"click",e[6]),te(r,"click",e[7]),te(i,"click",e[8]),te(b,"click",function(){Se(e[2])&&e[2].apply(this,arguments)})],L=!0)},p(y,[T]){e=y,(!j||T&16)&&U(n,"selected",e[4].tool==="pen"),(!j||T&16)&&U(r,"selected",e[4].tool==="highlighter"),(!j||T&16)&&U(i,"selected",e[4].tool==="eraser"),e[4].tool==="pen"||e[4].tool==="highlighter"?k?(k.p(e,T),T&16&&N(k,1)):(k=ut(e),k.c(),N(k,1),k.m(t,m)):k&&(Le(),q(k,1,1,()=>{k=null}),De()),(!j||T&32&&f!==(f=e[5].savingStatus==="saving"))&&(b.disabled=f)},i(y){j||(N(k),y&&Ne(()=>{j&&(H||(H=Ce(t,Oe,{duration:200},!0)),H.run(1))}),j=!0)},o(y){q(k),y&&(H||(H=Ce(t,Oe,{duration:200},!1)),H.run(0)),j=!1},d(y){y&&S(t),k&&k.d(),y&&H&&H.end(),L=!1,Ue(A)}}}function dn(e,t,n){let s,o;ue(e,W,b=>n(4,s=b)),ue(e,vt,b=>n(5,o=b));let{onRefresh:r=()=>{}}=t,{onDrawingUndo:a=()=>{}}=t,{stroke:u}=t,{color:i}=t;const l=()=>{G(W,s.tool=s.tool==="pen"?void 0:"pen",s)},h=()=>{G(W,s.tool=s.tool==="highlighter"?void 0:"highlighter",s)},m=()=>{G(W,s.tool=s.tool==="eraser"?void 0:"eraser",s)};function d(){u=Yt(this.value),n(0,u)}function x(){i=this.value,n(1,i)}return e.$$set=b=>{"onRefresh"in b&&n(2,r=b.onRefresh),"onDrawingUndo"in b&&n(3,a=b.onDrawingUndo),"stroke"in b&&n(0,u=b.stroke),"color"in b&&n(1,i=b.color)},[u,i,r,a,s,o,l,h,m,d,x]}class fn extends Ee{constructor(t){super(),xe(this,t,dn,un,we,{onRefresh:2,onDrawingUndo:3,stroke:0,color:1})}}function gn(e){let t,n=`<div class="trashcan-icon svelte-15jm748" style="-webkit-mask: url(${O}/images/svg/trash.svg) no-repeat center / contain; mask: url(${O}/images/svg/trash.svg) no-repeat center / contain;"></div>`,s,o;return{c(){t=z("div"),t.innerHTML=n,this.h()},l(r){t=R(r,"DIV",{class:!0,"data-svelte-h":!0}),he(t)!=="svelte-1bi7fon"&&(t.innerHTML=n),this.h()},h(){I(t,"class","trashcan svelte-15jm748"),U(t,"overTrashcan",e[1])},m(r,a){re(r,t,a),e[3](t),o=!0},p(r,[a]){(!o||a&2)&&U(t,"overTrashcan",r[1])},i(r){o||(r&&Ne(()=>{o&&(s||(s=Ce(t,ct,{duration:200},!0)),s.run(1))}),o=!0)},o(r){r&&(s||(s=Ce(t,ct,{duration:200},!1)),s.run(0)),o=!1},d(r){r&&S(t),e[3](null),r&&s&&s.end()}}}function hn(e,t,n){let{throwAway:s=()=>{}}=t,o,r=!1;const a=l=>{const h=o.getBoundingClientRect(),m=l instanceof MouseEvent?l.clientX:l.touches[0].clientX,d=l instanceof MouseEvent?l.clientY:l.touches[0].clientY;if(m<h.left||m>h.right||d<h.top||d>h.bottom){n(1,r=!1);return}n(1,r=!0)},u=l=>{const h=o.getBoundingClientRect(),m=l instanceof MouseEvent?l.clientX:l.touches[0].clientX,d=l instanceof MouseEvent?l.clientY:l.touches[0].clientY;if(m<h.left||m>h.right||d<h.top||d>h.bottom){n(1,r=!1);return}s()};Re(()=>{window.addEventListener("mousemove",a),window.addEventListener("touchmove",a),window.addEventListener("drag",a),window.addEventListener("dragend",u),window.addEventListener("mouseup",u),window.addEventListener("touchend",u)}),ht(()=>{window.removeEventListener("mousemove",a),window.removeEventListener("touchmove",a),window.removeEventListener("drag",a),window.removeEventListener("dragend",u),window.removeEventListener("mouseup",u),window.removeEventListener("touchend",u)});function i(l){$[l?"unshift":"push"](()=>{o=l,n(0,o)})}return e.$$set=l=>{"throwAway"in l&&n(2,s=l.throwAway)},[o,r,s,i]}class mn extends Ee{constructor(t){super(),xe(this,t,hn,gn,we,{throwAway:2})}}function dt(e){let t,n,s,o;function r(i){e[16](i)}function a(i){e[17](i)}let u={onDrawingUndo:e[14],onRefresh:e[15]};return e[4]!==void 0&&(u.stroke=e[4]),e[0]!==void 0&&(u.color=e[0]),t=new fn({props:u}),$.push(()=>ze(t,"stroke",r)),$.push(()=>ze(t,"color",a)),{c(){pe(t.$$.fragment)},l(i){be(t.$$.fragment,i)},m(i,l){ye(t,i,l),o=!0},p(i,l){const h={};l&128&&(h.onDrawingUndo=i[14]),!n&&l&16&&(n=!0,h.stroke=i[4],je(()=>n=!1)),!s&&l&1&&(s=!0,h.color=i[0],je(()=>s=!1)),t.$set(h)},i(i){o||(N(t.$$.fragment,i),o=!0)},o(i){q(t.$$.fragment,i),o=!1},d(i){_e(t,i)}}}function vn(e){let t,n;return t=new zt({}),{c(){pe(t.$$.fragment)},l(s){be(t.$$.fragment,s)},m(s,o){ye(t,s,o),n=!0},p:ve,i(s){n||(N(t.$$.fragment,s),n=!0)},o(s){q(t.$$.fragment,s),n=!1},d(s){_e(t,s)}}}function pn(e){let t,n,s=e[10],o,r,a,u=ft(e),i=e[2].trashcanVisible&&gt(e);return{c(){t=z("div"),n=z("div"),u.c(),o=Q(),i&&i.c(),this.h()},l(l){t=R(l,"DIV",{class:!0,style:!0});var h=B(t);n=R(h,"DIV",{class:!0});var m=B(n);u.l(m),m.forEach(S),o=Z(h),i&&i.l(h),h.forEach(S),this.h()},h(){I(n,"class","editor-container svelte-17mx60y"),I(t,"class","scrollable-canvas svelte-17mx60y"),I(t,"style",e[8]),Ne(()=>e[22].call(t))},m(l,h){re(l,t,h),P(t,n),u.m(n,null),P(t,o),i&&i.m(t,null),r=Xt(t,e[22].bind(t)),a=!0},p(l,h){h&1024&&we(s,s=l[10])?(Le(),q(u,1,1,ve),De(),u=ft(l),u.c(),N(u,1),u.m(n,null)):u.p(l,h),l[2].trashcanVisible?i?(i.p(l,h),h&4&&N(i,1)):(i=gt(l),i.c(),N(i,1),i.m(t,null)):i&&(Le(),q(i,1,1,()=>{i=null}),De()),(!a||h&256)&&I(t,"style",l[8])},i(l){a||(N(u),N(i),a=!0)},o(l){q(u),q(i),a=!1},d(l){l&&S(t),u.d(l),i&&i.d(),r()}}}function ft(e){let t,n,s,o,r,a,u={tabID:e[10]};t=new Kt({props:u}),e[18](t);function i(m){e[20](m)}function l(m){e[21](m)}let h={tabID:e[10],tool:e[9]};return e[3]!==void 0&&(h.color=e[3]),e[4]!==void 0&&(h.stroke=e[4]),s=new cn({props:h}),e[19](s),$.push(()=>ze(s,"color",i)),$.push(()=>ze(s,"stroke",l)),{c(){pe(t.$$.fragment),n=Q(),pe(s.$$.fragment)},l(m){be(t.$$.fragment,m),n=Z(m),be(s.$$.fragment,m)},m(m,d){ye(t,m,d),re(m,n,d),ye(s,m,d),a=!0},p(m,d){const x={};d&1024&&(x.tabID=m[10]),t.$set(x);const b={};d&1024&&(b.tabID=m[10]),d&512&&(b.tool=m[9]),!o&&d&8&&(o=!0,b.color=m[3],je(()=>o=!1)),!r&&d&16&&(r=!0,b.stroke=m[4],je(()=>r=!1)),s.$set(b)},i(m){a||(N(t.$$.fragment,m),N(s.$$.fragment,m),a=!0)},o(m){q(t.$$.fragment,m),q(s.$$.fragment,m),a=!1},d(m){m&&S(n),e[18](null),_e(t,m),e[19](null),_e(s,m)}}}function gt(e){let t,n,s;return n=new mn({props:{throwAway:e[5].closeActiveTab}}),{c(){t=z("div"),pe(n.$$.fragment),this.h()},l(o){t=R(o,"DIV",{class:!0});var r=B(t);be(n.$$.fragment,r),r.forEach(S),this.h()},h(){I(t,"class","trashcan-container svelte-17mx60y")},m(o,r){re(o,t,r),ye(n,t,null),s=!0},p(o,r){const a={};r&32&&(a.throwAway=o[5].closeActiveTab),n.$set(a)},i(o){s||(N(n.$$.fragment,o),s=!0)},o(o){q(n.$$.fragment,o),s=!1},d(o){o&&S(t),_e(n)}}}function bn(e){let t,n,s,o,r,a,u,i,l,h,m={};n=new Ft({props:m}),e[13](n);let d=e[2].toolbarVisible&&e[2].order.length>0&&dt(e);const x=[pn,vn],b=[];function _(f,w){return f[11].currentUser&&!f[11].isLoading?0:1}return a=_(e),u=b[a]=x[a](e),{c(){t=z("div"),pe(n.$$.fragment),s=Q(),o=z("div"),d&&d.c(),r=Q(),u.c(),this.h()},l(f){t=R(f,"DIV",{class:!0});var w=B(t);be(n.$$.fragment,w),s=Z(w),o=R(w,"DIV",{class:!0});var M=B(o);d&&d.l(M),M.forEach(S),r=Z(w),u.l(w),w.forEach(S),this.h()},h(){I(o,"class","toolbar"),I(t,"class","page-container svelte-17mx60y")},m(f,w){re(f,t,w),ye(n,t,null),P(t,s),P(t,o),d&&d.m(o,null),P(t,r),b[a].m(t,null),i=!0,l||(h=te(window,"keydown",e[12],{passive:!1}),l=!0)},p(f,[w]){const M={};n.$set(M),f[2].toolbarVisible&&f[2].order.length>0?d?(d.p(f,w),w&4&&N(d,1)):(d=dt(f),d.c(),N(d,1),d.m(o,null)):d&&(Le(),q(d,1,1,()=>{d=null}),De());let C=a;a=_(f),a===C?b[a].p(f,w):(Le(),q(b[C],1,1,()=>{b[C]=null}),De(),u=b[a],u?u.p(f,w):(u=b[a]=x[a](f),u.c()),N(u,1),u.m(t,null))},i(f){i||(N(n.$$.fragment,f),N(d),N(u),i=!0)},o(f){q(n.$$.fragment,f),q(d),q(u),i=!1},d(f){f&&S(t),e[13](null),_e(n),d&&d.d(),b[a].d(),l=!1,h()}}}function yn(e,t){var n=parseInt(e.slice(1,3),16),s=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16);return"rgba("+n+", "+s+", "+o+", "+t+")"}function _n(e,t,n){let s,o,r;ue(e,W,p=>n(2,s=p)),ue(e,mt,p=>n(23,o=p)),ue(e,vt,p=>n(11,r=p));let a="#000000",u="rgba(0, 0, 0, 1)",i=10,l,h,m,d=0,x="",b,_="";function f(p){p.key==="Escape"?(p.preventDefault(),p.stopPropagation(),s.tool!==void 0&&G(W,s.tool=void 0,s)):p.altKey&&p.key==="1"?(p.preventDefault(),p.stopPropagation(),s.tool==="pen"?G(W,s.tool=void 0,s):(G(W,s.tool="pen",s),G(W,s.toolbarVisible=!0,s))):p.altKey&&p.key==="2"?(p.preventDefault(),p.stopPropagation(),s.tool==="highlighter"?G(W,s.tool=void 0,s):(G(W,s.tool="highlighter",s),G(W,s.toolbarVisible=!0,s))):p.altKey&&p.key==="3"?(p.preventDefault(),p.stopPropagation(),s.tool==="eraser"?G(W,s.tool=void 0,s):(G(W,s.tool="eraser",s),G(W,s.toolbarVisible=!0,s))):p.ctrlKey&&p.key==="z"?(p.preventDefault(),p.stopPropagation(),console.log("undo"),(s.tool==="pen"||s.tool==="highlighter"||s.tool==="eraser")&&m.undo()):p.ctrlKey&&p.key==="Z"&&(p.preventDefault(),p.stopPropagation(),console.log("redo"))}W.subscribe(p=>{switch(n(10,_=p.order[p.activeIndex]),p.tool){case"pen":n(8,x=`cursor: url(${O}/images/svg/pen.svg) 1 20, auto;`),n(9,b="pen");const ee=St.find(ne=>ne.name===o.theme);ee&&n(0,a=ee.caret);break;case"highlighter":n(0,a="#ffdd33"),n(8,x=`cursor: url(${O}/images/svg/highlighter.svg) 1 18, auto;`),n(9,b="pen");break;case"eraser":n(9,b="eraser"),n(8,x=`cursor: url(${O}/images/svg/eraser.svg) 5 18, auto;`);break;default:n(8,x=""),n(9,b=void 0);break}}),Re(()=>{});function w(p){$[p?"unshift":"push"](()=>{l=p,n(5,l)})}const M=()=>m.undo(),C=()=>jt.loadFromFirestore();function H(p){i=p,n(4,i)}function j(p){a=p,n(0,a)}function L(p){$[p?"unshift":"push"](()=>{h=p,n(6,h)})}function A(p){$[p?"unshift":"push"](()=>{m=p,n(7,m)})}function k(p){u=p,n(3,u),n(2,s),n(0,a)}function y(p){i=p,n(4,i)}function T(){d=this.clientHeight,n(1,d)}return e.$$.update=()=>{e.$$.dirty&5&&n(3,u=s.tool==="highlighter"?yn(a,.3):a),e.$$.dirty&2&&d>0&&document.documentElement.style.setProperty("--canvas-height",d+"px")},[a,d,s,u,i,l,h,m,x,b,_,r,f,w,M,C,H,j,L,A,k,y,T]}class Pn extends Ee{constructor(t){super(),xe(this,t,_n,bn,we,{})}}export{Pn as component};
