const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/quill.Bk4jDS0q.js","../chunks/core.CG__ofcG.js"])))=>i.map(i=>d[i]);
var ht=Object.defineProperty;var mt=(e,n,t)=>n in e?ht(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var N=(e,n,t)=>mt(e,typeof n!="symbol"?n+"":n,t);import{s as Xe,n as pe,r as it,e as Ye,c as ve,o as qe,d as ge,z as yt,A as pt,a as Me}from"../chunks/scheduler.BOxWOvYx.js";import{S as Ie,i as Pe,e as V,b as bt,c as W,d as U,f as wt,g as Y,w as R,A as z,j as le,k as P,x as me,G as Ve,l as kt,s as ne,p as be,h as ie,v as De,q as we,z as Ge,r as ke,o as Fe,n as Ue,a as re,t as oe,u as xe,I as xt,m as He}from"../chunks/index.BFcqwp_n.js";import{e as Ae,u as st,o as lt}from"../chunks/each.DD9ZPifO.js";import{b as te}from"../chunks/paths.pN5sB-rB.js";import{m as Ne,t as ye,a as rt,d as ce,s as _t,f as Et}from"../chunks/firebaseStore.BKEzDMw3.js";import{_ as Ke}from"../chunks/preload-helper.D6kgxu3v.js";import{S as Tt}from"../chunks/Spinner.DVSMDdgP.js";function Lt(e){let n,t,i,o,l,u;return{c(){n=V("div"),t=V("button"),i=V("span"),o=bt(e[0]),this.h()},l(r){n=W(r,"DIV",{class:!0});var f=U(n);t=W(f,"BUTTON",{class:!0,draggable:!0});var _=U(t);i=W(_,"SPAN",{class:!0});var h=U(i);o=wt(h,e[0]),h.forEach(Y),_.forEach(Y),f.forEach(Y),this.h()},h(){R(i,"class","title svelte-1aycx2r"),R(t,"class","tab svelte-1aycx2r"),R(t,"draggable","true"),z(t,"active",e[1]),R(n,"class","tab-container svelte-1aycx2r"),z(n,"preventHover",e[2])},m(r,f){le(r,n,f),P(n,t),P(t,i),P(i,o),l||(u=[me(t,"mousedown",Ve(function(){Ye(e[3])&&e[3].apply(this,arguments)})),me(t,"touchstart",Ve(function(){Ye(e[3])&&e[3].apply(this,arguments)})),me(t,"dragstart",Ve(function(){Ye(e[4])&&e[4].apply(this,arguments)}))],l=!0)},p(r,[f]){e=r,f&1&&kt(o,e[0]),f&2&&z(t,"active",e[1]),f&4&&z(n,"preventHover",e[2])},i:pe,o:pe,d(r){r&&Y(n),l=!1,it(u)}}}function Ct(e,n,t){let{title:i=""}=n,{active:o=!1}=n,{preventHover:l=!1}=n,{onPointerdown:u=f=>{}}=n,{onDragstart:r=f=>{}}=n;return e.$$set=f=>{"title"in f&&t(0,i=f.title),"active"in f&&t(1,o=f.active),"preventHover"in f&&t(2,l=f.preventHover),"onPointerdown"in f&&t(3,u=f.onPointerdown),"onDragstart"in f&&t(4,r=f.onDragstart)},[i,o,l,u,r]}class ot extends Ie{constructor(n){super(),Pe(this,n,Ct,Lt,Xe,{title:0,active:1,preventHover:2,onPointerdown:3,onDragstart:4})}}function he(e){return e<.5?4*e*e*e:.5*Math.pow(2*e-2,3)+1}const je=(e,n)=>{const{duration:t=300,easing:i=he,onEnd:o=()=>{},onStep:l=()=>{},css:u}=n;let r;function f(_){if(!e){console.warn("Cannot find element to animate");return}r===void 0&&(r=_);const h=i((_-r)/t),E=1-h;h<1?(e.style.cssText=u(h,E),l(h,E),requestAnimationFrame(f)):(e.style.cssText="",o())}requestAnimationFrame(f)},We=e=>{const{duration:n=300,easing:t=he,onEnd:i=()=>{},onStep:o=()=>{}}=e;let l;function u(r){l===void 0&&(l=r);const f=t((r-l)/n),_=1-f;f<1?(o(f,_),requestAnimationFrame(u)):i()}requestAnimationFrame(u)};function Qe(e,n,t){const i=e.slice();return i[43]=n[t],i[44]=n,i[45]=t,i}function Ze(e,n){let t,i,o,l,u=n[45],r,f,_;function h(...g){return n[20](n[45],...g)}function E(g){n[21](g,n[43])}let w={active:n[11]==n[43],preventHover:n[10],onPointerdown:h,onDragstart:n[18]};n[13][n[43]].title!==void 0&&(w.title=n[13][n[43]].title),i=new ot({props:w}),ge.push(()=>xt(i,"title",E));const k=()=>n[22](t,u),v=()=>n[22](null,u);return{key:e,first:null,c(){t=V("div"),be(i.$$.fragment),l=ne(),this.h()},l(g){t=W(g,"DIV",{class:!0});var y=U(t);we(i.$$.fragment,y),l=ie(y),y.forEach(Y),this.h()},h(){R(t,"class","tab-container svelte-11x45ky"),z(t,"placeholder",n[12]==n[43]),this.first=t},m(g,y){le(g,t,y),ke(i,t,null),P(t,l),k(),r=!0,f||(_=yt(n[17].call(null,t)),f=!0)},p(g,y){n=g;const X={};y[0]&2056&&(X.active=n[11]==n[43]),y[0]&1024&&(X.preventHover=n[10]),y[0]&8&&(X.onPointerdown=h),!o&&y[0]&8200&&(o=!0,X.title=n[13][n[43]].title,pt(()=>o=!1)),i.$set(X),u!==n[45]&&(v(),u=n[45],k()),(!r||y[0]&4104)&&z(t,"placeholder",n[12]==n[43])},i(g){r||(re(i.$$.fragment,g),r=!0)},o(g){oe(i.$$.fragment,g),r=!1},d(g){g&&Y(t),xe(i),v(),f=!1,_()}}}function Dt(e){let n,t,i,o=[],l=new Map,u,r,f,_=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/plus.svg) no-repeat center / contain; mask: url(${te}/images/svg/plus.svg) no-repeat center / contain;"></span>`,h,E,w,k=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/trash.svg) no-repeat center / contain; mask: url(${te}/images/svg/trash.svg) no-repeat center / contain;"></span>`,v,g,y,X,T,S,m=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/pencil.svg) no-repeat center / contain; mask: url(${te}/images/svg/pencil.svg) no-repeat center / contain;"></span>`,I,L,M=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/gear.svg) no-repeat center / contain; mask: url(${te}/images/svg/gear.svg) no-repeat center / contain;"></span>`,K,B,G,Z,j,q,Q,de,se=Ae(e[3].order);const J=H=>H[43];for(let H=0;H<se.length;H+=1){let C=Qe(e,se,H),c=J(C);l.set(c,o[H]=Ze(c,C))}return G=new ot({props:{title:e[6],active:!e[8],preventHover:!0}}),{c(){n=V("div"),t=V("div"),i=V("div");for(let H=0;H<o.length;H+=1)o[H].c();u=ne(),r=V("div"),f=V("button"),f.innerHTML=_,h=ne(),E=V("div"),w=V("button"),w.innerHTML=k,v=ne(),g=V("button"),y=V("span"),T=ne(),S=V("button"),S.innerHTML=m,I=ne(),L=V("a"),L.innerHTML=M,K=ne(),B=V("div"),be(G.$$.fragment),Z=ne(),j=V("div"),this.h()},l(H){n=W(H,"DIV",{class:!0});var C=U(n);t=W(C,"DIV",{class:!0});var c=U(t);i=W(c,"DIV",{class:!0});var p=U(i);for(let ue=0;ue<o.length;ue+=1)o[ue].l(p);p.forEach(Y),u=ie(c),r=W(c,"DIV",{class:!0});var F=U(r);f=W(F,"BUTTON",{class:!0,"data-svelte-h":!0}),De(f)!=="svelte-g0ls06"&&(f.innerHTML=_),F.forEach(Y),h=ie(c),E=W(c,"DIV",{class:!0});var D=U(E);w=W(D,"BUTTON",{class:!0,"data-svelte-h":!0}),De(w)!=="svelte-hhcvrt"&&(w.innerHTML=k),v=ie(D),g=W(D,"BUTTON",{class:!0});var $=U(g);y=W($,"SPAN",{class:!0,style:!0}),U(y).forEach(Y),$.forEach(Y),T=ie(D),S=W(D,"BUTTON",{class:!0,"data-svelte-h":!0}),De(S)!=="svelte-4n2i7g"&&(S.innerHTML=m),I=ie(D),L=W(D,"A",{class:!0,href:!0,"data-svelte-h":!0}),De(L)!=="svelte-8w27ao"&&(L.innerHTML=M),D.forEach(Y),K=ie(c),B=W(c,"DIV",{class:!0});var ee=U(B);we(G.$$.fragment,ee),ee.forEach(Y),c.forEach(Y),Z=ie(C),j=W(C,"DIV",{class:!0}),U(j).forEach(Y),C.forEach(Y),this.h()},h(){R(i,"class","tabs svelte-11x45ky"),R(f,"class","button svelte-11x45ky"),R(r,"class","new-tab-container svelte-11x45ky"),R(w,"class","close button svelte-11x45ky"),R(y,"class","button-icon svelte-11x45ky"),Ge(y,"-webkit-mask","url("+te+"/images/svg/refresh.svg) no-repeat center / contain"),Ge(y,"mask","url("+te+"/images/svg/refresh.svg) no-repeat center / contain"),R(g,"class","refresh button svelte-11x45ky"),g.disabled=X=e[14].savingStatus==="saving",R(S,"class","pencil button svelte-11x45ky"),z(S,"selected",e[3].activeTool==="pencil"),R(L,"class","button svelte-11x45ky"),R(L,"href",te+"/settings"),R(E,"class","settings-container svelte-11x45ky"),R(B,"class","clone svelte-11x45ky"),z(B,"dragging",e[2]),R(t,"class","tabbar svelte-11x45ky"),R(j,"class","divider svelte-11x45ky"),R(n,"class","svelte-11x45ky")},m(H,C){le(H,n,C),P(n,t),P(t,i);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(i,null);e[23](i),P(t,u),P(t,r),P(r,f),P(t,h),P(t,E),P(E,w),P(E,v),P(E,g),P(g,y),P(E,T),P(E,S),P(E,I),P(E,L),P(t,K),P(t,B),ke(G,B,null),e[25](B),P(n,Z),P(n,j),e[26](n),q=!0,Q||(de=[me(f,"click",e[15]),me(w,"click",e[24]),me(g,"click",function(){Ye(e[0])&&e[0].apply(this,arguments)}),me(S,"click",function(){Ye(e[1])&&e[1].apply(this,arguments)})],Q=!0)},p(H,C){e=H,C[0]&801832&&(se=Ae(e[3].order),Fe(),o=st(o,C,J,1,e,se,l,i,lt,Ze,null,Qe),Ue()),(!q||C[0]&16384&&X!==(X=e[14].savingStatus==="saving"))&&(g.disabled=X),(!q||C[0]&8)&&z(S,"selected",e[3].activeTool==="pencil");const c={};C[0]&64&&(c.title=e[6]),C[0]&256&&(c.active=!e[8]),G.$set(c),(!q||C[0]&4)&&z(B,"dragging",e[2])},i(H){if(!q){for(let C=0;C<se.length;C+=1)re(o[C]);re(G.$$.fragment,H),q=!0}},o(H){for(let C=0;C<o.length;C+=1)oe(o[C]);oe(G.$$.fragment,H),q=!1},d(H){H&&Y(n);for(let C=0;C<o.length;C+=1)o[C].d();e[23](null),xe(G),e[25](null),e[26](null),Q=!1,it(de)}}}const Yt=12,Se=200,Le=32,Ce=200,Xt=1600,Je=.3;function It(e,n,t){let i,o,l,u,r;ve(e,Ne,d=>t(3,l=d)),ve(e,ye,d=>t(13,u=d)),ve(e,rt,d=>t(14,r=d));let{refreshClicked:f=()=>{}}=n,{pencilClicked:_=()=>{Me(Ne,l.activeTool=l.activeTool==="pencil"?void 0:"pencil",l)}}=n,h,E=[],w=0,k=null,v=-1,g="",y,X,T,S=!1,m=!1,I=0,L=0,M,K=!1;const B=(d,b=300)=>{let A;return(...O)=>{clearTimeout(A),A=setTimeout(()=>{d.apply(void 0,O)},b)}};function G(){ce.newTab()}const Z=d=>{const b=l.order.findIndex(A=>A===d);if(b<0||!E[b]){console.warn("Cannot close tab!");return}w=E[b].getBoundingClientRect().width,b<l.order.length-1&&(h.style.setProperty("--tab-max-width",`${w}px`),j()),b==l.activeIndex&&(b==l.order.length-1?ce.setActiveIndex(b-1):ce.setActiveIndex(b+1)),We({duration:Ce,easing:he,onStep:(A,O)=>{b==0?t(4,h.style.gridTemplateColumns=`minmax(${O*Le}px, ${O*w}px)`,h):t(4,h.style.gridTemplateColumns=`repeat(${b}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${O*Le}px, ${O*w}px)`,h)},onEnd:()=>{t(4,h.style.gridTemplateColumns="",h),ce.removeTab(d)}})},j=B(()=>{h&&(h.style.setProperty("--tab-max-width",`${Se}px`),We({duration:Ce,easing:he,onStep:(d,b)=>{h.style.setProperty("--tab-max-width",`${w+d*(Se-w)}px`)},onEnd:()=>{h.style.setProperty("--tab-max-width",`${Se}px`)}}))},Xt);function q(d){if(!h)return;const b=d.getBoundingClientRect().width;We({duration:Ce,easing:he,onStep:(A,O)=>{l.order.length==1?t(4,h.style.gridTemplateColumns=`minmax(${A*Le}px, ${A*b}px)`,h):t(4,h.style.gridTemplateColumns=`repeat(${l.order.length-1}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${A*Le}px, ${A*b}px)`,h),t(4,h.scrollLeft=h.scrollWidth,h)},onEnd:()=>{t(4,h.style.gridTemplateColumns="",h)}})}const Q=(d,b)=>{const A=E[0].getBoundingClientRect().width;ce.moveTab(d,b,()=>{if(d>b)for(let O=b;O<d;O++)je(E[O],{duration:Ce,easing:he,css:(Ee,ae)=>`transform: translateX(-${ae*A}px);`});if(d<b)for(let O=b;O>d;O--)je(E[O],{duration:Ce,easing:he,css:(Ee,ae)=>`transform: translateX(${ae*A}px);`})})};function de(d){!d.target||!d.dataTransfer||(d.dataTransfer.setData("text/plain",i),d.dataTransfer.setDragImage(new Image,0,0))}function se(d,b){if(d==0&&b==0){t(7,T.style.left="-1000px",T),t(7,T.style.top="-1000px",T);return}let A=M.getBoundingClientRect();if(d<A.left||d>A.right||b<A.top||b>A.bottom){m||(L=0),t(7,T.style.left=`${d+I}px`,T),t(7,T.style.top=`${b-X.height/2}px`,T),t(8,m=!0);return}m&&t(8,m=!1),t(7,T.style.left=`${d+I}px`,T),t(7,T.style.top=`${X.top}px`,T);const O=-h.scrollLeft,Ee=E[0].getBoundingClientRect().width;let ae=-1;if(d>O+l.order.length*Ee)ae=l.order.length-1;else for(let Te=0;Te<l.order.length;Te++)if(d>O+Te*Ee&&d<O+(Te+1)*Ee){ae=Te;break}d<20?(L=-Je,requestAnimationFrame(H)):d>h.clientWidth-10?(L=Je,requestAnimationFrame(H)):L=0,!(ae==-1||ae==l.placeholderIndex)&&Q(l.placeholderIndex,ae)}let J=0;function H(d){if(!S||L==0){J=0;return}J==0&&(J=d);const b=d-J;J=d,h.scrollBy({left:L*b}),requestAnimationFrame(H)}function C(d,b){if(!d.target)return;let A,O;d instanceof TouchEvent?(A=d.touches[0].clientX,O=d.touches[0].clientY):(A=d.clientX,O=d.clientY),window.addEventListener("touchmove",c,{passive:!1}),window.addEventListener("touchend",p),window.addEventListener("mousemove",c),window.addEventListener("mouseup",p),window.addEventListener("drag",c),window.addEventListener("dragend",p),window.addEventListener("blur",p),ce.setActiveIndex(b),y=d.target,X=y.getBoundingClientRect(),k=[A,O],I=X.left-A,X.top-O,t(7,T.style.width=`${X.width}px`,T),t(7,T.style.left=`${X.left}px`,T),t(7,T.style.top=`${X.top}px`,T),v=b,t(6,g=u[l.order[b]].title)}function c(d){let b,A;if(d instanceof TouchEvent?(b=d.touches[0].clientX,A=d.touches[0].clientY,d.preventDefault()):(b=d.clientX,A=d.clientY),S){se(b,A);return}k===null||Math.hypot(k[0]-b,k[1]-A)<Yt||(t(2,S=!0),ce.setPlaceholderIndex(v),ce.setActiveIndex(v))}function p(){window.removeEventListener("touchmove",c),window.removeEventListener("touchend",p),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",p),window.removeEventListener("drag",c),window.removeEventListener("dragend",p),window.removeEventListener("blur",p),k=null,t(8,m=!1),v=-1,I=0,ce.setPlaceholderIndex(),t(2,S=!1)}qe(()=>{h.style.setProperty("--tab-max-width",`${Se}px`),h.style.setProperty("--tab-min-width",`${Le}px`)});const F=(d,b)=>C(b,d);function D(d,b){e.$$.not_equal(u[b].title,d)&&(u[b].title=d,ye.set(u))}function $(d,b){ge[d?"unshift":"push"](()=>{E[b]=d,t(5,E)})}function ee(d){ge[d?"unshift":"push"](()=>{h=d,t(4,h)})}const ue=()=>Z(i);function ze(d){ge[d?"unshift":"push"](()=>{T=d,t(7,T)})}function vt(d){ge[d?"unshift":"push"](()=>{M=d,t(9,M)})}return e.$$set=d=>{"refreshClicked"in d&&t(0,f=d.refreshClicked),"pencilClicked"in d&&t(1,_=d.pencilClicked)},e.$$.update=()=>{e.$$.dirty[0]&8&&t(11,i=l.order[l.activeIndex]),e.$$.dirty[0]&8&&t(12,o=l.order[l.placeholderIndex]),e.$$.dirty[0]&4&&(S?t(10,K=!0):setTimeout(()=>t(10,K=!1),20))},[f,_,S,l,h,E,g,T,m,M,K,i,o,u,r,G,Z,q,de,C,F,D,$,ee,ue,ze,vt]}class Pt extends Ie{constructor(n){super(),Pe(this,n,It,Dt,Xe,{refreshClicked:0,pencilClicked:1},null,[-1,-1])}}function St(e){let n,t;return{c(){n=V("div"),t=V("div"),this.h()},l(i){n=W(i,"DIV",{class:!0});var o=U(n);t=W(o,"DIV",{class:!0}),U(t).forEach(Y),o.forEach(Y),this.h()},h(){R(t,"class","quill-editor svelte-1zs6ve"),R(n,"class","quill-editor-wrapper svelte-1zs6ve"),z(n,"disabled",e[0])},m(i,o){le(i,n,o),P(n,t),e[5](t)},p(i,[o]){o&1&&z(n,"disabled",i[0])},i:pe,o:pe,d(i){i&&Y(n),e[5](null)}}}function Mt(e,n,t){let i,o;ve(e,ye,m=>t(6,i=m)),ve(e,_t,m=>t(4,o=m));let{tabID:l}=n,{disabled:u=!1}=n,r,f;const _=(m,I=300)=>{let L;return(...M)=>{clearTimeout(L),L=setTimeout(()=>{m.apply(void 0,M)},I)}};async function h(m){var K,B,G,Z;if(!r)return;const{Delta:I,Range:L}=await Ke(async()=>{const{Delta:j,Range:q}=await import("../chunks/core.CG__ofcG.js").then(Q=>Q.G);return{Delta:j,Range:q}},[],import.meta.url);if(m.undo.length>0)for(var M=0;M<m.undo.length;M++){const j=(K=m.undo[M].range)==null?void 0:K.index,q=(B=m.undo[M].range)==null?void 0:B.length,Q={delta:new I(m.undo[M].delta.ops),range:j!==void 0&&q!==void 0?new L(j,q):null};r.history.stack.undo.push(Q)}if(m.redo.length>0)for(var M=0;M<m.redo.length;M++){const q=(G=m.redo[M].range)==null?void 0:G.index,Q=(Z=m.redo[M].range)==null?void 0:Z.length,de={delta:new I(m.redo[M].delta.ops),range:q!==void 0&&Q!==void 0?new L(q,Q):null};r.history.stack.redo.push(de)}}function E(m){var I;r&&((I=r.getSelection())==null?void 0:I.length)===0&&window.open(m.target.href,"_blank")}function w(){if(!r||!i[l])return;const m=i[l].ops;r.setContents(m);const I=i[l].history;h(I)}function k(){if(!r||!i[l])return;Me(ye,i[l].ops=r.getContents().ops,i);const m=structuredClone(r.history.stack);Me(ye,i[l].history=m,i)}const v=_(k,500);function g(){if(!r)return;r.formatText(0,r.getLength(),"link",!1,"api");const m=r.getText(),I=/https?:\/\/\S+/gi,L=m.matchAll(I);for(const B of L)r.formatText(B.index,B[0].length,"link",B[0],"api");const M=/.+\@.+\..+/gi,K=m.matchAll(M);for(const B of K)r.formatText(B.index,B[0].length,"link","mailto:"+B[0],"api");document.querySelectorAll(".ql-editor a").forEach(B=>{B.addEventListener("click",E)})}const y=_(g,500);function X(m,I,L){if(L==="user"){const M=r.getText().split(`
`)[0].trim();Me(ye,i[l].title=M===""?"Untitled":M,i),y(),v()}}async function T(){const{default:m}=await Ke(async()=>{const{default:I}=await import("../chunks/quill.Bk4jDS0q.js");return{default:I}},__vite__mapDeps([0,1]),import.meta.url);t(3,r=new m(f,{formats:["bold","italic","underline","strike","code","link"],placeholder:"Enter text here"})),w(),g(),r.on("text-change",X),r.keyboard.addBinding({key:"/",altKey:!0},()=>{r.format("code",!r.getFormat().code)}),r.keyboard.addBinding({key:"-",altKey:!0},()=>{r.format("strike",!r.getFormat().strike)})}qe(()=>{T()});function S(m){ge[m?"unshift":"push"](()=>{f=m,t(1,f)})}return e.$$set=m=>{"tabID"in m&&t(2,l=m.tabID),"disabled"in m&&t(0,u=m.disabled)},e.$$.update=()=>{e.$$.dirty&9&&(u?r==null||r.disable():r==null||r.enable()),e.$$.dirty&24&&(r==null||r.root.setAttribute("spellcheck",o.spellCheck.toString()))},[u,f,l,r,o,S]}class Ht extends Ie{constructor(n){super(),Pe(this,n,Mt,St,Xe,{tabID:2,disabled:0})}}const $e=500,At=300,et=500,Rt=300;class Bt{constructor(){N(this,"isMoving",!1);N(this,"isLongclick",!1);N(this,"button",0);N(this,"lastX",0);N(this,"lastY",0);N(this,"consecutiveClicks",0);N(this,"lastMouseupTime",0);N(this,"activeElement",null);this.reset()}reset(){this.isMoving=!1,this.isLongclick=!1,this.button=0,this.lastX=0,this.lastY=0,this.consecutiveClicks=0,this.lastMouseupTime=0,this.activeElement=null}}class Ot{constructor(){N(this,"isDragging",!1);N(this,"isPinching",!1);N(this,"isLongpressed",!1);N(this,"consecutiveTaps",0);N(this,"lastTouchendTime",0);N(this,"lastCenterX",0);N(this,"lastCenterY",0);N(this,"identifier",0);N(this,"x",0);N(this,"y",0);N(this,"hypotenuse",0);N(this,"activeElement",null);this.reset()}reset(){this.isDragging=!1,this.isPinching=!1,this.isLongpressed=!1,this.consecutiveTaps=0,this.lastTouchendTime=0,this.lastCenterX=0,this.lastCenterY=0,this.identifier=0,this.x=0,this.y=0,this.hypotenuse=0,this.activeElement=null}}let fe=[],a=new Bt,s=new Ot;const x=(e,n)=>{e!=null&&e.dispatchEvent(new CustomEvent("gesture",{detail:n,bubbles:!1,cancelable:!1}))},at=e=>{a.reset(),s.reset(),a.lastMouseupTime=Date.now(),window.removeEventListener("mousemove",Re),window.removeEventListener("mouseup",Be),window.removeEventListener("touchmove",Oe),window.removeEventListener("touchend",_e)},ct=e=>{if(window.removeEventListener("mousemove",Re),window.removeEventListener("mouseup",Be),window.removeEventListener("touchmove",Oe),window.removeEventListener("touchend",_e),a.isMoving)if(a.isMoving=!1,a.isLongclick)a.isLongclick=!1,x(a.activeElement,{event:e,name:"longclick-drag-end",x:a.lastX,y:a.lastY,dx:0,dy:0});else switch(a.button){case 0:x(a.activeElement,{event:e,name:"left-click-drag-end",x:a.lastX,y:a.lastY,dx:0,dy:0});break;case 1:x(a.activeElement,{event:e,name:"middle-click-drag-end",x:a.lastX,y:a.lastY,dx:0,dy:0});break;case 2:x(a.activeElement,{event:e,name:"right-click-drag-end",x:a.lastX,y:a.lastY,dx:0,dy:0});break}a.isLongclick&&x(a.activeElement,{event:e,name:"longclick-release",x:a.lastX,y:a.lastY,dx:0,dy:0}),a.reset(),s.isDragging&&(s.isDragging=!1,s.isLongpressed?(s.isLongpressed=!1,x(s.activeElement,{event:e,name:"longpress-drag-end",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0})):x(s.activeElement,{event:e,name:"touch-drag-end",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0})),s.isLongpressed&&x(s.activeElement,{event:e,name:"longpress-release",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0}),s.reset()},dt=e=>{x(e.target,{event:e,name:"wheel",x:e.clientX,y:e.clientY,dx:0,dy:0})},ut=e=>{},ft=e=>{document.activeElement!==e.target&&(window.addEventListener("mousemove",Re),window.addEventListener("mouseup",Be),a.activeElement=e.target,a.lastX=e.clientX,a.lastY=e.clientY,a.isMoving||(a.button=e.button),a.button===0&&window.setTimeout(()=>{Date.now()-a.lastMouseupTime>=et&&!a.isMoving&&(a.isLongclick=!0,x(a.activeElement,{event:e,name:"longclick",x:e.clientX,y:e.clientY,dx:0,dy:0}))},et))},Re=e=>{if(e.movementX===0&&e.movementY===0)return;let n=e.clientX-a.lastX,t=e.clientY-a.lastY;if(!a.isMoving)if(a.isLongclick)x(a.activeElement,{event:e,name:"longclick-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});else switch(a.button){case 0:x(a.activeElement,{event:e,name:"left-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 1:x(a.activeElement,{event:e,name:"middle-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 2:x(a.activeElement,{event:e,name:"right-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break}if(a.isMoving=!0,a.lastX=e.clientX,a.lastY=e.clientY,a.isLongclick)x(a.activeElement,{event:e,name:"longclick-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});else switch(a.button){case 0:x(a.activeElement,{event:e,name:"left-click-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});break;case 1:x(a.activeElement,{event:e,name:"middle-click-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});break;case 2:x(a.activeElement,{event:e,name:"right-click-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});break}},Be=e=>{if(window.removeEventListener("mousemove",Re),window.removeEventListener("mouseup",Be),a.lastMouseupTime=Date.now(),a.isMoving)if(a.isMoving=!1,a.isLongclick)a.isLongclick=!1,x(a.activeElement,{event:e,name:"longclick-drag-end",x:a.lastX,y:a.lastY,dx:0,dy:0});else switch(a.button){case 0:x(a.activeElement,{event:e,name:"left-click-drag-end",x:a.lastX,y:a.lastY,dx:0,dy:0});break;case 1:x(a.activeElement,{event:e,name:"middle-click-drag-end",x:a.lastX,y:a.lastY,dx:0,dy:0});break;case 2:x(a.activeElement,{event:e,name:"right-click-drag-end",x:a.lastX,y:a.lastY,dx:0,dy:0});break}else a.isLongclick||(e.button===2?x(a.activeElement,{event:e,name:"right-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):e.button===1?x(a.activeElement,{event:e,name:"middle-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):(a.consecutiveClicks===0&&x(a.activeElement,{event:e,name:"left-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),a.consecutiveClicks++,window.setTimeout(()=>{a.consecutiveClicks>1&&x(a.activeElement,{event:e,name:"double-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),a.consecutiveClicks=0},Rt)));a.isLongclick&&x(a.activeElement,{event:e,name:"longclick-release",x:e.clientX,y:e.clientY,dx:0,dy:0}),a.isLongclick=!1},gt=e=>{if(e.touches.length>1,document.activeElement!==e.target){if(e.touches.length>1){if(e.touches[0].identifier===s.identifier)return;s.isPinching=!0}window.addEventListener("touchmove",Oe,{passive:!1}),window.addEventListener("touchend",_e),window.addEventListener("touchcancel",_e),s.identifier=e.touches[0].identifier,s.x=e.touches[0].clientX,s.y=e.touches[0].clientY,s.activeElement=e.target,window.setTimeout(()=>{s.isPinching||s.isDragging||Date.now()-s.lastTouchendTime>=$e&&(s.isDragging=!1,s.isPinching=!1,s.hypotenuse=null,s.isLongpressed=!0,x(s.activeElement,{event:e,name:"longpress",x:s.x,y:s.y,dx:0,dy:0}))},$e)}},Oe=e=>{if(s.isDragging){let n=s.x,t=s.y;s.x=e.touches[0].clientX,s.y=e.touches[0].clientY;let i=s.x-n,o=s.y-t;s.isLongpressed?x(s.activeElement,{event:e,name:"longpress-dragging",x:s.x,y:s.y,dx:i,dy:o,force:e.touches[0].force}):x(s.activeElement,{event:e,name:"touch-dragging",x:s.x,y:s.y,dx:i,dy:o,force:e.touches[0].force});return}else if(!s.isLongpressed&&(s.isPinching||e.touches.length>1)){s.x=e.touches[0].clientX,s.y=e.touches[0].clientY;let n={x:e.touches[1].clientX,y:e.touches[1].clientY},t={x:(s.x+n.x)/2,y:(s.y+n.y)/2},i=Math.hypot(s.x-n.x,s.y-n.y);s.hypotenuse===null&&(s.hypotenuse=i,s.lastCenterX=t.x,s.lastCenterY=t.y,x(s.activeElement,{event:e,name:"pinch-start",x:t.x,y:t.y,dx:0,dy:0})),s.isPinching=!0;let o=i/s.hypotenuse,l=t.x-s.lastCenterX,u=t.y-s.lastCenterY;x(s.activeElement,{event:e,name:"pinching",x:t.x,y:t.y,zoom:o,dx:l,dy:u}),s.hypotenuse=i,s.lastCenterX=t.x,s.lastCenterY=t.y;return}else s.isDragging=!0,s.isLongpressed?(x(s.activeElement,{event:e,name:"longpress-drag-start",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force}),s.x=e.touches[0].clientX,s.y=e.touches[0].clientY,x(s.activeElement,{event:e,name:"longpress-dragging",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force})):(x(s.activeElement,{event:e,name:"touch-drag-start",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force}),s.x=e.touches[0].clientX,s.y=e.touches[0].clientY,x(s.activeElement,{event:e,name:"touch-dragging",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force}))},_e=e=>{s.isDragging&&e.touches.length>0&&e.touches[0].identifier===s.identifier||(s.lastTouchendTime=Date.now(),window.removeEventListener("touchmove",Oe),window.removeEventListener("touchend",_e),window.removeEventListener("touchcancel",_e),s.isDragging?(s.isDragging=!1,s.isLongpressed?(s.isLongpressed=!1,x(s.activeElement,{event:e,name:"longpress-drag-end",x:s.x,y:s.y,dx:0,dy:0})):x(s.activeElement,{event:e,name:"touch-drag-end",x:s.x,y:s.y,dx:0,dy:0})):s.isPinching?(s.isPinching=!1,s.hypotenuse=null,x(s.activeElement,{event:e,name:"pinch-end",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0})):s.isLongpressed||(s.consecutiveTaps===0&&x(s.activeElement,{event:e,name:"tap",x:s.x,y:s.y,dx:0,dy:0}),s.consecutiveTaps++,window.setTimeout(()=>{s.consecutiveTaps>1&&x(s.activeElement,{event:e,name:"double-tap",x:s.x,y:s.y,dx:0,dy:0}),s.consecutiveTaps=0},At)),s.isLongpressed&&x(s.activeElement,{event:e,name:"longpress-release",x:s.x,y:s.y,dx:0,dy:0}),s.isLongpressed=!1)};function Vt(...e){for(let n of e)fe.findIndex(t=>t===n)===-1&&(fe.length==0&&(window.addEventListener("blur",ct),window.addEventListener("focus",at)),fe.push(n),n.addEventListener("touchstart",gt,{passive:!1}),n.addEventListener("mousedown",ft,{passive:!1}),n.addEventListener("contextmenu",ut,{passive:!1}),n.addEventListener("wheel",dt,{passive:!1}))}function Wt(...e){const n=t=>{t.removeEventListener("touchstart",gt),t.removeEventListener("mousedown",ft),t.removeEventListener("contextmenu",ut),t.removeEventListener("wheel",dt)};if(e.length==0){for(let t of fe)n(t);fe=[]}else for(let t of e){let i=fe.findIndex(o=>o===t);i!==-1&&(n(t),fe.splice(i,1))}fe.length==0&&(window.removeEventListener("blur",ct),window.removeEventListener("focus",at))}function Nt(e){let n,t,i,o="LOG";return{c(){n=V("canvas"),t=ne(),i=V("div"),i.textContent=o,this.h()},l(l){n=W(l,"CANVAS",{id:!0,class:!0}),U(n).forEach(Y),t=ie(l),i=W(l,"DIV",{class:!0,"data-svelte-h":!0}),De(i)!=="svelte-rtly9t"&&(i.textContent=o),this.h()},h(){R(n,"id","canvas"),R(n,"class","svelte-1yxkvgw"),z(n,"disabled",e[0]),R(i,"class","log svelte-1yxkvgw")},m(l,u){le(l,n,u),e[10](n),le(l,t,u),le(l,i,u),e[11](i)},p(l,u){u[0]&1&&z(n,"disabled",l[0])},i:pe,o:pe,d(l){l&&(Y(n),Y(t),Y(i)),e[10](null),e[11](null)}}}function qt(e,n,t){let i,{radius:o=3}=n,{smoothness:l=2}=n,{stroke:u=5}=n,{pressureScaler:r=5}=n,{color:f="#000000"}=n,{disabled:_=!1}=n;function h(){k.clearRect(0,0,X,y),L=[]}function E(){if(L.length!=0){t(2,m.innerHTML="Undo",m),L.pop(),k.clearRect(0,0,X,y);for(let c=0;c<L.length;c++)q(L[c])}}let w,k,v={x:0,y:0},g=0,y=0,X=0,T,S=!1,m,I,L=[];function M(){w&&(Vt(w),window.addEventListener("keydown",J),console.log("drawing enabled"))}function K(){w&&(Wt(w),window.removeEventListener("keydown",J),console.log("drawing disabled"))}const B=(c,p,F,D)=>{var $=F-c,ee=D-p;return Math.sqrt($*$+ee*ee)},G=(c,p=300)=>{let F;return(...D)=>{clearTimeout(F),F=setTimeout(()=>{c.apply(void 0,D)},p)}};function Z(c,p){let F=w.getBoundingClientRect();return{x:(c-F.left)*T,y:(p-F.top)*T}}function j(){console.log("resizing"),se(),T=window.devicePixelRatio;let c=w.getBoundingClientRect();y=c.height*T,X=c.width*T,t(1,w.width=X,w),t(1,w.height=y,w);for(let p=0;p<L.length;p++)q(L[p])}function q(c){k.lineWidth=c.lineWidths[0],k.lineCap="round",k.strokeStyle=c.color,k.beginPath(),k.moveTo(c.points[0].x,c.points[0].y),k.stroke();for(let p=0;p<c.points.length;p++)k.lineWidth=c.lineWidths[p],k.quadraticCurveTo(c.points[p].x,c.points[p].y,c.ctrlPoints[p].x,c.ctrlPoints[p].y),k.stroke(),k.beginPath(),k.moveTo(c.ctrlPoints[p].x,c.ctrlPoints[p].y)}function Q(c,p,F){S=!0,v=Z(c,p),F!==void 0&&F>0?g=Math.log(F+1)*r*i:g=i,k.lineWidth=g,k.lineCap="round",k.strokeStyle=f,k.beginPath(),k.moveTo(v.x,v.y),k.stroke(),I={points:[],ctrlPoints:[],lineWidths:[],color:f}}function de(c,p,F){if(!S)return;let D=Z(c,p);if(o>0){if(B(D.x,D.y,v.x,v.y)<=o)return;let ue=Math.sqrt(D.x*D.x+D.y*D.y-2*D.x*v.x+v.x*v.x-2*D.y*v.y+v.y*v.y);if(D={x:D.x+o*((v.x-D.x)/ue),y:D.y+o*((v.y-D.y)/ue)},B(v.x,v.y,D.x,D.y)<=l)return}let $=(v.x+D.x)/2,ee=(v.y+D.y)/2;F!==void 0&&F>0&&(g=Math.log(F+1)*r*i*.2+g*.8),k.lineWidth=g,k.quadraticCurveTo(v.x,v.y,$,ee),k.stroke(),k.beginPath(),k.moveTo($,ee),I.points.push(v),I.ctrlPoints.push({x:$,y:ee}),I.lineWidths.push(g),v=D}function se(){S&&L.push(I),S=!1}function J(c){c.ctrlKey&&c.key=="z"&&E(),c.preventDefault()}qe(()=>{k=w.getContext("2d"),k.imageSmoothingEnabled=!1,w.addEventListener("gesture",p=>{switch(p.detail.name){case"left-click-drag-start":case"touch-drag-start":Q(p.detail.x,p.detail.y,p.detail.force);break;case"left-click-dragging":case"touch-dragging":p.detail.force>0&&t(2,m.innerHTML=p.detail.force,m),de(p.detail.x,p.detail.y,p.detail.force);break;case"left-click-drag-end":case"touch-drag-end":se();break}}),new ResizeObserver(G(j,0)).observe(w),t(0,_)});function H(c){ge[c?"unshift":"push"](()=>{w=c,t(1,w)})}function C(c){ge[c?"unshift":"push"](()=>{m=c,t(2,m)})}return e.$$set=c=>{"radius"in c&&t(3,o=c.radius),"smoothness"in c&&t(4,l=c.smoothness),"stroke"in c&&t(5,u=c.stroke),"pressureScaler"in c&&t(6,r=c.pressureScaler),"color"in c&&t(7,f=c.color),"disabled"in c&&t(0,_=c.disabled)},e.$$.update=()=>{e.$$.dirty[0]&32&&(i=Math.max(u,1)),e.$$.dirty[0]&1&&(_?K():M())},[_,w,m,o,l,u,r,f,h,E,H,C]}class Ft extends Ie{constructor(n){super(),Pe(this,n,qt,Nt,Xe,{radius:3,smoothness:4,stroke:5,pressureScaler:6,color:7,disabled:0,clear:8,undo:9},null,[-1,-1])}get clear(){return this.$$.ctx[8]}get undo(){return this.$$.ctx[9]}}function tt(e,n,t){const i=e.slice();return i[4]=n[t],i}function Ut(e){let n,t;return n=new Tt({}),{c(){be(n.$$.fragment)},l(i){we(n.$$.fragment,i)},m(i,o){ke(n,i,o),t=!0},p:pe,i(i){t||(re(n.$$.fragment,i),t=!0)},o(i){oe(n.$$.fragment,i),t=!1},d(i){xe(n,i)}}}function zt(e){let n,t,i,o,l,u=[],r=new Map,f,_,h,E;t=new Pt({props:{refreshClicked:Et.loadFromFirestore}});let w=Ae(Object.keys(e[3]));const k=v=>v[4];for(let v=0;v<w.length;v+=1){let g=tt(e,w,v),y=k(g);r.set(y,u[v]=nt(y,g))}return h=new Ft({props:{color:Zt,stroke:Kt,radius:jt,smoothness:Qt,disabled:e[0].activeTool!=="pencil"}}),{c(){n=V("div"),be(t.$$.fragment),i=ne(),o=V("div"),l=V("div");for(let v=0;v<u.length;v+=1)u[v].c();f=ne(),_=V("div"),be(h.$$.fragment),this.h()},l(v){n=W(v,"DIV",{class:!0});var g=U(n);we(t.$$.fragment,g),i=ie(g),o=W(g,"DIV",{class:!0});var y=U(o);l=W(y,"DIV",{class:!0});var X=U(l);for(let S=0;S<u.length;S+=1)u[S].l(X);X.forEach(Y),f=ie(y),_=W(y,"DIV",{class:!0});var T=U(_);we(h.$$.fragment,T),T.forEach(Y),y.forEach(Y),g.forEach(Y),this.h()},h(){R(l,"class","editor-container svelte-1w5t1su"),R(_,"class","drawing-container svelte-1w5t1su"),z(_,"disabled",e[0].activeTool!=="pencil"),R(o,"class","canvas-container svelte-1w5t1su"),R(n,"class","page-container svelte-1w5t1su")},m(v,g){le(v,n,g),ke(t,n,null),P(n,i),P(n,o),P(o,l);for(let y=0;y<u.length;y+=1)u[y]&&u[y].m(l,null);P(o,f),P(o,_),ke(h,_,null),E=!0},p(v,g){g&10&&(w=Ae(Object.keys(v[3])),Fe(),u=st(u,g,k,1,v,w,r,l,lt,nt,null,tt),Ue());const y={};g&1&&(y.disabled=v[0].activeTool!=="pencil"),h.$set(y),(!E||g&1)&&z(_,"disabled",v[0].activeTool!=="pencil")},i(v){if(!E){re(t.$$.fragment,v);for(let g=0;g<w.length;g+=1)re(u[g]);re(h.$$.fragment,v),E=!0}},o(v){oe(t.$$.fragment,v);for(let g=0;g<u.length;g+=1)oe(u[g]);oe(h.$$.fragment,v),E=!1},d(v){v&&Y(n),xe(t);for(let g=0;g<u.length;g+=1)u[g].d();xe(h)}}}function nt(e,n){let t,i,o;return i=new Ht({props:{disabled:n[4]!==n[1],tabID:n[4]}}),{key:e,first:null,c(){t=He(),be(i.$$.fragment),this.h()},l(l){t=He(),we(i.$$.fragment,l),this.h()},h(){this.first=t},m(l,u){le(l,t,u),ke(i,l,u),o=!0},p(l,u){n=l;const r={};u&10&&(r.disabled=n[4]!==n[1]),u&8&&(r.tabID=n[4]),i.$set(r)},i(l){o||(re(i.$$.fragment,l),o=!0)},o(l){oe(i.$$.fragment,l),o=!1},d(l){l&&Y(t),xe(i,l)}}}function Gt(e){let n,t,i,o;const l=[zt,Ut],u=[];function r(f,_){return f[2].currentUser&&!f[2].isLoading?0:1}return n=r(e),t=u[n]=l[n](e),{c(){t.c(),i=He()},l(f){t.l(f),i=He()},m(f,_){u[n].m(f,_),le(f,i,_),o=!0},p(f,[_]){let h=n;n=r(f),n===h?u[n].p(f,_):(Fe(),oe(u[h],1,1,()=>{u[h]=null}),Ue(),t=u[n],t?t.p(f,_):(t=u[n]=l[n](f),t.c()),re(t,1),t.m(i.parentNode,i))},i(f){o||(re(t),o=!0)},o(f){oe(t),o=!1},d(f){f&&Y(i),u[n].d(f)}}}let Kt=10,jt=3,Qt=2,Zt="#429A53";function Jt(e,n,t){let i,o,l,u;return ve(e,Ne,r=>t(0,o=r)),ve(e,rt,r=>t(2,l=r)),ve(e,ye,r=>t(3,u=r)),e.$$.update=()=>{e.$$.dirty&1&&t(1,i=o.order[o.activeIndex])},[o,i,l,u]}class an extends Ie{constructor(n){super(),Pe(this,n,Jt,Gt,Xe,{})}}export{an as component};
