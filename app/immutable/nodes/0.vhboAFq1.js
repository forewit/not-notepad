import{s as H,v as B,w as G,x as K,y as Q,c as g,o as X,n as M,a as F,d as ne}from"../chunks/scheduler.CIGC0wka.js";import{S as j,i as x,H as re,s as A,D as oe,h as L,j as D,a as E,t as k,g as p,e as T,c as P,v as ie,w as $,A as _,p as Y,E as le,q as Z,k as I,r as ee,u as te,d as R}from"../chunks/index.Dl2TOe6M.js";import{s as S,a as y,c as ce,d as q,e as U,g as ue,h as me,b as V,f as fe}from"../chunks/firebaseStore.CIVrer5I.js";import{t as z,a as J,m as de}from"../chunks/tabsStore.CYz402sz.js";import{g as pe}from"../chunks/entry.DiMPd6Vt.js";import{b as C}from"../chunks/paths.DhWAZ8dW.js";import{t as N}from"../chunks/themes.BTx5Q4mv.js";const he=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,ge=!0,be="always",Le=Object.freeze(Object.defineProperty({__proto__:null,prerender:ge,trailingSlash:be},Symbol.toStringTag,{value:"Module"}));function _e(n){let e,o,t;const r=n[3].default,s=B(r,n,n[2],null);return{c(){e=new re(!1),o=A(),s&&s.c(),this.h()},l(a){e=oe(a,!1),o=L(a),s&&s.l(a),this.h()},h(){e.a=o},m(a,i){e.m(n[0],a,i),D(a,o,i),s&&s.m(a,i),t=!0},p(a,[i]){(!t||i&1)&&e.p(a[0]),s&&s.p&&(!t||i&4)&&G(s,r,a,a[2],t?Q(r,a[2],i,null):K(a[2]),null)},i(a){t||(E(s,a),t=!0)},o(a){k(s,a),t=!1},d(a){a&&(e.d(),p(o)),s&&s.d(a)}}}function ve(n,e,o){let t,r;g(n,S,c=>o(1,r=c));let{$$slots:s={},$$scope:a}=e;function i(c){const m=N.find(h=>h.name===c);return m?`<style>
    :root {
    --bg: ${m.bg};
    --bg-alt: ${m.bgAlt};
    --main: ${m.main};
    --caret: ${m.caret};
    --error: ${m.error};
    --sub: ${m.sub};
    --text: ${m.text};
    }
    </style>`:""}function u(){var m;const c=N.find(h=>h.name===r.theme);c&&((m=document.querySelector('meta[name="theme-color"]'))==null||m.setAttribute("content",c.bg))}return X(()=>{i(r.theme),S.subscribe(u)}),n.$$set=c=>{"$$scope"in c&&o(2,a=c.$$scope)},n.$$.update=()=>{n.$$.dirty&2&&o(0,t=i(r.theme))},[t,r,a,s]}class ye extends j{constructor(e){super(),x(this,e,ve,_e,H,{})}}function Se(n){let e,o=`<span class="status-icon svelte-1mx6eh7" style="-webkit-mask: url(${C}/images/svg/double-checkmark.svg) no-repeat center / contain; mask: url(${C}/images/svg/double-checkmark.svg) no-repeat center / contain;"></span>`;return{c(){e=T("div"),e.innerHTML=o,this.h()},l(t){e=P(t,"DIV",{class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-jbp3id"&&(e.innerHTML=o),this.h()},h(){$(e,"class","status svelte-1mx6eh7"),_(e,"saving",n[0].savingStatus==="saving"),_(e,"saved",n[0].savingStatus==="saved"),_(e,"error",n[0].savingStatus==="error")},m(t,r){D(t,e,r)},p(t,[r]){r&1&&_(e,"saving",t[0].savingStatus==="saving"),r&1&&_(e,"saved",t[0].savingStatus==="saved"),r&1&&_(e,"error",t[0].savingStatus==="error")},i:M,o:M,d(t){t&&p(e)}}}function $e(n,e,o){let t;return g(n,y,r=>o(0,t=r)),[t]}class we extends j{constructor(e){super(),x(this,e,$e,Se,H,{})}}const{document:W}=he;function Ee(n){let e,o,t,r,s;const a=n[3].default,i=B(a,n,n[5],null);return r=new we({}),{c(){e=T("div"),i&&i.c(),o=A(),t=T("div"),Y(r.$$.fragment),this.h()},l(u){e=P(u,"DIV",{class:!0});var c=R(e);i&&i.l(c),o=L(c),t=P(c,"DIV",{class:!0});var m=R(t);Z(r.$$.fragment,m),m.forEach(p),c.forEach(p),this.h()},h(){$(t,"class","sync-status svelte-s472a6"),$(e,"class","layout-container svelte-s472a6")},m(u,c){D(u,e,c),i&&i.m(e,null),I(e,o),I(e,t),ee(r,t,null),n[4](e),s=!0},p(u,c){i&&i.p&&(!s||c&32)&&G(i,a,u,u[5],s?Q(a,u[5],c,null):K(u[5]),null)},i(u){s||(E(i,u),E(r.$$.fragment,u),s=!0)},o(u){k(i,u),k(r.$$.fragment,u),s=!1},d(u){u&&p(e),i&&i.d(u),te(r),n[4](null)}}}function ke(n){let e,o,t,r;return t=new ye({props:{$$slots:{default:[Ee]},$$scope:{ctx:n}}}),{c(){e=T("meta"),o=A(),Y(t.$$.fragment),this.h()},l(s){const a=le("svelte-1xk05yi",W.head);e=P(a,"META",{name:!0,content:!0}),a.forEach(p),o=L(s),Z(t.$$.fragment,s),this.h()},h(){$(e,"name","viewport"),$(e,"content","width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover")},m(s,a){I(W.head,e),D(s,o,a),ee(t,s,a),r=!0},p(s,[a]){const i={};a&33&&(i.$$scope={dirty:a,ctx:s}),t.$set(i)},i(s){r||(E(t.$$.fragment,s),r=!0)},o(s){k(t.$$.fragment,s),r=!1},d(s){s&&p(o),p(e),te(t,s)}}}function Te(){switch(screen.orientation.type){case"portrait-primary":document.documentElement.style.setProperty("--safe-area-top","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-primary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-secondary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","env(safe-area-inset-right)");break}}function Pe(n,e,o){let t,r,s,a,i;g(n,S,l=>o(7,t=l)),g(n,V,l=>o(8,r=l)),g(n,y,l=>o(2,s=l)),g(n,de,l=>o(9,a=l)),g(n,z,l=>o(10,i=l));let{$$slots:u={},$$scope:c}=e,m=!0,h;function O(){if(m)return;let l={};Object.entries(i).forEach(([d,f])=>{l[d]=JSON.stringify(f)});const v={activeIndex:a.activeIndex,settings:t,tabs:l};y.update(d=>({...d,data:v})),fe.publish()}z.subscribe(O),S.subscribe(O);function se(l){l&&Object.entries(l).forEach(([v,d])=>{try{J.newTabFromString(v,d)}catch(f){console.warn("Failed to parse tab!",d,f);return}})}let w=!1;X(()=>{screen.orientation.addEventListener("change",Te),ce.onAuthStateChanged(async l=>{if(!l){y.update(b=>({...b,isLoading:!1,currentUser:l})),o(1,w=!0);return}const v=q(U,"users",l.uid),d=await ue(v);let f={tabs:{},activeIndex:0,settings:{theme:"Canvas",spellCheck:!0}};if(d.exists())console.log("Fetching firestore user doc..."),f=d.data();else{console.log("Creating firestore user doc...");const b=q(U,"users",l.uid);await me(b,f,{merge:!0})}se(f.tabs),J.setActiveIndex(f.activeIndex),F(S,t=f.settings,t),y.update(b=>({...b,isLoading:!1,currentUser:l,data:f})),o(1,w=!0),m=!1})});function ae(l){ne[l?"unshift":"push"](()=>{h=l,o(0,h)})}return n.$$set=l=>{"$$scope"in l&&o(5,c=l.$$scope)},n.$$.update=()=>{n.$$.dirty&6&&!s.currentUser&&w&&(F(V,r=window.location.pathname.slice(C.length),r),pe(C+"/login"))},[h,w,s,u,ae,c]}class Oe extends j{constructor(e){super(),x(this,e,Pe,ke,H,{})}}export{Oe as component,Le as universal};
