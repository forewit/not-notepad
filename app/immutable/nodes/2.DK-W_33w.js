const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/quill.Bk4jDS0q.js","../chunks/core.CG__ofcG.js"])))=>i.map(i=>d[i]);
var pt=Object.defineProperty;var wt=(e,n,t)=>n in e?pt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var W=(e,n,t)=>wt(e,typeof n!="symbol"?n+"":n,t);import{s as He,n as be,r as dt,e as Se,c as ue,o as Qe,d as he,z as kt,A as _t,a as Me,B as xt}from"../chunks/scheduler.CNrmCPBX.js";import{S as Ae,i as Re,e as R,b as Et,c as B,d as F,f as Tt,g as X,w as H,A as j,j as fe,k as Y,x as ye,G as qe,l as Lt,s as ne,p as Te,h as ie,v as Pe,q as Le,z as Ze,r as De,o as Oe,n as Ne,a as se,t as le,u as Ce,I as Dt,m as xe}from"../chunks/index.SQS7u6L1.js";import{e as _e,u as ze,o as je}from"../chunks/each.Ug6gzH50.js";import{b as te}from"../chunks/paths.DEYILW0O.js";import{m as Ge,t as de,a as ut,d as ce,s as Ct,f as It}from"../chunks/firebaseStore.BY2wsGTN.js";import{_ as Je}from"../chunks/preload-helper.D6kgxu3v.js";import{S as Yt}from"../chunks/Spinner.DeVkdUsa.js";function Xt(e){let n,t,i,o,l,c;return{c(){n=R("div"),t=R("button"),i=R("span"),o=Et(e[0]),this.h()},l(r){n=B(r,"DIV",{class:!0});var g=F(n);t=B(g,"BUTTON",{class:!0,draggable:!0});var _=F(t);i=B(_,"SPAN",{class:!0});var v=F(i);o=Tt(v,e[0]),v.forEach(X),_.forEach(X),g.forEach(X),this.h()},h(){H(i,"class","title svelte-1aycx2r"),H(t,"class","tab svelte-1aycx2r"),H(t,"draggable","true"),j(t,"active",e[1]),H(n,"class","tab-container svelte-1aycx2r"),j(n,"preventHover",e[2])},m(r,g){fe(r,n,g),Y(n,t),Y(t,i),Y(i,o),l||(c=[ye(t,"mousedown",qe(function(){Se(e[3])&&e[3].apply(this,arguments)})),ye(t,"touchstart",qe(function(){Se(e[3])&&e[3].apply(this,arguments)})),ye(t,"dragstart",qe(function(){Se(e[4])&&e[4].apply(this,arguments)}))],l=!0)},p(r,[g]){e=r,g&1&&Lt(o,e[0]),g&2&&j(t,"active",e[1]),g&4&&j(n,"preventHover",e[2])},i:be,o:be,d(r){r&&X(n),l=!1,dt(c)}}}function Pt(e,n,t){let{title:i=""}=n,{active:o=!1}=n,{preventHover:l=!1}=n,{onPointerdown:c=g=>{}}=n,{onDragstart:r=g=>{}}=n;return e.$$set=g=>{"title"in g&&t(0,i=g.title),"active"in g&&t(1,o=g.active),"preventHover"in g&&t(2,l=g.preventHover),"onPointerdown"in g&&t(3,c=g.onPointerdown),"onDragstart"in g&&t(4,r=g.onDragstart)},[i,o,l,c,r]}class ft extends Ae{constructor(n){super(),Re(this,n,Pt,Xt,He,{title:0,active:1,preventHover:2,onPointerdown:3,onDragstart:4})}}function me(e){return e<.5?4*e*e*e:.5*Math.pow(2*e-2,3)+1}const $e=(e,n)=>{const{duration:t=300,easing:i=me,onEnd:o=()=>{},onStep:l=()=>{},css:c}=n;let r;function g(_){if(!e){console.warn("Cannot find element to animate");return}r===void 0&&(r=_);const v=i((_-r)/t),E=1-v;v<1?(e.style.cssText=c(v,E),l(v,E),requestAnimationFrame(g)):(e.style.cssText="",o())}requestAnimationFrame(g)},Ue=e=>{const{duration:n=300,easing:t=me,onEnd:i=()=>{},onStep:o=()=>{}}=e;let l;function c(r){l===void 0&&(l=r);const g=t((r-l)/n),_=1-g;g<1?(o(g,_),requestAnimationFrame(c)):i()}requestAnimationFrame(c)};function et(e,n,t){const i=e.slice();return i[43]=n[t],i[44]=n,i[45]=t,i}function tt(e,n){let t,i,o,l,c=n[45],r,g,_;function v(...m){return n[20](n[45],...m)}function E(m){n[21](m,n[43])}let C={active:n[11]==n[43],preventHover:n[10],onPointerdown:v,onDragstart:n[18]};n[13][n[43]].title!==void 0&&(C.title=n[13][n[43]].title),i=new ft({props:C}),he.push(()=>Dt(i,"title",E));const V=()=>n[22](t,c),U=()=>n[22](null,c);return{key:e,first:null,c(){t=R("div"),Te(i.$$.fragment),l=ne(),this.h()},l(m){t=B(m,"DIV",{class:!0});var y=F(t);Le(i.$$.fragment,y),l=ie(y),y.forEach(X),this.h()},h(){H(t,"class","tab-container svelte-11x45ky"),j(t,"placeholder",n[12]==n[43]),this.first=t},m(m,y){fe(m,t,y),De(i,t,null),Y(t,l),V(),r=!0,g||(_=kt(n[17].call(null,t)),g=!0)},p(m,y){n=m;const u={};y[0]&2056&&(u.active=n[11]==n[43]),y[0]&1024&&(u.preventHover=n[10]),y[0]&8&&(u.onPointerdown=v),!o&&y[0]&8200&&(o=!0,u.title=n[13][n[43]].title,_t(()=>o=!1)),i.$set(u),c!==n[45]&&(U(),c=n[45],V()),(!r||y[0]&4104)&&j(t,"placeholder",n[12]==n[43])},i(m){r||(se(i.$$.fragment,m),r=!0)},o(m){le(i.$$.fragment,m),r=!1},d(m){m&&X(t),Ce(i),U(),g=!1,_()}}}function St(e){let n,t,i,o=[],l=new Map,c,r,g,_=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/plus.svg) no-repeat center / contain; mask: url(${te}/images/svg/plus.svg) no-repeat center / contain;"></span>`,v,E,C,V=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/trash.svg) no-repeat center / contain; mask: url(${te}/images/svg/trash.svg) no-repeat center / contain;"></span>`,U,m,y,u,f,w,b=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/pencil.svg) no-repeat center / contain; mask: url(${te}/images/svg/pencil.svg) no-repeat center / contain;"></span>`,I,x,L=`<span class="button-icon svelte-11x45ky" style="-webkit-mask: url(${te}/images/svg/gear.svg) no-repeat center / contain; mask: url(${te}/images/svg/gear.svg) no-repeat center / contain;"></span>`,z,P,N,$,K,q,Q,ae,re=_e(e[3].order);const ee=S=>S[43];for(let S=0;S<re.length;S+=1){let D=et(e,re,S),M=ee(D);l.set(M,o[S]=tt(M,D))}return N=new ft({props:{title:e[6],active:!e[8],preventHover:!0}}),{c(){n=R("div"),t=R("div"),i=R("div");for(let S=0;S<o.length;S+=1)o[S].c();c=ne(),r=R("div"),g=R("button"),g.innerHTML=_,v=ne(),E=R("div"),C=R("button"),C.innerHTML=V,U=ne(),m=R("button"),y=R("span"),f=ne(),w=R("button"),w.innerHTML=b,I=ne(),x=R("a"),x.innerHTML=L,z=ne(),P=R("div"),Te(N.$$.fragment),$=ne(),K=R("div"),this.h()},l(S){n=B(S,"DIV",{class:!0});var D=F(n);t=B(D,"DIV",{class:!0});var M=F(t);i=B(M,"DIV",{class:!0});var Z=F(i);for(let h=0;h<o.length;h+=1)o[h].l(Z);Z.forEach(X),c=ie(M),r=B(M,"DIV",{class:!0});var ve=F(r);g=B(ve,"BUTTON",{class:!0,"data-svelte-h":!0}),Pe(g)!=="svelte-g0ls06"&&(g.innerHTML=_),ve.forEach(X),v=ie(M),E=B(M,"DIV",{class:!0});var J=F(E);C=B(J,"BUTTON",{class:!0,"data-svelte-h":!0}),Pe(C)!=="svelte-hhcvrt"&&(C.innerHTML=V),U=ie(J),m=B(J,"BUTTON",{class:!0});var pe=F(m);y=B(pe,"SPAN",{class:!0,style:!0}),F(y).forEach(X),pe.forEach(X),f=ie(J),w=B(J,"BUTTON",{class:!0,"data-svelte-h":!0}),Pe(w)!=="svelte-4n2i7g"&&(w.innerHTML=b),I=ie(J),x=B(J,"A",{class:!0,href:!0,"data-svelte-h":!0}),Pe(x)!=="svelte-8w27ao"&&(x.innerHTML=L),J.forEach(X),z=ie(M),P=B(M,"DIV",{class:!0});var we=F(P);Le(N.$$.fragment,we),we.forEach(X),M.forEach(X),$=ie(D),K=B(D,"DIV",{class:!0}),F(K).forEach(X),D.forEach(X),this.h()},h(){H(i,"class","tabs svelte-11x45ky"),H(g,"class","button svelte-11x45ky"),H(r,"class","new-tab-container svelte-11x45ky"),H(C,"class","close button svelte-11x45ky"),H(y,"class","button-icon svelte-11x45ky"),Ze(y,"-webkit-mask","url("+te+"/images/svg/refresh.svg) no-repeat center / contain"),Ze(y,"mask","url("+te+"/images/svg/refresh.svg) no-repeat center / contain"),H(m,"class","refresh button svelte-11x45ky"),m.disabled=u=e[14].savingStatus==="saving",H(w,"class","pencil button svelte-11x45ky"),j(w,"selected",e[3].activeTool==="pencil"),H(x,"class","button svelte-11x45ky"),H(x,"href",te+"/settings"),H(E,"class","settings-container svelte-11x45ky"),H(P,"class","clone svelte-11x45ky"),j(P,"dragging",e[2]),H(t,"class","tabbar svelte-11x45ky"),H(K,"class","divider svelte-11x45ky"),H(n,"class","svelte-11x45ky")},m(S,D){fe(S,n,D),Y(n,t),Y(t,i);for(let M=0;M<o.length;M+=1)o[M]&&o[M].m(i,null);e[23](i),Y(t,c),Y(t,r),Y(r,g),Y(t,v),Y(t,E),Y(E,C),Y(E,U),Y(E,m),Y(m,y),Y(E,f),Y(E,w),Y(E,I),Y(E,x),Y(t,z),Y(t,P),De(N,P,null),e[25](P),Y(n,$),Y(n,K),e[26](n),q=!0,Q||(ae=[ye(g,"click",e[15]),ye(C,"click",e[24]),ye(m,"click",function(){Se(e[0])&&e[0].apply(this,arguments)}),ye(w,"click",function(){Se(e[1])&&e[1].apply(this,arguments)})],Q=!0)},p(S,D){e=S,D[0]&801832&&(re=_e(e[3].order),Oe(),o=ze(o,D,ee,1,e,re,l,i,je,tt,null,et),Ne()),(!q||D[0]&16384&&u!==(u=e[14].savingStatus==="saving"))&&(m.disabled=u),(!q||D[0]&8)&&j(w,"selected",e[3].activeTool==="pencil");const M={};D[0]&64&&(M.title=e[6]),D[0]&256&&(M.active=!e[8]),N.$set(M),(!q||D[0]&4)&&j(P,"dragging",e[2])},i(S){if(!q){for(let D=0;D<re.length;D+=1)se(o[D]);se(N.$$.fragment,S),q=!0}},o(S){for(let D=0;D<o.length;D+=1)le(o[D]);le(N.$$.fragment,S),q=!1},d(S){S&&X(n);for(let D=0;D<o.length;D+=1)o[D].d();e[23](null),Ce(N),e[25](null),e[26](null),Q=!1,dt(ae)}}}const Mt=12,Be=200,Ye=32,Xe=200,Ht=1600,nt=.3;function At(e,n,t){let i,o,l,c,r;ue(e,Ge,a=>t(3,l=a)),ue(e,de,a=>t(13,c=a)),ue(e,ut,a=>t(14,r=a));let{refreshClicked:g=()=>{}}=n,{pencilClicked:_=()=>{Me(Ge,l.activeTool=l.activeTool==="pencil"?void 0:"pencil",l)}}=n,v,E=[],C=0,V=null,U=-1,m="",y,u,f,w=!1,b=!1,I=0,x=0,L,z=!1;const P=(a,p=300)=>{let T;return(...A)=>{clearTimeout(T),T=setTimeout(()=>{a.apply(void 0,A)},p)}};function N(){ce.newTab()}const $=a=>{const p=l.order.findIndex(T=>T===a);if(p<0||!E[p]){console.warn("Cannot close tab!");return}C=E[p].getBoundingClientRect().width,p<l.order.length-1&&(v.style.setProperty("--tab-max-width",`${C}px`),K()),p==l.activeIndex&&(p==l.order.length-1?ce.setActiveIndex(p-1):ce.setActiveIndex(p+1)),Ue({duration:Xe,easing:me,onStep:(T,A)=>{p==0?t(4,v.style.gridTemplateColumns=`minmax(${A*Ye}px, ${A*C}px)`,v):t(4,v.style.gridTemplateColumns=`repeat(${p}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${A*Ye}px, ${A*C}px)`,v)},onEnd:()=>{t(4,v.style.gridTemplateColumns="",v),ce.removeTab(a)}})},K=P(()=>{v&&(v.style.setProperty("--tab-max-width",`${Be}px`),Ue({duration:Xe,easing:me,onStep:(a,p)=>{v.style.setProperty("--tab-max-width",`${C+a*(Be-C)}px`)},onEnd:()=>{v.style.setProperty("--tab-max-width",`${Be}px`)}}))},Ht);function q(a){if(!v)return;const p=a.getBoundingClientRect().width;Ue({duration:Xe,easing:me,onStep:(T,A)=>{l.order.length==1?t(4,v.style.gridTemplateColumns=`minmax(${T*Ye}px, ${T*p}px)`,v):t(4,v.style.gridTemplateColumns=`repeat(${l.order.length-1}, minmax(var(--tab-min-width), var(--tab-max-width))) minmax(${T*Ye}px, ${T*p}px)`,v),t(4,v.scrollLeft=v.scrollWidth,v)},onEnd:()=>{t(4,v.style.gridTemplateColumns="",v)}})}const Q=(a,p)=>{const T=E[0].getBoundingClientRect().width;ce.moveTab(a,p,()=>{if(a>p)for(let A=p;A<a;A++)$e(E[A],{duration:Xe,easing:me,css:(ke,oe)=>`transform: translateX(-${oe*T}px);`});if(a<p)for(let A=p;A>a;A--)$e(E[A],{duration:Xe,easing:me,css:(ke,oe)=>`transform: translateX(${oe*T}px);`})})};function ae(a){!a.target||!a.dataTransfer||(a.dataTransfer.setData("text/plain",i),a.dataTransfer.setDragImage(new Image,0,0))}function re(a,p){if(a==0&&p==0){t(7,f.style.left="-1000px",f),t(7,f.style.top="-1000px",f);return}let T=L.getBoundingClientRect();if(a<T.left||a>T.right||p<T.top||p>T.bottom){b||(x=0),t(7,f.style.left=`${a+I}px`,f),t(7,f.style.top=`${p-u.height/2}px`,f),t(8,b=!0);return}b&&t(8,b=!1),t(7,f.style.left=`${a+I}px`,f),t(7,f.style.top=`${u.top}px`,f);const A=-v.scrollLeft,ke=E[0].getBoundingClientRect().width;let oe=-1;if(a>A+l.order.length*ke)oe=l.order.length-1;else for(let Ie=0;Ie<l.order.length;Ie++)if(a>A+Ie*ke&&a<A+(Ie+1)*ke){oe=Ie;break}a<20?(x=-nt,requestAnimationFrame(S)):a>v.clientWidth-10?(x=nt,requestAnimationFrame(S)):x=0,!(oe==-1||oe==l.placeholderIndex)&&Q(l.placeholderIndex,oe)}let ee=0;function S(a){if(!w||x==0){ee=0;return}ee==0&&(ee=a);const p=a-ee;ee=a,v.scrollBy({left:x*p}),requestAnimationFrame(S)}function D(a,p){if(!a.target)return;let T,A;a instanceof TouchEvent?(T=a.touches[0].clientX,A=a.touches[0].clientY):(T=a.clientX,A=a.clientY),window.addEventListener("touchmove",M,{passive:!1}),window.addEventListener("touchend",Z),window.addEventListener("mousemove",M),window.addEventListener("mouseup",Z),window.addEventListener("drag",M),window.addEventListener("dragend",Z),window.addEventListener("blur",Z),ce.setActiveIndex(p),y=a.target,u=y.getBoundingClientRect(),V=[T,A],I=u.left-T,u.top-A,t(7,f.style.width=`${u.width}px`,f),t(7,f.style.left=`${u.left}px`,f),t(7,f.style.top=`${u.top}px`,f),U=p,t(6,m=c[l.order[p]].title)}function M(a){let p,T;if(a instanceof TouchEvent?(p=a.touches[0].clientX,T=a.touches[0].clientY,a.preventDefault()):(p=a.clientX,T=a.clientY),w){re(p,T);return}V===null||Math.hypot(V[0]-p,V[1]-T)<Mt||(t(2,w=!0),ce.setPlaceholderIndex(U),ce.setActiveIndex(U))}function Z(){window.removeEventListener("touchmove",M),window.removeEventListener("touchend",Z),window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",Z),window.removeEventListener("drag",M),window.removeEventListener("dragend",Z),window.removeEventListener("blur",Z),V=null,t(8,b=!1),U=-1,I=0,ce.setPlaceholderIndex(),t(2,w=!1)}Qe(()=>{v.style.setProperty("--tab-max-width",`${Be}px`),v.style.setProperty("--tab-min-width",`${Ye}px`)});const ve=(a,p)=>D(p,a);function J(a,p){e.$$.not_equal(c[p].title,a)&&(c[p].title=a,de.set(c))}function pe(a,p){he[a?"unshift":"push"](()=>{E[p]=a,t(5,E)})}function we(a){he[a?"unshift":"push"](()=>{v=a,t(4,v)})}const h=()=>$(i);function O(a){he[a?"unshift":"push"](()=>{f=a,t(7,f)})}function G(a){he[a?"unshift":"push"](()=>{L=a,t(9,L)})}return e.$$set=a=>{"refreshClicked"in a&&t(0,g=a.refreshClicked),"pencilClicked"in a&&t(1,_=a.pencilClicked)},e.$$.update=()=>{e.$$.dirty[0]&8&&t(11,i=l.order[l.activeIndex]),e.$$.dirty[0]&8&&t(12,o=l.order[l.placeholderIndex]),e.$$.dirty[0]&4&&(w?t(10,z=!0):setTimeout(()=>t(10,z=!1),20))},[g,_,w,l,v,E,m,f,b,L,z,i,o,c,r,N,$,q,ae,D,ve,J,pe,we,h,O,G]}class Rt extends Ae{constructor(n){super(),Re(this,n,At,St,He,{refreshClicked:0,pencilClicked:1},null,[-1,-1])}}function Bt(e){let n,t;return{c(){n=R("div"),t=R("div"),this.h()},l(i){n=B(i,"DIV",{class:!0});var o=F(n);t=B(o,"DIV",{class:!0}),F(t).forEach(X),o.forEach(X),this.h()},h(){H(t,"class","quill-editor svelte-1zs6ve"),H(n,"class","quill-editor-wrapper svelte-1zs6ve"),j(n,"disabled",e[0])},m(i,o){fe(i,n,o),Y(n,t),e[5](t)},p(i,[o]){o&1&&j(n,"disabled",i[0])},i:be,o:be,d(i){i&&X(n),e[5](null)}}}function Ot(e,n,t){let i,o;ue(e,de,b=>t(6,i=b)),ue(e,Ct,b=>t(4,o=b));let{tabID:l}=n,{disabled:c=!1}=n,r,g;const _=(b,I=300)=>{let x;return(...L)=>{clearTimeout(x),x=setTimeout(()=>{b.apply(void 0,L)},I)}};async function v(b){var z,P,N,$;if(!r)return;const{Delta:I,Range:x}=await Je(async()=>{const{Delta:K,Range:q}=await import("../chunks/core.CG__ofcG.js").then(Q=>Q.G);return{Delta:K,Range:q}},[],import.meta.url);if(b.undo.length>0)for(var L=0;L<b.undo.length;L++){const K=(z=b.undo[L].range)==null?void 0:z.index,q=(P=b.undo[L].range)==null?void 0:P.length,Q={delta:new I(b.undo[L].delta.ops),range:K!==void 0&&q!==void 0?new x(K,q):null};r.history.stack.undo.push(Q)}if(b.redo.length>0)for(var L=0;L<b.redo.length;L++){const q=(N=b.redo[L].range)==null?void 0:N.index,Q=($=b.redo[L].range)==null?void 0:$.length,ae={delta:new I(b.redo[L].delta.ops),range:q!==void 0&&Q!==void 0?new x(q,Q):null};r.history.stack.redo.push(ae)}}function E(b){var I;r&&((I=r.getSelection())==null?void 0:I.length)===0&&window.open(b.target.href,"_blank")}function C(){if(!r||!i[l])return;const b=i[l].ops;r.setContents(b);const I=i[l].history;v(I)}function V(){if(!r||!i[l])return;Me(de,i[l].ops=r.getContents().ops,i);const b=structuredClone(r.history.stack);Me(de,i[l].history=b,i)}const U=_(V,500);function m(){if(!r)return;r.formatText(0,r.getLength(),"link",!1,"api");const b=r.getText(),I=/https?:\/\/\S+/gi,x=b.matchAll(I);for(const P of x)r.formatText(P.index,P[0].length,"link",P[0],"api");const L=/.+\@.+\..+/gi,z=b.matchAll(L);for(const P of z)r.formatText(P.index,P[0].length,"link","mailto:"+P[0],"api");document.querySelectorAll(".ql-editor a").forEach(P=>{P.addEventListener("click",E)})}const y=_(m,500);function u(b,I,x){if(x==="user"){const L=r.getText().split(`
`)[0].trim();Me(de,i[l].title=L===""?"Untitled":L,i),y(),U()}}async function f(){const{default:b}=await Je(async()=>{const{default:I}=await import("../chunks/quill.Bk4jDS0q.js");return{default:I}},__vite__mapDeps([0,1]),import.meta.url);t(3,r=new b(g,{formats:["bold","italic","underline","strike","code","link"],placeholder:"Enter text here"})),C(),m(),r.on("text-change",u),r.keyboard.addBinding({key:"/",altKey:!0},()=>{r.format("code",!r.getFormat().code)}),r.keyboard.addBinding({key:"-",altKey:!0},()=>{r.format("strike",!r.getFormat().strike)})}Qe(()=>{f()});function w(b){he[b?"unshift":"push"](()=>{g=b,t(1,g)})}return e.$$set=b=>{"tabID"in b&&t(2,l=b.tabID),"disabled"in b&&t(0,c=b.disabled)},e.$$.update=()=>{e.$$.dirty&9&&(c?r==null||r.disable():r==null||r.enable()),e.$$.dirty&24&&(r==null||r.root.setAttribute("spellcheck",o.spellCheck.toString()))},[c,g,l,r,o,w]}class Nt extends Ae{constructor(n){super(),Re(this,n,Ot,Bt,He,{tabID:2,disabled:0})}}const it=500,Vt=300,st=500,Wt=300;class Ft{constructor(){W(this,"isMoving",!1);W(this,"isLongclick",!1);W(this,"button",0);W(this,"lastX",0);W(this,"lastY",0);W(this,"consecutiveClicks",0);W(this,"lastMouseupTime",0);W(this,"activeElement",null);this.reset()}reset(){this.isMoving=!1,this.isLongclick=!1,this.button=0,this.lastX=0,this.lastY=0,this.consecutiveClicks=0,this.lastMouseupTime=0,this.activeElement=null}}class qt{constructor(){W(this,"isDragging",!1);W(this,"isPinching",!1);W(this,"isLongpressed",!1);W(this,"consecutiveTaps",0);W(this,"lastTouchendTime",0);W(this,"lastCenterX",0);W(this,"lastCenterY",0);W(this,"identifier",0);W(this,"x",0);W(this,"y",0);W(this,"hypotenuse",0);W(this,"activeElement",null);this.reset()}reset(){this.isDragging=!1,this.isPinching=!1,this.isLongpressed=!1,this.consecutiveTaps=0,this.lastTouchendTime=0,this.lastCenterX=0,this.lastCenterY=0,this.identifier=0,this.x=0,this.y=0,this.hypotenuse=0,this.activeElement=null}}let ge=[],d=new Ft,s=new qt;const k=(e,n)=>{e!=null&&e.dispatchEvent(new CustomEvent("gesture",{detail:n,bubbles:!1,cancelable:!1}))},gt=e=>{d.reset(),s.reset(),d.lastMouseupTime=Date.now(),window.removeEventListener("mousemove",Ve),window.removeEventListener("mouseup",We),window.removeEventListener("touchmove",Fe),window.removeEventListener("touchend",Ee)},ht=e=>{if(window.removeEventListener("mousemove",Ve),window.removeEventListener("mouseup",We),window.removeEventListener("touchmove",Fe),window.removeEventListener("touchend",Ee),d.isMoving)if(d.isMoving=!1,d.isLongclick)d.isLongclick=!1,k(d.activeElement,{event:e,name:"longclick-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});else switch(d.button){case 0:k(d.activeElement,{event:e,name:"left-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break;case 1:k(d.activeElement,{event:e,name:"middle-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break;case 2:k(d.activeElement,{event:e,name:"right-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break}d.isLongclick&&k(d.activeElement,{event:e,name:"longclick-release",x:d.lastX,y:d.lastY,dx:0,dy:0}),d.reset(),s.isDragging&&(s.isDragging=!1,s.isLongpressed?(s.isLongpressed=!1,k(s.activeElement,{event:e,name:"longpress-drag-end",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0})):k(s.activeElement,{event:e,name:"touch-drag-end",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0})),s.isLongpressed&&k(s.activeElement,{event:e,name:"longpress-release",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0}),s.reset()},vt=e=>{k(e.target,{event:e,name:"wheel",x:e.clientX,y:e.clientY,dx:0,dy:0})},mt=e=>{},yt=e=>{document.activeElement!==e.target&&(window.addEventListener("mousemove",Ve),window.addEventListener("mouseup",We),d.activeElement=e.target,d.lastX=e.clientX,d.lastY=e.clientY,d.isMoving||(d.button=e.button),d.button===0&&window.setTimeout(()=>{Date.now()-d.lastMouseupTime>=st&&!d.isMoving&&(d.isLongclick=!0,k(d.activeElement,{event:e,name:"longclick",x:e.clientX,y:e.clientY,dx:0,dy:0}))},st))},Ve=e=>{if(e.movementX===0&&e.movementY===0)return;let n=e.clientX-d.lastX,t=e.clientY-d.lastY;if(!d.isMoving)if(d.isLongclick)k(d.activeElement,{event:e,name:"longclick-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});else switch(d.button){case 0:k(d.activeElement,{event:e,name:"left-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 1:k(d.activeElement,{event:e,name:"middle-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break;case 2:k(d.activeElement,{event:e,name:"right-click-drag-start",x:e.clientX,y:e.clientY,dx:0,dy:0});break}if(d.isMoving=!0,d.lastX=e.clientX,d.lastY=e.clientY,d.isLongclick)k(d.activeElement,{event:e,name:"longclick-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});else switch(d.button){case 0:k(d.activeElement,{event:e,name:"left-click-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});break;case 1:k(d.activeElement,{event:e,name:"middle-click-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});break;case 2:k(d.activeElement,{event:e,name:"right-click-dragging",x:e.clientX,y:e.clientY,dx:n,dy:t});break}},We=e=>{if(window.removeEventListener("mousemove",Ve),window.removeEventListener("mouseup",We),d.lastMouseupTime=Date.now(),d.isMoving)if(d.isMoving=!1,d.isLongclick)d.isLongclick=!1,k(d.activeElement,{event:e,name:"longclick-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});else switch(d.button){case 0:k(d.activeElement,{event:e,name:"left-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break;case 1:k(d.activeElement,{event:e,name:"middle-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break;case 2:k(d.activeElement,{event:e,name:"right-click-drag-end",x:d.lastX,y:d.lastY,dx:0,dy:0});break}else d.isLongclick||(e.button===2?k(d.activeElement,{event:e,name:"right-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):e.button===1?k(d.activeElement,{event:e,name:"middle-click",x:e.clientX,y:e.clientY,dx:0,dy:0}):(d.consecutiveClicks===0&&k(d.activeElement,{event:e,name:"left-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),d.consecutiveClicks++,window.setTimeout(()=>{d.consecutiveClicks>1&&k(d.activeElement,{event:e,name:"double-click",x:e.clientX,y:e.clientY,dx:0,dy:0}),d.consecutiveClicks=0},Wt)));d.isLongclick&&k(d.activeElement,{event:e,name:"longclick-release",x:e.clientX,y:e.clientY,dx:0,dy:0}),d.isLongclick=!1},bt=e=>{if(e.touches.length>1,document.activeElement!==e.target){if(e.touches.length>1){if(e.touches[0].identifier===s.identifier)return;s.isPinching=!0}window.addEventListener("touchmove",Fe,{passive:!1}),window.addEventListener("touchend",Ee),window.addEventListener("touchcancel",Ee),s.identifier=e.touches[0].identifier,s.x=e.touches[0].clientX,s.y=e.touches[0].clientY,s.activeElement=e.target,window.setTimeout(()=>{s.isPinching||s.isDragging||Date.now()-s.lastTouchendTime>=it&&(s.isDragging=!1,s.isPinching=!1,s.hypotenuse=null,s.isLongpressed=!0,k(s.activeElement,{event:e,name:"longpress",x:s.x,y:s.y,dx:0,dy:0}))},it)}},Fe=e=>{if(s.isDragging){let n=s.x,t=s.y;s.x=e.touches[0].clientX,s.y=e.touches[0].clientY;let i=s.x-n,o=s.y-t;s.isLongpressed?k(s.activeElement,{event:e,name:"longpress-dragging",x:s.x,y:s.y,dx:i,dy:o,force:e.touches[0].force}):k(s.activeElement,{event:e,name:"touch-dragging",x:s.x,y:s.y,dx:i,dy:o,force:e.touches[0].force});return}else if(!s.isLongpressed&&(s.isPinching||e.touches.length>1)){s.x=e.touches[0].clientX,s.y=e.touches[0].clientY;let n={x:e.touches[1].clientX,y:e.touches[1].clientY},t={x:(s.x+n.x)/2,y:(s.y+n.y)/2},i=Math.hypot(s.x-n.x,s.y-n.y);s.hypotenuse===null&&(s.hypotenuse=i,s.lastCenterX=t.x,s.lastCenterY=t.y,k(s.activeElement,{event:e,name:"pinch-start",x:t.x,y:t.y,dx:0,dy:0})),s.isPinching=!0;let o=i/s.hypotenuse,l=t.x-s.lastCenterX,c=t.y-s.lastCenterY;k(s.activeElement,{event:e,name:"pinching",x:t.x,y:t.y,zoom:o,dx:l,dy:c}),s.hypotenuse=i,s.lastCenterX=t.x,s.lastCenterY=t.y;return}else s.isDragging=!0,s.isLongpressed?(k(s.activeElement,{event:e,name:"longpress-drag-start",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force}),s.x=e.touches[0].clientX,s.y=e.touches[0].clientY,k(s.activeElement,{event:e,name:"longpress-dragging",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force})):(k(s.activeElement,{event:e,name:"touch-drag-start",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force}),s.x=e.touches[0].clientX,s.y=e.touches[0].clientY,k(s.activeElement,{event:e,name:"touch-dragging",x:s.x,y:s.y,dx:0,dy:0,force:e.touches[0].force}))},Ee=e=>{s.isDragging&&e.touches.length>0&&e.touches[0].identifier===s.identifier||(s.lastTouchendTime=Date.now(),window.removeEventListener("touchmove",Fe),window.removeEventListener("touchend",Ee),window.removeEventListener("touchcancel",Ee),s.isDragging?(s.isDragging=!1,s.isLongpressed?(s.isLongpressed=!1,k(s.activeElement,{event:e,name:"longpress-drag-end",x:s.x,y:s.y,dx:0,dy:0})):k(s.activeElement,{event:e,name:"touch-drag-end",x:s.x,y:s.y,dx:0,dy:0})):s.isPinching?(s.isPinching=!1,s.hypotenuse=null,k(s.activeElement,{event:e,name:"pinch-end",x:s.lastCenterX,y:s.lastCenterY,dx:0,dy:0})):s.isLongpressed||(s.consecutiveTaps===0&&k(s.activeElement,{event:e,name:"tap",x:s.x,y:s.y,dx:0,dy:0}),s.consecutiveTaps++,window.setTimeout(()=>{s.consecutiveTaps>1&&k(s.activeElement,{event:e,name:"double-tap",x:s.x,y:s.y,dx:0,dy:0}),s.consecutiveTaps=0},Vt)),s.isLongpressed&&k(s.activeElement,{event:e,name:"longpress-release",x:s.x,y:s.y,dx:0,dy:0}),s.isLongpressed=!1)};function Ut(...e){for(let n of e)ge.findIndex(t=>t===n)===-1&&(ge.length==0&&(window.addEventListener("blur",ht),window.addEventListener("focus",gt)),ge.push(n),n.addEventListener("touchstart",bt,{passive:!1}),n.addEventListener("mousedown",yt,{passive:!1}),n.addEventListener("contextmenu",mt,{passive:!1}),n.addEventListener("wheel",vt,{passive:!1}))}function zt(...e){const n=t=>{t.removeEventListener("touchstart",bt),t.removeEventListener("mousedown",yt),t.removeEventListener("contextmenu",mt),t.removeEventListener("wheel",vt)};if(e.length==0){for(let t of ge)n(t);ge=[]}else for(let t of e){let i=ge.findIndex(o=>o===t);i!==-1&&(n(t),ge.splice(i,1))}ge.length==0&&(window.removeEventListener("blur",ht),window.removeEventListener("focus",gt))}function jt(e){let n,t,i,o,l="LOG";return{c(){n=R("div"),t=R("canvas"),i=ne(),o=R("div"),o.textContent=l,this.h()},l(c){n=B(c,"DIV",{class:!0});var r=F(n);t=B(r,"CANVAS",{id:!0,class:!0}),F(t).forEach(X),i=ie(r),o=B(r,"DIV",{class:!0,"data-svelte-h":!0}),Pe(o)!=="svelte-rtly9t"&&(o.textContent=l),r.forEach(X),this.h()},h(){H(t,"id","canvas"),H(t,"class","svelte-wjp7u3"),j(t,"disabled",e[0]),H(o,"class","log svelte-wjp7u3"),H(n,"class","canvas-container svelte-wjp7u3"),j(n,"hide",e[1])},m(c,r){fe(c,n,r),Y(n,t),e[12](t),Y(n,i),Y(n,o),e[13](o)},p(c,r){r[0]&1&&j(t,"disabled",c[0]),r[0]&2&&j(n,"hide",c[1])},i:be,o:be,d(c){c&&X(n),e[12](null),e[13](null)}}}const Gt=2;function lt(e){return{x:Ke(e.x),y:Ke(e.y)}}function Ke(e){return Number(e.toFixed(Gt))}function Kt(e,n,t){let i,o;ue(e,de,h=>t(25,o=h));let{radius:l=3}=n,{smoothness:c=2}=n,{stroke:r=5}=n,{pressureScaler:g=5}=n,{color:_="#000000"}=n,{disabled:v=!1}=n,{hide:E=!1}=n,{tabID:C=""}=n;function V(){y.clearRect(0,0,b,w),N=[]}function U(){if(N.length!=0){t(3,L.innerHTML="Undo",L),N.pop(),y.clearRect(0,0,b,w);for(let h=0;h<N.length;h++)ee(N[h])}}let m,y,u={x:0,y:0},f=0,w=0,b=0,I,x=!1,L,z,P,N=[];function $(){m&&(Ut(m),window.addEventListener("keydown",J))}function K(){m&&(zt(m),window.removeEventListener("keydown",J))}const q=(h,O,G,a)=>{var p=G-h,T=a-O;return Math.sqrt(p*p+T*T)},Q=(h,O=300)=>{let G;return(...a)=>{clearTimeout(G),G=setTimeout(()=>{h.apply(void 0,a)},O)}};function ae(h,O){let G=m.getBoundingClientRect();return{x:(h-G.left)*I,y:(O-G.top)*I}}function re(){if(!m)return;ve(),I=window.devicePixelRatio;let h=m.getBoundingClientRect();w=h.height*I,b=h.width*I,t(2,m.width=b,m),t(2,m.height=w,m);for(let O=0;O<N.length;O++)ee(N[O])}function ee(h){y.lineWidth=h.lineWidths[0],y.lineCap="round",y.strokeStyle=h.color,y.beginPath(),y.moveTo(h.points[0].x,h.points[0].y),y.stroke();for(let O=0;O<h.points.length;O++)y.lineWidth=h.lineWidths[O],y.quadraticCurveTo(h.points[O].x,h.points[O].y,h.ctrlPoints[O].x,h.ctrlPoints[O].y),y.stroke(),y.beginPath(),y.moveTo(h.ctrlPoints[O].x,h.ctrlPoints[O].y)}function S(){o[C]&&Me(de,o[C].paths=N,o)}function D(){o[C]&&(N=o[C].paths,re())}function M(h,O,G){x=!0,u=ae(h,O),G!==void 0&&G>0?f=Math.log(G+1)*g*i:f=i,y.lineWidth=f,y.lineCap="round",y.strokeStyle=_,y.beginPath(),y.moveTo(u.x,u.y),y.stroke(),z={points:[],ctrlPoints:[],lineWidths:[],color:_}}function Z(h,O,G){if(!x)return;let a=ae(h,O);if(l>0){if(q(a.x,a.y,u.x,u.y)<=l)return;let A=Math.sqrt(a.x*a.x+a.y*a.y-2*a.x*u.x+u.x*u.x-2*a.y*u.y+u.y*u.y);if(a={x:a.x+l*((u.x-a.x)/A),y:a.y+l*((u.y-a.y)/A)},q(u.x,u.y,a.x,a.y)<=c)return}let p=(u.x+a.x)/2,T=(u.y+a.y)/2;G!==void 0&&G>0&&(f=Math.log(G+1)*g*i*.2+f*.8),y.lineWidth=f,y.quadraticCurveTo(u.x,u.y,p,T),y.stroke(),y.beginPath(),y.moveTo(p,T),z.points.push(lt(u)),z.ctrlPoints.push(lt({x:p,y:T})),z.lineWidths.push(Ke(f)),u=a}function ve(){x&&(N.push(z),S()),x=!1}const J=function(h){h.ctrlKey&&h.key=="z"&&(U(),S()),h.preventDefault()};Qe(()=>{y=m.getContext("2d"),y.imageSmoothingEnabled=!1,m.addEventListener("gesture",h=>{switch(h.detail.name){case"left-click-drag-start":case"touch-drag-start":M(h.detail.x,h.detail.y,h.detail.force);break;case"left-click-dragging":case"touch-dragging":h.detail.force>0&&t(3,L.innerHTML=h.detail.force,L),Z(h.detail.x,h.detail.y,h.detail.force);break;case"left-click-drag-end":case"touch-drag-end":ve();break}}),P=new ResizeObserver(Q(re,0)),P.observe(m),D(),v?K():$()}),xt(()=>{P&&P.disconnect(),K()});function pe(h){he[h?"unshift":"push"](()=>{m=h,t(2,m)})}function we(h){he[h?"unshift":"push"](()=>{L=h,t(3,L)})}return e.$$set=h=>{"radius"in h&&t(4,l=h.radius),"smoothness"in h&&t(5,c=h.smoothness),"stroke"in h&&t(6,r=h.stroke),"pressureScaler"in h&&t(7,g=h.pressureScaler),"color"in h&&t(8,_=h.color),"disabled"in h&&t(0,v=h.disabled),"hide"in h&&t(1,E=h.hide),"tabID"in h&&t(9,C=h.tabID)},e.$$.update=()=>{e.$$.dirty[0]&64&&(i=Math.max(r,1)),e.$$.dirty[0]&1&&(v?K():$())},[v,E,m,L,l,c,r,g,_,C,V,U,pe,we]}class Qt extends Ae{constructor(n){super(),Re(this,n,Kt,jt,He,{radius:4,smoothness:5,stroke:6,pressureScaler:7,color:8,disabled:0,hide:1,tabID:9,clear:10,undo:11},null,[-1,-1])}get clear(){return this.$$.ctx[10]}get undo(){return this.$$.ctx[11]}}function rt(e,n,t){const i=e.slice();return i[4]=n[t],i}function at(e,n,t){const i=e.slice();return i[4]=n[t],i}function Zt(e){let n,t;return n=new Yt({}),{c(){Te(n.$$.fragment)},l(i){Le(n.$$.fragment,i)},m(i,o){De(n,i,o),t=!0},p:be,i(i){t||(se(n.$$.fragment,i),t=!0)},o(i){le(n.$$.fragment,i),t=!1},d(i){Ce(n,i)}}}function Jt(e){let n,t,i,o,l,c=[],r=new Map,g,_,v=[],E=new Map,C;t=new Rt({props:{refreshClicked:It.loadFromFirestore}});let V=_e(Object.keys(e[3]));const U=u=>u[4];for(let u=0;u<V.length;u+=1){let f=at(e,V,u),w=U(f);r.set(w,c[u]=ot(w,f))}let m=_e(Object.keys(e[3]));const y=u=>u[4];for(let u=0;u<m.length;u+=1){let f=rt(e,m,u),w=y(f);E.set(w,v[u]=ct(w,f))}return{c(){n=R("div"),Te(t.$$.fragment),i=ne(),o=R("div"),l=R("div");for(let u=0;u<c.length;u+=1)c[u].c();g=ne(),_=R("div");for(let u=0;u<v.length;u+=1)v[u].c();this.h()},l(u){n=B(u,"DIV",{class:!0});var f=F(n);Le(t.$$.fragment,f),i=ie(f),o=B(f,"DIV",{class:!0});var w=F(o);l=B(w,"DIV",{class:!0});var b=F(l);for(let x=0;x<c.length;x+=1)c[x].l(b);b.forEach(X),g=ie(w),_=B(w,"DIV",{class:!0});var I=F(_);for(let x=0;x<v.length;x+=1)v[x].l(I);I.forEach(X),w.forEach(X),f.forEach(X),this.h()},h(){H(l,"class","editor-container svelte-1w5t1su"),H(_,"class","drawing-container svelte-1w5t1su"),j(_,"disabled",e[0].activeTool!=="pencil"),H(o,"class","canvas-container svelte-1w5t1su"),H(n,"class","page-container svelte-1w5t1su")},m(u,f){fe(u,n,f),De(t,n,null),Y(n,i),Y(n,o),Y(o,l);for(let w=0;w<c.length;w+=1)c[w]&&c[w].m(l,null);Y(o,g),Y(o,_);for(let w=0;w<v.length;w+=1)v[w]&&v[w].m(_,null);C=!0},p(u,f){f&10&&(V=_e(Object.keys(u[3])),Oe(),c=ze(c,f,U,1,u,V,r,l,je,ot,null,at),Ne()),f&11&&(m=_e(Object.keys(u[3])),Oe(),v=ze(v,f,y,1,u,m,E,_,je,ct,null,rt),Ne()),(!C||f&1)&&j(_,"disabled",u[0].activeTool!=="pencil")},i(u){if(!C){se(t.$$.fragment,u);for(let f=0;f<V.length;f+=1)se(c[f]);for(let f=0;f<m.length;f+=1)se(v[f]);C=!0}},o(u){le(t.$$.fragment,u);for(let f=0;f<c.length;f+=1)le(c[f]);for(let f=0;f<v.length;f+=1)le(v[f]);C=!1},d(u){u&&X(n),Ce(t);for(let f=0;f<c.length;f+=1)c[f].d();for(let f=0;f<v.length;f+=1)v[f].d()}}}function ot(e,n){let t,i,o;return i=new Nt({props:{disabled:n[4]!==n[1],tabID:n[4]}}),{key:e,first:null,c(){t=xe(),Te(i.$$.fragment),this.h()},l(l){t=xe(),Le(i.$$.fragment,l),this.h()},h(){this.first=t},m(l,c){fe(l,t,c),De(i,l,c),o=!0},p(l,c){n=l;const r={};c&10&&(r.disabled=n[4]!==n[1]),c&8&&(r.tabID=n[4]),i.$set(r)},i(l){o||(se(i.$$.fragment,l),o=!0)},o(l){le(i.$$.fragment,l),o=!1},d(l){l&&X(t),Ce(i,l)}}}function ct(e,n){let t,i,o;return i=new Qt({props:{color:sn,stroke:en,radius:tn,smoothness:nn,tabID:n[4],hide:n[4]!==n[1],disabled:n[4]!==n[1]||n[0].activeTool!=="pencil"}}),{key:e,first:null,c(){t=xe(),Te(i.$$.fragment),this.h()},l(l){t=xe(),Le(i.$$.fragment,l),this.h()},h(){this.first=t},m(l,c){fe(l,t,c),De(i,l,c),o=!0},p(l,c){n=l;const r={};c&8&&(r.tabID=n[4]),c&10&&(r.hide=n[4]!==n[1]),c&11&&(r.disabled=n[4]!==n[1]||n[0].activeTool!=="pencil"),i.$set(r)},i(l){o||(se(i.$$.fragment,l),o=!0)},o(l){le(i.$$.fragment,l),o=!1},d(l){l&&X(t),Ce(i,l)}}}function $t(e){let n,t,i,o;const l=[Jt,Zt],c=[];function r(g,_){return g[2].currentUser&&!g[2].isLoading?0:1}return n=r(e),t=c[n]=l[n](e),{c(){t.c(),i=xe()},l(g){t.l(g),i=xe()},m(g,_){c[n].m(g,_),fe(g,i,_),o=!0},p(g,[_]){let v=n;n=r(g),n===v?c[n].p(g,_):(Oe(),le(c[v],1,1,()=>{c[v]=null}),Ne(),t=c[n],t?t.p(g,_):(t=c[n]=l[n](g),t.c()),se(t,1),t.m(i.parentNode,i))},i(g){o||(se(t),o=!0)},o(g){le(t),o=!1},d(g){g&&X(i),c[n].d(g)}}}let en=10,tn=3,nn=2,sn="rgba(253, 221, 77, 0.2)";function ln(e,n,t){let i,o,l,c;return ue(e,Ge,r=>t(0,o=r)),ue(e,ut,r=>t(2,l=r)),ue(e,de,r=>t(3,c=r)),e.$$.update=()=>{e.$$.dirty&1&&t(1,i=o.order[o.activeIndex])},[o,i,l,c]}class hn extends Ae{constructor(n){super(),Re(this,n,ln,$t,He,{})}}export{hn as component};
