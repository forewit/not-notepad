import{s as A,u as J,v as N,w as W,x as B,c as b,n as R,o as Y,a as V}from"../chunks/scheduler.uUNFeN3d.js";import{S as L,i as M,H as Z,s as j,D as ee,h as F,j as H,a as I,t as C,g as m,e as w,c as y,v as te,w as $,A as v,p as G,E as se,q as K,k as T,r as Q,u as X,d as x}from"../chunks/index.Bn23-NmW.js";import{a as S,b as ae,d as O,c as U,g as re,s as ne,f as oe}from"../chunks/firebaseStore.IpKJEeDt.js";import{t as q,a as P}from"../chunks/tabsStore.Dd0WpvX_.js";import{s as D,a as z}from"../chunks/settingsStore.DE--jHh7.js";import{g as ie}from"../chunks/entry.-EmmxIl6.js";import{b as E}from"../chunks/paths.DMQUgJWY.js";import{t as le}from"../chunks/themes.BTx5Q4mv.js";const ue=!0,ce="always",Ce=Object.freeze(Object.defineProperty({__proto__:null,prerender:ue,trailingSlash:ce},Symbol.toStringTag,{value:"Module"}));function fe(n){let e,r,a;const o=n[3].default,s=J(o,n,n[2],null);return{c(){e=new Z(!1),r=j(),s&&s.c(),this.h()},l(t){e=ee(t,!1),r=F(t),s&&s.l(t),this.h()},h(){e.a=r},m(t,c){e.m(n[0],t,c),H(t,r,c),s&&s.m(t,c),a=!0},p(t,[c]){(!a||c&1)&&e.p(t[0]),s&&s.p&&(!a||c&4)&&N(s,o,t,t[2],a?B(o,t[2],c,null):W(t[2]),null)},i(t){a||(I(s,t),a=!0)},o(t){C(s,t),a=!1},d(t){t&&(e.d(),m(r)),s&&s.d(t)}}}function me(n,e,r){let a,o;b(n,D,l=>r(1,o=l));let{$$slots:s={},$$scope:t}=e;function c(l){const i=le.find(f=>f.name===l);return i?`<style>
    :root {
    --bg: ${i.bg};
    --bg-alt: ${i.bgAlt};
    --main: ${i.main};
    --caret: ${i.caret};
    --error: ${i.error};
    --sub: ${i.sub};
    --text: ${i.text};
    }
    </style>`:""}return n.$$set=l=>{"$$scope"in l&&r(2,t=l.$$scope)},n.$$.update=()=>{n.$$.dirty&2&&r(0,a=c(o.theme))},[a,o,t,s]}class de extends L{constructor(e){super(),M(this,e,me,fe,A,{})}}function pe(n){let e,r=`<span class="status-icon svelte-1mx6eh7" style="-webkit-mask: url(${E}/images/svg/double-checkmark.svg) no-repeat center / contain; mask: url(${E}/images/svg/double-checkmark.svg) no-repeat center / contain;"></span>`;return{c(){e=w("div"),e.innerHTML=r,this.h()},l(a){e=y(a,"DIV",{class:!0,"data-svelte-h":!0}),te(e)!=="svelte-jbp3id"&&(e.innerHTML=r),this.h()},h(){$(e,"class","status svelte-1mx6eh7"),v(e,"saving",n[0].savingStatus==="saving"),v(e,"saved",n[0].savingStatus==="saved"),v(e,"error",n[0].savingStatus==="error")},m(a,o){H(a,e,o)},p(a,[o]){o&1&&v(e,"saving",a[0].savingStatus==="saving"),o&1&&v(e,"saved",a[0].savingStatus==="saved"),o&1&&v(e,"error",a[0].savingStatus==="error")},i:R,o:R,d(a){a&&m(e)}}}function he(n,e,r){let a;return b(n,S,o=>r(0,a=o)),[a]}class ge extends L{constructor(e){super(),M(this,e,he,pe,A,{})}}function _e(n){let e,r,a,o,s,t;const c=n[2].default,l=J(c,n,n[3],null);return s=new ge({}),{c(){e=w("div"),r=w("div"),l&&l.c(),a=j(),o=w("div"),G(s.$$.fragment),this.h()},l(i){e=y(i,"DIV",{class:!0});var f=x(e);r=y(f,"DIV",{class:!0});var h=x(r);l&&l.l(h),a=F(h),o=y(h,"DIV",{class:!0});var p=x(o);K(s.$$.fragment,p),p.forEach(m),h.forEach(m),f.forEach(m),this.h()},h(){$(o,"class","sync-status svelte-14x3dky"),$(r,"class","content svelte-14x3dky"),$(e,"class","container svelte-14x3dky")},m(i,f){H(i,e,f),T(e,r),l&&l.m(r,null),T(r,a),T(r,o),Q(s,o,null),t=!0},p(i,f){l&&l.p&&(!t||f&8)&&N(l,c,i,i[3],t?B(c,i[3],f,null):W(i[3]),null)},i(i){t||(I(l,i),I(s.$$.fragment,i),t=!0)},o(i){C(l,i),C(s.$$.fragment,i),t=!1},d(i){i&&m(e),l&&l.d(i),X(s)}}}function ve(n){let e,r,a,o;return a=new de({props:{$$slots:{default:[_e]},$$scope:{ctx:n}}}),{c(){e=w("meta"),r=j(),G(a.$$.fragment),this.h()},l(s){const t=se("svelte-1xk05yi",document.head);e=y(t,"META",{name:!0,content:!0}),t.forEach(m),r=F(s),K(a.$$.fragment,s),this.h()},h(){$(e,"name","viewport"),$(e,"content","width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover")},m(s,t){T(document.head,e),H(s,r,t),Q(a,s,t),o=!0},p(s,[t]){const c={};t&8&&(c.$$scope={dirty:t,ctx:s}),a.$set(c)},i(s){o||(I(a.$$.fragment,s),o=!0)},o(s){C(a.$$.fragment,s),o=!1},d(s){s&&m(r),m(e),X(a,s)}}}function be(n,e,r){let a,o,s,t;b(n,D,u=>r(5,a=u)),b(n,z,u=>r(6,o=u)),b(n,S,u=>r(1,s=u)),b(n,q,u=>r(7,t=u));let{$$slots:c={},$$scope:l}=e,i=!0;function f(){if(i)return;const u=t.tabs.map(d=>JSON.stringify(d));S.update(d=>({...d,data:{activeIndex:t.activeIndex,tabs:u,settings:a}})),oe.publish()}q.subscribe(()=>{f()}),D.subscribe(f);function h(u){u.length!==0&&u.forEach(d=>{try{P.newTabFromString(d)}catch(k){console.warn("Failed to parse tab!",d,k);return}})}let p=!1;return Y(()=>{ae.onAuthStateChanged(async u=>{if(!u){S.update(_=>({..._,isLoading:!1,currentUser:u})),r(0,p=!0);return}const d=O(U,"users",u.uid),k=await re(d);let g={tabs:[],activeIndex:0,settings:{theme:"Canvas",spellCheck:!0}};if(k.exists())console.log("Fetching firestore user doc..."),g=k.data();else{console.log("Creating firestore user doc...");const _=O(U,"users",u.uid);await ne(_,g,{merge:!0})}h(g.tabs),P.setActiveIndex(g.activeIndex),V(D,a=g.settings,a),S.update(_=>({..._,isLoading:!1,currentUser:u,data:g})),r(0,p=!0),i=!1})}),n.$$set=u=>{"$$scope"in u&&r(3,l=u.$$scope)},n.$$.update=()=>{n.$$.dirty&3&&!s.currentUser&&p&&(V(z,o=window.location.pathname.slice(E.length),o),ie(E+"/login"))},[p,s,c,l]}class Ee extends L{constructor(e){super(),M(this,e,be,ve,A,{})}}export{Ee as component,Ce as universal};
