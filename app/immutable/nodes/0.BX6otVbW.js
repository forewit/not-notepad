import{s as j,v as G,w as J,x as K,y as N,c as _,o as Q,n as z,a as x,d as se}from"../chunks/scheduler.CIGC0wka.js";import{S as L,i as M,H as ae,s as R,D as ne,h as q,j as D,a as E,t as T,g as d,e as $,c as S,v as re,w as p,A as b,p as X,E as oe,q as Y,k as P,r as Z,u as ee,d as O}from"../chunks/index.Dl2TOe6M.js";import{s as y,a as v,c as ie,d as U,e as V,g as le,h as ce,b as F,f as ue}from"../chunks/firebaseStore.B3uC_gyM.js";import{t as me,a as A,m as W}from"../chunks/tabsStore.DqP4h8Qm.js";import{b as C,g as de}from"../chunks/entry.Ddy_nTT5.js";import{t as B}from"../chunks/themes.BTx5Q4mv.js";const fe=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,pe=!0,he="always",Ae=Object.freeze(Object.defineProperty({__proto__:null,prerender:pe,trailingSlash:he},Symbol.toStringTag,{value:"Module"}));function ge(r){let e,o,s;const a=r[3].default,i=G(a,r,r[2],null);return{c(){e=new ae(!1),o=R(),i&&i.c(),this.h()},l(t){e=ne(t,!1),o=q(t),i&&i.l(t),this.h()},h(){e.a=o},m(t,n){e.m(r[0],t,n),D(t,o,n),i&&i.m(t,n),s=!0},p(t,[n]){(!s||n&1)&&e.p(t[0]),i&&i.p&&(!s||n&4)&&J(i,a,t,t[2],s?N(a,t[2],n,null):K(t[2]),null)},i(t){s||(E(i,t),s=!0)},o(t){T(i,t),s=!1},d(t){t&&(e.d(),d(o)),i&&i.d(t)}}}function be(r,e,o){let s,a;_(r,y,c=>o(1,a=c));let{$$slots:i={},$$scope:t}=e;function n(c){const m=B.find(h=>h.name===c);return m?`<style>
    :root {
    --bg: ${m.bg};
    --bg-alt: ${m.bgAlt};
    --main: ${m.main};
    --caret: ${m.caret};
    --error: ${m.error};
    --sub: ${m.sub};
    --text: ${m.text};
    }
    </style>`:""}function l(){var m;const c=B.find(h=>h.name===a.theme);c&&((m=document.querySelector('meta[name="theme-color"]'))==null||m.setAttribute("content",c.bg))}return Q(()=>{n(a.theme),y.subscribe(l)}),r.$$set=c=>{"$$scope"in c&&o(2,t=c.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&o(0,s=n(a.theme))},[s,a,t,i]}class _e extends L{constructor(e){super(),M(this,e,be,ge,j,{})}}function ve(r){let e,o=`<span class="status-icon svelte-1mx6eh7" style="-webkit-mask: url(${C}/images/svg/double-checkmark.svg) no-repeat center / contain; mask: url(${C}/images/svg/double-checkmark.svg) no-repeat center / contain;"></span>`;return{c(){e=$("div"),e.innerHTML=o,this.h()},l(s){e=S(s,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-jbp3id"&&(e.innerHTML=o),this.h()},h(){p(e,"class","status svelte-1mx6eh7"),b(e,"saving",r[0].savingStatus==="saving"),b(e,"saved",r[0].savingStatus==="saved"),b(e,"error",r[0].savingStatus==="error")},m(s,a){D(s,e,a)},p(s,[a]){a&1&&b(e,"saving",s[0].savingStatus==="saving"),a&1&&b(e,"saved",s[0].savingStatus==="saved"),a&1&&b(e,"error",s[0].savingStatus==="error")},i:z,o:z,d(s){s&&d(e)}}}function ye(r,e,o){let s;return _(r,v,a=>o(0,s=a)),[s]}class $e extends L{constructor(e){super(),M(this,e,ye,ve,j,{})}}const{document:H}=fe;function Se(r){let e,o,s,a,i;const t=r[3].default,n=G(t,r,r[5],null);return a=new $e({}),{c(){e=$("div"),n&&n.c(),o=R(),s=$("div"),X(a.$$.fragment),this.h()},l(l){e=S(l,"DIV",{class:!0});var c=O(e);n&&n.l(c),o=q(c),s=S(c,"DIV",{class:!0});var m=O(s);Y(a.$$.fragment,m),m.forEach(d),c.forEach(d),this.h()},h(){p(s,"class","sync-status svelte-j4k8tx"),p(e,"class","layout-container svelte-j4k8tx")},m(l,c){D(l,e,c),n&&n.m(e,null),P(e,o),P(e,s),Z(a,s,null),r[4](e),i=!0},p(l,c){n&&n.p&&(!i||c&32)&&J(n,t,l,l[5],i?N(t,l[5],c,null):K(l[5]),null)},i(l){i||(E(n,l),E(a.$$.fragment,l),i=!0)},o(l){T(n,l),T(a.$$.fragment,l),i=!1},d(l){l&&d(e),n&&n.d(l),ee(a),r[4](null)}}}function we(r){let e,o,s,a,i;return a=new _e({props:{$$slots:{default:[Se]},$$scope:{ctx:r}}}),{c(){e=$("meta"),o=$("meta"),s=R(),X(a.$$.fragment),this.h()},l(t){const n=oe("svelte-17tnzz8",H.head);e=S(n,"META",{name:!0,content:!0}),o=S(n,"META",{name:!0,content:!0}),n.forEach(d),s=q(t),Y(a.$$.fragment,t),this.h()},h(){p(e,"name","viewport"),p(e,"content","width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover"),p(o,"name","theme-color"),p(o,"content","var(--bg)")},m(t,n){P(H.head,e),P(H.head,o),D(t,s,n),Z(a,t,n),i=!0},p(t,[n]){const l={};n&33&&(l.$$scope={dirty:n,ctx:t}),a.$set(l)},i(t){i||(E(a.$$.fragment,t),i=!0)},o(t){T(a.$$.fragment,t),i=!1},d(t){t&&d(s),d(e),d(o),ee(a,t)}}}function ke(){switch(screen.orientation.type){case"portrait-primary":document.documentElement.style.setProperty("--safe-area-top","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-primary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-secondary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","env(safe-area-inset-right)");break}}function Ee(r,e,o){let s,a,i,t;_(r,y,u=>o(7,s=u)),_(r,W,u=>o(8,a=u)),_(r,F,u=>o(9,i=u)),_(r,v,u=>o(2,t=u));let{$$slots:n={},$$scope:l}=e,c=!0,m;function h(){if(c)return;const u=A.packTabs(),I={activeIndex:a.activeIndex,order:a.order,settings:s,tabs:u};v.update(k=>({...k,data:I})),ue.publish()}me.subscribe(h),y.subscribe(h);let w=!1;Q(()=>{screen.orientation.addEventListener("change",ke),ie.onAuthStateChanged(async u=>{if(!u){v.update(g=>({...g,isLoading:!1,currentUser:u})),o(1,w=!0);return}const I=U(V,"users",u.uid),k=await le(I);let f={tabs:{},activeIndex:0,order:[],settings:{theme:"Canvas",spellCheck:!0}};if(k.exists())console.log("Fetching firestore user doc..."),f=k.data();else{console.log("Creating firestore user doc...");const g=U(V,"users",u.uid);await ce(g,f,{merge:!0})}A.loadPackedTabs(f.tabs),x(W,a.order=f.order,a),A.setActiveIndex(f.activeIndex),x(y,s=f.settings,s),v.update(g=>({...g,isLoading:!1,currentUser:u,data:f})),o(1,w=!0),c=!1})});function te(u){se[u?"unshift":"push"](()=>{m=u,o(0,m)})}return r.$$set=u=>{"$$scope"in u&&o(5,l=u.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&!t.currentUser&&w&&(x(F,i=window.location.pathname.slice(C.length),i),de(C+"/login"))},[m,w,t,n,te,l]}class He extends L{constructor(e){super(),M(this,e,Ee,we,j,{})}}export{He as component,Ae as universal};
