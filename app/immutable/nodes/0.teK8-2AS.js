import{s as x,v as B,w as G,x as K,y as Q,c as g,o as X,n as F,a as R,d as ne}from"../chunks/scheduler.CIGC0wka.js";import{S as A,i as H,H as re,s as L,D as oe,h as M,j,a as T,t as P,g as p,e as w,c as E,v as ie,w as b,A as v,p as Y,E as le,q as Z,k as C,r as ee,u as te,d as q}from"../chunks/index.Dl2TOe6M.js";import{s as $,a as S,c as ce,d as z,e as U,g as ue,h as me,b as V,f as fe}from"../chunks/firebaseStore.DymASJVF.js";import{t as J,a as N,m as de}from"../chunks/tabsStore.DzwIpWC-.js";import{g as pe}from"../chunks/entry.BoOMoW1k.js";import{b as D}from"../chunks/paths.DmhvC_Ez.js";import{t as W}from"../chunks/themes.BTx5Q4mv.js";const he=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,ge=!0,be="always",Le=Object.freeze(Object.defineProperty({__proto__:null,prerender:ge,trailingSlash:be},Symbol.toStringTag,{value:"Module"}));function _e(r){let e,o,s;const a=r[3].default,i=B(a,r,r[2],null);return{c(){e=new re(!1),o=L(),i&&i.c(),this.h()},l(t){e=oe(t,!1),o=M(t),i&&i.l(t),this.h()},h(){e.a=o},m(t,n){e.m(r[0],t,n),j(t,o,n),i&&i.m(t,n),s=!0},p(t,[n]){(!s||n&1)&&e.p(t[0]),i&&i.p&&(!s||n&4)&&G(i,a,t,t[2],s?Q(a,t[2],n,null):K(t[2]),null)},i(t){s||(T(i,t),s=!0)},o(t){P(i,t),s=!1},d(t){t&&(e.d(),p(o)),i&&i.d(t)}}}function ve(r,e,o){let s,a;g(r,$,u=>o(1,a=u));let{$$slots:i={},$$scope:t}=e;function n(u){const m=W.find(h=>h.name===u);return m?`<style>
    :root {
    --bg: ${m.bg};
    --bg-alt: ${m.bgAlt};
    --main: ${m.main};
    --caret: ${m.caret};
    --error: ${m.error};
    --sub: ${m.sub};
    --text: ${m.text};
    }
    </style>`:""}function c(){var m;const u=W.find(h=>h.name===a.theme);u&&((m=document.querySelector('meta[name="theme-color"]'))==null||m.setAttribute("content",u.bg))}return X(()=>{n(a.theme),$.subscribe(c)}),r.$$set=u=>{"$$scope"in u&&o(2,t=u.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&o(0,s=n(a.theme))},[s,a,t,i]}class ye extends A{constructor(e){super(),H(this,e,ve,_e,x,{})}}function Se(r){let e,o=`<span class="status-icon svelte-1mx6eh7" style="-webkit-mask: url(${D}/images/svg/double-checkmark.svg) no-repeat center / contain; mask: url(${D}/images/svg/double-checkmark.svg) no-repeat center / contain;"></span>`;return{c(){e=w("div"),e.innerHTML=o,this.h()},l(s){e=E(s,"DIV",{class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-jbp3id"&&(e.innerHTML=o),this.h()},h(){b(e,"class","status svelte-1mx6eh7"),v(e,"saving",r[0].savingStatus==="saving"),v(e,"saved",r[0].savingStatus==="saved"),v(e,"error",r[0].savingStatus==="error")},m(s,a){j(s,e,a)},p(s,[a]){a&1&&v(e,"saving",s[0].savingStatus==="saving"),a&1&&v(e,"saved",s[0].savingStatus==="saved"),a&1&&v(e,"error",s[0].savingStatus==="error")},i:F,o:F,d(s){s&&p(e)}}}function $e(r,e,o){let s;return g(r,S,a=>o(0,s=a)),[s]}class we extends A{constructor(e){super(),H(this,e,$e,Se,x,{})}}const{document:I}=he;function Ee(r){let e,o,s,a,i;const t=r[3].default,n=B(t,r,r[5],null);return a=new we({}),{c(){e=w("div"),n&&n.c(),o=L(),s=w("div"),Y(a.$$.fragment),this.h()},l(c){e=E(c,"DIV",{class:!0});var u=q(e);n&&n.l(u),o=M(u),s=E(u,"DIV",{class:!0});var m=q(s);Z(a.$$.fragment,m),m.forEach(p),u.forEach(p),this.h()},h(){b(s,"class","sync-status svelte-j4k8tx"),b(e,"class","layout-container svelte-j4k8tx")},m(c,u){j(c,e,u),n&&n.m(e,null),C(e,o),C(e,s),ee(a,s,null),r[4](e),i=!0},p(c,u){n&&n.p&&(!i||u&32)&&G(n,t,c,c[5],i?Q(t,c[5],u,null):K(c[5]),null)},i(c){i||(T(n,c),T(a.$$.fragment,c),i=!0)},o(c){P(n,c),P(a.$$.fragment,c),i=!1},d(c){c&&p(e),n&&n.d(c),te(a),r[4](null)}}}function ke(r){let e,o,s,a,i;return a=new ye({props:{$$slots:{default:[Ee]},$$scope:{ctx:r}}}),{c(){e=w("meta"),o=w("meta"),s=L(),Y(a.$$.fragment),this.h()},l(t){const n=le("svelte-17tnzz8",I.head);e=E(n,"META",{name:!0,content:!0}),o=E(n,"META",{name:!0,content:!0}),n.forEach(p),s=M(t),Z(a.$$.fragment,t),this.h()},h(){b(e,"name","viewport"),b(e,"content","width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover"),b(o,"name","theme-color"),b(o,"content","var(--bg)")},m(t,n){C(I.head,e),C(I.head,o),j(t,s,n),ee(a,t,n),i=!0},p(t,[n]){const c={};n&33&&(c.$$scope={dirty:n,ctx:t}),a.$set(c)},i(t){i||(T(a.$$.fragment,t),i=!0)},o(t){P(a.$$.fragment,t),i=!1},d(t){t&&p(s),p(e),p(o),te(a,t)}}}function Te(){switch(screen.orientation.type){case"portrait-primary":document.documentElement.style.setProperty("--safe-area-top","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-primary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--safe-area-right","0px");break;case"landscape-secondary":document.documentElement.style.setProperty("--safe-area-top","0px"),document.documentElement.style.setProperty("--safe-area-left","0px"),document.documentElement.style.setProperty("--safe-area-right","env(safe-area-inset-right)");break}}function Pe(r,e,o){let s,a,i,t,n;g(r,$,l=>o(7,s=l)),g(r,V,l=>o(8,a=l)),g(r,S,l=>o(2,i=l)),g(r,de,l=>o(9,t=l)),g(r,J,l=>o(10,n=l));let{$$slots:c={},$$scope:u}=e,m=!0,h;function O(){if(m)return;let l={};Object.entries(n).forEach(([d,f])=>{l[d]=JSON.stringify(f)});const y={activeIndex:t.activeIndex,settings:s,tabs:l};S.update(d=>({...d,data:y})),fe.publish()}J.subscribe(O),$.subscribe(O);function se(l){l&&Object.entries(l).forEach(([y,d])=>{try{N.newTabFromString(y,d)}catch(f){console.warn("Failed to parse tab!",d,f);return}})}let k=!1;X(()=>{screen.orientation.addEventListener("change",Te),ce.onAuthStateChanged(async l=>{if(!l){S.update(_=>({..._,isLoading:!1,currentUser:l})),o(1,k=!0);return}const y=z(U,"users",l.uid),d=await ue(y);let f={tabs:{},activeIndex:0,settings:{theme:"Canvas",spellCheck:!0}};if(d.exists())console.log("Fetching firestore user doc..."),f=d.data();else{console.log("Creating firestore user doc...");const _=z(U,"users",l.uid);await me(_,f,{merge:!0})}se(f.tabs),N.setActiveIndex(f.activeIndex),R($,s=f.settings,s),S.update(_=>({..._,isLoading:!1,currentUser:l,data:f})),o(1,k=!0),m=!1})});function ae(l){ne[l?"unshift":"push"](()=>{h=l,o(0,h)})}return r.$$set=l=>{"$$scope"in l&&o(5,u=l.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&!i.currentUser&&k&&(R(V,a=window.location.pathname.slice(D.length),a),pe(D+"/login"))},[h,k,i,c,ae,u]}class Me extends A{constructor(e){super(),H(this,e,Pe,ke,x,{})}}export{Me as component,Le as universal};
